// dynvis v0.9.5 Copyright 2025 Bundesamt für Statistik
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).dynvis=t.dynvis||{})}(this,(function(t){"use strict";class e{constructor(t,e){this._colors=t,this._empty=e||{default:"#8e8e8e",light:"#8e8e8e",dark:"#8e8e8e"}}color(t,e=null){return this._colors[t]}colors(t="default"){return this._colors.map((e=>e[t]||e.default))}get(t){const e=this._colors.filter((e=>e.name===t));return e&&e[0]||null}empty(){return this._empty}}const i=new e([{name:"blue",default:"#728cd7",light:"#728cd7",dark:"#728cd7"},{name:"violet",default:"#4f25d2",light:"#4f25d2",dark:"#4f25d2"},{name:"pink",default:"#cd35ab",light:"#cd35ab",dark:"#cd35ab"},{name:"orange",default:"#f56a00",light:"#f56a00",dark:"#f56a00"},{name:"red",default:"#dc0018",light:"#dc0018",dark:"#dc0018"},{name:"green",default:"#399D50",light:"#399D50",dark:"#399D50"},{name:"purple",default:"#a332de",light:"#a332de",dark:"#a332de"},{name:"teal",default:"#00a2b9",light:"#00a2b9",dark:"#00a2b9"},{name:"grey",default:"#8e8e8e",light:"#8e8e8e",dark:"#8e8e8e"}]),s=new e([{name:"de",default:"#dc0018",light:"#dc0018",dark:"#dc0018"},{name:"fr",default:"#728cd7",light:"#728cd7",dark:"#728cd7"},{name:"it",default:"#399d50",light:"#399d50",dark:"#399d50"},{name:"rm",default:"#f56a00",light:"#f56a00",dark:"#f56a00"},{name:"en",default:"#cd35ab",light:"#cd35ab",dark:"#cd35ab"}]),n=new e([{name:"catholic",default:"#728cd7",light:"#728cd7",dark:"#728cd7"},{name:"protestant",default:"#dc0018",light:"#dc0018",dark:"#dc0018"},{name:"ohterChristianCommunities",default:"#00a2b9",light:"#00a2b9",dark:"#00a2b9"},{name:"jewish",default:"#4f25d2",light:"#4f25d2",dark:"#4f25d2"},{name:"muslim",default:"#399d50",light:"#399d50",dark:"#399d50"},{name:"otherChurches",default:"#cd35ab",light:"#cd35ab",dark:"#cd35ab"},{name:"noAffiliation",default:"#f56a00",light:"#f56a00",dark:"#f56a00"},{name:"unknown",default:"#8e8e8e",light:"#8e8e8e",dark:"#8e8e8e"}]),r=new e([{name:"primary",default:"#399d50",light:"#399d50",dark:"#399d50"},{name:"secondary",default:"#728cd7",light:"#728cd7",dark:"#728cd7"},{name:"tertiary",default:"#dc0018",light:"#dc0018",dark:"#dc0018"}]),a=new e([{name:"primaryLevel",default:"#00a2b9",light:"#00a2b9",dark:"#00a2b9"},{name:"secondaryLevel",default:"#cd35ab",light:"#cd35ab",dark:"#cd35ab"},{name:"tertiaryLevel",default:"#4f25d2",light:"#4f25d2",dark:"#4f25d2"}]),l=new e([{name:"yes",default:"#399d50",light:"#399d50",dark:"#399d50"},{name:"no",default:"#a332de",light:"#a332de",dark:"#a332de"}]),o=new e([{name:"men",default:"#399d50",light:"#399d50",dark:"#399d50"},{name:"women",default:"#a332de",light:"#a332de",dark:"#a332de"}]),h=new e([{name:"swiss",default:"#dc0018",light:"#dc0018",dark:"#dc0018"},{name:"abroad",default:"#728cd7",light:"#728cd7",dark:"#728cd7"},{name:"eu",default:"#2b408c",light:"#2b408c",dark:"#2b408c"}]),c=h,d=new e([{name:"import",default:"#728cd7",light:"#728cd7",dark:"#728cd7"},{name:"export",default:"#dc0018",light:"#dc0018",dark:"#dc0018"}]),u=["#C2CEF2","#9AADE4","#728CD7","#4B62B3","#2B408C","#142966"],_=new e([{default:u[2]}]),p=new e([{default:u[1]},{default:u[3]}]),f=new e([{default:u[0]},{default:u[2]},{default:u[4]}]),g=new e([{default:u[1]},{default:u[2]},{default:u[3]},{default:u[4]}]),y=new e([{default:u[0]},{default:u[1]},{default:u[2]},{default:u[3]},{default:u[4]}]),m=new e([{default:u[0]},{default:u[1]},{default:u[2]},{default:u[3]},{default:u[4]},{default:u[5]}]),x=new e([{default:u[0]},{default:"#9EB0E6"},{default:"#7A92DA"},{default:"#5D76BE"},{default:"#445CA0"},{default:"#2C4282"},{default:u[5]}]),v=new e([{default:u[0]},{default:"#A3B4E7"},{default:"#849BDD"},{default:"#6982CC"},{default:"#526BB1"},{default:"#3D5497"},{default:"#283E7E"},{default:u[5]}]),b=new e([{default:u[0]},{default:"#A7B8E9"},{default:"#8CA1E0"},{default:"#718BD6"},{default:"#5D76BE"},{default:"#4A62A7"},{default:"#384F91"},{default:"#263C7B"},{default:u[5]}]),w=new e([{default:u[0]},{default:"#AABAEA"},{default:"#92A6E2"},{default:"#7A92DA"},{default:"#6680C9"},{default:"#556DB4"},{default:"#445CA0"},{default:"#344A8C"},{default:"#243979"},{default:u[5]}]);var A="http://www.w3.org/1999/xhtml",k={svg:"http://www.w3.org/2000/svg",xhtml:A,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function L(t){var e=t+="",i=e.indexOf(":");return i>=0&&"xmlns"!==(e=t.slice(0,i))&&(t=t.slice(i+1)),k.hasOwnProperty(e)?{space:k[e],local:t}:t}function S(t){return function(){var e=this.ownerDocument,i=this.namespaceURI;return i===A&&e.documentElement.namespaceURI===A?e.createElement(t):e.createElementNS(i,t)}}function C(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function R(t){var e=L(t);return(e.local?C:S)(e)}function T(){}function M(t){return null==t?T:function(){return this.querySelector(t)}}function z(t){return null==t?[]:Array.isArray(t)?t:Array.from(t)}function D(){return[]}function $(t){return null==t?D:function(){return this.querySelectorAll(t)}}function V(t){return function(){return this.matches(t)}}function W(t){return function(e){return e.matches(t)}}var E=Array.prototype.find;function B(){return this.firstElementChild}var I=Array.prototype.filter;function j(){return Array.from(this.children)}function H(t){return new Array(t.length)}function N(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function O(t,e,i,s,n,r){for(var a,l=0,o=e.length,h=r.length;l<h;++l)(a=e[l])?(a.__data__=r[l],s[l]=a):i[l]=new N(t,r[l]);for(;l<o;++l)(a=e[l])&&(n[l]=a)}function F(t,e,i,s,n,r,a){var l,o,h,c=new Map,d=e.length,u=r.length,_=new Array(d);for(l=0;l<d;++l)(o=e[l])&&(_[l]=h=a.call(o,o.__data__,l,e)+"",c.has(h)?n[l]=o:c.set(h,o));for(l=0;l<u;++l)h=a.call(t,r[l],l,r)+"",(o=c.get(h))?(s[l]=o,o.__data__=r[l],c.delete(h)):i[l]=new N(t,r[l]);for(l=0;l<d;++l)(o=e[l])&&c.get(_[l])===o&&(n[l]=o)}function P(t){return t.__data__}function U(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function q(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function X(t){return function(){this.removeAttribute(t)}}function Y(t){return function(){this.removeAttributeNS(t.space,t.local)}}function G(t,e){return function(){this.setAttribute(t,e)}}function Z(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function K(t,e){return function(){var i=e.apply(this,arguments);null==i?this.removeAttribute(t):this.setAttribute(t,i)}}function J(t,e){return function(){var i=e.apply(this,arguments);null==i?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,i)}}function Q(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function tt(t){return function(){this.style.removeProperty(t)}}function et(t,e,i){return function(){this.style.setProperty(t,e,i)}}function it(t,e,i){return function(){var s=e.apply(this,arguments);null==s?this.style.removeProperty(t):this.style.setProperty(t,s,i)}}function st(t,e){return t.style.getPropertyValue(e)||Q(t).getComputedStyle(t,null).getPropertyValue(e)}function nt(t){return function(){delete this[t]}}function rt(t,e){return function(){this[t]=e}}function at(t,e){return function(){var i=e.apply(this,arguments);null==i?delete this[t]:this[t]=i}}function lt(t){return t.trim().split(/^|\s+/)}function ot(t){return t.classList||new ht(t)}function ht(t){this._node=t,this._names=lt(t.getAttribute("class")||"")}function ct(t,e){for(var i=ot(t),s=-1,n=e.length;++s<n;)i.add(e[s])}function dt(t,e){for(var i=ot(t),s=-1,n=e.length;++s<n;)i.remove(e[s])}function ut(t){return function(){ct(this,t)}}function _t(t){return function(){dt(this,t)}}function pt(t,e){return function(){(e.apply(this,arguments)?ct:dt)(this,t)}}function ft(){this.textContent=""}function gt(t){return function(){this.textContent=t}}function yt(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function mt(){this.innerHTML=""}function xt(t){return function(){this.innerHTML=t}}function vt(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function bt(){this.nextSibling&&this.parentNode.appendChild(this)}function wt(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function At(){return null}function kt(){var t=this.parentNode;t&&t.removeChild(this)}function Lt(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function St(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Ct(t){return function(){var e=this.__on;if(e){for(var i,s=0,n=-1,r=e.length;s<r;++s)i=e[s],t.type&&i.type!==t.type||i.name!==t.name?e[++n]=i:this.removeEventListener(i.type,i.listener,i.options);++n?e.length=n:delete this.__on}}}function Rt(t,e,i){return function(){var s,n=this.__on,r=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(n)for(var a=0,l=n.length;a<l;++a)if((s=n[a]).type===t.type&&s.name===t.name)return this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=r,s.options=i),void(s.value=e);this.addEventListener(t.type,r,i),s={type:t.type,name:t.name,value:e,listener:r,options:i},n?n.push(s):this.__on=[s]}}function Tt(t,e,i){var s=Q(t),n=s.CustomEvent;"function"==typeof n?n=new n(e,i):(n=s.document.createEvent("Event"),i?(n.initEvent(e,i.bubbles,i.cancelable),n.detail=i.detail):n.initEvent(e,!1,!1)),t.dispatchEvent(n)}function Mt(t,e){return function(){return Tt(this,t,e)}}function zt(t,e){return function(){return Tt(this,t,e.apply(this,arguments))}}N.prototype={constructor:N,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},ht.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var Dt=[null];function $t(t,e){this._groups=t,this._parents=e}function Vt(){return new $t([[document.documentElement]],Dt)}function Wt(t){return"string"==typeof t?new $t([[document.querySelector(t)]],[document.documentElement]):new $t([[t]],Dt)}function Et(t,e){if(t=function(t){let e;for(;e=t.sourceEvent;)t=e;return t}(t),void 0===e&&(e=t.currentTarget),e){var i=e.ownerSVGElement||e;if(i.createSVGPoint){var s=i.createSVGPoint();return s.x=t.clientX,s.y=t.clientY,[(s=s.matrixTransform(e.getScreenCTM().inverse())).x,s.y]}if(e.getBoundingClientRect){var n=e.getBoundingClientRect();return[t.clientX-n.left-e.clientLeft,t.clientY-n.top-e.clientTop]}}return[t.pageX,t.pageY]}function Bt(t,e,i){let s=t;return 0===s.length&&(s=i||"untitled"),"."===s.substr(0,1)&&(s=`f_${s}`),s.substr(s.length-4,4)!==`.${e}`&&(s+=`.${e}`),s}function It(t,e){const i=document.createElement("a");i.href=t,i.download=e,document.body.appendChild(i),i.click(),document.body.removeChild(i)}function jt(t,e,i=0){return!(e.left-i>=t.right||e.right<=t.left-i||e.top-i>=t.bottom||e.bottom<=t.top-i)}function Ht(t){const e=t.match(/translate\((\d+)\s+(\d+)\)/);return e?[parseInt(e[1],10),parseInt(e[2],10)]:null}function Nt(t,e){const i=window.getComputedStyle(t);Array.from(i).forEach((function(t){e.style.setProperty(t,i.getPropertyValue(t),i.getPropertyPriority(t))}));for(let i=0;i<t.children.length;i++)Nt(t.children[i],e.children[i])}function Ot(t,e,i){const s=t.cloneNode(!0);s.setAttribute("xmlns","http://www.w3.org/2000/svg"),s.setAttribute("xmlns:xlinkg","http://www.w3.org/1999/xlink");let n=0;for(let e=0;e<s.children.length;e++){const i=s.children[e];if("g"===i.tagName)if(i.classList.contains("dv_noprint"))n+=t.children[e].getBoundingClientRect().height;else{const t=Ht(i.getAttribute("transform"));if(null!==t){const e=t[0],s=t[1]-n;i.setAttribute("transform",`translate(${e} ${s})`)}}}const r=parseInt(s.getAttribute("height"));s.setAttribute("height",""+(r-n)),s.querySelectorAll(".dv_noprint").forEach((t=>{t.remove()}));const a=function(){const t=document.styleSheets,e={text:"",sheets:[]},i=[];for(let s=0;s<t.length;s++)try{const n=t[s].rules||t[s].cssRules;for(let t=0;t<n.length;t++)n[t].selectorText&&(e.text+=n[t].cssText,i.push(n[t].selectorText))}catch(i){e.sheets.push(t[s].href),console.log(`Impossible to read stylesheet ${t[s].href}`)}return{css:e,selectors:i}}(),l=a.css,o=[...new Set(a.selectors.map((t=>function(t){return t.match(/[.]([_a-zA-Z0-9]+)/g)||[]}(t))).flat().map((t=>t.substr(1))).filter((t=>t.indexOf("_")>=0)))],h=document.createElement("style");h.innerText=l.text,s.insertBefore(h,s.firstChild);let c="";l.sheets.forEach((t=>{c+=`<link xmlns="http://www.w3.org/1999/xhtml" rel="stylesheet" href="${t}" type="text/css"/>`})),s.innerHTML=c+s.innerHTML;const d=document.createElement("div");d.append(s),d.style.position="absolute",d.style.top="-99999px",document.body.append(d);let u=function(t,e){let i=t;return e.forEach((t=>{i=i.replaceAll(t,t.replaceAll("_",""))})),i}(d.innerHTML,o);u=u.replaceAll("&nbsp;"," ");const _=new Blob([u],{type:"data:application/octet-stream"}),p=URL.createObjectURL(_);It(p,Bt(e,"svg",i||"graphics.svg")),document.body.removeChild(d),URL.revokeObjectURL(p)}function Ft(t,e,i,s){if(void 0===document.createElement("canvas").toBlob)return void alert("PNG export is not supported by your browser");const n=s&&s.padding||10,r=t.cloneNode(!0);r.setAttribute("xmlns","http://www.w3.org/2000/svg"),r.setAttribute("xmlns:xlinkg","http://www.w3.org/1999/xlink"),Nt(t,r);let a=0;for(let e=0;e<r.children.length;e++){const i=r.children[e];if("g"===i.tagName)if(i.classList.contains("dv_noprint"))a+=t.children[e].getBoundingClientRect().height;else{const t=Ht(i.getAttribute("transform"));if(null!==t){const e=t[0],s=t[1]-a;i.setAttribute("transform",`translate(${e} ${s})`)}}}const l=parseInt(r.getAttribute("height"))-a;r.setAttribute("height",`${l}`),r.querySelectorAll(".dv_noprint").forEach((t=>{t.remove()}));const o=document.createElement("div");o.append(r),o.style.position="absolute",o.style.top="-9999px",document.body.append(o);let h=o.innerHTML;h=h.replaceAll("&nbsp;"," ");const c=new Blob([h],{type:"image/svg+xml;charset=utf8"}),d=URL.createObjectURL(c),u=r.getBoundingClientRect(),_=document.createElement("canvas");_.width=u.width+2*n,_.height=l+2*n,_.style.visibility="hidden";const p=_.getContext("2d");p.clearRect(0,0,u.width+2*n,l+2*n),p.fillStyle="white",p.fillRect(0,0,u.width+20,l+20);const f=new Image;f.onload=function(){p.drawImage(f,n,n);It(_.toDataURL("image/png"),Bt(e,"png",i||"graphics.png")),URL.revokeObjectURL(d),document.body.removeChild(o)},f.src=d,o.append(f)}$t.prototype=Vt.prototype={constructor:$t,select:function(t){"function"!=typeof t&&(t=M(t));for(var e=this._groups,i=e.length,s=new Array(i),n=0;n<i;++n)for(var r,a,l=e[n],o=l.length,h=s[n]=new Array(o),c=0;c<o;++c)(r=l[c])&&(a=t.call(r,r.__data__,c,l))&&("__data__"in r&&(a.__data__=r.__data__),h[c]=a);return new $t(s,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){return z(t.apply(this,arguments))}}(t):$(t);for(var e=this._groups,i=e.length,s=[],n=[],r=0;r<i;++r)for(var a,l=e[r],o=l.length,h=0;h<o;++h)(a=l[h])&&(s.push(t.call(a,a.__data__,h,l)),n.push(a));return new $t(s,n)},selectChild:function(t){return this.select(null==t?B:function(t){return function(){return E.call(this.children,t)}}("function"==typeof t?t:W(t)))},selectChildren:function(t){return this.selectAll(null==t?j:function(t){return function(){return I.call(this.children,t)}}("function"==typeof t?t:W(t)))},filter:function(t){"function"!=typeof t&&(t=V(t));for(var e=this._groups,i=e.length,s=new Array(i),n=0;n<i;++n)for(var r,a=e[n],l=a.length,o=s[n]=[],h=0;h<l;++h)(r=a[h])&&t.call(r,r.__data__,h,a)&&o.push(r);return new $t(s,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,P);var i=e?F:O,s=this._parents,n=this._groups;"function"!=typeof t&&(t=function(t){return function(){return t}}(t));for(var r=n.length,a=new Array(r),l=new Array(r),o=new Array(r),h=0;h<r;++h){var c=s[h],d=n[h],u=d.length,_=U(t.call(c,c&&c.__data__,h,s)),p=_.length,f=l[h]=new Array(p),g=a[h]=new Array(p);i(c,d,f,g,o[h]=new Array(u),_,e);for(var y,m,x=0,v=0;x<p;++x)if(y=f[x]){for(x>=v&&(v=x+1);!(m=g[v])&&++v<p;);y._next=m||null}}return(a=new $t(a,s))._enter=l,a._exit=o,a},enter:function(){return new $t(this._enter||this._groups.map(H),this._parents)},exit:function(){return new $t(this._exit||this._groups.map(H),this._parents)},join:function(t,e,i){var s=this.enter(),n=this,r=this.exit();return"function"==typeof t?(s=t(s))&&(s=s.selection()):s=s.append(t+""),null!=e&&(n=e(n))&&(n=n.selection()),null==i?r.remove():i(r),s&&n?s.merge(n).order():n},merge:function(t){for(var e=t.selection?t.selection():t,i=this._groups,s=e._groups,n=i.length,r=s.length,a=Math.min(n,r),l=new Array(n),o=0;o<a;++o)for(var h,c=i[o],d=s[o],u=c.length,_=l[o]=new Array(u),p=0;p<u;++p)(h=c[p]||d[p])&&(_[p]=h);for(;o<n;++o)l[o]=i[o];return new $t(l,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,i=t.length;++e<i;)for(var s,n=t[e],r=n.length-1,a=n[r];--r>=0;)(s=n[r])&&(a&&4^s.compareDocumentPosition(a)&&a.parentNode.insertBefore(s,a),a=s);return this},sort:function(t){function e(e,i){return e&&i?t(e.__data__,i.__data__):!e-!i}t||(t=q);for(var i=this._groups,s=i.length,n=new Array(s),r=0;r<s;++r){for(var a,l=i[r],o=l.length,h=n[r]=new Array(o),c=0;c<o;++c)(a=l[c])&&(h[c]=a);h.sort(e)}return new $t(n,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var s=t[e],n=0,r=s.length;n<r;++n){var a=s[n];if(a)return a}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,i=0,s=e.length;i<s;++i)for(var n,r=e[i],a=0,l=r.length;a<l;++a)(n=r[a])&&t.call(n,n.__data__,a,r);return this},attr:function(t,e){var i=L(t);if(arguments.length<2){var s=this.node();return i.local?s.getAttributeNS(i.space,i.local):s.getAttribute(i)}return this.each((null==e?i.local?Y:X:"function"==typeof e?i.local?J:K:i.local?Z:G)(i,e))},style:function(t,e,i){return arguments.length>1?this.each((null==e?tt:"function"==typeof e?it:et)(t,e,null==i?"":i)):st(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?nt:"function"==typeof e?at:rt)(t,e)):this.node()[t]},classed:function(t,e){var i=lt(t+"");if(arguments.length<2){for(var s=ot(this.node()),n=-1,r=i.length;++n<r;)if(!s.contains(i[n]))return!1;return!0}return this.each(("function"==typeof e?pt:e?ut:_t)(i,e))},text:function(t){return arguments.length?this.each(null==t?ft:("function"==typeof t?yt:gt)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?mt:("function"==typeof t?vt:xt)(t)):this.node().innerHTML},raise:function(){return this.each(bt)},lower:function(){return this.each(wt)},append:function(t){var e="function"==typeof t?t:R(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var i="function"==typeof t?t:R(t),s=null==e?At:"function"==typeof e?e:M(e);return this.select((function(){return this.insertBefore(i.apply(this,arguments),s.apply(this,arguments)||null)}))},remove:function(){return this.each(kt)},clone:function(t){return this.select(t?St:Lt)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,i){var s,n,r=function(t){return t.trim().split(/^|\s+/).map((function(t){var e="",i=t.indexOf(".");return i>=0&&(e=t.slice(i+1),t=t.slice(0,i)),{type:t,name:e}}))}(t+""),a=r.length;if(!(arguments.length<2)){for(l=e?Rt:Ct,s=0;s<a;++s)this.each(l(r[s],e,i));return this}var l=this.node().__on;if(l)for(var o,h=0,c=l.length;h<c;++h)for(s=0,o=l[h];s<a;++s)if((n=r[s]).type===o.type&&n.name===o.name)return o.value},dispatch:function(t,e){return this.each(("function"==typeof e?zt:Mt)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var s,n=t[e],r=0,a=n.length;r<a;++r)(s=n[r])&&(yield s)}};const Pt=[];for(let t=0;t<256;++t)Pt.push((t+256).toString(16).slice(1));let Ut;const qt=new Uint8Array(16);var Xt={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Yt(t,e,i){if(Xt.randomUUID&&!e&&!t)return Xt.randomUUID();const s=(t=t||{}).random??t.rng?.()??function(){if(!Ut){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Ut=crypto.getRandomValues.bind(crypto)}return Ut(qt)}();if(s.length<16)throw new Error("Random bytes length must be >= 16");if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e){if((i=i||0)<0||i+16>e.length)throw new RangeError(`UUID byte range ${i}:${i+15} is out of buffer bounds`);for(let t=0;t<16;++t)e[i+t]=s[t];return e}return function(t,e=0){return(Pt[t[e+0]]+Pt[t[e+1]]+Pt[t[e+2]]+Pt[t[e+3]]+"-"+Pt[t[e+4]]+Pt[t[e+5]]+"-"+Pt[t[e+6]]+Pt[t[e+7]]+"-"+Pt[t[e+8]]+Pt[t[e+9]]+"-"+Pt[t[e+10]]+Pt[t[e+11]]+Pt[t[e+12]]+Pt[t[e+13]]+Pt[t[e+14]]+Pt[t[e+15]]).toLowerCase()}(s)}function Gt(t,e){return t<e[0]?e[0]:t>e[1]?e[1]:t}function Zt(t,e){for(let i=t.length-1;i>=0;i--)if(e(t[i]))return t[i];return null}class Kt{constructor(){this.nodes={}}update(t){const e=t.length;for(let i=0;i<e;i++)this.insert(t[i],i>0?t[i-1]:null,i<e-1?t[i+1]:null)}insert(t,e,i){if(this.has(t))return;let s=this.nodes[e]||null,n=this.nodes[i]||null;null!==s&&null===n&&(n=s.after),null===s&&null!==n&&(s=n.before);const r=new Jt(t,s,n);s&&(s.after=r),n&&(n.before=r),this.nodes[t]=r}nodeWithValue(t){return this.nodes[t]}has(t){return void 0!==this.nodes[t]}sequence(){const t=Object.values(this.nodes).filter((t=>null===t.before));if(0===t.length)return[];const e=t[0],i=[e.value];let s=e.after;for(;null!==s;)i.push(s.value),s=s.after;return i}}class Jt{constructor(t,e,i){this.value=t,this.before=e,this.after=i}}function Qt(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function te(t){for(let e=0;e<t.length;e++)if(void 0!==t[e])return t[e]}function ee(t,e){for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(Qt(e[i])?(void 0===t[i]&&(t[i]={}),"object"==typeof t[i]?ee(t[i],e[i]):t[i]=e[i]):t[i]=e[i])}function ie(t,e){const i={};return ee(i,t||{}),ee(i,e||{}),i}class se{defineDefaults(t){for(const[e,i]of Object.entries(t))this[`_${e}`]=i,this[e]=t=>(this[`_${e}`]=t,this)}config(t,e=void 0){if(!this._config)return e;const i=t.split(".");let s=this._config;for(let t=0;t<i.length;t++){if(void 0===s[i[t]])return;s=s[i[t]]}return s}set(t,e,i=!0){if(void 0===e&&"object"==typeof t)return Object.keys(t).forEach((e=>{this.set(e,t[e])})),this;this.props=this.props||{};const s=t.split(".");let n=this.props,r=0;for(;r<s.length;r++)void 0===n[s[r]]&&(n[s[r]]={}),r<s.length-1&&(n=n[s[r]]);const a=s[r-1];return"object"==typeof e&&"object"==typeof n[a]&&i?ee(n[a],e):n[a]=e,this}get(t,e=void 0,i=null,s=null){let n=((t,e)=>{let i=this.props||{};for(let s=0;s<t.length;s++){if(void 0===i[t[s]])return e;i=i[t[s]]}return void 0===i?e:i})(t.split("."),e);return"function"==typeof n&&null!==i&&(n=n(...i)),"object"==typeof n&&s&&void 0!==n.default?Object.prototype.hasOwnProperty.call(n,s)?n[s]:n.default:n}}class ne{constructor(t=null,e=null,i=null,s=null){this.left=t,this.top=e,this.right=i,this.bottom=s}height(){return null===this.top||null===this.bottom?null:this.bottom-this.top}setHeight(t){return null===this.top&&null===this.bottom?(console.error("[Rect] Impossible to set height, top and bottom are null."),this):"number"==typeof this.top?(this.bottom=this.top+t,this):(this.top=this.bottom-t,this)}width(){return null===this.left||null===this.right?null:this.right-this.left}setWidth(t){return null===this.left&&null===this.right?(console.error("[Rect] Impossible to set width, left and right are null."),this):"number"==typeof this.left?(this.right=this.left+t,this):(this.left=this.right-t,this)}centerX(){return this.right-this.width()/2}centerY(){return this.bottom-this.height()/2}}
/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */
var re=Object.prototype.toString,ae=Array.isArray||function(t){return"[object Array]"===re.call(t)};function le(t){return"function"==typeof t}function oe(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function he(t,e){return null!=t&&"object"==typeof t&&e in t}var ce=RegExp.prototype.test;var de=/\S/;function ue(t){return!function(t,e){return ce.call(t,e)}(de,t)}var _e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};var pe=/\s*/,fe=/\s+/,ge=/\s*=/,ye=/\s*\}/,me=/#|\^|\/|>|\{|&|=|!/;function xe(t){this.string=t,this.tail=t,this.pos=0}function ve(t,e){this.view=t,this.cache={".":this.view},this.parent=e}function be(){this.templateCache={_cache:{},set:function(t,e){this._cache[t]=e},get:function(t){return this._cache[t]},clear:function(){this._cache={}}}}xe.prototype.eos=function(){return""===this.tail},xe.prototype.scan=function(t){var e=this.tail.match(t);if(!e||0!==e.index)return"";var i=e[0];return this.tail=this.tail.substring(i.length),this.pos+=i.length,i},xe.prototype.scanUntil=function(t){var e,i=this.tail.search(t);switch(i){case-1:e=this.tail,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,i),this.tail=this.tail.substring(i)}return this.pos+=e.length,e},ve.prototype.push=function(t){return new ve(t,this)},ve.prototype.lookup=function(t){var e,i,s,n=this.cache;if(n.hasOwnProperty(t))e=n[t];else{for(var r,a,l,o=this,h=!1;o;){if(t.indexOf(".")>0)for(r=o.view,a=t.split("."),l=0;null!=r&&l<a.length;)l===a.length-1&&(h=he(r,a[l])||(i=r,s=a[l],null!=i&&"object"!=typeof i&&i.hasOwnProperty&&i.hasOwnProperty(s))),r=r[a[l++]];else r=o.view[t],h=he(o.view,t);if(h){e=r;break}o=o.parent}n[t]=e}return le(e)&&(e=e.call(this.view)),e},be.prototype.clearCache=function(){void 0!==this.templateCache&&this.templateCache.clear()},be.prototype.parse=function(t,e){var i=this.templateCache,s=t+":"+(e||we.tags).join(":"),n=void 0!==i,r=n?i.get(s):void 0;return null==r&&(r=function(t,e){if(!t)return[];var i,s,n,r=!1,a=[],l=[],o=[],h=!1,c=!1,d="",u=0;function _(){if(h&&!c)for(;o.length;)delete l[o.pop()];else o=[];h=!1,c=!1}function p(t){if("string"==typeof t&&(t=t.split(fe,2)),!ae(t)||2!==t.length)throw new Error("Invalid tags: "+t);i=new RegExp(oe(t[0])+"\\s*"),s=new RegExp("\\s*"+oe(t[1])),n=new RegExp("\\s*"+oe("}"+t[1]))}p(e||we.tags);for(var f,g,y,m,x,v,b=new xe(t);!b.eos();){if(f=b.pos,y=b.scanUntil(i))for(var w=0,A=y.length;w<A;++w)ue(m=y.charAt(w))?(o.push(l.length),d+=m):(c=!0,r=!0,d+=" "),l.push(["text",m,f,f+1]),f+=1,"\n"===m&&(_(),d="",u=0,r=!1);if(!b.scan(i))break;if(h=!0,g=b.scan(me)||"name",b.scan(pe),"="===g?(y=b.scanUntil(ge),b.scan(ge),b.scanUntil(s)):"{"===g?(y=b.scanUntil(n),b.scan(ye),b.scanUntil(s),g="&"):y=b.scanUntil(s),!b.scan(s))throw new Error("Unclosed tag at "+b.pos);if(x=">"==g?[g,y,f,b.pos,d,u,r]:[g,y,f,b.pos],u++,l.push(x),"#"===g||"^"===g)a.push(x);else if("/"===g){if(!(v=a.pop()))throw new Error('Unopened section "'+y+'" at '+f);if(v[1]!==y)throw new Error('Unclosed section "'+v[1]+'" at '+f)}else"name"===g||"{"===g||"&"===g?c=!0:"="===g&&p(y)}if(_(),v=a.pop())throw new Error('Unclosed section "'+v[1]+'" at '+b.pos);return function(t){for(var e,i=[],s=i,n=[],r=0,a=t.length;r<a;++r)switch((e=t[r])[0]){case"#":case"^":s.push(e),n.push(e),s=e[4]=[];break;case"/":n.pop()[5]=e[2],s=n.length>0?n[n.length-1][4]:i;break;default:s.push(e)}return i}(function(t){for(var e,i,s=[],n=0,r=t.length;n<r;++n)(e=t[n])&&("text"===e[0]&&i&&"text"===i[0]?(i[1]+=e[1],i[3]=e[3]):(s.push(e),i=e));return s}(l))}(t,e),n&&i.set(s,r)),r},be.prototype.render=function(t,e,i,s){var n=this.getConfigTags(s),r=this.parse(t,n),a=e instanceof ve?e:new ve(e,void 0);return this.renderTokens(r,a,i,t,s)},be.prototype.renderTokens=function(t,e,i,s,n){for(var r,a,l,o="",h=0,c=t.length;h<c;++h)l=void 0,"#"===(a=(r=t[h])[0])?l=this.renderSection(r,e,i,s,n):"^"===a?l=this.renderInverted(r,e,i,s,n):">"===a?l=this.renderPartial(r,e,i,n):"&"===a?l=this.unescapedValue(r,e):"name"===a?l=this.escapedValue(r,e,n):"text"===a&&(l=this.rawValue(r)),void 0!==l&&(o+=l);return o},be.prototype.renderSection=function(t,e,i,s,n){var r=this,a="",l=e.lookup(t[1]);if(l){if(ae(l))for(var o=0,h=l.length;o<h;++o)a+=this.renderTokens(t[4],e.push(l[o]),i,s,n);else if("object"==typeof l||"string"==typeof l||"number"==typeof l)a+=this.renderTokens(t[4],e.push(l),i,s,n);else if(le(l)){if("string"!=typeof s)throw new Error("Cannot use higher-order sections without the original template");null!=(l=l.call(e.view,s.slice(t[3],t[5]),(function(t){return r.render(t,e,i,n)})))&&(a+=l)}else a+=this.renderTokens(t[4],e,i,s,n);return a}},be.prototype.renderInverted=function(t,e,i,s,n){var r=e.lookup(t[1]);if(!r||ae(r)&&0===r.length)return this.renderTokens(t[4],e,i,s,n)},be.prototype.indentPartial=function(t,e,i){for(var s=e.replace(/[^ \t]/g,""),n=t.split("\n"),r=0;r<n.length;r++)n[r].length&&(r>0||!i)&&(n[r]=s+n[r]);return n.join("\n")},be.prototype.renderPartial=function(t,e,i,s){if(i){var n=this.getConfigTags(s),r=le(i)?i(t[1]):i[t[1]];if(null!=r){var a=t[6],l=t[5],o=t[4],h=r;0==l&&o&&(h=this.indentPartial(r,o,a));var c=this.parse(h,n);return this.renderTokens(c,e,i,h,s)}}},be.prototype.unescapedValue=function(t,e){var i=e.lookup(t[1]);if(null!=i)return i},be.prototype.escapedValue=function(t,e,i){var s=this.getConfigEscape(i)||we.escape,n=e.lookup(t[1]);if(null!=n)return"number"==typeof n&&s===we.escape?String(n):s(n)},be.prototype.rawValue=function(t){return t[1]},be.prototype.getConfigTags=function(t){return ae(t)?t:t&&"object"==typeof t?t.tags:void 0},be.prototype.getConfigEscape=function(t){return t&&"object"==typeof t&&!ae(t)?t.escape:void 0};var we={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(t){Ae.templateCache=t},get templateCache(){return Ae.templateCache}},Ae=new be;we.clearCache=function(){return Ae.clearCache()},we.parse=function(t,e){return Ae.parse(t,e)},we.render=function(t,e,i,s){if("string"!=typeof t)throw new TypeError('Invalid template! Template should be a "string" but "'+((ae(n=t)?"array":typeof n)+'" was given as the first argument for mustache#render(template, view, partials)'));var n;return Ae.render(t,e,i,s)},we.escape=function(t){return String(t).replace(/[&<>"'`=\/]/g,(function(t){return _e[t]}))},we.Scanner=xe,we.Context=ve,we.Writer=be;const ke={h1:{fontSize:{desktop:32,mobile:24},fontWeight:400,lineHeight:1.5,paragraphSpacingBottom:9},h2:{fontSize:{desktop:24,mobile:18},fontWeight:400,lineHeight:1.5,paragraphSpacingBottom:9},h3:{fontSize:{desktop:18,mobile:16},fontWeight:700,lineHeight:1.5,paragraphSpacingBottom:9},h4:{fontSize:{desktop:14,mobile:12},fontWeight:700,lineHeight:1.5,paragraphSpacingBottom:9},p:{fontSize:{desktop:12,mobile:12},fontWeight:400,lineHeight:1.2,paragraphSpacingBottom:9},p1:{fontSize:{desktop:16,mobile:14},fontWeight:400,lineHeight:1.5,paragraphSpacingBottom:9},p2:{fontSize:{desktop:14,mobile:12},fontWeight:400,lineHeight:1.5,paragraphSpacingBottom:9},p3:{fontSize:{desktop:12,mobile:12},fontWeight:400,lineHeight:1.5,paragraphSpacingBottom:9},meta:{fontSize:{desktop:12,mobile:12},fontWeight:400,lineHeight:1.5,paragraphSpacingBottom:9},metaBold:{fontSize:{desktop:12,mobile:12},fontWeight:700,lineHeight:1.5,paragraphSpacingBottom:9}};function Le(t,e="desktop"){const i=ke[t]||ke.p;return Object.fromEntries(Object.keys(i).map((t=>[t,"object"==typeof i[t]?i[t][e]:i[t]])))}class Se{constructor(t){this._parser=new DOMParser,this._style=[{width:300,fontSize:12,fontStyle:"normal",fontWeight:400,fontFamily:null,fontColor:"#000",linkColor:"#069",lineHeight:1.2,tabStops:[],defaultTabWidth:50,paragraphSpacingBottom:0,textAlign:"left"}],this.baseStyle=t||{},this._style.push(t),this.handleClickOnLink=(t,e)=>!0}style(t){for(let e=this._style.length-1;e>=0;e--){const i=this._style[e][t];if(void 0!==i)return i}return null}escape(t){return new Option(t).innerHTML}render(t,e,i,s,n){this.env=s||this.env,Qt(n)&&this._style.push(n),this._x=0,this._y=0,this._lineNodes=[],this._lines=[this._lineNodes],this._nodeWrapper=e,e.innerHTML="<g></g>",this._node=this._nodeWrapper.querySelector("g"),this._src=`${"function"==typeof t?t(i):t}`,this._src=i?we.render(this._src.trim(),i):this._src.trim(),this._src.startsWith("<text")||(this._src=`<text>${this._src.replace("\\n","<br/>")}</text>`),this._src=this._src.replace(/&(?![a-zA-Z]+;|#[0-9]+;)/g,"&amp;"),this._doc=this._parser.parseFromString(this._src,"text/xml");this._doc.querySelector("parsererror")&&console.error("Error in parsing text:",this._src),this._root=this._doc.firstChild,this._applyNodeStyle(this._root),this._renderNode(this._root);const r=-1*this._node.getBBox().y;this._node.setAttribute("transform",`translate(0 ${r})`),this._alignText(),Qt(n)&&this._style.pop()}_applyNodeStyle(t,e=null){const i=t.getAttributeNames(),s=e?Le(e,this.env):{};i.forEach((e=>{const i=this._getStyleAttribute(e,t);i&&(s[e]=i)})),this._style.push(s)}_getStyleAttribute(t,e){return({width:parseInt,fontSize:parseInt,fontWeight:parseInt,fontFamily:t=>t,fontColor:t=>t,lineHeight:t=>t,tabStops:this._parseTabStops,defaultTabWidth:parseInt,paragraphSpacingBottom:parseInt,textAlign:t=>t,fill:t=>t,stroke:t=>t,strokeWidth:parseFloat,baseLineShift:parseFloat,r:parseInt,w:parseInt,h:parseInt}[t]||(t=>null))(e.getAttribute(t))}_parseTabStops(t){return t.split(",").map((t=>{const e=(/([0-9]+)([clr]*)/.exec(t)||[]).slice(1);return e[0]=parseInt(e[0]),e}))}_lineHeight(t,e=12){return"number"==typeof t?t*e:t.trim().endsWith("px")||t.trim().endsWith("pt")?parseFloat(t):parseFloat(t)*e}_newLine(){this._x=0,this._y+=this._lineHeight(this.style("lineHeight"),this.style("fontSize")),this._lineNodes=[],this._lines.push(this._lineNodes)}_renderNode(t){const e=[];for(let i=0;i<t.childNodes.length;i++){const s=t.childNodes[i],n=this._renderNodeWithName(s);n&&e.push(n)}return e}_renderNodeWithName(t){return({"#text":this._renderTextNode,p:this._renderP,p1:this._renderPWithType("p1"),p2:this._renderPWithType("p2"),p3:this._renderPWithType("p3"),h1:this._renderPWithType("h1"),h2:this._renderPWithType("h2"),h3:this._renderPWithType("h3"),h4:this._renderPWithType("h4"),a:this._renderA,span:this._renderSpan,b:this._renderB,i:this._renderI,br:this._renderBr,tab:this._renderTab,circle:this._renderCircle,rect:this._renderRect}[t.nodeName]||(t=>{console.warn(`[FormattedTextRenderer] Unknown node ${t.nodeName}`)})).bind(this)(t)}_renderTextNode(t){if(0===t.nodeValue.trim().length)return;const e=this._appendTextNode(t.nodeValue),i=e.node().getBBox().width;let s=[e.node()];const n=this.style("width");return this._x+i>n&&(s=this._wrapText(e,t,n)),this._x+=s[s.length-1].getBBox().width,s}_appendTextNode(t){const e=Wt(this._node).append("text").attr("x",this._x).attr("y",this._y).text(t.replace(/(\s+)/g," ")).call((t=>{t.style("font-size",`${this.style("fontSize")}px`),t.style("font-weight",this.style("fontWeight")),t.style("font-family",this.style("fontFamily")),t.style("fill",this.style("fontColor")),t.style("font-style",this.style("fontStyle"))}));return this._pushLineNode(e),e}_wrapText(t,e,i){let s=t;const n=e.nodeValue.split(/[^\S\u00A0]+/).reverse();let r=n.pop(),a=[];const l=[s.node()];for(;void 0!==r;){a.push(r),s.text(a.join(" "));const t=s.node().getComputedTextLength();this._x+t>i&&(a.length>1||this._lineNodes.length>1)&&(a.pop(),s.text(a.join(" ")),a=[r],this._x=0,this._y+=this._lineHeight(this.style("lineHeight"),this.style("fontSize")),this._lineNodes=[],this._lines.push(this._lineNodes),s=this._appendTextNode(r),l.push(s.node())),r=n.pop()}return l}_renderP(t,e=null){this._applyNodeStyle(t,e),this._newLine();const i=this._renderNode(t);return this._y+=this.style("paragraphSpacingBottom"),this._style.pop(),i}_renderPWithType(t){const e=t;return t=>this._renderP(t,e)}_renderA(t){this._applyNodeStyle(t),this._style.push({fontColor:this.style("linkColor")});const e=this._renderNode(t);this._style.pop(),this._style.pop();const i=e.flat(1/0);return i.forEach((e=>{e.style.cursor="pointer",Wt(e).on("mouseenter",(()=>i.forEach((t=>{t.style.textDecoration="underline"})))).on("mouseleave",(()=>i.forEach((t=>{t.style.textDecoration=null})))).on("click",(()=>{if(!1===this.handleClickOnLink(t,this))return;const e=t.getAttribute("href");e&&window.open(e)}))})),e}_renderSpan(t){this._applyNodeStyle(t);const e=this._renderNode(t);return this._style.pop(),e}_renderCircle(t){this._applyNodeStyle(t);const e=this.style("r")||this.style("fontSize")/2,i=Wt(this._node).append("circle").attr("cx",this._x+e).attr("cy",this._y-this.style("fontSize")/2-(this.style("baseLineShift")||0)+1).attr("r",e).style("fill",this.style("fill")||this.style("fontColor")).style("stroke",this.style("stroke")||"none").style("stroke-width",this.style("strokeWidth")||0);return this._pushLineNode(i),this._x+=2*e,this._style.pop(),i}_renderRect(t){this._applyNodeStyle(t);const e=this.style("w")||this.style("fontSize"),i=this.style("h")||this.style("fontSize"),s=Wt(this._node).append("rect").attr("x",this._x).attr("y",this._y-this.style("fontSize")+(this.style("fontSize")-i)-(this.style("baseLineShift")||0)+1).attr("width",e).attr("height",i).style("fill",this.style("fill")||this.style("fontColor")).style("stroke",this.style("stroke")||"none").style("stroke-width",this.style("strokeWidth")||0);return this._pushLineNode(s),this._x+=e,this._style.pop(),s}_renderBr(t){return this._newLine(),null}_renderTab(t){const e=this.style("tabStops");for(let t=0;t<e.length;t++)if(e[t][0]>this._x)return void(this._x=e[t][0]);return this._x=Math.ceil(this._x/this.style("defaultTabWidth"))*this.style("defaultTabWidth"),null}_renderB(t){this._style.push({fontWeight:700});const e=this._renderNode(t);return this._style.pop(),e}_renderI(t){this._style.push({fontStyle:"italic"});const e=this._renderNode(t);return this._style.pop(),e}_pushLineNode(t){t.textAlign=this.style("textAlign"),t.lineWidth=this.style("width"),this._lineNodes.push(t)}_alignText(){this._lines.forEach((t=>{if(0===t.length)return;const e=t[0].textAlign;if("left"===e)return;const i=t[0].node().getBBox().x,s=t[t.length-1].node().getBBox().x+t[t.length-1].node().getBBox().width-i;if(0===s)return;const n=(t[0].lineWidth-s)/("center"===e?2:1);t.forEach((t=>{t.attr("transform",`translate(${n} 0)`)}))}))}}class Ce extends se{constructor(t={},e={}){super(),Object.prototype.hasOwnProperty.call(t,"class")?(this._config=t,this._options=e):(this._config={},this._options=t),this.id="u"+Yt().replace(/-/g,""),this.hasError=!1,this.messageMode=!1,this.messages={default:"An error occurred"},this.maxViewRect=new ne(0,0,400,20),this.viewRect=new ne(0,0,400,20),this._style={margin:{top:0,right:0,bottom:0,left:0},padding:{top:this.get("padding.top",0),right:this.get("padding.right",0),bottom:this.get("padding.bottom",0),left:this.get("padding.left",0)},message:{fillColor:"none",strokeColor:"#ccc",strokeWidth:"1px",font:{size:18,color:"#777",weight:400},lineHeight:"24px",height:100}},this._registered_events={},this._parents=[],Object.keys(this._config).forEach((t=>{this.set(t,this._config[t])}));const i=this.get("events",{});Object.keys(i).forEach((t=>i[t]&&this.on(t,i[t])))}style(t){return this._style=ie(this._style,t),this}showMessage(t,e){this.viewRect.setHeight(this._style.message.height+40),this.viewRect.setWidth(this.maxViewRect.width());const i=e||this.messages[t]||this.messages.default;this._node.innerHTML="",Wt(this._node).append("rect").attr("x",1).attr("y",1).attr("width",this.viewRect.width()-2).attr("height",this._style.message.height||100).style("fill",this._style.message.fillColor||"none").style("stroke",this._style.message.strokeColor||"#ccc").style("stroke-width",this._style.message.strokeWidth||"1px");const s=Wt(this._node).append("g").attr("transform","translate(50 20)").node();new Se({fontSize:this._style.message.font.size||18,fontColor:this._style.message.font.color||"#777",fontWeight:this._style.message.font.weight||400,lineHeight:this._style.message.lineHeight||"24px",textAlign:"center",width:Math.min(this.viewRect.width()-100)}).render(i,s,{},{},{})}setMessageMode(t,e){return this.messageMode=t,this.messages[t]=e,this}on(t,e){return this._registered_events[t]=(this._registered_events[t]||[]).concat([e]),this}off(t,e){return this._registered_events[t]&&(this._registered_events[t]=this._registered_events[t].filter((t=>t!==e))),this}emit(t,e){(this._registered_events[t]||[]).forEach((t=>t(...e||[])))}hasBeenRegistered(t,e){this._parents.push({role:e,parent:t})}_f(...t){const e="function"==typeof t[0]?t[0](...t.slice(1)):t[0],i=this._state&&this._state.ENV||null;return e&&i&&e[i]?e[i]:e}_(...t){return this._f(...t)}}class Re extends Array{append(t,e){return this.push([t,e]),this}get(t){for(let e=0;e<this.length;e++)if(this[e][0]===t)return this[e][1];return null}set(t,e){for(let i=0;i<this.length;i++)if(this[i][0]===t)return void(this[i][1]=e);this.append(t,e)}}class Te{constructor(t){this.config=t}extend(t){return ie(this.config,t)}}const Me=new Te({class:"ContentBox",padding:{top:0,right:0,bottom:0,left:0},dataSource:null,transformer:t=>t,events:{init:null}});class ze extends Ce{constructor(t={},e={}){super(Me.extend(t),e),this._options.style&&this.style(this._options.style),this.datasource=this.get("datasource",null),this._state={},this._initialized=!1,this.stateWillUpdate=(t,e,i)=>t}data(t){return this.datasource=t,this}transformer(t){return this.set("transformer",t)}transformedData(t){return null===this.datasource||null===this.datasource.data?null:this.get("transformer",(t=>t),[this.datasource.data,t,this])}setState(t){console.info("Set state",t),this.emit("setState",[this.stateWillUpdate(t,this._state,this)])}beforeStateWillUpdate(t){return this.stateWillUpdate=t,this}boxHeight(){return this.viewRect.height()+this._style.padding.top+this._style.padding.bottom}boxWidth(){return this.viewRect.width()+this._style.padding.left+this._style.padding.right}init(t,e){this.emit("init",[t,e,this]),this._initialized=!0,this._state=e}prerender(t,e){this._state=e,this._initialized||this.init(t,e),this.datasource&&this.datasource.load(this),this.viewRect=new ne(this.maxViewRect.left||0,this.maxViewRect.top||0,this.maxViewRect.right||(this.maxViewRect.left||0)+300,this.maxViewRect.bottom||(this.maxViewRect.top||0)+10)}render(t,e){}}function De(t){return t.charAt(0).toUpperCase()+t.slice(1)}function $e(t,e){return function(i){i.attr("transform",`translate(${t} ${e})`)}}function Ve(t,e){if(!t)return null;if("string"==typeof t||"number"==typeof t)return t;if(!e)return t.default;const i=e.classList.contains("dv_alt")&&void 0!==t.alt?t.alt:t;return e.classList.contains("dv_selected")||e.classList.contains("dv_select")||e.parentElement.classList.contains("dv_selected")||e.parentElement.classList.contains("dv_select")?te([i.dark,i.selected,t.dark,t.selected]):e.classList.contains("dv_highlight")||e.classList.contains("dv_highlighted")?te([i.highlighted,i.selected,t.highlighted,t.selected]):e.classList.contains("dv_faded")?te([i.light,i.faded,i.default,t.light,t.faded,t.default]):te([i.default,t.default])}function We(t=""){return(t.length>0?t+"-":"")+function(t){if(!t||!/^[0-9a-f]+$/i.test(t))throw new Error("Input must be a valid hexadecimal string");let e="",i=BigInt("0x"+t);const s=BigInt(64);if(i===BigInt(0))return"";for(;i>0;)e="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-."[Number(i%s)]+e,i/=s;return e}(Yt().replaceAll("-",""))}class Ee extends ze{constructor(t,e){super(e),this._text=t||"",this.style({font:{size:14,weight:700,color:"#000"},text:{align:"left",lineHeight:1.2},padding:{bottom:10}}),this._options=e,this.className="dv_text "+(e.className||""),this._vars=null,this.anchors={left:"start",center:"middle",right:"end"}}text(t,e){return this._text=t,this._options=e||this._options,this}vars(t){return this._vars=t,this}_applyOptions(t,e){t.type&&this.style(Le(t.type,e.ENV)),t.style&&this.style(t.style)}init(t,e){Wt(t).append("g").attr("class",this.className),this.emit("init",[t,e,this]),this._initialized=!0}prerender(t,e){if(super.prerender(t,e),!("string"==typeof this._text||!this.datasource||this.datasource&&this.datasource.loaded))return void console.info("Rendering of data-driven box postponed. Datasource not yet ready.");this.emit("prerenderWillStart",[t,e,this]),this._applyOptions(this._options,e);const i=this._style,s=this.datasource?this.transformedData(e):null;this._renderer=this._renderer||new Se({}),ee(this._renderer.baseStyle,{fontSize:this._f(i.fontSize||i.font.size,this,e),fontWeight:this._f(i.fontWeight||i.font.weight,this,e),fontColor:this._f(i.fontColor||i.font.color,this,e),textAlign:this._f(i.textAlign||i.text.align,this,e),lineHeight:this._f(i.lineHeight||i.text.lineHeight,this,e),width:this.viewRect.width()});const n="function"==typeof this._text?this._text(e,s,this):this._text,r="function"==typeof this._vars?this._vars(e,s,this):Object.assign({data:s},e,this._vars);this._renderer.render(n,t.querySelector("g.dv_text"),r,e.ENV);const a=t.querySelector("g.dv_text").getBBox();Wt(t).select("g.dv_text").call($e(this.viewRect.left,this.viewRect.top)),this.viewRect.setHeight(a.height),this.emit("prerenderDidEnd",[t,e,this])}render(t,e){("function"!=typeof this._text||!this.datasource||this.datasource&&this.datasource.loaded)&&(this.emit("renderWillStart",[t,e,this]),super.render(t,e),this.emit("renderDidEnd",[t,e,this]))}}const Be=new Te({class:"DataUploadRect",text:"Drag and drop data file here",padding:{top:0,right:0,bottom:0,left:0},height:50,events:{dataUploaded:null,init:null,prerenderWillStart:null,prerenderDidEnd:null,renderWillStart:null,renderDidEnd:null}});class Ie extends Ce{constructor(t={}){super(Be.extend(t),{})}text(t){return this.set("text",t)}init(t,e){this.emit("init",[t,e,this]),this._initialized=!0,Wt(t).node().parentNode.classList.add("dv_noprint"),Wt(t).append("text").attr("x",12).attr("y",30).text(this.get("text")).style("font-size","12px"),Wt(t).append("rect").attr("class","dv_dropZone").attr("x",1).attr("y",7).attr("rx",7).attr("ry",7),this.rect=Wt(t).select("rect").node(),this.rect.addEventListener("dragstart",this.handleDragStart.bind(this),!1),this.rect.addEventListener("dragenter",this.handleDragEnter.bind(this),!1),this.rect.addEventListener("dragover",this.handleDragOver.bind(this),!1),this.rect.addEventListener("dragleave",this.handleDragLeave.bind(this),!1),this.rect.addEventListener("drop",this.handleDrop.bind(this),!1),this.rect.addEventListener("dragend",this.handleDropEnd.bind(this),!1)}prerender(t,e){this._state=e,this._initialized||this.init(t,e),this.emit("prerenderWillStart",[t,e,this]),this.viewRect.setHeight(this.get("height",50)),this.emit("prerenderDidEnd",[t,e,this])}render(t,e){Wt(t).select("rect.dv_dropZone").attr("width",this.viewRect.width()-14).attr("height",this.viewRect.height()-14)}handleDragStart(t){}handleDragEnter(t){this.stopPropagation(t),this.rect.classList.add("dv_active")}handleDragOver(t){this.stopPropagation(t),this.rect.classList.add("dv_active")}handleDragLeave(t){this.rect.classList.remove("dv_active")}handleDrop(t){this.stopPropagation(t),this.rect.classList.remove("dv_active");const e=t.dataTransfer.files[0],i=e.type.search("json")>=0,s=new FileReader;s.onload=t=>{try{const e=i?JSON.parse(t.target.result):t.target.result;this.emit("dataUploaded",[e])}catch(t){alert("Error reading file.\n"+t.message)}},s.readAsText(e)}handleDropEnd(t){this.rect.classList.remove("dv_active")}eventHasFiles(t){return t.dataTransfer.types.some((t=>"Files"===t))}stopPropagation(t){if(this.eventHasFiles(t))return t.stopPropagation(),t.preventDefault?t.preventDefault():t.returnValue=!1}}function je(){return document.documentElement.getBoundingClientRect().width<window.innerWidth}class He extends Ce{constructor(t,e={}){super(),this.style({minWidth:e.minWidth||200}),this.environment=t=>t.width<=343?"mobile":"desktop",this.state=e.state||{},this.state._&&this.state._.register(this),this._options=e,this._node=t,this._initialized=!1,this._node.innerHTML='\n      <div style="text-align: center; width: 100%; padding: 15px;">\n        <svg width="50" height="50">\n          <circle fill="none" stroke="#ccc" stroke-width="3" cx="25" cy="25" r="20" />\n          <line stroke="#fff" stroke-width="6" x1="0" x2="10" y1="25" y2="25">\n            <animateTransform attributeName="transform" dur="2s" type="rotate" from="0 25 25"\n              to="360 25 25" repeatCount="indefinite" />\n          </line>\n        </svg>\n      </div>\n    ',this.height=null,this._previousHeight=null,this._boxes=new Re,this._dataSources=[],this._vscroll=null,this._defaultConfig=e.defaultConfig||{},this.embedConfig={},this._waitForConfigFn=null,this._waitForConfigDone=!1,this.subscribers={},window.addEventListener("resize",this.handleResize.bind(this)),window.addEventListener("message",this.handleMessage.bind(this)),this.sendMessage("ready",{})}name(t){return this._options.name=t,this}init(){if(this._node.innerHTML="",this._svg=Wt(this._node).append("svg").attr("id",this.id).attr("class","dv_layout").style("display","block").node(),Wt(this._node).attr("role","document graphics-document"),this._options.name||console.warn("[layout.name] Visualization does not have a name. Please provide a name for accessibility purposes."),Wt(this._svg).attr("role","presentation"),this._options.allowDataUpload){const t=(new Ie).text("Drag and drop data file here").on("dataUploaded",this.handleDataUpload.bind(this));this.setBox("dataUploadRect",t)}window.setTimeout((()=>{this.render()}),700),this._initialized=!0}handleResize(){this.emit("sizeDidChange",[this]),this.render()}handleDataUpload(t){if(0===this._dataSources.length)return;const e=this._dataSources[0];e.data=t,e._postprocess(),this.render()}resizeNode(){if(!this._initialized)return;const t=getComputedStyle(this._node);this.width=Math.max(this._style.minWidth,parseInt(t.width)),this.height=parseInt(t.height),Wt("#"+this.id).attr("width",this.width).attr("height",this.height)}then(t,e=2e3){this._waitForConfigFn=t,window.setTimeout(this.checkForConfigDone.bind(this),e)}checkForConfigDone(){!1===this._waitForConfigDone&&(console.warn("Content is not stand-alone, expecting an embed config.\nSwitching to default config."),this._waitForConfigFn(this._defaultConfig,this.state,this))}handleMessage(t){if(window===window.top)return;const e=t.data;if(!e||"object"!=typeof e||!e.type||!e.data)return;const i=e.type||null;if(!i)return;const s=e.data;if("setState"===i)this.handleSetState(s);else this.publish(i,s)}handleSetState(t){const e=t.config||{},i=t.state||{};Object.keys(e).length>0?this.setConfig(e,i):this.setState(i,!1)}sendMessage(t,e){window!==window.top&&window.parent.postMessage({type:t,data:e},"*")}publish(t,e,i){this.subscribers[t]&&this.subscribers[t].forEach((t=>t(e,i)))}subscribe(t,e){this.subscribers[t]||(this.subscribers[t]=[]),this.subscribers[t].push(e)}setBox(t,e){return this._boxes.set(t,e),this.registerBox(e),this}registerBox(t){t.on("dataDidLoad",this.dataDidLoad.bind(this)),t.on("setState",this.setState.bind(this)),t.on("stateDidUpdate",this.stateDidUpdate.bind(this)),t.on("requestResize",this.sizeDidChange.bind(this)),t.hasBeenRegistered(this,"layout")}boxes(){return this._boxes}dataDidLoad(t){this._dataSources.push(t),this.emit("dataDidLoad",[this,this._dataSources]),this.render()}stateDidUpdate(t=!0){this.emit("stateDidUpdate",[this]),t&&this.sendMessage("setState",{state:this.state}),this.render()}sizeDidChange(){this.resizeNode(),this.render()}render(){this._initialized||this.init(),this.resizeNode(),this._options.name&&Wt(this._node).attr("aria-label",this._(this._options.name,this._dataSources,this.state,this)),this._vscroll=null===this._vscroll?je():this._vscroll;let t=this._style.padding.top;this.state.ENV=this.environment(this);for(let e=0;e<this._boxes.length;e++){const i=this._boxes[e][0],s=this._boxes[e][1];document.getElementById(s.id)||Wt("#"+this.id).append("g").attr("id",s.id).attr("class","dv_"+i).append("g"),s.maxViewRect=new ne(0,0,this.width-this._style.padding.right-s._style.padding.right,null),document.getElementById(s.id).setAttribute("transform",`translate(${this._style.padding.left+s._style.padding.left} ${t+s._style.padding.top})`);const n=document.querySelector(`#${s.id} g`);s._node=n;try{s.hasError&&(s.hasError=!1,s.messageMode=null,n.innerHTML="",s._initialized=!1),s.messageMode?s.showMessage(s.messageMode):s.prerender(n,this.state)}catch(t){console.error(`[DV] An error occurred during prerender step for box "${i}":\n`,t),s.showMessage(s.messageMode||"error"),s.hasError=!0}try{s.hasError||s.messageMode?console.warn(`[DV] Skipping render step for box "${i} due to previous error.`):s.render(n,this.state)}catch(t){console.error(`[DV] An error occurred during render step for box "${i}":\n`,t),s.showMessage(s.messageMode||"error"),s.hasError=!0}t+=s.viewRect.height()+s._style.padding.top+s._style.padding.bottom}return this.adjustHeight(),setTimeout((()=>{!1===this._vscroll&&this._vscroll!==je()?(console.info("Vertical scroll bar appeared during rendering. Rendering again."),this._vscroll=je(),this.render()):this._vscroll=je()}),500),this}adjustHeight(){this._previousHeight=this.height,this.height=this._style.padding.top+this._style.padding.bottom;for(let t=0;t<this._boxes.length;t++){const e=this._boxes[t][1];this.height+=e.viewRect.height()+e._style.padding.top+e._style.padding.bottom}if(this._previousHeight===this.height)return;Wt("#"+this.id).attr("height",this.height);const t=getComputedStyle(document.body),e=Math.ceil((parseFloat(t.marginTop)||0)+parseFloat(t.height)+(parseFloat(t.marginBottom)||0)),i=Math.ceil((parseFloat(t.marginLeft)||0)+parseFloat(t.width)+(parseFloat(t.marginRight)||0));this.sendMessage("resize",{layout:{height:this.height,width:this.width},document:{width:i,height:e}})}setState(t,e=!0){Object.assign(this.state,t),this.state._?this.state._.stateDidUpdate(e):this.stateDidUpdate(e)}setConfig(t,e){this.embedConfig=t,"function"==typeof this._waitForConfigFn&&!1===this._waitForConfigDone&&(this._waitForConfigFn(t,e,this),this._waitForConfigDone=!0)}saveAsSvg(t,e={}){Ot(document.getElementById(this.id),t,"chart.svg")}saveAsPng(t,e={padding:10}){Ft(document.getElementById(this.id),t,"chart.png",e)}saveAsDsv(t,e,i={}){this._dataSources.forEach((s=>{s.saveAsDsv(t,e,i)}))}saveAsCsv(t,e={}){this.saveAsDsv(",",t,e)}saveAsTsv(t,e={}){this.saveAsDsv("\t",t,e)}}class Ne{constructor(t){this._node="string"==typeof t?document.querySelector(t):t,this._node||console.error(`[dynvis.select] Element ${t}' not found.`)}simpleLayout(t){return function(t,e){console.warn("[Layout] Function `simpleLayout` is deprecated. Use `layout` instead.");const i=new He(t,e);return i.setBox("title",new Ee("Title",{style:{font:{size:14,weight:"bold"}},className:"dv_title"})),i.setBox("chart",new ze(null,{className:"dv_chart"})),i.chart=function(t){return this.setBox("chart",t),this}.bind(i),i.title=function(t){return this._boxes.get("title").text(t),this}.bind(i),i}(this._node,t)}layout(t){return function(t,e){return new He(t,e)}(this._node,t)}}const Oe=["left","center","right"];class Fe extends ze{constructor(t){super(t),this._boxes=[],this.style({spacing:{horizontal:0,vertical:0}})}addBox(t,e){return t||console.error("[FlexBox.addBox] box is undefined"),this._boxes.push({box:t,opt:e}),t.on("setState",this.setState.bind(this)),t.on("dataDidLoad",this.dataDidLoad.bind(this)),t.hasBeenRegistered(this,"flexBox"),this}insertBox(t,e,i){return t||console.error("[FlexBox.addBox] box is undefined"),this._boxes.splice(i,0,{box:t,opt:e}),t.on("setState",this.setState.bind(this)),t.on("dataDidLoad",this.dataDidLoad.bind(this)),t.hasBeenRegistered(this,"flexBox"),this}removeBox(t){const e=this._boxes.findIndex((e=>e.box===t));return-1!==e&&(this._boxes.splice(e,1),t.off("setState",this.setState.bind(this)),t.off("dataDidLoad",this.dataDidLoad.bind(this))),this}hasBeenRegistered(t,e){super.hasBeenRegistered(t,e),this._boxes.forEach((i=>{i.box.hasBeenRegistered(t,e)}))}dataDidLoad(t){this._parents.forEach((e=>{"layout"===e.role&&e.parent.dataDidLoad(t)}))}_sortedBoxes(){return this._boxes.forEach((t=>{t._alignment=Oe.indexOf(t.opt.alignment||"left")})),this._boxes.sort(((t,e)=>(e.opt.priority||0)-(t.opt.priority||0)||t._alignment-e._alignment))}prerender(t,e){super.prerender(t,e),this.emit("prerenderWillStart",[t,e,this]),this._sortedBoxes().forEach((i=>{if(!t.querySelector(`#${i.box.id}`)){const s=Wt(t).append("g").attr("id",i.box.id).attr("class","dv_flexBoxElement");i.opt.attrs&&Object.keys(i.opt.attrs).forEach((t=>{s.attr(t,i.opt.attrs[t])}));const n=s.append("g");i.box.init(n.node(),e)}}));const i=this._sortedBoxes().map((t=>t.box.id));t.querySelectorAll("g.dv_flexBoxElement").forEach((t=>{const e=t.getAttribute("id");-1===i.indexOf(e)&&t.remove()}));const s=this.viewRect.width();this._sortedBoxes().forEach((i=>{i.box.maxViewRect=new ne(0,0,s-i.box._style.padding.right-i.box._style.padding.left,null);const n=t.querySelector(`#${i.box.id} g`);if(t.querySelector(`#${i.box.id}`).setAttribute("transform",`translate(${this.viewRect.left+i.box._style.padding.left} ${this.viewRect.top+i.box._style.padding.top})`),i.opt.width&&i.box.maxViewRect.setWidth(Math.min(s-i.box._style.padding.right-i.box._style.padding.left,"function"==typeof i.opt.width?i.opt.width(s-i.box._style.padding.right-i.box._style.padding.left,i.box,e,n):i.opt.width)),this._f(i.opt.hide,i,this._state))n.style.display="none";else{n.style.display=null;try{i.box.hasError=!1,i.box.messageMode?i.box.showMessage(i.box.messageMode):i.box.prerender(n,e)}catch(t){console.error('[DV] An error occurred during prerender step for a box in a FlexBox":\n',t),i.box.showMessage("error"),i.box.hasError=!0}}this.emit("prerenderDidEnd",[t,e,this])})),this.viewRect.setHeight(this._positionBoxes())}render(t,e){super.render(t,e),this.emit("renderWillStart",[t,e,this]),this._boxes.filter((t=>!0!==this._f(t.opt.hide,t,this._state))).forEach((t=>{try{t.box.hasError||t.box.messageMode?console.warn("[DV] Skipping render step for a box in a FlexBox due to previous error."):t.box.render(document.querySelector(`#${t.box.id} g`),e)}catch(e){console.error('[DV] An error occurred during render step for a box in a FlexBox":\n',e),t.box.showMessage("error"),t.box.hasError=!0}})),this.emit("renderDidEnd",[t,e,this])}_positionBoxes(){const t=[],e=this._style.spacing.horizontal;let i={left:[],center:[],right:[],widths:{left:0,center:0,right:0,total:0},totalHeight:0};this._sortedBoxes().filter((t=>!0!==this._f(t.opt.hide,t,this._state))).forEach((e=>{this._placeBoxInRow(e.box,i,e.opt.horizontalAlignment||"left")||(t.push(i),i={left:[],center:[],right:[]},i.widths={left:0,center:0,right:0,total:0},i.totalHeight=0,this._placeBoxInRow(e.box,i,e.opt.horizontalAlignment||"left",!0)),i.totalHeight=Math.max(i.totalHeight,e.box.boxHeight()),e.box.valign=e.opt.verticalAlignment||"top"})),t.push(i);let s=0;return t.forEach((t=>{let n=0;t.left.forEach((t=>{let r=0;"middle"===t.valign&&(r=(i.totalHeight-t.boxHeight())/2),"bottom"===t.valign&&(r=i.totalHeight-t.boxHeight()),Wt(`#${t.id}`).call($e(n,s+r)),n+=t.maxViewRect.width()+t._style.padding.left+t._style.padding.right+e})),n=this.viewRect.width()/2-t.widths.center/2,t.center.forEach((t=>{let r=0;"middle"===t.valign&&(r=(i.totalHeight-t.boxHeight())/2),"bottom"===t.valign&&(r=i.totalHeight-t.boxHeight()),Wt(`#${t.id}`).call($e(n,s+r)),n+=t.maxViewRect.width()+t._style.padding.left+t._style.padding.right+e})),n=this.viewRect.width(),t.right.forEach((t=>{let r=0;"middle"===t.valign&&(r=(i.totalHeight-t.boxHeight())/2),"bottom"===t.valign&&(r=i.totalHeight-t.boxHeight()),n-=t.maxViewRect.width()+t._style.padding.left+t._style.padding.right+e;const a=t.maxViewRect.width()-t.viewRect.width();Wt(`#${t.id}`).call($e(n+a,s+r))})),s+=t.totalHeight+this._style.spacing.vertical})),s-this._style.spacing.vertical}_placeBoxInRow(t,e,i,s){const n=this._style.spacing.horizontal,r=t.viewRect.width()+t._style.padding.left+t._style.padding.right+n;if(s)return e[i].push(t),e.widths[i]+=r,e.widths.total+=r,!0;if(e.widths.total+r>this.viewRect.width()+n)return!1;const a={left:{min:0,max:e.widths.left},center:{min:this.viewRect.width()/2-e.widths.center/2,max:this.viewRect.width()/2+e.widths.center/2},right:{min:this.viewRect.width()+n-e.widths.right,max:this.viewRect.width()+n}};switch(i){case"right":a.right.min-=r;break;case"center":a.center.min-=r/2,a.center.max+=r/2;break;default:a.left.max+=r}return!(e.left.length>0&&e.center.length>0&&a.left.max>a.center.min)&&(!(e.left.length>0&&0===e.center.length&&e.right.length>0&&a.left.max>a.right.min)&&(!(e.center.length>0&&e.right.length>0&&a.center.max>a.right.min)&&(!(a.left.max>a.right.max||a.right.min<a.left.min||a.center.min<a.left.min||a.center.max>a.right.max)&&(e[i].push(t),e.widths[i]+=r,e.widths.total+=r,!0))))}}class Pe extends ze{constructor(t,e){super(),this._category=t,this._parent=e,this._boxes=new Re}setBox(t,e){return this._boxes.set(t,e),e.on("setState",this.setState.bind(this)),e.on("dataDidLoad",this.dataDidLoad.bind(this)),this}dataDidLoad(t){this._parent.dataDidLoad(t)}init(t,e){const i=Object.assign({},e);i[this._parent._mapToState]=this._category,super.init(t,i),this._parent._content(this,this._category,this._parent._contentOptions),this._boxes.forEach((([e,s])=>{const n=Wt(t).append("g").attr("id",`${this._category}/${s.id}`).attr("class",`dv_${e}`);s.__node=n.node(),s.init(s.__node,i)}))}prerender(t,e){const i=Object.assign({},e);i[this._parent._mapToState]=this._category,super.prerender(t,i),this.emit("prerenderWillStart",[t,i,this]);const s=this.viewRect.width(),n=this._boxes.map((([t,e])=>(e.maxViewRect=new ne(0,0,s,null),e.prerender(e.__node,i),e.viewRect.height()+e._style.padding.top+e._style.padding.bottom))).reduce(((t,e)=>t+e));this.viewRect.setHeight(n),this.emit("prerenderDidEnd",[t,i,this])}render(t,e){const i=Object.assign({},e);i[this._parent._mapToState]=this._category,super.render(t,i),this.emit("renderWillStart",[t,i,this]);let s=0;for(let t=0;t<this._boxes.length;t++){const e=this._boxes[t][1];e.__node.setAttribute("transform",`translate(0, ${s})`),e.render(e.__node,i),s+=e.viewRect.height()+e._style.padding.top+e._style.padding.bottom}this.emit("renderDidEnd",[t,e,this])}}class Ue extends Fe{constructor(){super(),this._cellWidth=300,this._categories=null,this._categoriesSort=null,this._mapToState=null,this._content=()=>{},this._contentOptions=null,this._d={categories:null},this._c={boxes:{}},this.style({spacing:{horizontal:15,vertical:15}})}categories(t){return this._categories=t,this}categoriesSort(t){return this._categoriesSort=t,this}mapToState(t){return this._mapToState=t,this}content(t,e){return this._content=t,this._contentOptions=e||null,this}cellWidth(t){return this._cellWidth=t,this}prerender(t,e){this._d.categories=this._(this._categories,e,this),this._categoriesSort&&this._d.categories.sort(this._categoriesSort),Object.keys(this._c.boxes).forEach((t=>{-1===this._d.categories.indexOf(t)&&(this.removeBox(this._c.boxes[t]),delete this._c.boxes[t])})),this._d.categories.forEach(((t,i)=>{this._c.boxes[t]||(this._c.boxes[t]=new Pe(t,this),this.insertBox(this._c.boxes[t],{priority:1,verticalAlignment:"top",horizontalAlignment:"left",width:t=>{const i=this._style.spacing.horizontal,s=this._(this._cellWidth,{gridWidth:t,hSpacing:i},e,this),n=Math.max(1,Math.min(this._d.categories.length,Math.floor((t+i)/(s+i))));return Math.floor((t-(n-1)*i)/n)},attrs:{"data-category":t}},i))})),super.prerender(t,e)}}var qe={},Xe={};function Ye(t){return new Function("d","return {"+t.map((function(t,e){return JSON.stringify(t)+": d["+e+'] || ""'})).join(",")+"}")}function Ge(t){var e=Object.create(null),i=[];return t.forEach((function(t){for(var s in t)s in e||i.push(e[s]=s)})),i}function Ze(t,e){var i=t+"",s=i.length;return s<e?new Array(e-s+1).join(0)+i:i}function Ke(t){var e,i=t.getUTCHours(),s=t.getUTCMinutes(),n=t.getUTCSeconds(),r=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":((e=t.getUTCFullYear())<0?"-"+Ze(-e,6):e>9999?"+"+Ze(e,6):Ze(e,4))+"-"+Ze(t.getUTCMonth()+1,2)+"-"+Ze(t.getUTCDate(),2)+(r?"T"+Ze(i,2)+":"+Ze(s,2)+":"+Ze(n,2)+"."+Ze(r,3)+"Z":n?"T"+Ze(i,2)+":"+Ze(s,2)+":"+Ze(n,2)+"Z":s||i?"T"+Ze(i,2)+":"+Ze(s,2)+"Z":"")}function Je(t){var e=new RegExp('["'+t+"\n\r]"),i=t.charCodeAt(0);function s(t,e){var s,n=[],r=t.length,a=0,l=0,o=r<=0,h=!1;function c(){if(o)return Xe;if(h)return h=!1,qe;var e,s,n=a;if(34===t.charCodeAt(n)){for(;a++<r&&34!==t.charCodeAt(a)||34===t.charCodeAt(++a););return(e=a)>=r?o=!0:10===(s=t.charCodeAt(a++))?h=!0:13===s&&(h=!0,10===t.charCodeAt(a)&&++a),t.slice(n+1,e-1).replace(/""/g,'"')}for(;a<r;){if(10===(s=t.charCodeAt(e=a++)))h=!0;else if(13===s)h=!0,10===t.charCodeAt(a)&&++a;else if(s!==i)continue;return t.slice(n,e)}return o=!0,t.slice(n,r)}for(10===t.charCodeAt(r-1)&&--r,13===t.charCodeAt(r-1)&&--r;(s=c())!==Xe;){for(var d=[];s!==qe&&s!==Xe;)d.push(s),s=c();e&&null==(d=e(d,l++))||n.push(d)}return n}function n(e,i){return e.map((function(e){return i.map((function(t){return a(e[t])})).join(t)}))}function r(e){return e.map(a).join(t)}function a(t){return null==t?"":t instanceof Date?Ke(t):e.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t}return{parse:function(t,e){var i,n,r=s(t,(function(t,s){if(i)return i(t,s-1);n=t,i=e?function(t,e){var i=Ye(t);return function(s,n){return e(i(s),n,t)}}(t,e):Ye(t)}));return r.columns=n||[],r},parseRows:s,format:function(e,i){return null==i&&(i=Ge(e)),[i.map(a).join(t)].concat(n(e,i)).join("\n")},formatBody:function(t,e){return null==e&&(e=Ge(t)),n(t,e).join("\n")},formatRows:function(t){return t.map(r).join("\n")},formatRow:r,formatValue:a}}var Qe=Je("\t").parse;function ti(t){for(var e in t){var i,s,n=t[e].trim();if(n)if("true"===n)n=!0;else if("false"===n)n=!1;else if("NaN"===n)n=NaN;else if(isNaN(i=+n)){if(!(s=n.match(/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/)))continue;ei&&s[4]&&!s[7]&&(n=n.replace(/-/g,"/").replace(/T/," ")),n=new Date(n)}else n=i;else n=null;t[e]=n}return t}const ei=new Date("2019-01-01T00:00").getHours()||new Date("2019-07-01T00:00").getHours();function ii(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}function si(t,e){return fetch(t,e).then(ii)}var ni,ri=(ni=Qe,function(t,e,i){return 2===arguments.length&&"function"==typeof e&&(i=e,e=void 0),si(t,e).then((function(t){return ni(t,i)}))});function ai(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);if(204!==t.status&&205!==t.status)return t.json()}function li(t,...e){const i=function(t,e){return oi({},t,...e)}(t,e);return function(t){return hi({},t)}(i)}function oi(t,e,...i){const s=i.shift();if(e.forEach((e=>{const i=e[s];t[i]=t[i]||[],t[i].push(e)})),i.length>0)for(const e in t)t[e]=oi({},t[e],...i);return t}function hi(t,e){return t.children=e instanceof Array?e:Object.entries(e).map((([t,e])=>hi({key:t},e))),t}class ci{constructor(){this.type=null,this.path=null,this.loadFn=()=>null,this.loaded=!1,this.loading=!1,this.data=null,this.exportDataFn=null,this.isHierarchical=!1,this._transformFn=null}tsv(t){return this.type="tsv",this.path=t,this.loadFn=()=>ri(this.path,ti),this}dsv(t,e){return this.type="dsv",this.path=e,this.loadFn=()=>function(t,e,i,s){3===arguments.length&&"function"==typeof i&&(s=i,i=void 0);var n=Je(t);return si(e,i).then((function(t){return n.parse(t,s)}))}(t,this.path,ti),this}json(t){return this.type="json",this.path=t,this.loadFn=()=>function(t,e){return fetch(t,e).then(ai)}(this.path),this}js(t){return this.type="js",this.path=null,this.loadFn=()=>new Promise(((e,i)=>{t?e(t):i(new Error("Javascript object invalid"))})),this}transform(t){return this._transformFn=t,this}hierarchy(...t){return this.isHierarchical=!0,this._hierarchy={keys:t},this.loaded&&this._calculateHierarchy(),this}_calculateHierarchy(){this.originalData=this.data,this.data=li(this.data,...this._hierarchy.keys)}load(t,e){void 0===e&&"function"==typeof t&&(e=t,t=void 0),this.loaded?e&&e(this.data):this._loading||(t&&t.emit("dataWillLoad",[this]),this._loading=!0,this.loadFn().then((i=>{this.data=i,this.loaded=!0,this._loading=!1,this._postprocess(),e&&e(this.data),t&&t.emit("dataDidLoad",[this]),this.path?console.info(`[DataSource] ${this.type.toUpperCase()} loaded: ${this.path}`):console.info(`[DataSource] ${this.type.toUpperCase()} loaded.`)})))}_postprocess(){if(this._transformFn){const t=this._transformFn(this.data,this);t&&(this.data=t)}this.isHierarchical&&this._calculateHierarchy()}saveAsDsv(t,e,i={}){const s=this.exportDataFn?this.exportDataFn(this.data):this.data;let n="";i.header&&(n+=i.header&&i.header.join?i.header.join("\n"):i.header||"",n+="\n\n"),n+=(i.columns?s.columns.map((t=>i.columns[t]||t)):s.columns).join(t)+"\n",s.forEach((e=>{n+=s.columns.map((t=>null===e[t]||void 0===e[t]?"n/a":e[t])).join(t)+"\n"})),i.footer&&(n+="\n\n",n+=i.footer&&i.footer.join?i.footer.join("\n"):i.footer||""),function(t,e){const i=new Blob(["\ufeff"+e],{type:"data:application/octet-stream"}),s=URL.createObjectURL(i),n=t.split("."),r=n.length>1?n[n.length-1]:"txt";It(s,Bt(n.length>1?n.slice(0,n.length-1).join("."):t,r)),URL.revokeObjectURL(s)}(e,n)}saveAsTsv(t,e={}){this.saveAsDsv("\t",t,e)}saveAsCsv(t,e={}){this.saveAsDsv(",",t,e)}}function di(t,e){return null==t||null==e?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function ui(t,e){return null==t||null==e?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function _i(t){let e,i,s;function n(t,s,n=0,r=t.length){if(n<r){if(0!==e(s,s))return r;do{const e=n+r>>>1;i(t[e],s)<0?n=e+1:r=e}while(n<r)}return n}return 2!==t.length?(e=di,i=(e,i)=>di(t(e),i),s=(e,i)=>t(e)-i):(e=t===di||t===ui?t:pi,i=t,s=t),{left:n,center:function(t,e,i=0,r=t.length){const a=n(t,e,i,r-1);return a>i&&s(t[a-1],e)>-s(t[a],e)?a-1:a},right:function(t,s,n=0,r=t.length){if(n<r){if(0!==e(s,s))return r;do{const e=n+r>>>1;i(t[e],s)<=0?n=e+1:r=e}while(n<r)}return n}}}function pi(){return 0}const fi=_i(di).right;_i((function(t){return null===t?NaN:+t})).center;var gi=fi;class yi extends Map{constructor(t,e=xi){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),null!=t)for(const[e,i]of t)this.set(e,i)}get(t){return super.get(mi(this,t))}has(t){return super.has(mi(this,t))}set(t,e){return super.set(function({_intern:t,_key:e},i){const s=e(i);return t.has(s)?t.get(s):(t.set(s,i),i)}(this,t),e)}delete(t){return super.delete(function({_intern:t,_key:e},i){const s=e(i);t.has(s)&&(i=t.get(s),t.delete(s));return i}(this,t))}}function mi({_intern:t,_key:e},i){const s=e(i);return t.has(s)?t.get(s):i}function xi(t){return null!==t&&"object"==typeof t?t.valueOf():t}const vi=Math.sqrt(50),bi=Math.sqrt(10),wi=Math.sqrt(2);function Ai(t,e,i){const s=(e-t)/Math.max(0,i),n=Math.floor(Math.log10(s)),r=s/Math.pow(10,n),a=r>=vi?10:r>=bi?5:r>=wi?2:1;let l,o,h;return n<0?(h=Math.pow(10,-n)/a,l=Math.round(t*h),o=Math.round(e*h),l/h<t&&++l,o/h>e&&--o,h=-h):(h=Math.pow(10,n)*a,l=Math.round(t/h),o=Math.round(e/h),l*h<t&&++l,o*h>e&&--o),o<l&&.5<=i&&i<2?Ai(t,e,2*i):[l,o,h]}function ki(t,e,i){return Ai(t=+t,e=+e,i=+i)[2]}function Li(t,e,i){i=+i;const s=(e=+e)<(t=+t),n=s?ki(e,t,i):ki(t,e,i);return(s?-1:1)*(n<0?1/-n:n)}function Si(t,e){let i;if(void 0===e)for(const e of t)null!=e&&(i<e||void 0===i&&e>=e)&&(i=e);else{let s=-1;for(let n of t)null!=(n=e(n,++s,t))&&(i<n||void 0===i&&n>=n)&&(i=n)}return i}function Ci(t,e){let i;if(void 0===e)for(const e of t)null!=e&&(i>e||void 0===i&&e>=e)&&(i=e);else{let s=-1;for(let n of t)null!=(n=e(n,++s,t))&&(i>n||void 0===i&&n>=n)&&(i=n)}return i}function Ri(t,e){let i=0;if(void 0===e)for(let e of t)(e=+e)&&(i+=e);else{let s=-1;for(let n of t)(n=+e(n,++s,t))&&(i+=n)}return i}function Ti(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}const Mi=Symbol("implicit");function zi(){var t=new yi,e=[],i=[],s=Mi;function n(n){let r=t.get(n);if(void 0===r){if(s!==Mi)return s;t.set(n,r=e.push(n)-1)}return i[r%i.length]}return n.domain=function(i){if(!arguments.length)return e.slice();e=[],t=new yi;for(const s of i)t.has(s)||t.set(s,e.push(s)-1);return n},n.range=function(t){return arguments.length?(i=Array.from(t),n):i.slice()},n.unknown=function(t){return arguments.length?(s=t,n):s},n.copy=function(){return zi(e,i).unknown(s)},Ti.apply(n,arguments),n}function Di(t,e,i){t.prototype=e.prototype=i,i.constructor=t}function $i(t,e){var i=Object.create(t.prototype);for(var s in e)i[s]=e[s];return i}function Vi(){}var Wi=.7,Ei=1/Wi,Bi="\\s*([+-]?\\d+)\\s*",Ii="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ji="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Hi=/^#([0-9a-f]{3,8})$/,Ni=new RegExp(`^rgb\\(${Bi},${Bi},${Bi}\\)$`),Oi=new RegExp(`^rgb\\(${ji},${ji},${ji}\\)$`),Fi=new RegExp(`^rgba\\(${Bi},${Bi},${Bi},${Ii}\\)$`),Pi=new RegExp(`^rgba\\(${ji},${ji},${ji},${Ii}\\)$`),Ui=new RegExp(`^hsl\\(${Ii},${ji},${ji}\\)$`),qi=new RegExp(`^hsla\\(${Ii},${ji},${ji},${Ii}\\)$`),Xi={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Yi(){return this.rgb().formatHex()}function Gi(){return this.rgb().formatRgb()}function Zi(t){var e,i;return t=(t+"").trim().toLowerCase(),(e=Hi.exec(t))?(i=e[1].length,e=parseInt(e[1],16),6===i?Ki(e):3===i?new ts(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===i?Ji(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===i?Ji(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=Ni.exec(t))?new ts(e[1],e[2],e[3],1):(e=Oi.exec(t))?new ts(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Fi.exec(t))?Ji(e[1],e[2],e[3],e[4]):(e=Pi.exec(t))?Ji(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=Ui.exec(t))?as(e[1],e[2]/100,e[3]/100,1):(e=qi.exec(t))?as(e[1],e[2]/100,e[3]/100,e[4]):Xi.hasOwnProperty(t)?Ki(Xi[t]):"transparent"===t?new ts(NaN,NaN,NaN,0):null}function Ki(t){return new ts(t>>16&255,t>>8&255,255&t,1)}function Ji(t,e,i,s){return s<=0&&(t=e=i=NaN),new ts(t,e,i,s)}function Qi(t,e,i,s){return 1===arguments.length?((n=t)instanceof Vi||(n=Zi(n)),n?new ts((n=n.rgb()).r,n.g,n.b,n.opacity):new ts):new ts(t,e,i,null==s?1:s);var n}function ts(t,e,i,s){this.r=+t,this.g=+e,this.b=+i,this.opacity=+s}function es(){return`#${rs(this.r)}${rs(this.g)}${rs(this.b)}`}function is(){const t=ss(this.opacity);return`${1===t?"rgb(":"rgba("}${ns(this.r)}, ${ns(this.g)}, ${ns(this.b)}${1===t?")":`, ${t})`}`}function ss(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function ns(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function rs(t){return((t=ns(t))<16?"0":"")+t.toString(16)}function as(t,e,i,s){return s<=0?t=e=i=NaN:i<=0||i>=1?t=e=NaN:e<=0&&(t=NaN),new os(t,e,i,s)}function ls(t){if(t instanceof os)return new os(t.h,t.s,t.l,t.opacity);if(t instanceof Vi||(t=Zi(t)),!t)return new os;if(t instanceof os)return t;var e=(t=t.rgb()).r/255,i=t.g/255,s=t.b/255,n=Math.min(e,i,s),r=Math.max(e,i,s),a=NaN,l=r-n,o=(r+n)/2;return l?(a=e===r?(i-s)/l+6*(i<s):i===r?(s-e)/l+2:(e-i)/l+4,l/=o<.5?r+n:2-r-n,a*=60):l=o>0&&o<1?0:a,new os(a,l,o,t.opacity)}function os(t,e,i,s){this.h=+t,this.s=+e,this.l=+i,this.opacity=+s}function hs(t){return(t=(t||0)%360)<0?t+360:t}function cs(t){return Math.max(0,Math.min(1,t||0))}function ds(t,e,i){return 255*(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)}Di(Vi,Zi,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Yi,formatHex:Yi,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return ls(this).formatHsl()},formatRgb:Gi,toString:Gi}),Di(ts,Qi,$i(Vi,{brighter(t){return t=null==t?Ei:Math.pow(Ei,t),new ts(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?Wi:Math.pow(Wi,t),new ts(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new ts(ns(this.r),ns(this.g),ns(this.b),ss(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:es,formatHex:es,formatHex8:function(){return`#${rs(this.r)}${rs(this.g)}${rs(this.b)}${rs(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:is,toString:is})),Di(os,(function(t,e,i,s){return 1===arguments.length?ls(t):new os(t,e,i,null==s?1:s)}),$i(Vi,{brighter(t){return t=null==t?Ei:Math.pow(Ei,t),new os(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?Wi:Math.pow(Wi,t),new os(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,i=this.l,s=i+(i<.5?i:1-i)*e,n=2*i-s;return new ts(ds(t>=240?t-240:t+120,n,s),ds(t,n,s),ds(t<120?t+240:t-120,n,s),this.opacity)},clamp(){return new os(hs(this.h),cs(this.s),cs(this.l),ss(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=ss(this.opacity);return`${1===t?"hsl(":"hsla("}${hs(this.h)}, ${100*cs(this.s)}%, ${100*cs(this.l)}%${1===t?")":`, ${t})`}`}}));var us=t=>()=>t;function _s(t){return 1==(t=+t)?ps:function(e,i){return i-e?function(t,e,i){return t=Math.pow(t,i),e=Math.pow(e,i)-t,i=1/i,function(s){return Math.pow(t+s*e,i)}}(e,i,t):us(isNaN(e)?i:e)}}function ps(t,e){var i=e-t;return i?function(t,e){return function(i){return t+i*e}}(t,i):us(isNaN(t)?e:t)}var fs=function t(e){var i=_s(e);function s(t,e){var s=i((t=Qi(t)).r,(e=Qi(e)).r),n=i(t.g,e.g),r=i(t.b,e.b),a=ps(t.opacity,e.opacity);return function(e){return t.r=s(e),t.g=n(e),t.b=r(e),t.opacity=a(e),t+""}}return s.gamma=t,s}(1);var gs,ys=(gs=function(t){var e=t.length-1;return function(i){var s=i<=0?i=0:i>=1?(i=1,e-1):Math.floor(i*e),n=t[s],r=t[s+1],a=s>0?t[s-1]:2*n-r,l=s<e-1?t[s+2]:2*r-n;return function(t,e,i,s,n){var r=t*t,a=r*t;return((1-3*t+3*r-a)*e+(4-6*r+3*a)*i+(1+3*t+3*r-3*a)*s+a*n)/6}((i-s/e)*e,a,n,r,l)}},function(t){var e,i,s=t.length,n=new Array(s),r=new Array(s),a=new Array(s);for(e=0;e<s;++e)i=Qi(t[e]),n[e]=i.r||0,r[e]=i.g||0,a[e]=i.b||0;return n=gs(n),r=gs(r),a=gs(a),i.opacity=1,function(t){return i.r=n(t),i.g=r(t),i.b=a(t),i+""}});function ms(t,e){e||(e=[]);var i,s=t?Math.min(e.length,t.length):0,n=e.slice();return function(r){for(i=0;i<s;++i)n[i]=t[i]*(1-r)+e[i]*r;return n}}function xs(t,e){var i,s=e?e.length:0,n=t?Math.min(s,t.length):0,r=new Array(n),a=new Array(s);for(i=0;i<n;++i)r[i]=Ss(t[i],e[i]);for(;i<s;++i)a[i]=e[i];return function(t){for(i=0;i<n;++i)a[i]=r[i](t);return a}}function vs(t,e){var i=new Date;return t=+t,e=+e,function(s){return i.setTime(t*(1-s)+e*s),i}}function bs(t,e){return t=+t,e=+e,function(i){return t*(1-i)+e*i}}function ws(t,e){var i,s={},n={};for(i in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)i in t?s[i]=Ss(t[i],e[i]):n[i]=e[i];return function(t){for(i in s)n[i]=s[i](t);return n}}var As=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ks=new RegExp(As.source,"g");function Ls(t,e){var i,s,n,r=As.lastIndex=ks.lastIndex=0,a=-1,l=[],o=[];for(t+="",e+="";(i=As.exec(t))&&(s=ks.exec(e));)(n=s.index)>r&&(n=e.slice(r,n),l[a]?l[a]+=n:l[++a]=n),(i=i[0])===(s=s[0])?l[a]?l[a]+=s:l[++a]=s:(l[++a]=null,o.push({i:a,x:bs(i,s)})),r=ks.lastIndex;return r<e.length&&(n=e.slice(r),l[a]?l[a]+=n:l[++a]=n),l.length<2?o[0]?function(t){return function(e){return t(e)+""}}(o[0].x):function(t){return function(){return t}}(e):(e=o.length,function(t){for(var i,s=0;s<e;++s)l[(i=o[s]).i]=i.x(t);return l.join("")})}function Ss(t,e){var i,s=typeof e;return null==e||"boolean"===s?us(e):("number"===s?bs:"string"===s?(i=Zi(e))?(e=i,fs):Ls:e instanceof Zi?fs:e instanceof Date?vs:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}(e)?ms:Array.isArray(e)?xs:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?ws:bs)(t,e)}function Cs(t,e){return t=+t,e=+e,function(i){return Math.round(t*(1-i)+e*i)}}var Rs,Ts=180/Math.PI,Ms={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function zs(t,e,i,s,n,r){var a,l,o;return(a=Math.sqrt(t*t+e*e))&&(t/=a,e/=a),(o=t*i+e*s)&&(i-=t*o,s-=e*o),(l=Math.sqrt(i*i+s*s))&&(i/=l,s/=l,o/=l),t*s<e*i&&(t=-t,e=-e,o=-o,a=-a),{translateX:n,translateY:r,rotate:Math.atan2(e,t)*Ts,skewX:Math.atan(o)*Ts,scaleX:a,scaleY:l}}function Ds(t,e,i,s){function n(t){return t.length?t.pop()+" ":""}return function(r,a){var l=[],o=[];return r=t(r),a=t(a),function(t,s,n,r,a,l){if(t!==n||s!==r){var o=a.push("translate(",null,e,null,i);l.push({i:o-4,x:bs(t,n)},{i:o-2,x:bs(s,r)})}else(n||r)&&a.push("translate("+n+e+r+i)}(r.translateX,r.translateY,a.translateX,a.translateY,l,o),function(t,e,i,r){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),r.push({i:i.push(n(i)+"rotate(",null,s)-2,x:bs(t,e)})):e&&i.push(n(i)+"rotate("+e+s)}(r.rotate,a.rotate,l,o),function(t,e,i,r){t!==e?r.push({i:i.push(n(i)+"skewX(",null,s)-2,x:bs(t,e)}):e&&i.push(n(i)+"skewX("+e+s)}(r.skewX,a.skewX,l,o),function(t,e,i,s,r,a){if(t!==i||e!==s){var l=r.push(n(r)+"scale(",null,",",null,")");a.push({i:l-4,x:bs(t,i)},{i:l-2,x:bs(e,s)})}else 1===i&&1===s||r.push(n(r)+"scale("+i+","+s+")")}(r.scaleX,r.scaleY,a.scaleX,a.scaleY,l,o),r=a=null,function(t){for(var e,i=-1,s=o.length;++i<s;)l[(e=o[i]).i]=e.x(t);return l.join("")}}}var $s=Ds((function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Ms:zs(e.a,e.b,e.c,e.d,e.e,e.f)}),"px, ","px)","deg)"),Vs=Ds((function(t){return null==t?Ms:(Rs||(Rs=document.createElementNS("http://www.w3.org/2000/svg","g")),Rs.setAttribute("transform",t),(t=Rs.transform.baseVal.consolidate())?zs((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):Ms)}),", ",")",")");function Ws(t){return+t}var Es=[0,1];function Bs(t){return t}function Is(t,e){return(e-=t=+t)?function(i){return(i-t)/e}:function(t){return function(){return t}}(isNaN(e)?NaN:.5)}function js(t,e,i){var s=t[0],n=t[1],r=e[0],a=e[1];return n<s?(s=Is(n,s),r=i(a,r)):(s=Is(s,n),r=i(r,a)),function(t){return r(s(t))}}function Hs(t,e,i){var s=Math.min(t.length,e.length)-1,n=new Array(s),r=new Array(s),a=-1;for(t[s]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<s;)n[a]=Is(t[a],t[a+1]),r[a]=i(e[a],e[a+1]);return function(e){var i=gi(t,e,1,s)-1;return r[i](n[i](e))}}function Ns(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Os(){var t,e,i,s,n,r,a=Es,l=Es,o=Ss,h=Bs;function c(){var t=Math.min(a.length,l.length);return h!==Bs&&(h=function(t,e){var i;return t>e&&(i=t,t=e,e=i),function(i){return Math.max(t,Math.min(e,i))}}(a[0],a[t-1])),s=t>2?Hs:js,n=r=null,d}function d(e){return null==e||isNaN(e=+e)?i:(n||(n=s(a.map(t),l,o)))(t(h(e)))}return d.invert=function(i){return h(e((r||(r=s(l,a.map(t),bs)))(i)))},d.domain=function(t){return arguments.length?(a=Array.from(t,Ws),c()):a.slice()},d.range=function(t){return arguments.length?(l=Array.from(t),c()):l.slice()},d.rangeRound=function(t){return l=Array.from(t),o=Cs,c()},d.clamp=function(t){return arguments.length?(h=!!t||Bs,c()):h!==Bs},d.interpolate=function(t){return arguments.length?(o=t,c()):o},d.unknown=function(t){return arguments.length?(i=t,d):i},function(i,s){return t=i,e=s,c()}}function Fs(){return Os()(Bs,Bs)}function Ps(t,e){if((i=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var i,s=t.slice(0,i);return[s.length>1?s[0]+s.slice(2):s,+t.slice(i+1)]}function Us(t){return(t=Ps(Math.abs(t)))?t[1]:NaN}var qs,Xs=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ys(t){if(!(e=Xs.exec(t)))throw new Error("invalid format: "+t);var e;return new Gs({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function Gs(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function Zs(t,e){var i=Ps(t,e);if(!i)return t+"";var s=i[0],n=i[1];return n<0?"0."+new Array(-n).join("0")+s:s.length>n+1?s.slice(0,n+1)+"."+s.slice(n+1):s+new Array(n-s.length+2).join("0")}Ys.prototype=Gs.prototype,Gs.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var Ks={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Zs(100*t,e),r:Zs,s:function(t,e){var i=Ps(t,e);if(!i)return t+"";var s=i[0],n=i[1],r=n-(qs=3*Math.max(-8,Math.min(8,Math.floor(n/3))))+1,a=s.length;return r===a?s:r>a?s+new Array(r-a+1).join("0"):r>0?s.slice(0,r)+"."+s.slice(r):"0."+new Array(1-r).join("0")+Ps(t,Math.max(0,e+r-1))[0]},X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Js(t){return t}var Qs,tn,en,sn=Array.prototype.map,nn=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function rn(t){var e,i,s=void 0===t.grouping||void 0===t.thousands?Js:(e=sn.call(t.grouping,Number),i=t.thousands+"",function(t,s){for(var n=t.length,r=[],a=0,l=e[0],o=0;n>0&&l>0&&(o+l+1>s&&(l=Math.max(1,s-o)),r.push(t.substring(n-=l,n+l)),!((o+=l+1)>s));)l=e[a=(a+1)%e.length];return r.reverse().join(i)}),n=void 0===t.currency?"":t.currency[0]+"",r=void 0===t.currency?"":t.currency[1]+"",a=void 0===t.decimal?".":t.decimal+"",l=void 0===t.numerals?Js:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(sn.call(t.numerals,String)),o=void 0===t.percent?"%":t.percent+"",h=void 0===t.minus?"−":t.minus+"",c=void 0===t.nan?"NaN":t.nan+"";function d(t){var e=(t=Ys(t)).fill,i=t.align,d=t.sign,u=t.symbol,_=t.zero,p=t.width,f=t.comma,g=t.precision,y=t.trim,m=t.type;"n"===m?(f=!0,m="g"):Ks[m]||(void 0===g&&(g=12),y=!0,m="g"),(_||"0"===e&&"="===i)&&(_=!0,e="0",i="=");var x="$"===u?n:"#"===u&&/[boxX]/.test(m)?"0"+m.toLowerCase():"",v="$"===u?r:/[%p]/.test(m)?o:"",b=Ks[m],w=/[defgprs%]/.test(m);function A(t){var n,r,o,u=x,A=v;if("c"===m)A=b(t)+A,t="";else{var k=(t=+t)<0||1/t<0;if(t=isNaN(t)?c:b(Math.abs(t),g),y&&(t=function(t){t:for(var e,i=t.length,s=1,n=-1;s<i;++s)switch(t[s]){case".":n=e=s;break;case"0":0===n&&(n=s),e=s;break;default:if(!+t[s])break t;n>0&&(n=0)}return n>0?t.slice(0,n)+t.slice(e+1):t}(t)),k&&0==+t&&"+"!==d&&(k=!1),u=(k?"("===d?d:h:"-"===d||"("===d?"":d)+u,A=("s"===m?nn[8+qs/3]:"")+A+(k&&"("===d?")":""),w)for(n=-1,r=t.length;++n<r;)if(48>(o=t.charCodeAt(n))||o>57){A=(46===o?a+t.slice(n+1):t.slice(n))+A,t=t.slice(0,n);break}}f&&!_&&(t=s(t,1/0));var L=u.length+t.length+A.length,S=L<p?new Array(p-L+1).join(e):"";switch(f&&_&&(t=s(S+t,S.length?p-A.length:1/0),S=""),i){case"<":t=u+t+A+S;break;case"=":t=u+S+t+A;break;case"^":t=S.slice(0,L=S.length>>1)+u+t+A+S.slice(L);break;default:t=S+u+t+A}return l(t)}return g=void 0===g?6:/[gprs]/.test(m)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),A.toString=function(){return t+""},A}return{format:d,formatPrefix:function(t,e){var i=d(((t=Ys(t)).type="f",t)),s=3*Math.max(-8,Math.min(8,Math.floor(Us(e)/3))),n=Math.pow(10,-s),r=nn[8+s/3];return function(t){return i(n*t)+r}}}}function an(t,e,i,s){var n,r=Li(t,e,i);switch((s=Ys(null==s?",f":s)).type){case"s":var a=Math.max(Math.abs(t),Math.abs(e));return null!=s.precision||isNaN(n=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Us(e)/3)))-Us(Math.abs(t)))}(r,a))||(s.precision=n),en(s,a);case"":case"e":case"g":case"p":case"r":null!=s.precision||isNaN(n=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Us(e)-Us(t))+1}(r,Math.max(Math.abs(t),Math.abs(e))))||(s.precision=n-("e"===s.type));break;case"f":case"%":null!=s.precision||isNaN(n=function(t){return Math.max(0,-Us(Math.abs(t)))}(r))||(s.precision=n-2*("%"===s.type))}return tn(s)}function ln(t){var e=t.domain;return t.ticks=function(t){var i=e();return function(t,e,i){if(!((i=+i)>0))return[];if((t=+t)==(e=+e))return[t];const s=e<t,[n,r,a]=s?Ai(e,t,i):Ai(t,e,i);if(!(r>=n))return[];const l=r-n+1,o=new Array(l);if(s)if(a<0)for(let t=0;t<l;++t)o[t]=(r-t)/-a;else for(let t=0;t<l;++t)o[t]=(r-t)*a;else if(a<0)for(let t=0;t<l;++t)o[t]=(n+t)/-a;else for(let t=0;t<l;++t)o[t]=(n+t)*a;return o}(i[0],i[i.length-1],null==t?10:t)},t.tickFormat=function(t,i){var s=e();return an(s[0],s[s.length-1],null==t?10:t,i)},t.nice=function(i){null==i&&(i=10);var s,n,r=e(),a=0,l=r.length-1,o=r[a],h=r[l],c=10;for(h<o&&(n=o,o=h,h=n,n=a,a=l,l=n);c-- >0;){if((n=ki(o,h,i))===s)return r[a]=o,r[l]=h,e(r);if(n>0)o=Math.floor(o/n)*n,h=Math.ceil(h/n)*n;else{if(!(n<0))break;o=Math.ceil(o*n)/n,h=Math.floor(h*n)/n}s=n}return t},t}function on(){var t=Fs();return t.copy=function(){return Ns(t,on())},Ti.apply(t,arguments),ln(t)}Qs=rn({thousands:",",grouping:[3],currency:["$",""]}),tn=Qs.format,en=Qs.formatPrefix;const hn=new Date,cn=new Date;function dn(t,e,i,s){function n(e){return t(e=0===arguments.length?new Date:new Date(+e)),e}return n.floor=e=>(t(e=new Date(+e)),e),n.ceil=i=>(t(i=new Date(i-1)),e(i,1),t(i),i),n.round=t=>{const e=n(t),i=n.ceil(t);return t-e<i-t?e:i},n.offset=(t,i)=>(e(t=new Date(+t),null==i?1:Math.floor(i)),t),n.range=(i,s,r)=>{const a=[];if(i=n.ceil(i),r=null==r?1:Math.floor(r),!(i<s&&r>0))return a;let l;do{a.push(l=new Date(+i)),e(i,r),t(i)}while(l<i&&i<s);return a},n.filter=i=>dn((e=>{if(e>=e)for(;t(e),!i(e);)e.setTime(e-1)}),((t,s)=>{if(t>=t)if(s<0)for(;++s<=0;)for(;e(t,-1),!i(t););else for(;--s>=0;)for(;e(t,1),!i(t););})),i&&(n.count=(e,s)=>(hn.setTime(+e),cn.setTime(+s),t(hn),t(cn),Math.floor(i(hn,cn))),n.every=t=>(t=Math.floor(t),isFinite(t)&&t>0?t>1?n.filter(s?e=>s(e)%t==0:e=>n.count(0,e)%t==0):n:null)),n}const un=dn((()=>{}),((t,e)=>{t.setTime(+t+e)}),((t,e)=>e-t));un.every=t=>(t=Math.floor(t),isFinite(t)&&t>0?t>1?dn((e=>{e.setTime(Math.floor(e/t)*t)}),((e,i)=>{e.setTime(+e+i*t)}),((e,i)=>(i-e)/t)):un:null),un.range;const _n=1e3,pn=6e4,fn=36e5,gn=864e5,yn=6048e5,mn=2592e6,xn=31536e6,vn=dn((t=>{t.setTime(t-t.getMilliseconds())}),((t,e)=>{t.setTime(+t+e*_n)}),((t,e)=>(e-t)/_n),(t=>t.getUTCSeconds()));vn.range;const bn=dn((t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*_n)}),((t,e)=>{t.setTime(+t+e*pn)}),((t,e)=>(e-t)/pn),(t=>t.getMinutes()));bn.range;const wn=dn((t=>{t.setUTCSeconds(0,0)}),((t,e)=>{t.setTime(+t+e*pn)}),((t,e)=>(e-t)/pn),(t=>t.getUTCMinutes()));wn.range;const An=dn((t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*_n-t.getMinutes()*pn)}),((t,e)=>{t.setTime(+t+e*fn)}),((t,e)=>(e-t)/fn),(t=>t.getHours()));An.range;const kn=dn((t=>{t.setUTCMinutes(0,0,0)}),((t,e)=>{t.setTime(+t+e*fn)}),((t,e)=>(e-t)/fn),(t=>t.getUTCHours()));kn.range;const Ln=dn((t=>t.setHours(0,0,0,0)),((t,e)=>t.setDate(t.getDate()+e)),((t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*pn)/gn),(t=>t.getDate()-1));Ln.range;const Sn=dn((t=>{t.setUTCHours(0,0,0,0)}),((t,e)=>{t.setUTCDate(t.getUTCDate()+e)}),((t,e)=>(e-t)/gn),(t=>t.getUTCDate()-1));Sn.range;const Cn=dn((t=>{t.setUTCHours(0,0,0,0)}),((t,e)=>{t.setUTCDate(t.getUTCDate()+e)}),((t,e)=>(e-t)/gn),(t=>Math.floor(t/gn)));function Rn(t){return dn((e=>{e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)}),((t,e)=>{t.setDate(t.getDate()+7*e)}),((t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*pn)/yn))}Cn.range;const Tn=Rn(0),Mn=Rn(1),zn=Rn(2),Dn=Rn(3),$n=Rn(4),Vn=Rn(5),Wn=Rn(6);function En(t){return dn((e=>{e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)}),((t,e)=>{t.setUTCDate(t.getUTCDate()+7*e)}),((t,e)=>(e-t)/yn))}Tn.range,Mn.range,zn.range,Dn.range,$n.range,Vn.range,Wn.range;const Bn=En(0),In=En(1),jn=En(2),Hn=En(3),Nn=En(4),On=En(5),Fn=En(6);Bn.range,In.range,jn.range,Hn.range,Nn.range,On.range,Fn.range;const Pn=dn((t=>{t.setDate(1),t.setHours(0,0,0,0)}),((t,e)=>{t.setMonth(t.getMonth()+e)}),((t,e)=>e.getMonth()-t.getMonth()+12*(e.getFullYear()-t.getFullYear())),(t=>t.getMonth()));Pn.range;const Un=dn((t=>{t.setUTCDate(1),t.setUTCHours(0,0,0,0)}),((t,e)=>{t.setUTCMonth(t.getUTCMonth()+e)}),((t,e)=>e.getUTCMonth()-t.getUTCMonth()+12*(e.getUTCFullYear()-t.getUTCFullYear())),(t=>t.getUTCMonth()));Un.range;const qn=dn((t=>{t.setMonth(0,1),t.setHours(0,0,0,0)}),((t,e)=>{t.setFullYear(t.getFullYear()+e)}),((t,e)=>e.getFullYear()-t.getFullYear()),(t=>t.getFullYear()));qn.every=t=>isFinite(t=Math.floor(t))&&t>0?dn((e=>{e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)}),((e,i)=>{e.setFullYear(e.getFullYear()+i*t)})):null,qn.range;const Xn=dn((t=>{t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),((t,e)=>{t.setUTCFullYear(t.getUTCFullYear()+e)}),((t,e)=>e.getUTCFullYear()-t.getUTCFullYear()),(t=>t.getUTCFullYear()));function Yn(t,e,i,s,n,r){const a=[[vn,1,_n],[vn,5,5e3],[vn,15,15e3],[vn,30,3e4],[r,1,pn],[r,5,3e5],[r,15,9e5],[r,30,18e5],[n,1,fn],[n,3,108e5],[n,6,216e5],[n,12,432e5],[s,1,gn],[s,2,1728e5],[i,1,yn],[e,1,mn],[e,3,7776e6],[t,1,xn]];function l(e,i,s){const n=Math.abs(i-e)/s,r=_i((([,,t])=>t)).right(a,n);if(r===a.length)return t.every(Li(e/xn,i/xn,s));if(0===r)return un.every(Math.max(Li(e,i,s),1));const[l,o]=a[n/a[r-1][2]<a[r][2]/n?r-1:r];return l.every(o)}return[function(t,e,i){const s=e<t;s&&([t,e]=[e,t]);const n=i&&"function"==typeof i.range?i:l(t,e,i),r=n?n.range(t,+e+1):[];return s?r.reverse():r},l]}Xn.every=t=>isFinite(t=Math.floor(t))&&t>0?dn((e=>{e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),((e,i)=>{e.setUTCFullYear(e.getUTCFullYear()+i*t)})):null,Xn.range,Yn(Xn,Un,Bn,Cn,kn,wn);const[Gn,Zn]=Yn(qn,Pn,Tn,Ln,An,bn);function Kn(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function Jn(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function Qn(t,e,i){return{y:t,m:e,d:i,H:0,M:0,S:0,L:0}}var tr,er,ir={"-":"",_:" ",0:"0"},sr=/^\s*\d+/,nr=/^%/,rr=/[\\^$*+?|[\]().{}]/g;function ar(t,e,i){var s=t<0?"-":"",n=(s?-t:t)+"",r=n.length;return s+(r<i?new Array(i-r+1).join(e)+n:n)}function lr(t){return t.replace(rr,"\\$&")}function or(t){return new RegExp("^(?:"+t.map(lr).join("|")+")","i")}function hr(t){return new Map(t.map(((t,e)=>[t.toLowerCase(),e])))}function cr(t,e,i){var s=sr.exec(e.slice(i,i+1));return s?(t.w=+s[0],i+s[0].length):-1}function dr(t,e,i){var s=sr.exec(e.slice(i,i+1));return s?(t.u=+s[0],i+s[0].length):-1}function ur(t,e,i){var s=sr.exec(e.slice(i,i+2));return s?(t.U=+s[0],i+s[0].length):-1}function _r(t,e,i){var s=sr.exec(e.slice(i,i+2));return s?(t.V=+s[0],i+s[0].length):-1}function pr(t,e,i){var s=sr.exec(e.slice(i,i+2));return s?(t.W=+s[0],i+s[0].length):-1}function fr(t,e,i){var s=sr.exec(e.slice(i,i+4));return s?(t.y=+s[0],i+s[0].length):-1}function gr(t,e,i){var s=sr.exec(e.slice(i,i+2));return s?(t.y=+s[0]+(+s[0]>68?1900:2e3),i+s[0].length):-1}function yr(t,e,i){var s=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(i,i+6));return s?(t.Z=s[1]?0:-(s[2]+(s[3]||"00")),i+s[0].length):-1}function mr(t,e,i){var s=sr.exec(e.slice(i,i+1));return s?(t.q=3*s[0]-3,i+s[0].length):-1}function xr(t,e,i){var s=sr.exec(e.slice(i,i+2));return s?(t.m=s[0]-1,i+s[0].length):-1}function vr(t,e,i){var s=sr.exec(e.slice(i,i+2));return s?(t.d=+s[0],i+s[0].length):-1}function br(t,e,i){var s=sr.exec(e.slice(i,i+3));return s?(t.m=0,t.d=+s[0],i+s[0].length):-1}function wr(t,e,i){var s=sr.exec(e.slice(i,i+2));return s?(t.H=+s[0],i+s[0].length):-1}function Ar(t,e,i){var s=sr.exec(e.slice(i,i+2));return s?(t.M=+s[0],i+s[0].length):-1}function kr(t,e,i){var s=sr.exec(e.slice(i,i+2));return s?(t.S=+s[0],i+s[0].length):-1}function Lr(t,e,i){var s=sr.exec(e.slice(i,i+3));return s?(t.L=+s[0],i+s[0].length):-1}function Sr(t,e,i){var s=sr.exec(e.slice(i,i+6));return s?(t.L=Math.floor(s[0]/1e3),i+s[0].length):-1}function Cr(t,e,i){var s=nr.exec(e.slice(i,i+1));return s?i+s[0].length:-1}function Rr(t,e,i){var s=sr.exec(e.slice(i));return s?(t.Q=+s[0],i+s[0].length):-1}function Tr(t,e,i){var s=sr.exec(e.slice(i));return s?(t.s=+s[0],i+s[0].length):-1}function Mr(t,e){return ar(t.getDate(),e,2)}function zr(t,e){return ar(t.getHours(),e,2)}function Dr(t,e){return ar(t.getHours()%12||12,e,2)}function $r(t,e){return ar(1+Ln.count(qn(t),t),e,3)}function Vr(t,e){return ar(t.getMilliseconds(),e,3)}function Wr(t,e){return Vr(t,e)+"000"}function Er(t,e){return ar(t.getMonth()+1,e,2)}function Br(t,e){return ar(t.getMinutes(),e,2)}function Ir(t,e){return ar(t.getSeconds(),e,2)}function jr(t){var e=t.getDay();return 0===e?7:e}function Hr(t,e){return ar(Tn.count(qn(t)-1,t),e,2)}function Nr(t){var e=t.getDay();return e>=4||0===e?$n(t):$n.ceil(t)}function Or(t,e){return t=Nr(t),ar($n.count(qn(t),t)+(4===qn(t).getDay()),e,2)}function Fr(t){return t.getDay()}function Pr(t,e){return ar(Mn.count(qn(t)-1,t),e,2)}function Ur(t,e){return ar(t.getFullYear()%100,e,2)}function qr(t,e){return ar((t=Nr(t)).getFullYear()%100,e,2)}function Xr(t,e){return ar(t.getFullYear()%1e4,e,4)}function Yr(t,e){var i=t.getDay();return ar((t=i>=4||0===i?$n(t):$n.ceil(t)).getFullYear()%1e4,e,4)}function Gr(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+ar(e/60|0,"0",2)+ar(e%60,"0",2)}function Zr(t,e){return ar(t.getUTCDate(),e,2)}function Kr(t,e){return ar(t.getUTCHours(),e,2)}function Jr(t,e){return ar(t.getUTCHours()%12||12,e,2)}function Qr(t,e){return ar(1+Sn.count(Xn(t),t),e,3)}function ta(t,e){return ar(t.getUTCMilliseconds(),e,3)}function ea(t,e){return ta(t,e)+"000"}function ia(t,e){return ar(t.getUTCMonth()+1,e,2)}function sa(t,e){return ar(t.getUTCMinutes(),e,2)}function na(t,e){return ar(t.getUTCSeconds(),e,2)}function ra(t){var e=t.getUTCDay();return 0===e?7:e}function aa(t,e){return ar(Bn.count(Xn(t)-1,t),e,2)}function la(t){var e=t.getUTCDay();return e>=4||0===e?Nn(t):Nn.ceil(t)}function oa(t,e){return t=la(t),ar(Nn.count(Xn(t),t)+(4===Xn(t).getUTCDay()),e,2)}function ha(t){return t.getUTCDay()}function ca(t,e){return ar(In.count(Xn(t)-1,t),e,2)}function da(t,e){return ar(t.getUTCFullYear()%100,e,2)}function ua(t,e){return ar((t=la(t)).getUTCFullYear()%100,e,2)}function _a(t,e){return ar(t.getUTCFullYear()%1e4,e,4)}function pa(t,e){var i=t.getUTCDay();return ar((t=i>=4||0===i?Nn(t):Nn.ceil(t)).getUTCFullYear()%1e4,e,4)}function fa(){return"+0000"}function ga(){return"%"}function ya(t){return+t}function ma(t){return Math.floor(+t/1e3)}function xa(t){return new Date(t)}function va(t){return t instanceof Date?+t:+new Date(+t)}function ba(t,e,i,s,n,r,a,l,o,h){var c=Fs(),d=c.invert,u=c.domain,_=h(".%L"),p=h(":%S"),f=h("%I:%M"),g=h("%I %p"),y=h("%a %d"),m=h("%b %d"),x=h("%B"),v=h("%Y");function b(t){return(o(t)<t?_:l(t)<t?p:a(t)<t?f:r(t)<t?g:s(t)<t?n(t)<t?y:m:i(t)<t?x:v)(t)}return c.invert=function(t){return new Date(d(t))},c.domain=function(t){return arguments.length?u(Array.from(t,va)):u().map(xa)},c.ticks=function(e){var i=u();return t(i[0],i[i.length-1],null==e?10:e)},c.tickFormat=function(t,e){return null==e?b:h(e)},c.nice=function(t){var i=u();return t&&"function"==typeof t.range||(t=e(i[0],i[i.length-1],null==t?10:t)),t?u(function(t,e){var i,s=0,n=(t=t.slice()).length-1,r=t[s],a=t[n];return a<r&&(i=s,s=n,n=i,i=r,r=a,a=i),t[s]=e.floor(r),t[n]=e.ceil(a),t}(i,t)):c},c.copy=function(){return Ns(c,ba(t,e,i,s,n,r,a,l,o,h))},c}function wa(){return Ti.apply(ba(Gn,Zn,qn,Pn,Tn,Ln,An,bn,vn,er).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Aa(t,e,i,s=0){const n=Wt(t),r=n.text().trim().split("\n");t.innerHTML="";const a=+n.attr("x");let l=+n.attr("y");const o=n.attr("text-anchor")||"start";for(let t=0;t<r.length;t++){const h=r[t].split(/[^\S\u00A0]+/).reverse();let c=n.append("tspan").attr("x",a).attr("y",l).attr("text-anchor",o),d=h.pop(),u=[];for(;d;)u.push(d),c.text(u.join(" ")),c.node().getComputedTextLength()>e&&u.length>1&&(u.pop(),c.text(u.join(" ")),u=[d],l+=i,c=n.append("tspan").attr("x",a).attr("y",l).attr("text-anchor",o).text(d)),d=h.pop();l+=i+s}}function ka(t,e,i,s,n=null,r=3){let a=0,l=!1;for(;a<t.length&&!1===l;){e.innerHTML=t[a];const n=e.getBBox();l=n.width<=i&&n.height<=s,a+=1}if(null!==n&&!1===l){let t=e.getBBox();if(t.height>s)return!1;let a=e.innerHTML;for(;a.length>r&&t.width>i;)if(a=a.substring(0,a.length-1),e.innerHTML=a+n,t=e.getBBox(),t.width<=i)return!0;return!1}return l}function La(t,e,i){const s={400:t=>.1+.58*t,700:t=>.1+.65*t};return Math.ceil(t*(s[i]||s[400])(e))}function Sa(t,e,i,s){if(t.getComputedTextLength()<=e)return;const n=Wt(t),r=t.textContent.trim();if(!r||r&&0===r.length)return;const a=r.split(/\s+/);t.textContent="";const l=a.map((e=>(t.textContent=e+" ",t.getComputedTextLength())));t.textContent="";const o=function(t,e){const i=Array(e).fill(null).map((()=>[])),s=t.reduce(((t,e)=>t+e)),n=Math.max(...t),r=Math.max(s/e,n);let a=0,l=0;for(let s=0;s<t.length;s++){const n=t[s];l+n>r&&(a=Math.min(a+1,e-1),l=0),i[a].push(n),l+=n}return i}(l,i);let h=0,c=0;for(let t=0;t<o.length;t++)n.append("tspan").attr("x",0).attr("y",c).text(a.slice(h,h+o[t].length).join(" ")),h+=o[t].length,c+=s}!function(t){tr=function(t){var e=t.dateTime,i=t.date,s=t.time,n=t.periods,r=t.days,a=t.shortDays,l=t.months,o=t.shortMonths,h=or(n),c=hr(n),d=or(r),u=hr(r),_=or(a),p=hr(a),f=or(l),g=hr(l),y=or(o),m=hr(o),x={a:function(t){return a[t.getDay()]},A:function(t){return r[t.getDay()]},b:function(t){return o[t.getMonth()]},B:function(t){return l[t.getMonth()]},c:null,d:Mr,e:Mr,f:Wr,g:qr,G:Yr,H:zr,I:Dr,j:$r,L:Vr,m:Er,M:Br,p:function(t){return n[+(t.getHours()>=12)]},q:function(t){return 1+~~(t.getMonth()/3)},Q:ya,s:ma,S:Ir,u:jr,U:Hr,V:Or,w:Fr,W:Pr,x:null,X:null,y:Ur,Y:Xr,Z:Gr,"%":ga},v={a:function(t){return a[t.getUTCDay()]},A:function(t){return r[t.getUTCDay()]},b:function(t){return o[t.getUTCMonth()]},B:function(t){return l[t.getUTCMonth()]},c:null,d:Zr,e:Zr,f:ea,g:ua,G:pa,H:Kr,I:Jr,j:Qr,L:ta,m:ia,M:sa,p:function(t){return n[+(t.getUTCHours()>=12)]},q:function(t){return 1+~~(t.getUTCMonth()/3)},Q:ya,s:ma,S:na,u:ra,U:aa,V:oa,w:ha,W:ca,x:null,X:null,y:da,Y:_a,Z:fa,"%":ga},b={a:function(t,e,i){var s=_.exec(e.slice(i));return s?(t.w=p.get(s[0].toLowerCase()),i+s[0].length):-1},A:function(t,e,i){var s=d.exec(e.slice(i));return s?(t.w=u.get(s[0].toLowerCase()),i+s[0].length):-1},b:function(t,e,i){var s=y.exec(e.slice(i));return s?(t.m=m.get(s[0].toLowerCase()),i+s[0].length):-1},B:function(t,e,i){var s=f.exec(e.slice(i));return s?(t.m=g.get(s[0].toLowerCase()),i+s[0].length):-1},c:function(t,i,s){return k(t,e,i,s)},d:vr,e:vr,f:Sr,g:gr,G:fr,H:wr,I:wr,j:br,L:Lr,m:xr,M:Ar,p:function(t,e,i){var s=h.exec(e.slice(i));return s?(t.p=c.get(s[0].toLowerCase()),i+s[0].length):-1},q:mr,Q:Rr,s:Tr,S:kr,u:dr,U:ur,V:_r,w:cr,W:pr,x:function(t,e,s){return k(t,i,e,s)},X:function(t,e,i){return k(t,s,e,i)},y:gr,Y:fr,Z:yr,"%":Cr};function w(t,e){return function(i){var s,n,r,a=[],l=-1,o=0,h=t.length;for(i instanceof Date||(i=new Date(+i));++l<h;)37===t.charCodeAt(l)&&(a.push(t.slice(o,l)),null!=(n=ir[s=t.charAt(++l)])?s=t.charAt(++l):n="e"===s?" ":"0",(r=e[s])&&(s=r(i,n)),a.push(s),o=l+1);return a.push(t.slice(o,l)),a.join("")}}function A(t,e){return function(i){var s,n,r=Qn(1900,void 0,1);if(k(r,t,i+="",0)!=i.length)return null;if("Q"in r)return new Date(r.Q);if("s"in r)return new Date(1e3*r.s+("L"in r?r.L:0));if(e&&!("Z"in r)&&(r.Z=0),"p"in r&&(r.H=r.H%12+12*r.p),void 0===r.m&&(r.m="q"in r?r.q:0),"V"in r){if(r.V<1||r.V>53)return null;"w"in r||(r.w=1),"Z"in r?(n=(s=Jn(Qn(r.y,0,1))).getUTCDay(),s=n>4||0===n?In.ceil(s):In(s),s=Sn.offset(s,7*(r.V-1)),r.y=s.getUTCFullYear(),r.m=s.getUTCMonth(),r.d=s.getUTCDate()+(r.w+6)%7):(n=(s=Kn(Qn(r.y,0,1))).getDay(),s=n>4||0===n?Mn.ceil(s):Mn(s),s=Ln.offset(s,7*(r.V-1)),r.y=s.getFullYear(),r.m=s.getMonth(),r.d=s.getDate()+(r.w+6)%7)}else("W"in r||"U"in r)&&("w"in r||(r.w="u"in r?r.u%7:"W"in r?1:0),n="Z"in r?Jn(Qn(r.y,0,1)).getUTCDay():Kn(Qn(r.y,0,1)).getDay(),r.m=0,r.d="W"in r?(r.w+6)%7+7*r.W-(n+5)%7:r.w+7*r.U-(n+6)%7);return"Z"in r?(r.H+=r.Z/100|0,r.M+=r.Z%100,Jn(r)):Kn(r)}}function k(t,e,i,s){for(var n,r,a=0,l=e.length,o=i.length;a<l;){if(s>=o)return-1;if(37===(n=e.charCodeAt(a++))){if(n=e.charAt(a++),!(r=b[n in ir?e.charAt(a++):n])||(s=r(t,i,s))<0)return-1}else if(n!=i.charCodeAt(s++))return-1}return s}return x.x=w(i,x),x.X=w(s,x),x.c=w(e,x),v.x=w(i,v),v.X=w(s,v),v.c=w(e,v),{format:function(t){var e=w(t+="",x);return e.toString=function(){return t},e},parse:function(t){var e=A(t+="",!1);return e.toString=function(){return t},e},utcFormat:function(t){var e=w(t+="",v);return e.toString=function(){return t},e},utcParse:function(t){var e=A(t+="",!0);return e.toString=function(){return t},e}}}(t),er=tr.format,tr.parse,tr.utcFormat,tr.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});const Ca=["linear","time"],Ra=["ordinal","band"];class Ta{constructor(t,e="linear",i="bottom",s={}){this.chartArea=t,this.type=e,this.placement=i,this.flexibleBand=s.flexibleBand||!1,this.formatValue=s.formatValue||Ma,this.ticks=null,this.style={values:{font:{size:12,color:"#757575",weight:400},align:"h"===this.orient()?"center":s.valuesAlign||"right",thinLabels:null,allowLabelShortening:!0}},this.valuesWidth=null,this._lineWrapping=!1,this.scale=null}orient(){return"bottom"===this.placement||"top"===this.placement?"h":"v"}isContinuous(){return Ca.indexOf(this.type)>=0}isCategorical(){return Ra.indexOf(this.type)>=0}init(t,e){this._state=e,t.classList.add("dv_axis"),Wt(t).append("g").attr("class","dv_axisTicks")}prerender(t,e){this._state=e,this.valuesSel=Wt(t).select(".dv_axisTicks").selectAll("g").data(this.ticks).join("g").selectAll("text").data((t=>[t])).join("text").classed("dv_hidden",!1),this.valuesSel.text((t=>this.formatValue(t,{axis:this},e,this.chartArea.chart))).style("font-size",`${this.style.values.font.size}px`),this.xValuesSel=Wt(t).select(".dv_xAxis .dv_axisTicks").selectAll("g").data(this.ticks).join("g").selectAll("line").data((t=>[t])).join("line").classed("dv_hidden",!1).style("stroke","#ccc").style("stroke-width",1),this._computeValueLabelWidth()}render(t,e,i,s){this.valuesSel=Wt(t).select(".dv_axisTicks").selectAll("g").data(this.ticks).join("g").selectAll("text").data(((t,e)=>[{lbl:t,idx:e}])).join("text").style("fill",(t=>this._(this.style.values.font.color,t,{axis:this},e,this.chartArea.chart))).style("font-weight",(t=>this._(this.style.values.font.weight,t,{axis:this},e,this.chartArea.chart))),this.xValuesSel=Wt(t).select(".dv_axisTicks").selectAll("g").data(this.ticks).join("g").selectAll("line").data(((t,e)=>[{lbl:t,idx:e}])).join("line"),!1===this._lineWrapping&&this.valuesSel.text((t=>this.formatValue(t.lbl,{axis:this},e,this.chartArea.chart))).style("font-size",`${this.style.values.font.size}px`),"h"===this.orient()?this.renderH(t,e,i,s):this.renderV(t,e,i,s)}renderH(t,e,i,s){const n="bottom"===this.placement?i.bottom+this.style.values.font.size+4:i.top-4;this.valuesSel.attr("x",((t,e)=>this.scale(t.lbl,t.idx)+("band"===this.type?this.scale.bandwidth()/2:0))).attr("y",n+2).style("text-anchor","middle").call((t=>{const e=t.nodes();e.forEach((t=>t.classList.remove("dv_hidden"))),e.sort(((t,e)=>t.getBoundingClientRect().left-e.getBoundingClientRect().left)),this._hasOverlappingLabels(e)&&("band"===this.type&&!0===this.style.values.allowLabelShortening?this._shortenLabels(e):!1!==this.style.values.thinLabels&&this._thinLabels(e))})),this.xValuesSel.attr("x1",((t,e)=>this.scale(t.lbl,t.idx)+("band"===this.type?this.scale.bandwidth()/2:0))).attr("x2",((t,e)=>this.scale(t.lbl,t.idx)+("band"===this.type?this.scale.bandwidth()/2:0))).attr("y1",((t,e)=>i.bottom)).attr("y2",((t,e)=>i.bottom+5)).style("fill","black")}renderV(t,e,i,s){let n=0,r="start";if("center"===this.style.values.align?(n=this.valuesWidth.max/2,r="middle"):"right"===this.style.values.align&&(n=this.valuesWidth.max,r="end"),"band"===this.type&&this.flexibleBand){const t=this.valuesSel.nodes().map(((t,e)=>t.getBoundingClientRect().height+3));this.scale.stepSize(t)}this.valuesSel.attr("transform",((t,e,i)=>{let s=this.scale(t.lbl,t.idx);if("band"===this.type){s+=.5*this.scale.bandwidth(t.idx),s+=this.style.values.font.size+2;s-=i[e].getBoundingClientRect().height/2}else s+=this.style.values.font.size/2-2;return`translate(${n} ${s})`})).style("text-anchor",r).call((t=>{if(this.isContinuous()&&!1!==this.style.values.thinLabels||!0===this.style.values.thinLabels){const e=t.nodes();e.forEach((t=>t.classList.remove("dv_hidden"))),this._hasOverlappingLabels(e)&&this._thinLabels(e)}}))}wrapLabels(t,e=300){this._lineWrapping=!0,this.valuesSel.nodes().forEach((i=>{Sa(i,e,t,1.25*this.style.values.font.size)}))}_computeValueLabelWidth(){const t=this.valuesSel.nodes();this.valuesWidth={first:t[0].getBoundingClientRect().width,last:t[t.length-1].getBoundingClientRect().width,max:t.reduce(((t,e)=>Math.max(t,e.getBoundingClientRect().width)),0)}}_hasOverlappingLabels(t){for(let e=1;e<t.length;e++){if(jt(t[e].getBoundingClientRect(),t[e-1].getBoundingClientRect(),4))return!0}return!1}_thinLabels(t){const e=t.map((t=>t.getBoundingClientRect())),i=function(t,e){for(let i=e;i<t.length;i+=e)if(jt(t[i],t[i-e],4))return!0;return!1};let s=1;for(;i(e,s)&&s<t.length;)s+=1;for(let e=1;e<t.length;e++)e%s>0&&t[e].classList.add("dv_hidden")}_shortenLabels(t){if(this.style.values.allowLabelShortening){const e=this.scale.step()-4;t.forEach((t=>{const i=t.getBoundingClientRect();i.width>e&&ka([t.innerHTML],t,e,i.height,"…",3)}))}this._hasOverlappingLabels(t)&&this._thinLabels(t)}_(...t){const e="function"==typeof t[0]?t[0](...t.slice(1)):t[0],i=this._state&&this._state.ENV||null;return e&&i&&e[i]?e[i]:e}}function Ma(t,e,i,s){if("time"===e.axis.type){const i=e.axis._temporalResolution||"D";return za[i](t)}return`${t}`}const za={Y:t=>`${t.getFullYear()}`,M:t=>t.toLocaleDateString(dynvis.LOCALE||"en-US",{month:"numeric",year:"numeric"}),W:t=>t.toLocaleDateString(dynvis.LOCALE||"en-US",{day:"numeric",month:"numeric",year:"numeric"}),D:t=>t.toLocaleDateString(dynvis.LOCALE||"en-US",{day:"numeric",month:"numeric",year:"numeric"}),h:t=>t.toLocaleDateString(dynvis.LOCALE||"en-US",{hour:"numeric",day:"numeric",month:"numeric",year:"numeric"}),m:t=>t.toLocaleDateString(dynvis.LOCALE||"en-US",{minute:"numeric",hour:"numeric",day:"numeric",month:"numeric",year:"numeric"})};function Da(){let t=[],e=[],i=0,s=.3,n=30,r=null,a=null;function l(o,h){const c=void 0===h?t.flat(1).indexOf(o):h;let d=0;(t.length>1&&Array.isArray(t[0])?t.length:0)>0&&(d=function(t,e){let i=0;for(;i<t.length;){if(e<t[i].length)return i;e-=t[i].length,i++}return-1}(t,c)+1);const u=l.step();if(Array.isArray(r))return e[0]+u*s+a[c];let _=e[0]+u*s+c*u;return d>0&&(_+=d*n,_+=(d-1)*(2*u*s-u*i)),_}return l.domain=function(e){return void 0===e?t:(t=e,this)},l.range=function(t){return void 0===t?e:(e=t,this)},l.step=function(a){if(null!==r)return Array.isArray(r)?"number"==typeof a?r[a]:r.reduce(((t,e)=>Math.min(t,e))):r;if(e.length<2)return 0;const l=t.flat(1).length,o=t.length>1&&Array.isArray(t[0])?t.length:0;return(e[1]-e[0]-o*n)/(l*(1-i)+(0===o?l-1:l-1-(o-1))*i+(0===o?2:2+2*(o-1))*s)},l.bandwidth=function(t){return l.step(t)*(1-i)},l.stepSize=function(t){if(void 0===t)return r;if(r=t,Array.isArray(t)){let e=0;a=[];for(let i=0;i<t.length;i++)a.push(e),e+=t[i]}return this},l.paddingInner=function(t){return void 0===t?i:(i=t,this)},l.paddingOuter=function(t){return void 0===t?s:(s=t,this)},l.hasGroups=function(){return t.length>0&&Array.isArray(t[0])},l.groupSpacing=function(t){return void 0===t?n:(n=t,this)},l.group=function(e){const i=e<=0?0:t.slice(0,e).map((t=>t.length)).reduce(((t,e)=>t+e)),r=l.step();return l(null,i)-n-r*s},l.type="band",l}function $a(t,e,i,s=[1,2,5,10]){const n=(e-t)/i,r=Math.pow(10,Math.floor(Math.log10(n))),a=s.map((t=>Math.abs(t*r-n))),l=a.indexOf(Math.min(...a));return{step:r*s[l],base:r,idx:l}}class Va{constructor(t){this.chart=t,this.viewRect=new ne(0,0,null,null),this.dataRect=new ne(0,0,null,null),this._xAxis=null,this._yAxis=null,this._xAxisLabel=null,this._yAxisLabel=null,this._xDomain=[0,100],this._yDomain=[0,100],this._xDomainChanged=!1,this._yDomainChanged=!1,this._xValues=null,this._yValues=null,this.snapXDomainToTicks=!0,this.snapYDomainToTicks=!0,this.xScale=null,this.yScale=null,this._xGrid=null,this._yGrid=null,this._xTicks=null,this._yTicks=null,this.style={categories:{paddingInner:null,minimumPaddingInner:0},dataRect:{padding:{left:0,right:0,top:0,bottom:0}},xAxis:{format:t=>t,ticks:null,numberOfTicks:10,snapTicks:!1,label:{font:{size:12,color:"#757575"}}},yAxis:{format:t=>t,ticks:null,numberOfTicks:10,snapTicks:!1,label:{font:{size:12,color:"#757575"}},values:{offset:12}},grid:{horizontal:{customize:null},vertical:{customize:null}},tickStepMultipliers:[1,2,5,10]}}xAxis(t={}){return this._xAxis=new Ta(this,t.type||"linear",t.placement||"bottom",t),this._xAxisLabel=t.label||null,this}yAxis(t={}){return this._yAxis=new Ta(this,t.type||"linear",t.placement||"left",t),this._yAxisLabel=t.label||null,this}xGrid(t){return this._xGrid=t.show?t:null,this}yGrid(t){return this._yGrid=t.show?t:null,this}xDomain(t){return this._xDomain=t,this._xDomainChanged=!0,this}yDomain(t){return this._yDomain=t,this._yDomainChanged=!0,this}updateStyle(t){ee(this.style,t)}init(t,e){this._node=Wt(t).append("g").attr("class","dv_chartArea");const i=this._node.append("g").attr("class","dv_xAxis");if(this._xAxis.init&&this._xAxis.init(i.node(),e),this._xGridNode=this._node.append("g").attr("class","dv_xGrid"),this._xAxisLabelNode=this._node.append("g").attr("class","dv_xAxisLabel").append("g"),this._xAxisLabelRenderer=new Se({}),this._yAxis){const t=this._node.append("g").attr("class","dv_yAxis");this._yAxis.init(t.node(),e)}this._yGridNode=this._node.append("g").attr("class","dv_yGrid"),this._yAxisLabelNode=this._node.append("g").attr("class","dv_yAxisLabel").append("g"),this._yAxisLabelRenderer=new Se({}),this._propagateStyles()}prerender(t,e){this._propagateStyles(),this._prerenderXAxis(t,e),this._prerenderYAxis(t,e),this._renderXAxisLabel(e),this._renderYAxisLabel(e)}_prerenderXAxis(t,e){this._xAxis.formatValue=this.style.xAxis.format,this._xTicks=this._xAxis.isContinuous()?this._computeXTicks():this._xDomain,this._xAxis.ticks=this._xTicks,this._xAxis.prerender(this._node.select(".dv_xAxis").node(),e)}_prerenderYAxis(t,e){this._yAxis.formatValue=this.style.yAxis.format,this._yTicks=this._yAxis.isContinuous()?this.ticks(this._yDomain[0],this._yDomain[1],10):this._yDomain,this._yAxis&&(this._yAxis.ticks=this._yTicks.flat(1),this._yAxis.prerender(this._node.select(".dv_yAxis").node(),e))}_propagateStyles(){this._xAxis.style?ee(this._xAxis.style,this.style.xAxis):Object.keys(this._xAxis).forEach((t=>{t.style&&ee(t.style,this.style.xAxis)})),this._yAxis.style?ee(this._yAxis.style,this.style.yAxis):Object.keys(this._yAxis).forEach((t=>{t.style&&ee(t.style,this.style.yAxis)}))}render(t,e){this.computeDataRect(),this._xAxis.isContinuous()?this._computeXTicks():this._xdom=this._xDomain,this._yAxis.isContinuous()?this._computeYTicks():this._ydom=this._yDomain;const i=this.style.dataRect.padding;this.xScale=this._scale(this._xAxis.type,this._xdom,[this.dataRect.left+i.left,this.dataRect.right-i.right],this.style.xScale||{}),this.yScale=this._scale(this._yAxis.type,this._ydom,this._yAxis.isCategorical()?[this.dataRect.top+i.top,this.dataRect.bottom-i.bottom]:[this.dataRect.bottom-i.bottom,this.dataRect.top+i.top],this.style.yScale||{}),"band"===this._xAxis.type&&(!0===this.style.categories.noPadding?(this.xScale.paddingInner=0,this.xScale.paddingOuter=0):this._setCategoryPadding(this.xScale,this.style.xAxis.paddingInner)),"band"===this._yAxis.type&&(!0===this.style.categories.noPadding?(this.yScale.paddingInner=0,this.yScale.paddingOuter=0):this._setCategoryPadding(this.yScale,this.style.yAxis.paddingInner)),this._yAxis&&(this._yAxis.ticks=this._yTicks.flat(1),this._yAxis.scale=this.yScale,this._yAxis.render(this._node.select(".dv_yAxis").node(),e,this.dataRect,this._ydom),this._node.select(".dv_yAxis").attr("transform",`translate(${this.viewRect.left} 0)`));let s=0;this._xAxis&&(this._xAxis.ticks=this._xTicks,this._xAxis.scale=this.xScale,"top"===this._xAxis.placement&&"band"===this.yScale.type&&this.yScale.hasGroups()&&(s=this.yScale.groupSpacing()),this._xAxis.render(this._node.select(".dv_xAxis").node(),e,{top:this.dataRect.top+s,bottom:this.dataRect.bottom,left:this.dataRect.left,right:this.dataRect.right},this._xdom)),this._xGrid&&this._renderXGrid(e,s),this._yGrid&&this._renderYGrid(e),this._xAxisLabel&&this._renderXAxisLabel(e,s),this._yAxisLabel&&this._renderYAxisLabel(e)}_renderXGrid(t,e=0){const i=this._xAxis.valuesSel.nodes().map((t=>t.classList.contains("dv_hidden")));this._xGridNode.selectAll("line").data(this._xTicks).join("line").attr("x1",(t=>this.xScale(t))).attr("x2",(t=>this.xScale(t))).attr("y1",this.dataRect.bottom).attr("y2",this.dataRect.top+e).style("stroke",(e=>this._(this._xGrid.color,e,{axis:"xAxis",chartArea:this},t,this.chart)||"#ccc")).style("stroke-width",(e=>{const i=this._(this._xGrid.width,e,{axis:"xAxis",chartArea:this},t,this.chart);return`${null==i?1:i}px`})).classed("dv_hidden",((t,e)=>i[e])).call((e=>{"function"==typeof this.style.grid.vertical.customize&&this.style.grid.vertical.customize(e,t,this)}))}_renderXAxisLabel(t,e=0){if(!this._xAxisLabel)return void this._xAxisLabelNode.selectAll("text").remove();ee(this._xAxisLabelRenderer.baseStyle,{width:Math.max(0,this.dataRect.width()||this.viewRect.width()-100),fontSize:this.style.xAxis.label.font.size,fontColor:this.style.xAxis.label.font.color,maxLines:2,textAlign:"center"});const i=this._xAxisLabel;this._xAxisLabelRenderer.render(i,this._xAxisLabelNode.node(),t);const s=this._xAxisLabelNode.node().getBoundingClientRect().height,n="bottom"===this._xAxis.placement?this.viewRect.bottom-s+e:this.viewRect.top+e;this._xAxisLabelNode.attr("transform",`translate(${this.dataRect.left} ${n})`)}_renderYAxisLabel(t){if(!this._yAxisLabel)return void this._yAxisLabelNode.selectAll("text").remove();ee(this._yAxisLabelRenderer.baseStyle,{width:Math.max(0,this.dataRect.width()||this.viewRect.width()-100),fontSize:this.style.yAxis.label.font.size,fontColor:this.style.yAxis.label.font.color,maxLines:2});const e=this._yAxisLabel;this._yAxisLabelRenderer.render(e,this._yAxisLabelNode.node(),t),this._yAxisLabelNode.attr("transform",`translate(${this.viewRect.left} ${this.viewRect.top})`)}_renderYGrid(t){const e=this._yAxis.valuesSel.nodes().map((t=>t.classList.contains("dv_hidden")));this._yGridNode.selectAll("line").data(this._yTicks).join("line").attr("y1",((t,e)=>this.yScale(t,e))).attr("y2",((t,e)=>this.yScale(t,e))).attr("x1",this.dataRect.left).attr("x2",this.dataRect.right).style("stroke",(e=>this._(this._yGrid.color,e,{axis:"yAxis",chartArea:this},t,this.chart)||"#ccc")).style("stroke-width",(e=>{const i=this._(this._yGrid.width,e,{axis:"yAxis",chartArea:this},t,this.chart);return`${null==i?1:i}px`})).classed("dv_hidden",((t,i)=>e[i])).call((e=>{"function"==typeof this.style.grid.horizontal.customize&&this.style.grid.horizontal.customize(e,t,this)}))}computeDataRect(){const t=this._xAxis?this._xAxis.valuesSel.nodes().reduce(((t,e)=>Math.max(t,e.getBoundingClientRect().height)),0):0,e=this._xAxisLabel?this._xAxisLabelNode.node().getBBox().height:0,i=this._yAxisLabel?this._yAxisLabelNode.node().getBBox().height:0;if(this.dataRect.top=this.viewRect.top+(this._yAxis&&this._yAxis.isCategorical()&&"top"===this._xAxis.placement?this._yAxis.style.values.font.size/2:0)+(this._yAxisLabel?i+12:0)+(this._xAxis&&"top"===this._xAxis.placement?t+4:0)+(this._xAxisLabel&&"top"===this._xAxis.placement?e+4:0),this.dataRect.bottom=this.viewRect.bottom-(this._xAxis&&"bottom"===this._xAxis.placement?t+4:0)-(this._xAxisLabel&&"bottom"===this._xAxis.placement?e+4:0),this._yAxis.isCategorical()){let t=this._yAxis.valuesWidth.max;this.style.yAxis.label.width&&(t=this._(this.style.yAxis.label.width,this.viewRect.width(),this._yAxis.valuesWidth.max));let e=this.style.yAxis.label.nLines;void 0!==e&&e>1&&!this.style.yAxis.label.width?t=this._yAxis.valuesWidth.max/e:e=Math.ceil(this._yAxis.valuesWidth.max/t),t<this._yAxis.valuesWidth.max&&(this._yAxis.wrapLabels(e,t),this._yAxis._computeValueLabelWidth())}const s=this._yAxis?this._yAxis.valuesWidth.max:0;this.dataRect.left=this.viewRect.left+(this._yAxis?s+this.style.yAxis.values.offset:0),this.dataRect.right=this.viewRect.right,this._xAxis&&this._xAxis.isContinuous()&&(this.dataRect.right-=this._xAxis.valuesWidth.last/2+4)}_scale(t,e,i,s={}){let n={linear:on,ordinal:zi,band:Da,time:wa}[t]||null;if(null===n&&(console.warn(`Invalid axis type: '${t}'. Use one of: 'linear', 'ordinal', 'band', 'time'`),n=on),n=n(),n.domain(e),"ordinal"===t&&2===i.length&&e.length>2){const t=e.length,s=(i[1]-i[0])/(t-1),r=e.map(((t,e)=>i[0]+e*s));n.range(r)}else n.range(i);for(const t in s)"function"==typeof n[t]&&n[t](s[t]);return n}ticks(t,e,i){const s=$a(t,e,i,this.style.tickStepMultipliers),n=Math.floor(t/s.step)*s.step,r=Math.ceil(e/s.step)*s.step,a=[];for(let t=n;t<=r;t+=s.step)a.push(t);return this._ensureMaximumOvershootRatio(a,[t,e],s,s),a}ticksTemporal(t,e,i){const s=wa().domain([t,e]).ticks(i);return s[0]!==t&&s.unshift(t),s[s.length-1]!==e&&s.push(e),{ticks:s,resolution:this._temporalResolution(t,e,i)}}_computeXTicks(){const t=this.style.dataRect.padding,e=this.dataRect.width()-t.left-t.right;if(null!==this.style.xAxis.ticks){const t=this.chart.transformedData&&this.chart.transformedData(this.chart._state)||null;this._xTicks=this._(this.style.xAxis.ticks,{width:e,chartArea:this,domain:this._xDomain,data:t},this.chart._state,this.chart)}if(null===this._xTicks||null===this.style.xAxis.ticks){let t=this.style.xAxis.numberOfTicks||10;if(null!==this._xAxis.valuesWidth){const i=this._xAxis&&this._xAxis.valuesWidth.max+12||0,s=Math.floor(e/i)-2;t=this.style.xAxis.numberOfTicks<s?this.style.xAxis.numberOfTicks:s,t=Math.max(2,t)}if(this._xTicks=null,"time"===this._xAxis.type){const e=this.ticksTemporal(this._xDomain[0],this._xDomain[1],t);this._xTicks=e.ticks,this._xAxis._temporalResolution=e.resolution}else this._xTicks=this.ticks(this._xDomain[0],this._xDomain[1],t);this._xTicks.length<2&&(this._xTicks=[...this._xDomain])}return!0===this.style.xAxis.snapTicks&&(this._xTicks=this._snapTicks(this._xTicks,this._xValues,this._xDomain)),this._xdom=this.snapXDomainToTicks?[this._xTicks[0],this._xTicks[this._xTicks.length-1]]:this._xDomain,this._xTicks}_computeYTicks(){const t=this.dataRect.height()/Math.min(30,this._yAxis&&this._yAxis.style.values.font.size+12||0);if(null!==this.style.yAxis.ticks){const e=this.chart.transformedData&&this.chart.transformedData(this.chart._state)||null;this._yTicks=this._(this.style.yAxis.ticks,{height:t,chartArea:this,domain:this._yDomain,data:e},this.chart._state,this.chart)}if(null===this._yTicks||null===this.style.yAxis.ticks){const e=this._(this.style.yAxis.numberOfTicks,this.chart._state,this.chart)||Math.min(10,Math.max(2,Math.floor(t)));this._yTicks=this.ticks(this._yDomain[0],this._yDomain[1],e)}return!0===this.style.yAxis.snapTicks&&(this._yTicks=this._snapTicks(this._yTicks,this._yValues,this._yDomain)),this._ydom=this.snapYDomainToTicks?[this._yTicks[0],this._yTicks[this._yTicks.length-1]]:this._yDomain,this._yTicks}_snapTicks(t,e,i){if(null==e)return console.warn("Snapping of tick values is not supported for this chart"),t;let s=t.map((t=>function(t,e){let i=e[0];for(let s=0;s<e.length;s++)Math.abs(e[s]-t)<Math.abs(i-t)&&(i=e[s]);return i}(t,e)));return s=[...new Set(s)],s=s.filter((t=>t>=i[0]&&t<=i[i.length-1])),s.sort(),s}_ensureMaximumOvershootRatio(t,e,i,s){const n=.2,r=t.length,a=[1,2,5,10];let l=(e[0]-t[0])/(t[r-1]-t[0]),o=i;l>n&&(o=0===i.idx?{step:i.base/2,base:i.base/10,idx:3}:{step:i.base*a[i.idx-1],base:i.base,idx:i.idx-1},t[0]=Math.floor(e[0]/o.step)*o.step);let h=(t[r-1]-e[1])/(t[r-1]-t[0]),c=s;h>n&&(c=0===s.idx?{step:s.base/2,base:s.base/10,idx:3}:{step:s.base*a[s.idx-1],base:s.base,idx:s.idx-1},t[r-1]=Math.ceil(e[1]/c.step)*c.step),l=(e[0]-t[0])/(t[r-1]-t[0]),h=(t[r-1]-e[1])/(t[r-1]-t[0]),(l>n||h>n)&&this._ensureMaximumOvershootRatio(t,e,o,c)}_setCategoryPadding(t,e){const i=t.step(),s=this.style.categories.minimumPaddingInner;let n=this.style.categories.paddingInner||s||7;n=null!==this.style.categories.paddingInner?"function"==typeof this.style.categories.paddingInner?this.style.categories.paddingInner(t,this):this.style.categories.paddingInner:i*(void 0===e?.2:e),n=n<s?s:n,t.paddingInner(Math.min(.5,n/i))}_temporalResolution(t,e,i=10){const s=new Date(t),n=new Date(e);(isNaN(s.getTime())||isNaN(n.getTime()))&&console.warn("Unable to interpret date/time values as a valid Date or Time. You might want to use an ordinal axis type instead.");const r=n-s,a=[n.getYear()-s.getYear(),12*(n.getYear()-s.getYear())-s.getMonth()+n.getMonth(),r/6048e5,r/864e5,r/36e5,r/6e4];return"YMWDhm"[a.indexOf(a.filter((t=>t>=i))[0])]}_(...t){const e="function"==typeof t[0]?t[0](...t.slice(1)):t[0],i=this._state&&this._state.ENV||null;return e&&i&&e[i]?e[i]:e}}class Wa extends Va{constructor(t){super(t),this.dataRect={left:new ne(0,0,null,null),right:new ne(0,0,null,null)},this._xDomain={left:[0,100],right:[0,100]},this.style.dataRect.padding.gutter=16}xAxis(t={}){return this._xAxis={left:new Ta(this,t.type||"linear",t.placement||"bottom",t),right:new Ta(this,t.type||"linear",t.placement||"bottom",t)},this._xAxisLabel={left:t.labelLeft||t.label||null,right:t.labelRight||t.label||null},this}init(t,e){super.init(t,e);const i=this._node.select("g.dv_xAxis").append("g").attr("class","dv_xAxisLeft"),s=this._node.select("g.dv_xAxis").append("g").attr("class","dv_xAxisRight");this._xAxis.left.init(i.node(),e),this._xAxis.right.init(s.node(),e),this._xGridNode={left:this._xGridNode.append("g").attr("class","dv_xGridLeft"),right:this._xGridNode.append("g").attr("class","dv_xGridRight")},this._xAxisLabelNode={left:this._xAxisLabelNode.append("g").attr("class","dv_xAxisLabelLeft").append("g"),right:this._xAxisLabelNode.append("g").attr("class","dv_xAxisLabelRight").append("g")},this._xAxisLabelRenderer={left:new Se({}),right:new Se({})},this._yAxis.style.values.align="center"}_prerenderXAxis(t,e){this._xTicks=this._xAxis.left.isContinuous()?this._computeXTicks():this._xDomain,this._xAxis.left.ticks=this._xTicks.left,this._xAxis.right.ticks=this._xTicks.right,this._xAxis.left.prerender(this._node.select(".dv_xAxisLeft").node(),e),this._xAxis.right.prerender(this._node.select(".dv_xAxisRight").node(),e)}render(t,e){this.computeDataRect(),this._xAxis.left.isContinuous()?this._computeXTicks():this._xdom=this._xDomain,this._yAxis.isContinuous()?this._computeYTicks():this._ydom=this._yDomain;const i=this.style.dataRect.padding;if(this.xScale={left:this._scale(this._xAxis.left.type,this._xdom.left,[this.dataRect.left.right,this.dataRect.left.left]),right:this._scale(this._xAxis.right.type,this._xdom.right,[this.dataRect.right.left,this.dataRect.right.right])},this.yScale=this._scale(this._yAxis.type,this._ydom,this._yAxis.isCategorical()?[this.dataRect.left.top+i.top,this.dataRect.left.bottom-i.bottom]:[this.dataRect.left.bottom-i.bottom,this.dataRect.left.top+i.top]),"band"===this._xAxis.left.type&&(this._setCategoryPadding(this.xScale.left),this._setCategoryPadding(this.xScale.right)),"band"===this._yAxis.type&&this._setCategoryPadding(this.yScale),this._yAxis){this._yAxis.ticks=this._yTicks,this._yAxis.scale=this.yScale;const t=new ne(this.dataRect.left.right,this.dataRect.left.top,this.dataRect.right.left,this.dataRect.left.bottom);this._yAxis.render(this._node.select(".dv_yAxis").node(),e,t,this._ydom),this._node.select(".dv_yAxis").attr("transform",`translate(${t.left+i.gutter/2} 0)`)}this._xAxis.left.ticks=this._xTicks.left,this._xAxis.right.ticks=this._xTicks.right,this._xAxis.left.scale=this.xScale.left,this._xAxis.right.scale=this.xScale.right,this._xAxis.left.render(this._node.select(".dv_xAxisLeft").node(),e,this.dataRect.left,this._xdom.left),this._xAxis.right.render(this._node.select(".dv_xAxisRight").node(),e,this.dataRect.right,this._xdom.right),this._xGrid&&this._renderXGrid(e),this._yGrid&&this._renderYGrid(e),this._xAxisLabel&&this._renderXAxisLabel(e),this._yAxisLabel&&this._renderYAxisLabel(e)}_renderXGrid(t){["left","right"].forEach((t=>{this._xGridNode[t].selectAll("line").data(this._xTicks[t]).join("line").attr("x1",(e=>this.xScale[t](e))).attr("x2",(e=>this.xScale[t](e))).attr("y1",this.dataRect[t].bottom).attr("y2",this.dataRect[t].top).style("stroke",this._xGrid.color||"#ccc").style("stroke-width",`${this._xGrid.width||1}px`)}))}_renderXAxisLabel(t){["left","right"].forEach((e=>{ee(this._xAxisLabelRenderer[e].baseStyle,{width:Math.max(0,this.dataRect[e].width()||this.viewRect.width()/2-100),fontSize:12,fontColor:"#757575",maxLines:2,textAlign:"center"});const i=this._xAxisLabel[e];this._xAxisLabelRenderer[e].render(i,this._xAxisLabelNode[e].node(),t);const s=this._xAxisLabelNode[e].node().getBoundingClientRect().height,n="bottom"===this._xAxis[e].placement?this.viewRect.bottom-s:this.viewRect.top;this._xAxisLabelNode[e].attr("transform",`translate(${this.dataRect[e].left} ${n})`)}))}_computeXTicks(){const t=this.style.dataRect.padding,e=this.dataRect.left.width()-t.left-t.right-t.gutter/2,i=this.dataRect.right.width()-t.left-t.right-t.gutter/2;let s=10,n=10;if(null!==this._xAxis.left.valuesWidth){const t=this._xAxis.left.valuesWidth.max+12,r=this._xAxis.right.valuesWidth.max+12;s=Math.min(12,Math.max(2,Math.floor(e/t)-2)),n=Math.min(12,Math.max(2,Math.floor(i/r)-2))}if(this._xTicks={left:null,right:null},"time"===this._xAxis.type){const t=this.ticksTemporal(this._xDomain.left[0],this._xDomain.left[1],s);this._xTicks.left=t.ticks,this._xAxis.left._temporalResolution=t.resolution;const e=this.ticksTemporal(this._xDomain.right[0],this._xDomain.right[1],n);this._xTicks.right=e.ticks,this._xAxis.right._temporalResolution=e.resolution}else this._xTicks.left=this.ticks(this._xDomain.left[0],this._xDomain.left[1],s),this._xTicks.right=this.ticks(this._xDomain.right[0],this._xDomain.right[1],n);return this._xTicks.left.length<2&&(this._xTicks.left=[...this._xDomain.left]),this._xTicks.right.length<2&&(this._xTicks.right=[...this._xDomain.right]),this._xdom=this.snapXDomainToTicks?{left:[this._xTicks.left[0],this._xTicks.left[this._xTicks.left.length-1]],right:[this._xTicks.right[0],this._xTicks.right[this._xTicks.right.length-1]]}:this._xDomain,this._xTicks}computeDataRect(){const t=Math.max(this._xAxis.left.valuesSel.nodes().reduce(((t,e)=>Math.max(t,e.getBoundingClientRect().height)),0),this._xAxis.right.valuesSel.nodes().reduce(((t,e)=>Math.max(t,e.getBoundingClientRect().height)),0)),e=this._yAxis?this._yAxis.valuesWidth.max:0,i=this._xAxisLabel?Math.max(this._xAxisLabelNode.left.node().getBBox().height,this._xAxisLabelNode.right.node().getBBox().height):0,s=this._yAxisLabel?this._yAxisLabelNode.node().getBBox().height:0,n=this.viewRect.width()-e-this.style.dataRect.padding.gutter,r=this._xTicks.left[this._xTicks.left.length-1]-this._xTicks.left[0],a=n/(r+(this._xTicks.right[this._xTicks.right.length-1]-this._xTicks.right[0]))*r;this.dataRect.left.left=this.viewRect.left,this.dataRect.right.left=this.viewRect.left+a+e+this.style.dataRect.padding.gutter,this.dataRect.left.top=this.viewRect.top+(this._yAxis&&this._yAxis.isCategorical()&&"bottom"===this._xAxis.left.placement?this._yAxis.style.values.font.size/2:0)+(this._yAxisLabel?s+12:0)+("top"===this._xAxis.left.placement?t+i+8:0),this.dataRect.right.top=this.dataRect.left.top,this.dataRect.left.bottom=this.viewRect.bottom-("bottom"===this._xAxis.left.placement?t+i+8:0),this.dataRect.right.bottom=this.dataRect.left.bottom,this.dataRect.left.right=this.dataRect.left.left+a,this.dataRect.right.right=this.viewRect.right,this._xAxis.left.isContinuous()&&(this.dataRect.left.left+=this._xAxis.left.valuesWidth.last/2+4,this.dataRect.right.right-=this._xAxis.right.valuesWidth.last/2+4)}}class Ea extends ze{constructor(t={},e){void 0!==e||Object.prototype.hasOwnProperty.call(t,"class")||(e=t,t={}),super(t,e),this.hasChartArea=e.hasChartArea||!1,this.hasGriddedChartArea=e.hasGriddedChartArea||!1,this.chartArea=!0===this.hasChartArea?this.hasGriddedChartArea?new Wa(this):new Va(this):null,this.style({chartArea:{margin:{top:0,right:0,left:0,bottom:0}}}),this._sync={},this._syncFn={}}svg(){if(this._node)return this._svg||(this._svg="svg"===this._node.tagName?this._node:this._node.closest("svg")),this._svg;console.error("No SVG node found. Chart needs to be initalized before calling svg()")}defs(){if(!this._defs){const t=this.svg();this._defs=t.querySelector("defs")||Wt(t).insert("defs",":first-child").node()}return this._defs}xAxis(t={}){return this.chartArea.xAxis(t),this}yAxis(t={}){return this.chartArea.yAxis(t),this}init(t,e){super.init(t,e),this._node=t,this._clipPath=Wt(this.defs()).append("clipPath").attr("id",`clip_${this.id}`),this._clipPath.append("rect"),this.chartArea&&(this.chartArea.xGrid(this._style.xGrid||{}),this.chartArea.yGrid(this._style.yGrid||{}),this.chartArea.init(t,e),this.chartArea.updateStyle(this._style),this.on("prerenderDidEnd",this.afterPrerender.bind(this)))}prerender(t,e){super.prerender(t,e),this._node=t}afterPrerender(t,e,i){if(this.chartArea){this.chartArea.updateStyle(this._style);const i=this._style.chartArea.margin;this.chartArea.viewRect.setHeight(this.viewRect.height()-i.top-i.bottom),this.chartArea.viewRect.top=i.top,this.chartArea.viewRect.setWidth(this.viewRect.width()-i.left-i.right),this.chartArea.viewRect.left=i.left,this.chartArea.prerender(t,e)}}render(t,e){if(super.render(t,e),this.chartArea){const i=this._style.chartArea.margin;this.chartArea.viewRect.setHeight(this.viewRect.height()-i.top-i.bottom),this.chartArea.viewRect.top=i.top,this.chartArea.viewRect.setWidth(this.viewRect.width()-i.left-i.right),this.chartArea.viewRect.left=i.left,this.chartArea.render(t,e)}}selectNthChild(t,e){t&&t.childNodes[e]&&t.childNodes[e].classList.add("dv_select")}sync(t){for(const e in t){const i=t[e];Array.isArray(i)?i.forEach((t=>this.syncProperty(e,t))):this.syncProperty(e,i)}return this}syncProperty(t,e){const i=this._sync[t]||[];let s=null;for(let t=0;t<i.length;t++)i[t].target===e.target&&(s=t);if(null!==s&&!0===e.delete)return e.target.syncProperty(t,{target:this,delete:!0,propagate:!1}),void i.splice(s,1);null===s?(i.push(e),this._sync[t]=i):i[s]=e,!1!==e.propagate&&e.target.syncProperty(t,{...e,target:this,propagate:!1})}triggerSync(t,e){(this._sync[t]||[]).forEach((i=>{i.target.updateSync(this,t,e)}))}updateSync(t,e,i){const s=this._syncFn[e];void 0!==s?s(t,...i):console.warn(`No sync function for ${e} on chart ${this.uid}`)}}class Ba extends Ea{prerender(t,e){super.prerender(t,e),this.datasource.loaded?(this.emit("prerenderWillStart",[t,e,this]),this.emit("prerender",[t,e,this]),this.emit("prerenderDidEnd",[t,e,this])):console.info("Rendering of chart postponed. Datasource not yet ready.")}render(t,e){this.datasource.loaded&&(this.emit("renderWillStart",[t,e,this]),super.render(t,e),this.emit("render",[t,e,this]),this.emit("renderDidEnd",[t,e,this]))}}class Ia{insert(t){let e=null;if("defs"===t.tagName)e=t;else{const i="svg"===t.tagName?t:t.closest("svg");e=i.querySelector("defs"),e||(e=Wt(i).insert("defs",":first-child").node())}e.querySelector(`#${this.id}`)||this.render(e)}render(t){}}class ja extends Ia{constructor(t,e){super(),this.id=t,this.opts=e}render(t){const e=this.opts.strokeWidth||2,i=this.opts.xStep||10,s=this.opts.yStep||10,n=Wt(t).append("pattern").attr("id",this.id).attr("x",.5*i).attr("y",.5*s).attr("width",2*i).attr("height",2*s).attr("patternUnits","userSpaceOnUse");for(let t=-3;t<=3;t++)n.append("line").attr("x1",t*i).attr("y1",3*s).attr("x2",(t+3)*i).attr("y2",0).style("stroke-width",`${e}px`).style("stroke",this.opts.color||"#000").style("stroke-linecap","square")}}class Ha extends ze{}class Na extends Ha{constructor(t){super(t),this.style({padding:{bottom:5},font:{size:12,lineHeight:1.5},box:{shape:"rect",width:12,height:12,lineWidth:2,padding:{left:16,right:8,bottom:10},customize:()=>{}},column:{maxWidth:t=>t},align:"center"}),this.defineDefaults({categories:[],colors:[],shapes:null,boxes:null,display:!0}),this._d={data:null,categories:null,boxes:null},this._c={shownCategories:null,shownColors:null},this._events={select:{fn:null,options:null},deselect:{fn:null,options:null}}}on(t,e,i){if(!(["select","deselect"].indexOf(t)<0))return this._events[t]={fn:e,options:void 0===i?null:i},this;console.warn(`Event '${t} unknown.`)}init(t,e){super.init(t,e),t.classList.add("dv_legend"),t.classList.add("dv_categoricalLegend"),Wt(t).append("g").attr("class","dv_legendWrapper")}prerender(t,e){if(super.prerender(t,e),!(null===this.datasource||this.datasource&&this.datasource.loaded))return void console.info("Rendering of legend postponed. Datasource not yet ready.");this.emit("prerenderWillStart",[t,e,this]),this._d.data=this.transformedData(this._state),this._extractedCategories=this._(this._categories,{data:this._d.data},e,this),this._extractedColors=this._(this._colors,{data:this._d.data},e,this);let i=this._(this._display,this._extractedCategories,e,this);!0===i&&(i=this._extractedCategories.map((()=>!0))),!1===i&&(i=this._extractedCategories.map((()=>!1))),this._d.categories=this._extractedCategories.map(((t,e)=>({category:t,idx:e,color:this._extractedColors[e],display:i[e]}))),null!==this._boxes&&Array.isArray(this._boxes)?this._d.boxes=this._boxes:this._d.boxes=this._d.categories.map(((t,i)=>null!==this._boxes?this._(this._boxes,t,e,this):this._style.box));const s=(t,e,i)=>{void 0===t[e]&&(t[e]=i)};if(this._d.boxes.forEach((t=>{s(t,"shape","rect"),s(t,"width",12),s(t,"height",12),s(t,"lineWidth",2),s(t,"padding",{left:16,right:8,bottom:10}),s(t.padding,"left",16),s(t.padding,"right",8),s(t.padding,"bottom",10),s(t,"customize",(()=>{}))})),this._c.shownCategories=this._d.categories.filter((t=>t.display)),this._c.shownColors=this._extractedColors.filter(((t,e)=>i[e])),Wt(t).select(".dv_legendWrapper").selectAll("g").data([]).exit().remove(),0===this._c.shownCategories.length)return this.viewRect.setHeight(0),void Wt(t).classed("dv_hidden",!0);const n=Wt(t).select(".dv_legendWrapper").selectAll("g").data(this._c.shownCategories).enter().append("g").on("mouseover",this._select.bind(this)).on("mouseleave",this._deselect.bind(this)).style("cursor","default");n.each(((t,e,i)=>{const s=this._shapes&&this._shapes.length>e?this._shapes[e]:this._d.boxes[e].shape;this._renderShape(s,t,e,Wt(i[e]))}));const r=this._f(this._style.font.size,this,this._state);n.append("text"),Wt(t).select(".dv_legendWrapper").selectAll("text").text((t=>t.category)).style("font-size",`${r}px`).attr("x",((t,e)=>this._d.boxes[e].width+this._d.boxes[e].padding.right)).attr("y",((t,e)=>r+Math.max((this._d.boxes[e].height-r)/2,0))).each(((t,e,i)=>{const s="function"==typeof this._style.column.maxWidth?this._style.column.maxWidth(this.viewRect.width(),t.category,t.idx,i[e]):this._style.column.maxWidth;s&&Aa(i[e],s-this._d.boxes[e].width-this._d.boxes[e].padding.right-this._d.boxes[e].padding.left,r*this._style.font.lineHeight)})),this._fitLegendElements(t);const a=Wt(t).select(".dv_legendWrapper").node().getBoundingClientRect().height;this.viewRect.setHeight(a+this._style.padding.top+this._style.padding.bottom)}render(t,e){if(null!==this.datasource&&!this.datasource.loaded)return;const i=Wt(t).select(".dv_legendWrapper").node().getBoundingClientRect().width;let s=0;"center"===this._style.align&&(s=(this.viewRect.width()-i)/2),"right"===this._style.align&&(s=this.viewRect.width()-i),Wt(t).select(".dv_legendWrapper").selectAll(".dv_geom").each(((t,i,s)=>{if(!this._d.boxes[i].customize)return;const n=this._extractedCategories.indexOf(t.category||t);this._d.boxes[i].customize(s[i],t,n,e,this)})),Wt(t).select(".dv_legendWrapper").call($e(s+this.viewRect.left,this.viewRect.top))}_renderShape(t,e,i,s){if(null===t)return;const n=this._f(this._style.font.size,this,this._state),r=Math.max((n-this._d.boxes[i].height)/2+2,0);"rect"===t&&s.append("rect").attr("class","dv_geom").attr("x",0).attr("y",r).attr("width",this._d.boxes[i].width).attr("height",this._d.boxes[i].height).style("fill",this._c.shownColors[i]),"circle"===t&&s.append("ellipse").attr("class","dv_geom").attr("cx",this._d.boxes[i].width/2).attr("cy",r+this._d.boxes[i].height/2).attr("rx",this._d.boxes[i].width/2).attr("ry",this._d.boxes[i].height/2).style("fill",this._c.shownColors[i]),"line"===t&&s.append("line").attr("class","dv_geom").attr("x1",0).attr("y1",r+this._d.boxes[i].height/2).attr("x2",this._d.boxes[i].width).attr("y2",r+this._d.boxes[i].height/2).style("stroke",this._c.shownColors[i]).style("stroke-width",`${this._d.boxes[i].lineWidth}px`)}_fitLegendElements(t){const e=Wt(t).select(".dv_legendWrapper").selectAll("g").nodes().map((t=>{const e=t.getBoundingClientRect();return{w:e.width,h:e.height}})),i=this.viewRect.width();let s=!1,n=0;for(;!s;){n+=1;const r=Math.ceil(this._c.shownCategories.length/n),a=[],l=[];if(e.forEach(((t,e)=>{const i=e%r;a[i]=Math.max(t.w+this._d.boxes[e].padding.left,a[i]||0);const s=Math.floor(e/r);l[s]=Math.max(t.h+this._d.boxes[e].padding.bottom,l[s]||0)})),s=a.reduce(((t,e)=>t+e))-e.map(((t,e)=>this._d.boxes[e].padding.left)).reduce(((t,e)=>Math.min(t,e)))<=i,n===this._c.shownCategories.length&&(s=!0),s){const e=[0];a.forEach(((t,i)=>{e[i+1]=(e[i]||0)+t}));const i=[0];l.forEach(((t,e)=>{i[e+1]=(i[e]||0)+t})),Wt(t).select(".dv_legendWrapper").selectAll("g").attr("transform",((t,s)=>{const n=s%r,a=Math.floor(s/r);return`translate(${e[n]} ${i[a]})`}))}}}_select(t,e){this._events.select.fn&&this._events.select.fn(t,e,this._events.select.options)}_deselect(t,e){this._events.deselect.fn&&this._events.deselect.fn(t,e,this._events.select.options)}}function Oa(t,e){if(!t)return null;if("string"==typeof t)return t;const i=e.classList.contains("dv_alt")&&void 0!==t.alt?t.alt:t;return e.classList.contains("dv_selected")||e.classList.contains("dv_select")||e.parentElement.classList.contains("dv_selected")||e.parentElement.classList.contains("dv_select")?i.dark||i.selected||i.default||t.dark||t.selected||t.default:e.classList.contains("dv_faded")?i.light||i.faded||i.default||t.light||t.faded||t.default:i.default||t.default}class Fa extends Ea{constructor(t){t.hasChartArea=!0,super(t),this._values=null,this._confidenceInterval=null,this.style({categories:{font:{size:12,color:"#000"}},values:{show:"always",font:{size:11,colorInside:"#fff",colorOutside:"#000"},format:t=>t},bars:{spacing:3,fill:{default:"rgb(110, 160, 195)",selected:"rgb(110, 160, 195)"},confidenceInterval:{opacity:1,color:"#333",xStep:7,yStep:7,strokeWidth:2,label:"Confidence interval",showLegend:!0}},marks:{symbol:"line",stroke:"#000",strokeWidth:2,fill:"#000",width:0,height:null,customize:null,showLegend:!0},legend:{align:"left",position:"top",padding:{top:15,bottom:5}}}),this.legend=null,this._mark=null,this._markTitle=null,this.defineDefaults({minValue:null,maxValue:null,categories:null})}mark(t,e=null){return this._mark=t,this._markTitle=e,this}valueRange(t,e){return this._minValue=t,this._maxValue=e,this}values(t,e=null){return this._values=t,this._confidenceInterval=e,this}init(t,e){super.init(t,e);const i=this._style,s=Wt(t).append("g").attr("class","dv_chartWrapper");if(s.append("g").attr("class","dv_bars"),this._confidenceInterval&&s.append("g").attr("class","dv_bars_ci"),s.append("g").attr("class","dv_categories"),this._mark&&s.append("g").attr("class","dv_mark"),!1!==i.values.show&&"never"!==i.values.show&&s.append("g").attr("class",("hover"===i.values.show?"dv_hover ":"")+"dv_values"),s.append("g").attr("class","dv_barLabels"),this._legendNode=Wt(t).append("g").node(),this._confidenceInterval){new ja(`barchart${this.id}`,{xStep:i.bars.confidenceInterval.xStep,yStep:i.bars.confidenceInterval.yStep,strokeWidth:i.bars.confidenceInterval.strokeWidth,color:i.bars.confidenceInterval.color}).insert(t)}if(this._confidenceInterval&&this._style.bars.confidenceInterval.showLegend||this._markTitle&&this._style.marks.showLegend){const t=[],s=[],n=[];this._confidenceInterval&&this._style.bars.confidenceInterval.showLegend&&(t.push(this._(i.bars.confidenceInterval.label,e,this)),s.push(`url(#barchart${this.id})`),n.push("ci")),this._markTitle&&this._style.marks.showLegend&&(t.push(this._(this._markTitle,e,this)),s.push("#f0f0f0"),n.push("mark")),this.legend=(new Na).categories(t).colors(s).style({align:i.legend.align,padding:{bottom:0},box:{width:30,height:20,bottom:0,customize:(t,e,s,r,a)=>{"ci"===n[s]&&Wt(t).style("fill-opacity",i.bars.confidenceInterval.opacity),"mark"===n[s]&&this._renderMarkSymbol(t.parentNode,e,s,r,{x:15,y:10,h:20})}}}),this.legend.init(this._legendNode,e)}Wt(t).append("g").attr("class","dv_interaction")}prerender(t,e){super.prerender(t,e);const i=this._style;if(this._node=t,this.datasource.loaded){if(this.emit("prerenderWillStart",[t,e,this]),this._data=this.transformedData(e),this._cats="function"==typeof this._categories?this._categories(this._data,e,this):this._data.map((t=>t[this._categories])),this._vals="function"==typeof this._values?this._values(this._data,e,this):this._data.map((t=>t[this._values])),this._valsCI=this._confidenceIntervalValues(),this._markVals=this._mark?this._markValues():null,this.legend){const t=[];this._confidenceInterval&&this._style.bars.confidenceInterval.showLegend&&t.push(this._valsCI.flat().some((t=>null!==t&&0!==t))),this._markTitle&&this._style.marks.showLegend&&t.push(this._markVals.some((t=>null!==t))),this.legend.display(t)}this._vmax=null===this._maxValue?Si(this._vals.map(((t,e)=>t+this._valsCI[e][1]))):this._f(this._maxValue,this._vals,e,this),this._vmin=Math.min(0,null===this._minValue?Ci(this._vals.map(((t,e)=>t-this._valsCI[e][0]))):this._f(this._minValue,this._vals,e,this)),!1!==i.values.show&&"never"!==i.values.show&&Wt(t).select(".dv_values").selectAll("text").data(this._vals).join("text").attr("x",0).attr("y",0).style("font-size",`${i.values.font.size}px`).text((t=>i.values.format(t,e,this)))}else console.info("Rendering of chart postponed. Datasource not yet ready.")}_renderMarkSymbol(t,e,i,s){}_confidenceIntervalValues(){if(!this._confidenceInterval)return this._vals.map((t=>[0,0]));if("function"==typeof this._confidenceInterval){return this._confidenceInterval(this._data,this._state,this).map((t=>null===t?[0,0]:"number"==typeof t?[t,t]:[t.lower,t.upper]))}return"object"==typeof this._confidenceInterval?this._data.map((t=>[t[this._confidenceInterval.lower],t[this._confidenceInterval.upper]])):this._data.map((t=>[t[this._confidenceInterval],t[this._confidenceInterval]]))}_markValues(){return"string"==typeof this._mark?this._data.map((t=>t[this._mark])):"function"==typeof this._mark?this._mark(this._data,this._state,this):this._mark}_handleSelect(t){this._node.querySelectorAll(".dv_select").forEach((t=>t.classList.remove("dv_select")));const e=parseInt(t.target.getAttribute("data-idx"));this.selectNthChild(this._node.querySelector(".dv_bars"),e),this.selectNthChild(this._node.querySelector(".dv_categories"),e),this.selectNthChild(this._node.querySelector(".dv_values"),e),Wt(this._node).select(".dv_bars").selectAll("rect").style("fill",((t,e,i)=>Oa(this._f(this._style.bars.fill,{value:t,idx:e,nodes:i},this._state,this),i[e])))}_handleUnselect(t){this._node.querySelectorAll(".dv_select").forEach((t=>t.classList.remove("dv_select"))),Wt(this._node).select(".dv_bars").selectAll("rect").style("fill",((t,e,i)=>Oa(this._f(this._style.bars.fill,{value:t,idx:e,nodes:i},this._state,this),i[e])))}}function Pa(t,e,i){Wt(t).append("circle").attr("cx",e.x).attr("cy",e.y).attr("r",((i.width||i.height||8)-(i.strokeWidth||0))/2).style("fill",i.fill||"none").style("stroke",i.stroke||"none").style("stroke-width",i.strokeWidth)}function Ua(t,e,i){const s=i.height-(i.strokeWidth||0),n=i.width-(i.strokeWidth||0),r=[[e.x,e.y-s/2],[e.x+n/2,e.y],[e.x,e.y+s/2],[e.x-n/2,e.y]];Wt(t).append("polygon").attr("points",r.map((t=>`${t[0]},${t[1]}`)).join(" ")).style("fill",i.fill||"none").style("stroke",i.stroke||"none").style("stroke-width",i.strokeWidth)}function qa(t,e,i){const s=i.height/2,n=i.width/2;Wt(t).append("line").attr("x1",e.x-n).attr("y1",e.y-s).attr("x2",e.x+n).attr("y2",e.y+s).style("fill","none").style("stroke",i.stroke||"none").style("stroke-width",i.strokeWidth)}function Xa(t,e,i,s){const n={circle:Pa,diamond:Ua,line:qa}[e];n&&n(t,i,s)}class Ya extends Fa{constructor(t){super(t),this.xAxis({type:"linear",placement:"top"}),this.yAxis({type:"band"}),this.style({dataRect:{padding:{top:20,bottom:20}},grid:{horizontal:{show:!1},vertical:{show:!0,color:"#ccc",width:1}},stackedDisplay:!1,bars:{minWidth:200},barLabels:{color:"#000",font:{size:10,weight:400},offset:7},xAxis:{show:!0,format:null,numberOfTicks:10,customize:function(t){}},yAxis:{values:{align:"right"},font:{size:12,color:"#757575",weight:700}}}),this.defineDefaults({height:(t,e,i)=>30*t.values.length+50+(i.legend&&i.legend.viewRect.height()||0),xAxisTitle:null,barLabel:null})}xAxisFormat(t){return console.warn("[BarChart] xAxisFormat is deprecated. Use style({ xAxis: { format: ... } }) instead."),this._style.xAxis.format=t,this}init(t,e){super.init(t,e),t.classList.add("dv_horizontalBarChart"),this.chartArea.xGrid(this._style.grid.vertical),this.chartArea.yGrid(this._style.grid.horizontal),this._style.xAxis.format=this._style.xAxis.format||this._style.values.format}prerender(t,e){if(super.prerender(t,e),!this.datasource.loaded)return;const i=this._style;if(this.viewRect.setHeight(this._f(this._height,{values:this._vals,categories:this._cats},e,this)),this._prerenderBarLabels(t,e),this.legend&&(this._valsCI.flat().filter((t=>0!==t&&null!==t)).length>0||this._markTitle))if(this._legendNode.classList.remove("dv_hidden"),this.legend.maxViewRect=new ne(this.viewRect.left,this.viewRect.top,this.viewRect.width(),null),this.legend.prerender(this._legendNode,e),0===this.legend._c.shownCategories.length)this._legendNode.classList.add("dv_hidden"),this._style.chartArea.margin.top=0,this._style.chartArea.margin.bottom=0;else{const t="bottom"===i.legend.position?i.legend.padding.top:i.legend.padding.bottom;"top"===this._style.legend.position?this._style.chartArea.margin.top=this.legend.viewRect.height()+t:this._style.chartArea.margin.bottom=this.legend.viewRect.height()+t}else this._legendNode.classList.add("dv_hidden"),this._style.chartArea.margin.top=0,this._style.chartArea.margin.bottom=0;this.chartArea._xAxisLabel=this._f(this._xAxisTitle,this,e),this.chartArea.xDomain([this._vmin,this._vmax]),this.chartArea.yDomain(this._cats),this.emit("prerenderDidEnd",[t,e,this])}_prerenderBarLabels(t,e){null!==this._barLabel&&Wt(t).select(".dv_barLabels").selectAll("text").data(this._vals).join("text").style("font-size",`${this._style.barLabels.font.size}px`).style("font-weight",this._style.barLabels.font.weight).style("fill",this._style.barLabels.color).text(((t,i)=>this._(this._barLabel,{value:t,idx:i,category:this._cats[i]},e,this)))}render(t,e){this.datasource.loaded&&(this.emit("renderWillStart",[t,e,this]),super.render(t,e),this.legend&&(this._valsCI.flat().filter((t=>0!==t&&null!==t)).length>0||this._markTitle)&&"bottom"===this._style.legend.position&&t.querySelector(".dv_legend").setAttribute("transform",`translate(0 ${this.chartArea.viewRect.height()+this._style.legend.padding.top})`),this._renderBars(t,e),this._renderBarLabels(t,e),this._style.xAxis.customize(this.chartArea._xAxis,e,this))}_renderBars(t,e){Wt(t).select(".dv_bars").selectAll("rect").data(this._vals).join("rect").style("fill",((t,i,s)=>Oa(this._f(this._style.bars.fill,{value:t,idx:i,nodes:s},e,this),s[i]))).attr("x",(t=>Math.min(this.chartArea.xScale(0),this.chartArea.xScale(t||0)))).attr("y",((t,e)=>this.chartArea.yScale(this._cats[e]))).attr("height",this.chartArea.yScale.bandwidth()).attr("width",(t=>Math.abs(this.chartArea.xScale(t||0)-this.chartArea.xScale(0)))),this._confidenceInterval&&Wt(t).select(".dv_bars_ci").selectAll("rect").data(this._valsCI).join("rect").style("fill",`url(#barchart${this.id})`).style("fill-opacity",this._style.bars.confidenceInterval.opacity).attr("x",((t,e)=>this.chartArea.xScale(this._vals[e]-t[0]))).attr("y",((t,e)=>this.chartArea.yScale(this._cats[e]))).attr("height",this.chartArea.yScale.bandwidth()).attr("width",((t,e)=>this.chartArea.xScale(this._vals[e]+t[1])-this.chartArea.xScale(this._vals[e]-t[0]))),this._mark&&this._renderMark(t,e),this.legend&&this.legend.render(this._legendNode,e),Wt(t).select(".dv_interaction").selectAll("rect").data(this._vals).join("rect").attr("x",this.viewRect.left).attr("y",((t,e)=>this.chartArea.yScale(this._cats[e]))).attr("height",this.chartArea.yScale.bandwidth()).attr("width",this.viewRect.width()).attr("data-idx",((t,e)=>e)).on("mouseover",this._handleSelect.bind(this)).on("click",this._handleSelect.bind(this)).on("mouseout",this._handleUnselect.bind(this)),this._renderValues(t),this.emit("renderDidEnd",[t,e,this])}_renderBarLabels(t,e){if(null===this._barLabel)return;const i=Wt(t).select(".dv_bars").selectAll("rect").nodes().map((t=>{const e=parseFloat(t.getAttribute("x"));return{xmin:e,xmax:e+parseFloat(t.getAttribute("width"))}}));Wt(t).select(".dv_values").selectAll("text").nodes().forEach(((t,e)=>{const s=t.getBBox();i[e].xmin=Math.min(i[e].xmin,s.x),i[e].xmax=Math.max(i[e].xmax,s.x+s.width)})),Wt(t).select(".dv_bars_ci").selectAll("rect").nodes().forEach(((t,e)=>{const s=t.getBBox();s.width>0&&(i[e].xmin=Math.min(i[e].xmin,s.x),i[e].xmax=Math.max(i[e].xmax,s.x+s.width))}));const s=Wt(t).select(".dv_yAxis").selectAll("text").nodes().map((t=>{const e=t.getBBox();return e.x+e.width})).reduce(((t,e)=>Math.max(t,e)),0);Wt(t).select(".dv_barLabels").selectAll("text").attr("x",((t,e)=>t>0?i[e].xmax+this._style.barLabels.offset:i[e].xmin-this._style.barLabels.offset)).attr("y",((t,e)=>{const i=this._style.values.font.size,s=(this.chartArea.yScale.bandwidth()-i)/2-1.5;return this.chartArea.yScale(this._cats[e])+i+s})).style("text-anchor",(t=>t>0?"start":"end")).each(((t,e,i)=>{i[e].classList.remove("dv_hidden");const n=i[e].getBBox();(n.x<s||n.x+n.width>this.viewRect.width())&&i[e].classList.add("dv_hidden")}))}_renderMark(t,e){Wt(t).select(".dv_mark").selectAll("g").data(this._markVals).join("g").attr("transform",((t,e)=>null===t?"":`translate(${this.chartArea.xScale(t)} ${this.chartArea.yScale(this._cats[e])})`)).classed("dv_hidden",(t=>null===t)).call((t=>{t.each(((t,i,s)=>{s[i].innerHTML="",this._renderMarkSymbol(s[i],t,i,e)}))}))}_renderMarkSymbol(t,e,i,s,n=null){const r=this.chartArea.yScale.bandwidth(),a=n||{x:0,y:r/2,h:null},l=this._style;"function"==typeof l.marks.symbol?l.marks.symbol({value:e,idx:i,node:t,cx:a.x,cy:a.y,barHeight:a.h||r},s,this):Xa(t,l.marks.symbol,{x:a.x,y:a.y},Object.assign({},l.marks,{height:l.marks.height||a.h||r})),l.marks.customize&&l.marks.customize({value:e,idx:i,node:t},s,this)}_renderValues(t){!1!==this._style.values.show&&"never"!==this._style.values.show&&Wt(t).select(".dv_values").selectAll("text").data(this._vals).join("text").attr("y",((t,e)=>{const i=this._style.values.font.size,s=(this.chartArea.yScale.bandwidth()-i)/2-1.5;return this.chartArea.yScale(this._cats[e])+i+s})).each(this._renderValueLabel.bind(this))}_renderValueLabel(t,e,i){const s=i[e],n=s.getBoundingClientRect().width,r=this._valsCI[e][0],a=this._valsCI[e][1],l=null!==this._markVals?this._markVals[e]:null;n>=this.chartArea.xScale(t<0?-t-a:t-r)-(null!==l?this.chartArea.xScale(l):this.chartArea.xScale(0))-14?(s.setAttribute("x",t>=0||null===t?this.chartArea.xScale(t+this._valsCI[e][1])+7:this.chartArea.xScale(t-this._valsCI[e][0])-7),s.style.fill=this._f(this._style.values.font.colorOutside,{data:t,idx:e,node:i[e]},this._state,this),s.style.textAnchor=t<0?"end":"start"):(this._confidenceInterval?(s.setAttribute("x",t>0?this.chartArea.xScale(0)+7:this.chartArea.xScale(0)-7),s.style.textAnchor=t<0?"end":"start"):(s.setAttribute("x",t>0?this.chartArea.xScale(t+this._valsCI[e][1])-7:this.chartArea.xScale(t-this._valsCI[e][0])+7),s.style.textAnchor=t<0?"start":"end"),s.style.fill=this._f(this._style.values.font.colorInside,{data:t,idx:e,node:i[e]},this._state,this))}}class Ga extends ze{}class Za extends Ga{constructor(t){super(t),this.defineDefaults({anchorPosition:["lefttop","leftbottom","centertop","centerbottom","centerleft","centerright","righttop","rightbottom"],position:t=>({x:t.clientX,y:t.clientY}),text:null}),this._currentAnchorPosition=0,this.style({margin:{top:12,right:12,bottom:12,left:12},padding:{top:6,right:6,bottom:6,left:6},arrow:{width:16,height:10}}),this.viewRect.left=this._style.margin.left+this._style.padding.left,this.viewRect.top=this._style.margin.top+this._style.padding.top,this.viewRect.bottom=this.viewRect.top+12,this.viewRect.right=this.viewRect.left+24,this.shown=!1,this._viewPortWarningShown=!1}bindTooltip(t=null,e=null){this.chart=t,this.state=e;const i=this,s=function(){};return s.apply=function(t,e){const s=e[0];i.attach(s)},s}attach(t){t.on("mouseenter",this.show.bind(this)).on("mousemove",this.move.bind(this)).on("mouseout",this.hide.bind(this)),t.each(((t,e,i)=>{i[e].__idx__=e})),this._svgNode=function(t,e){let i=t.parentNode;for(;null!==i;){if(i.matches(e))return i;i=i.parentNode}return null}(t.node(),"svg")}show(t,e){if(this.shown)return void this.move(t,e);this._root=Wt(document.body).append("svg").attr("class","dv_tooltip"),this._root.node().innerHTML='\n      <defs>\n        <filter id="shadow">\n          <feDropShadow dx="0.2" dy="0.4" stdDeviation="3" flood-opacity="0.4"/>\n        </filter>\n      </defs>',this._border=this._root.append("g").attr("class","dv_shape").append("path").style("filter","url(#shadow)");const i=this._root.append("g").attr("class","dv_content");this._text?this._renderText(i.node(),t,e):this._renderCustom(i.node(),t,e),this.shown=!0}_dataFromEvent(t,e){const i={value:void 0===e?t.target.__data__:e,idx:t.target.__idx__};return this.datasource&&this.datasource.data&&(i.data=this.datasource.data[i.idx]||this.datasource.data||null),i}_renderText(t,e,i){const s=Wt(t).selectAll("g").data([0]).join("g").attr("transform",`translate(${this.viewRect.left} ${this.viewRect.top})`),n=new Se({}),r=this._f(this._text,{target:e.target,data:this._dataFromEvent(e,i),renderer:n,tooltip:this,event:e},this.state,this.chart);n.render(r,s.node(),{});const a=s.node().getBoundingClientRect();this.viewRect.setWidth(a.width),this.viewRect.setHeight(a.height)}_renderCustom(t,e,i){const s=this._dataFromEvent(e,i);this.emit("init",[t,s,this,e]),this.emit("prerender",[t,s,this,e]),this._setPosition(this._position(e)),this._renderBorder(this._anchorPosition[this._currentAnchorPosition]),this.emit("render",[t,s,this,e])}move(t,e){this._setPosition(this._position(t)),this._renderBorder(this._anchorPosition[this._currentAnchorPosition]);const i=this._root.select("g.dv_content");this._text?this._renderText(i.node(),t,e):this._renderCustom(i.node(),t,e)}hide(){this.emit("tooltipWillDisappear",[this]),this._root&&this._root.remove(),this.shown=!1}bbox(){const t=this._style;return{left:this.viewRect.left-t.padding.left-t.margin.left,right:this.viewRect.right+t.padding.right+t.margin.right,top:this.viewRect.top-t.padding.top-t.margin.top,bottom:this.viewRect.bottom+t.padding.bottom+t.margin.bottom}}_anchorCoordinate(t){const e=this.bbox(),i=(e.right-e.left)/2,s=(e.bottom-e.top)/2,n=this._style.margin;return{lefttop:{x:e.left+n.left-5,y:e.top-5},leftbottom:{x:e.left+n.left,y:e.bottom+5},centertop:{x:e.left+i,y:e.top-5},centerbottom:{x:e.left+i,y:e.bottom+5},centerleft:{x:e.left-5,y:e.top+s},centerright:{x:e.right+5,y:e.top+s},righttop:{x:e.right-n.right+5,y:e.top-5},rightbottom:{x:e.right-n.right,y:e.bottom+5}}[t]}_setPosition(t){for(let e=0;e<this._anchorPosition.length;e++)if(this._setPositionWithAnchor(t,this._anchorCoordinate(this._anchorPosition[e])),this._currentAnchorPosition=e,this._isInsideViewport())return;this._viewPortWarningShown||(console.warn("Tooltip is at least partly outside the view port"),this._viewPortWarningShown=!0);let e=-1/0,i=0;for(let s=0;s<this._anchorPosition.length;s++){this._setPositionWithAnchor(t,this._anchorCoordinate(this._anchorPosition[s]));const n=this._proportionInsideViewport();n>e&&(e=n,i=s)}this._setPositionWithAnchor(t,this._anchorCoordinate(this._anchorPosition[i])),this._currentAnchorPosition=i}_setPositionWithAnchor(t,e){const i=this.bbox(),s=window.scrollX,n=window.scrollY;this._root.style("position","absolute").style("left",`${t.x-e.x+s}px`).style("top",`${t.y-e.y+n}px`).attr("width",i.right-i.left+"px").attr("height",i.bottom-i.top+"px")}_isInsideViewport(){const t=this._root.node().getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)-3}_proportionInsideViewport(){const t=this._root.node().getBoundingClientRect(),e=window.innerHeight||document.documentElement.clientHeight,i=window.innerWidth||document.documentElement.clientWidth;return(Math.min(i,t.right)-Math.max(0,t.left))/t.width*((Math.min(e,t.bottom)-Math.max(0,t.top))/t.height)}_renderBorder(t){const e=this.bbox(),i=this._style,s=this._style.arrow.width,n=this._style.arrow.height,r=e.left+i.margin.left,a=e.right-i.margin.right,l=e.top+i.margin.top,o=e.bottom-i.margin.bottom,h=(a-r)/2,c=(o-l)/2,d={lefttop:`M ${r} ${l-n} L ${r} ${o} L ${a} ${o} L ${a} ${l} L ${r+s/2} ${l} Z`,leftbottom:`M ${r} ${l} L ${r} ${o+n} L ${r+s/2} ${o} L ${a} ${o} L ${a} ${l} Z`,centertop:`M ${r} ${l} L ${r} ${o} L ${a} ${o} L ${a} ${l} L ${r+h+s/2} ${l} L ${r+h} ${l-n} L ${r+h-s/2} ${l} Z`,centerbottom:`M ${r} ${l} L ${r} ${o} L ${r+h-s/2} ${o} L ${r+h} ${o+n} L ${r+h+s/2} ${o} L ${a} ${o} L ${a} ${l} Z`,centerleft:`M ${r} ${l} L ${r} ${l+c-s/2} L ${r-n} ${l+c} L ${r} ${l+c+s/2} L ${r} ${o} L ${a} ${o} L ${a} ${l} Z`,centerright:`M ${r} ${l} L ${r} ${o} L ${a} ${o} L ${a} ${l+c+s/2} L ${a+n} ${l+c} L ${a} ${l+c-s/2} L ${a} ${l} Z`,righttop:`M ${r} ${l} L ${r} ${o} L ${a} ${o} L ${a} ${l-n} L ${a-s/2} ${l} Z`,rightbottom:`M ${r} ${l} L ${r} ${o} L ${a-s/2} ${o} L ${a} ${o+n} L ${a} ${l} Z`}[t];this._border.attr("d",d)}}const Ka=["#C2CEF2","#AABAEA","#92A6E2","#7A92DA","#6680C9","#556DB4","#445CA0","#344A8C","#243979","#142966"];class Ja extends Ea{constructor(t={}){t.hasChartArea=!0,super(t),this.xAxis({type:"linear",placement:"top"}),this.yAxis({type:"band"}),this.chartArea.style.categories.minimumPaddingInner=14,this.legend=null,this._values=null,this._confidenceInterval=null,this.defineDefaults({categories:null,colors:null,height:(t,e,i)=>t.values.length*(24*t.series.length)+50+i.legend.viewRect.height(),series:null,tooltipText:null,xAxisTitle:null,xAxisFormat:t=>t}),this._minValue=null,this._maxValue=null,this.tooltip=null,this.style({bars:{spacing:1,confidenceInterval:{opacity:1,color:"#333",xStep:7,yStep:7,strokeWidth:2,label:"Confidence interval",showLegend:!0}},dataRect:{padding:{top:20,bottom:20}},grid:{horizontal:{show:!1},vertical:{show:!0,color:"#ccc",width:1}},legend:{show:!0,align:"top",box:{width:8,height:8},padding:{top:0,bottom:20}},values:{show:"never",onHover:{showAllSeries:!1,showAllCategories:!1},font:{size:10,weight:400,color:"#000",verticalShift:0},offset:5,format:(t,e,i,s)=>t},tooltip:{show:!0,maxWidth:300,font:{size:12},valueFormat:(t,e,i,s)=>Number.isInteger(t)?t:t.toFixed(1)}})}values(t,e=null){return this._values=t,this._confidenceInterval=e,this}minValue(t){return this._minValue=t,this}maxValue(t){return this._maxValue=t,this}valueRange(t,e){return this._minValue=t,this._maxValue=e,this}init(t,e){super.init(t,e);const i=this._style;if(t.classList.add("dv_groupedBarChart"),Wt(t).append("g").attr("class","dv_bars"),Wt(t).append("g").attr("class","dv_bars_ci"),this._legendNode=Wt(t).append("g").node(),Wt(t).append("g").attr("class",("hover"===this._style.values.show?"dv_hover ":"")+"dv_valueLabels"),Wt(t).append("g").attr("class","dv_interaction"),this.legend=(new Na).style({align:this._style.legend.align,box:{width:this._style.legend.box.width,height:this._style.legend.box.height,padding:{bottom:6},customize:(t,e,s,n,r)=>{s===this._seriesCache.length&&Wt(t).style("fill-opacity",i.bars.confidenceInterval.opacity)}}}),this.legend.init(this._legendNode,e),this.chartArea.xGrid(this._style.grid.vertical),this.chartArea.yGrid(this._style.grid.horizontal),this.chartArea._xAxisLabel=this._f(this._xAxisTitle,e,this),this.chartArea.xAxis.formatValue=this._xAxisFormat,this.chartArea.style.dataRect.padding.top=this._style.dataRect.padding.top,this.chartArea.style.dataRect.padding.bottom=this._style.dataRect.padding.bottom,this._hasConfidenceIntervals()){new ja(`barchart${this.id}`,{xStep:i.bars.confidenceInterval.xStep,yStep:i.bars.confidenceInterval.yStep,strokeWidth:i.bars.confidenceInterval.strokeWidth,color:i.bars.confidenceInterval.color}).insert(t)}this._style.tooltip.show&&(this.tooltip=new Za,this.tooltip.anchorPosition(["centerbottom","centertop","centerleft","centerright"]).on("init",this._initTooltip.bind(this)).on("prerender",this._prerenderTooltip.bind(this)).on("render",this._renderTooltip.bind(this)))}prerender(t,e){if(super.prerender(t,e),!this.datasource.loaded)return void console.info("Rendering of chart postponed. Datasource not yet ready.");this.emit("prerenderWillStart",[t,e,this]),this._data=this.transformedData(e),this._vals=this._f(this._values,this._data,e,this),this._cats=this._f(this._categories,this._vals,e,this),this._seriesCache=this._f(this._series,this._vals,this._data,e,this),this._valsCI=this._confidenceIntervalValues(),this._computeSeriesMax(),this._cols=this._colors?this._f(this._colors,this._vals,this._seriesCache,e,this):Ka,this._vmin=null===this._minValue?Math.min(0,Ci(this._vals.map((t=>t._min)))):this._(this._minValue,this._vals,this._data,e,this),this._vmax=null===this._maxValue?Si(this._vals.map((t=>t._max))):this._(this._maxValue,this._vals,this._data,e,this);const i=this._seriesCache.map((t=>t.title));this.legend.categories(this._hasConfidenceIntervals()&&this._style.bars.confidenceInterval.showLegend?[...i,this._style.bars.confidenceInterval.label]:i).colors(this._hasConfidenceIntervals()&&this._style.bars.confidenceInterval.showLegend?[...this._cols,`url(#barchart${this.id})`]:this._cols);this._(this._style.legend.show,{data:this._data,values:this._vals,categories:this._cats,series:this._seriesCache},e,this)&&this.legend._categories.length>1?(this.legend.maxViewRect=new ne(this.viewRect.left,this.viewRect.top,this.viewRect.width(),null),this.legend.prerender(this._legendNode,e),this.style({chartArea:{margin:{top:this.legend.viewRect.height()+this._style.legend.padding.bottom}}})):(this.style({chartArea:{margin:{top:0}}}),this._legendNode.querySelector("g.dv_legendWrapper").innerHTML=""),this.viewRect.setHeight(this._f(this._height,{values:this._vals,series:this._seriesCache},e,this)),this.chartArea.xDomain([this._vmin,this._vmax]),this.chartArea.yDomain(this._cats),this._prerenderValueLabels(t,e),this.emit("prerenderDidEnd",[t,e,this])}_prerenderValueLabels(t,e){if(null===this._values)return;if([!0,"always","hover"].indexOf(this._style.values.show)<0)return;Wt(t).select(".dv_valueLabels").selectAll("g").data(this._seriesCache.map(((t,e)=>({key:t.key,idx:e})))).join("g").selectAll("text").data(((t,e)=>this._vals.map(((i,s)=>({allValues:i,value:i[t.key],series:t.key,allSeries:this._seriesCache,seriesIdx:e,category:this._cats.flat(1)[s],categoryIdx:s}))))).join("text").style("font-size",`${this._style.values.font.size}px`).style("font-weight",this._style.values.font.weight).style("fill",(t=>this._(this._style.values.font.color,t,e,this))).text((t=>this._style.values.format(t.value,t,e,this)));const i=[...t.querySelectorAll(".dv_valueLabels text")].map((t=>t.getBoundingClientRect().width)).reduce(((t,e)=>Math.max(t,e)));this._style.dataRect.padding.right=Math.max(this._style.dataRect.padding.right||0,i)}render(t,e){if(!this.datasource.loaded)return;this.emit("renderWillStart",[t,e,this]),super.render(t,e);this._(this._style.legend.show,{data:this._data,values:this._vals,categories:this._cats,series:this._seriesCache},e,this)&&this.legend._categories.length>1&&this.legend.render(this._legendNode,e),this._renderBars(t,e),this._hasConfidenceIntervals()&&this._renderCI(t,e),this._renderValueLabels(t,e),this._renderInteractionBars(t,e)}_renderBars(t,e){const i=this._seriesCache.length;Wt(t).select(".dv_bars").selectAll("g").data(this._seriesCache.map(((t,e)=>({key:t.key,idx:e})))).join("g").attr("fill",((t,e)=>this._cols[e])).selectAll("rect").data((t=>this._vals.map(((e,i)=>({value:e[t.key],series:t,data:e,idx:i}))))).join("rect").attr("x",(t=>this.chartArea.xScale(Math.min(t.value,0)))).attr("y",((t,e)=>{const s=t.series.idx*(this.chartArea.yScale.bandwidth()/i);return this.chartArea.yScale(this._cats[e])+s})).attr("height",this.chartArea.yScale.bandwidth()/i-this._style.bars.spacing).attr("width",(t=>Math.abs(this.chartArea.xScale(t.value)-this.chartArea.xScale(0))))}_renderCI(t,e){const i=this._seriesCache.length;Wt(t).select(".dv_bars_ci").selectAll("g").data(this._seriesCache.map(((t,e)=>({key:t.key,idx:e})))).join("g").selectAll("rect").data((t=>this._valsCI.map(((e,i)=>({ci:e[t.key],series:t,idx:i}))))).join("rect").style("fill",`url(#barchart${this.id})`).style("fill-opacity",this._style.bars.confidenceInterval.opacity).attr("x",((t,e)=>this.chartArea.xScale(this._vals[e][t.series.key]-t.ci[0]))).attr("y",((t,e)=>{const s=t.series.idx*(this.chartArea.yScale.bandwidth()/i);return this.chartArea.yScale(this._cats[e])+s+1})).attr("height",this.chartArea.yScale.bandwidth()/i-this._style.bars.spacing-2).attr("width",((t,e)=>{const i=t.series.key;return this.chartArea.xScale(this._vals[e][i]+t.ci[1])-this.chartArea.xScale(this._vals[e][i]-t.ci[0])}))}_renderValueLabels(t,e){if(null===this._values)return;if([!0,"always","hover"].indexOf(this._style.values.show)<0)return;const i=this.chartArea.yScale.bandwidth()/this._seriesCache.length;Wt(t).select(".dv_valueLabels").selectAll("text").attr("x",(t=>t.value<0?this.chartArea.xScale(t.value)-this._style.values.offset:this.chartArea.xScale(t.value)+this._style.values.offset)).attr("y",(t=>{const e=t.seriesIdx*i;return this.chartArea.yScale(t.category)+e+.5*i+.5*this._style.values.font.size+this._style.values.font.verticalShift})).style("text-anchor",(t=>t.value<0?"end":"start"))}_renderInteractionBars(t,e){const i=this._seriesCache.length,s=Wt(t).select(".dv_interaction").selectAll("g").data(this._seriesCache.map(((t,e)=>({key:t.key,idx:e})))).join("g").style("opacity",0).selectAll("rect").data((t=>this._vals.map(((e,i)=>({value:e[t.key],series:t,data:e,idx:i}))))).join("rect").attr("x",(t=>this.chartArea.xScale(this._vmin))).attr("y",((t,e)=>{const s=t.series.idx*(this.chartArea.yScale.bandwidth()/i);return this.chartArea.yScale(this._cats[e])+s})).attr("height",this.chartArea.yScale.bandwidth()/i).attr("width",((t,e)=>{const i=t.series.key;return this.chartArea.xScale(t.value+this._valsCI[e][i][1])}));this.tooltip&&s.call(this.tooltip.bindTooltip())}_hasConfidenceIntervals(){return!(null===this._confidenceInterval)}_confidenceIntervalValues(){if(!this._hasConfidenceIntervals())return this._vals.map((t=>Object.fromEntries(this._seriesCache.map((t=>[t.key,[0,0]])))));return this._f(this._confidenceInterval,this._data,this._state,this).map((t=>Object.fromEntries(this._seriesCache.map((e=>{const i=t[e.key];let s=[i,i];return null===i?s=[0,0]:"object"==typeof i&&(s=[i.lower,i.upper]),[e.key,s]})))))}_getTooltipText(t,e){return"string"==typeof this._tooltipText?this._tooltipText:"function"==typeof this._tooltipText?this._tooltipText(t,this._state,e,this):this.defaultTooltipText(t,this._state,e)}defaultTooltipText(t,e,i){const s=this._seriesCache.map((t=>t.title)),n=this._cols,r=t.idx,a=this._seriesCache.map((e=>{const i={key:e.key,title:e.title,data:t.value.data,category:this._cats[r],confidenceInterval:this._valsCI[r][e.key]};return this._style.tooltip.valueFormat(t.value.data[e.key],i,this._state,this)}));let l="<p>";s.forEach(((t,e)=>{l+=`<rect w="8" h="8" baseLineShift="1" fill="${n[e]}" /><tab /><span fontColor="#757575">${t}</span><tab/><b>${a[e]}</b><br/>`})),l+="</p>";return`\n      <text lineHeight="1.8" tabStops="15,${La(Math.max(...s.map((t=>t.length))),12,400)+20}">\n        <p fontSize="14" fontWeight="700">{{category}}</p>\n        ${l}\n      </text>`}_initTooltip(t,e,i,s){Wt(t).append("text")}_prerenderTooltip(t,e,i,s){const n=new Se({width:this._style.tooltip.maxWidth,fontSize:this._style.tooltip.font.size}),r=this._cats[e.idx];n.render(this._getTooltipText(e,i),t,{category:r,d:e,state:this._state});const a=t.getBoundingClientRect();i.viewRect.setHeight(a.height+10),i.viewRect.setWidth(a.width+10),t.setAttribute("transform",`translate(${i.viewRect.left+5} ${i.viewRect.top+5})`)}_renderTooltip(t,e,i,s){}_computeSeriesMax(){this._vals.forEach(((t,e)=>{t._max=this._seriesCache.map((i=>t[i.key]+this._valsCI[e][i.key][1])).reduce(((t,e)=>Math.max(t,e))),t._min=this._seriesCache.map((i=>t[i.key]+this._valsCI[e][i.key][1])).reduce(((t,e)=>Math.min(t,e)))}))}}var Qa=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map((function(t){for(var e=t.length/6|0,i=new Array(e),s=0;s<e;)i[s]="#"+t.slice(6*s,6*++s);return i}));function tl(t){return function(){return t}}(t=>{ys(t[t.length-1])})(Qa);const el=Math.abs,il=Math.atan2,sl=Math.cos,nl=Math.max,rl=Math.min,al=Math.sin,ll=Math.sqrt,ol=1e-12,hl=Math.PI,cl=hl/2,dl=2*hl;function ul(t){return t>=1?cl:t<=-1?-cl:Math.asin(t)}const _l=Math.PI,pl=2*_l,fl=1e-6,gl=pl-fl;function yl(t){this._+=t[0];for(let e=1,i=t.length;e<i;++e)this._+=arguments[e]+t[e]}class ml{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==t?yl:function(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return yl;const i=10**e;return function(t){this._+=t[0];for(let e=1,s=t.length;e<s;++e)this._+=Math.round(arguments[e]*i)/i+t[e]}}(t)}moveTo(t,e){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,e){this._append`L${this._x1=+t},${this._y1=+e}`}quadraticCurveTo(t,e,i,s){this._append`Q${+t},${+e},${this._x1=+i},${this._y1=+s}`}bezierCurveTo(t,e,i,s,n,r){this._append`C${+t},${+e},${+i},${+s},${this._x1=+n},${this._y1=+r}`}arcTo(t,e,i,s,n){if(t=+t,e=+e,i=+i,s=+s,(n=+n)<0)throw new Error(`negative radius: ${n}`);let r=this._x1,a=this._y1,l=i-t,o=s-e,h=r-t,c=a-e,d=h*h+c*c;if(null===this._x1)this._append`M${this._x1=t},${this._y1=e}`;else if(d>fl)if(Math.abs(c*l-o*h)>fl&&n){let u=i-r,_=s-a,p=l*l+o*o,f=u*u+_*_,g=Math.sqrt(p),y=Math.sqrt(d),m=n*Math.tan((_l-Math.acos((p+d-f)/(2*g*y)))/2),x=m/y,v=m/g;Math.abs(x-1)>fl&&this._append`L${t+x*h},${e+x*c}`,this._append`A${n},${n},0,0,${+(c*u>h*_)},${this._x1=t+v*l},${this._y1=e+v*o}`}else this._append`L${this._x1=t},${this._y1=e}`;else;}arc(t,e,i,s,n,r){if(t=+t,e=+e,r=!!r,(i=+i)<0)throw new Error(`negative radius: ${i}`);let a=i*Math.cos(s),l=i*Math.sin(s),o=t+a,h=e+l,c=1^r,d=r?s-n:n-s;null===this._x1?this._append`M${o},${h}`:(Math.abs(this._x1-o)>fl||Math.abs(this._y1-h)>fl)&&this._append`L${o},${h}`,i&&(d<0&&(d=d%pl+pl),d>gl?this._append`A${i},${i},0,1,${c},${t-a},${e-l}A${i},${i},0,1,${c},${this._x1=o},${this._y1=h}`:d>fl&&this._append`A${i},${i},0,${+(d>=_l)},${c},${this._x1=t+i*Math.cos(n)},${this._y1=e+i*Math.sin(n)}`)}rect(t,e,i,s){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${i=+i}v${+s}h${-i}Z`}toString(){return this._}}function xl(t){let e=3;return t.digits=function(i){if(!arguments.length)return e;if(null==i)e=null;else{const t=Math.floor(i);if(!(t>=0))throw new RangeError(`invalid digits: ${i}`);e=t}return t},()=>new ml(e)}function vl(t){return t.innerRadius}function bl(t){return t.outerRadius}function wl(t){return t.startAngle}function Al(t){return t.endAngle}function kl(t){return t&&t.padAngle}function Ll(t,e,i,s,n,r,a){var l=t-i,o=e-s,h=(a?r:-r)/ll(l*l+o*o),c=h*o,d=-h*l,u=t+c,_=e+d,p=i+c,f=s+d,g=(u+p)/2,y=(_+f)/2,m=p-u,x=f-_,v=m*m+x*x,b=n-r,w=u*f-p*_,A=(x<0?-1:1)*ll(nl(0,b*b*v-w*w)),k=(w*x-m*A)/v,L=(-w*m-x*A)/v,S=(w*x+m*A)/v,C=(-w*m+x*A)/v,R=k-g,T=L-y,M=S-g,z=C-y;return R*R+T*T>M*M+z*z&&(k=S,L=C),{cx:k,cy:L,x01:-c,y01:-d,x11:k*(n/b-1),y11:L*(n/b-1)}}function Sl(){var t=vl,e=bl,i=tl(0),s=null,n=wl,r=Al,a=kl,l=null,o=xl(h);function h(){var h,c,d=+t.apply(this,arguments),u=+e.apply(this,arguments),_=n.apply(this,arguments)-cl,p=r.apply(this,arguments)-cl,f=el(p-_),g=p>_;if(l||(l=h=o()),u<d&&(c=u,u=d,d=c),u>ol)if(f>dl-ol)l.moveTo(u*sl(_),u*al(_)),l.arc(0,0,u,_,p,!g),d>ol&&(l.moveTo(d*sl(p),d*al(p)),l.arc(0,0,d,p,_,g));else{var y,m,x=_,v=p,b=_,w=p,A=f,k=f,L=a.apply(this,arguments)/2,S=L>ol&&(s?+s.apply(this,arguments):ll(d*d+u*u)),C=rl(el(u-d)/2,+i.apply(this,arguments)),R=C,T=C;if(S>ol){var M=ul(S/d*al(L)),z=ul(S/u*al(L));(A-=2*M)>ol?(b+=M*=g?1:-1,w-=M):(A=0,b=w=(_+p)/2),(k-=2*z)>ol?(x+=z*=g?1:-1,v-=z):(k=0,x=v=(_+p)/2)}var D=u*sl(x),$=u*al(x),V=d*sl(w),W=d*al(w);if(C>ol){var E,B=u*sl(v),I=u*al(v),j=d*sl(b),H=d*al(b);if(f<hl)if(E=function(t,e,i,s,n,r,a,l){var o=i-t,h=s-e,c=a-n,d=l-r,u=d*o-c*h;if(!(u*u<ol))return[t+(u=(c*(e-r)-d*(t-n))/u)*o,e+u*h]}(D,$,j,H,B,I,V,W)){var N=D-E[0],O=$-E[1],F=B-E[0],P=I-E[1],U=1/al(function(t){return t>1?0:t<-1?hl:Math.acos(t)}((N*F+O*P)/(ll(N*N+O*O)*ll(F*F+P*P)))/2),q=ll(E[0]*E[0]+E[1]*E[1]);R=rl(C,(d-q)/(U-1)),T=rl(C,(u-q)/(U+1))}else R=T=0}k>ol?T>ol?(y=Ll(j,H,D,$,u,T,g),m=Ll(B,I,V,W,u,T,g),l.moveTo(y.cx+y.x01,y.cy+y.y01),T<C?l.arc(y.cx,y.cy,T,il(y.y01,y.x01),il(m.y01,m.x01),!g):(l.arc(y.cx,y.cy,T,il(y.y01,y.x01),il(y.y11,y.x11),!g),l.arc(0,0,u,il(y.cy+y.y11,y.cx+y.x11),il(m.cy+m.y11,m.cx+m.x11),!g),l.arc(m.cx,m.cy,T,il(m.y11,m.x11),il(m.y01,m.x01),!g))):(l.moveTo(D,$),l.arc(0,0,u,x,v,!g)):l.moveTo(D,$),d>ol&&A>ol?R>ol?(y=Ll(V,W,B,I,d,-R,g),m=Ll(D,$,j,H,d,-R,g),l.lineTo(y.cx+y.x01,y.cy+y.y01),R<C?l.arc(y.cx,y.cy,R,il(y.y01,y.x01),il(m.y01,m.x01),!g):(l.arc(y.cx,y.cy,R,il(y.y01,y.x01),il(y.y11,y.x11),!g),l.arc(0,0,d,il(y.cy+y.y11,y.cx+y.x11),il(m.cy+m.y11,m.cx+m.x11),g),l.arc(m.cx,m.cy,R,il(m.y11,m.x11),il(m.y01,m.x01),!g))):l.arc(0,0,d,w,b,g):l.lineTo(V,W)}else l.moveTo(0,0);if(l.closePath(),h)return l=null,h+""||null}return h.centroid=function(){var i=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,s=(+n.apply(this,arguments)+ +r.apply(this,arguments))/2-hl/2;return[sl(s)*i,al(s)*i]},h.innerRadius=function(e){return arguments.length?(t="function"==typeof e?e:tl(+e),h):t},h.outerRadius=function(t){return arguments.length?(e="function"==typeof t?t:tl(+t),h):e},h.cornerRadius=function(t){return arguments.length?(i="function"==typeof t?t:tl(+t),h):i},h.padRadius=function(t){return arguments.length?(s=null==t?null:"function"==typeof t?t:tl(+t),h):s},h.startAngle=function(t){return arguments.length?(n="function"==typeof t?t:tl(+t),h):n},h.endAngle=function(t){return arguments.length?(r="function"==typeof t?t:tl(+t),h):r},h.padAngle=function(t){return arguments.length?(a="function"==typeof t?t:tl(+t),h):a},h.context=function(t){return arguments.length?(l=null==t?null:t,h):l},h}var Cl=Array.prototype.slice;function Rl(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function Tl(t){this._context=t}function Ml(t){return new Tl(t)}function zl(t){return t[0]}function Dl(t){return t[1]}function $l(t,e){var i=tl(!0),s=null,n=Ml,r=null,a=xl(l);function l(l){var o,h,c,d=(l=Rl(l)).length,u=!1;for(null==s&&(r=n(c=a())),o=0;o<=d;++o)!(o<d&&i(h=l[o],o,l))===u&&((u=!u)?r.lineStart():r.lineEnd()),u&&r.point(+t(h,o,l),+e(h,o,l));if(c)return r=null,c+""||null}return t="function"==typeof t?t:void 0===t?zl:tl(t),e="function"==typeof e?e:void 0===e?Dl:tl(e),l.x=function(e){return arguments.length?(t="function"==typeof e?e:tl(+e),l):t},l.y=function(t){return arguments.length?(e="function"==typeof t?t:tl(+t),l):e},l.defined=function(t){return arguments.length?(i="function"==typeof t?t:tl(!!t),l):i},l.curve=function(t){return arguments.length?(n=t,null!=s&&(r=n(s)),l):n},l.context=function(t){return arguments.length?(null==t?s=r=null:r=n(s=t),l):s},l}function Vl(t,e,i){var s=null,n=tl(!0),r=null,a=Ml,l=null,o=xl(h);function h(h){var c,d,u,_,p,f=(h=Rl(h)).length,g=!1,y=new Array(f),m=new Array(f);for(null==r&&(l=a(p=o())),c=0;c<=f;++c){if(!(c<f&&n(_=h[c],c,h))===g)if(g=!g)d=c,l.areaStart(),l.lineStart();else{for(l.lineEnd(),l.lineStart(),u=c-1;u>=d;--u)l.point(y[u],m[u]);l.lineEnd(),l.areaEnd()}g&&(y[c]=+t(_,c,h),m[c]=+e(_,c,h),l.point(s?+s(_,c,h):y[c],i?+i(_,c,h):m[c]))}if(p)return l=null,p+""||null}function c(){return $l().defined(n).curve(a).context(r)}return t="function"==typeof t?t:void 0===t?zl:tl(+t),e="function"==typeof e?e:tl(void 0===e?0:+e),i="function"==typeof i?i:void 0===i?Dl:tl(+i),h.x=function(e){return arguments.length?(t="function"==typeof e?e:tl(+e),s=null,h):t},h.x0=function(e){return arguments.length?(t="function"==typeof e?e:tl(+e),h):t},h.x1=function(t){return arguments.length?(s=null==t?null:"function"==typeof t?t:tl(+t),h):s},h.y=function(t){return arguments.length?(e="function"==typeof t?t:tl(+t),i=null,h):e},h.y0=function(t){return arguments.length?(e="function"==typeof t?t:tl(+t),h):e},h.y1=function(t){return arguments.length?(i=null==t?null:"function"==typeof t?t:tl(+t),h):i},h.lineX0=h.lineY0=function(){return c().x(t).y(e)},h.lineY1=function(){return c().x(t).y(i)},h.lineX1=function(){return c().x(s).y(e)},h.defined=function(t){return arguments.length?(n="function"==typeof t?t:tl(!!t),h):n},h.curve=function(t){return arguments.length?(a=t,null!=r&&(l=a(r)),h):a},h.context=function(t){return arguments.length?(null==t?r=l=null:l=a(r=t),h):r},h}function Wl(t,e){return e<t?-1:e>t?1:e>=t?0:NaN}function El(t){return t}function Bl(){var t=El,e=Wl,i=null,s=tl(0),n=tl(dl),r=tl(0);function a(a){var l,o,h,c,d,u=(a=Rl(a)).length,_=0,p=new Array(u),f=new Array(u),g=+s.apply(this,arguments),y=Math.min(dl,Math.max(-dl,n.apply(this,arguments)-g)),m=Math.min(Math.abs(y)/u,r.apply(this,arguments)),x=m*(y<0?-1:1);for(l=0;l<u;++l)(d=f[p[l]=l]=+t(a[l],l,a))>0&&(_+=d);for(null!=e?p.sort((function(t,i){return e(f[t],f[i])})):null!=i&&p.sort((function(t,e){return i(a[t],a[e])})),l=0,h=_?(y-u*x)/_:0;l<u;++l,g=c)o=p[l],c=g+((d=f[o])>0?d*h:0)+x,f[o]={data:a[o],index:l,value:d,startAngle:g,endAngle:c,padAngle:m};return f}return a.value=function(e){return arguments.length?(t="function"==typeof e?e:tl(+e),a):t},a.sortValues=function(t){return arguments.length?(e=t,i=null,a):e},a.sort=function(t){return arguments.length?(i=t,e=null,a):i},a.startAngle=function(t){return arguments.length?(s="function"==typeof t?t:tl(+t),a):s},a.endAngle=function(t){return arguments.length?(n="function"==typeof t?t:tl(+t),a):n},a.padAngle=function(t){return arguments.length?(r="function"==typeof t?t:tl(+t),a):r},a}Tl.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}};class Il{constructor(t,e){this._context=t,this._x=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line}point(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,e,t,e):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+e)/2,t,this._y0,t,e)}this._x0=t,this._y0=e}}function jl(t){return new Il(t,!0)}function Hl(t){return t.source}function Nl(t){return t.target}function Ol(){return function(t){let e=Hl,i=Nl,s=zl,n=Dl,r=null,a=null,l=xl(o);function o(){let o;const h=Cl.call(arguments),c=e.apply(this,h),d=i.apply(this,h);if(null==r&&(a=t(o=l())),a.lineStart(),h[0]=c,a.point(+s.apply(this,h),+n.apply(this,h)),h[0]=d,a.point(+s.apply(this,h),+n.apply(this,h)),a.lineEnd(),o)return a=null,o+""||null}return o.source=function(t){return arguments.length?(e=t,o):e},o.target=function(t){return arguments.length?(i=t,o):i},o.x=function(t){return arguments.length?(s="function"==typeof t?t:tl(+t),o):s},o.y=function(t){return arguments.length?(n="function"==typeof t?t:tl(+t),o):n},o.context=function(e){return arguments.length?(null==e?r=a=null:a=t(r=e),o):r},o}(jl)}function Fl(t,e){this._context=t,this._t=e}function Pl(t){return new Fl(t,.5)}function Ul(t){return new Fl(t,0)}function ql(t){return new Fl(t,1)}function Xl(t,e){if((n=t.length)>1)for(var i,s,n,r=1,a=t[e[0]],l=a.length;r<n;++r)for(s=a,a=t[e[r]],i=0;i<l;++i)a[i][1]+=a[i][0]=isNaN(s[i][1])?s[i][0]:s[i][1]}function Yl(t){for(var e=t.length,i=new Array(e);--e>=0;)i[e]=e;return i}function Gl(t,e){return t[e]}function Zl(t){const e=[];return e.key=t,e}function Kl(){var t=tl([]),e=Yl,i=Xl,s=Gl;function n(n){var r,a,l=Array.from(t.apply(this,arguments),Zl),o=l.length,h=-1;for(const t of n)for(r=0,++h;r<o;++r)(l[r][h]=[0,+s(t,l[r].key,h,n)]).data=t;for(r=0,a=Rl(e(l));r<o;++r)l[a[r]].index=r;return i(l,a),l}return n.keys=function(e){return arguments.length?(t="function"==typeof e?e:tl(Array.from(e)),n):t},n.value=function(t){return arguments.length?(s="function"==typeof t?t:tl(+t),n):s},n.order=function(t){return arguments.length?(e=null==t?Yl:"function"==typeof t?t:tl(Array.from(t)),n):e},n.offset=function(t){return arguments.length?(i=null==t?Xl:t,n):i},n}Fl.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var i=this._x*(1-this._t)+t*this._t;this._context.lineTo(i,this._y),this._context.lineTo(i,e)}}this._x=t,this._y=e}};class Jl extends Ea{constructor(t={}){t.hasChartArea=!0,super(t),this.xAxis({type:"linear",placement:"top"}),this.yAxis({type:"band"}),this.showLegend=!0,this.legend=null,this.defineDefaults({barLabel:null,categories:null,colors:null,groups:null,height:(t,e,i)=>{const s=i._grps?30*i._grps.length:0,n=i.showLegend?i.legend.viewRect.height():0;return s+(i.chartArea._xAxisLabel?20:0)+30*t.values.length+50+n},maxValue:null,series:null,tooltipText:null,values:t=>t,xAxisTitle:null,xAxisFormat:t=>t}),this.style({dataRect:{padding:{top:0,bottom:0}},yScale:{paddingInner:.25,paddingOuter:.35,groupSpacing:40},grid:{horizontal:{show:!1},vertical:{show:!0,color:"#ccc",width:1}},groups:{font:{size:12,weight:700},padding:{top:20,bottom:10}},legend:{align:"top",padding:{top:0,bottom:10}},barLabels:{color:"#000",font:{size:10,weight:400},offset:5},values:{show:"never",onHover:{showAllSeries:!1,showAllCategories:!1},font:{size:10,weight:400,colorInside:"#fff",colorOutside:"#000"},position:"right",offset:5,format:(t,e,i,s)=>t},tooltip:{show:!0,maxWidth:300,font:{size:12},valueFormat:(t,e,i,s)=>void 0===t?null:Number.isInteger(t)?t:t.toFixed(1)}})}init(t,e){super.init(t,e),t.classList.add("dv_stackedBarChart"),Wt(t).append("g").attr("class","dv_bars"),Wt(t).append("g").attr("class","dv_groups"),this._legendNode=Wt(t).append("g").node(),Wt(t).append("g").attr("class","dv_barLabels"),Wt(t).append("g").attr("class",("hover"===this._style.values.show?"dv_hover ":"")+"dv_valueLabels"),Wt(t).append("g").attr("class","dv_interaction"),this.legend=(new Na).style({align:this._style.legend.align,box:{width:8,height:8,padding:{bottom:6}}}),this.legend.init(this._legendNode,e),this.chartArea.xGrid(this._style.grid.vertical),this.chartArea.yGrid(this._style.grid.horizontal),this.chartArea.xAxis.formatValue=this._xAxisFormat,this.chartArea.style.dataRect.padding.top=this._style.dataRect.padding.top,this.chartArea.style.dataRect.padding.bottom=this._style.dataRect.padding.bottom,this.tooltip=new Za,this.tooltip.anchorPosition(["centerbottom","centertop","centerleft","centerright"]).on("init",this._initTooltip.bind(this)).on("prerender",this._prerenderTooltip.bind(this)).on("render",this._renderTooltip.bind(this))}prerender(t,e){if(super.prerender(t,e),!this.datasource.loaded)return void console.info("Rendering of chart postponed. Datasource not yet ready.");this.emit("prerenderWillStart",[t,e,this]),this.chartArea._xAxisLabel=this._f(this._xAxisTitle,e,this),this._data=this.transformedData(e),this._vals=this._values(this._data,e,this),this._grps=this._(this._groups,this._vals,this._data,e,this),this._cats=this._(this._categories,this._vals,e,this),this._seriesCache=this._f(this._series,this._vals,this._data,e,this),this._computeSeriesTotal(),this._cols=this._colors?this._f(this._colors,this._vals,this._seriesCache,e,this):Qa[Math.max(Math.min(11,this._seriesCache.length),3)],this._vmax=null===this._maxValue?Si(this._vals.map((t=>t._tot))):this._(this._maxValue,{data:this._data,values:this._vals,groups:this._grps,categories:this._cats,maxValue:Si(this._vals.map((t=>t._tot)))},e,this);const i=Kl().keys(this._seriesCache.map((t=>t.key))).value(((t,e)=>t[e]||0));this._stack=i(this._vals),this._prerenderBarLabels(t,e),this._prerenderValueLabels(t,e),this.legend.categories(this._seriesCache.map((t=>t.title))).colors(this._cols).style(this._style.legend),this.showLegend=this._(this._style.legend.show,{data:this._data,values:this._vals,categories:this._cats,series:this._seriesCache},e,this);const s=Wt(t).selectAll(".dv_barLabels text").nodes().map((t=>t.getBoundingClientRect().width)).reduce(((t,e)=>Math.max(t,e)),0);this.showLegend?(this.legend.maxViewRect=new ne(this.viewRect.left,this.viewRect.top+(this._style.legend.padding.top||0),this.viewRect.width(),null),this.legend.prerender(this._legendNode,e),this.style({chartArea:{margin:{top:this.legend.viewRect.height()+this._style.legend.padding.bottom,right:s}}})):(this.style({chartArea:{margin:{top:0,right:s}}}),this._legendNode.querySelector("g.dv_legendWrapper").innerHTML=""),this.viewRect.setHeight(this._f(this._height,{values:this._vals,series:this._seriesCache},e,this)),this.chartArea.xDomain([0,this._vmax]),this.chartArea.yDomain(this._cats),this.emit("prerenderDidEnd",[t,e,this])}_prerenderBarLabels(t,e){null!==this._barLabel&&Wt(t).select(".dv_barLabels").selectAll("text").data(this._vals).join("text").style("font-size",`${this._style.barLabels.font.size}px`).style("font-weight",this._style.barLabels.font.weight).style("fill",this._style.barLabels.color).text((t=>this._(this._barLabel,{values:t},e,this)))}_prerenderValueLabels(t,e){null!==this._values&&([!0,"always","hover"].indexOf(this._style.values.show)<0||Wt(t).select(".dv_valueLabels").selectAll("g").data(this._vals).join("g").selectAll("text").data(((t,e)=>this._seriesCache.map(((i,s)=>({allValues:t,value:t[i.key],series:i,allSeries:this._seriesCache,seriesIdx:s,category:this._cats.flat(1)[e],categoryIdx:e,stackedValues:this._stack[s][e]}))))).join("text").style("font-size",`${this._style.values.font.size}px`).style("font-weight",this._style.values.font.weight).style("fill",(t=>this._(this._style.values.font.colorInside,{...t,barColor:this._cols[t.seriesIdx]},e,this))).text((t=>this._style.values.format(t.value,t,e,this))))}render(t,e){this.datasource.loaded&&(this.emit("renderWillStart",[t,e,this]),super.render(t,e),this.showLegend&&this.legend.render(this._legendNode,e),Array.isArray(this._grps)&&this._grps.length>1&&this._renderGroupHeadings(t,e),this._renderBars(t,e),this._renderBarLabels(t,e),this._renderValueLabels(t,e),this._renderInteractionLayer(t,e))}_renderGroupHeadings(t,e){Wt(t).select(".dv_groups").selectAll("rect").data(this._grps).join("rect").attr("x",0).attr("y",((t,e)=>{let i=this.chartArea.yScale.group(e);return"top"===this.chartArea._xAxis.placement&&0===e&&(i-=this.chartArea.yScale.groupSpacing()),i})).attr("width",this.viewRect.width()).attr("height",this.chartArea.yScale.groupSpacing()).style("fill","#fff").style("fill-opacity",((t,e)=>"top"===this.chartArea._xAxis.placement&&0===e?0:1)),Wt(t).select(".dv_groups").selectAll("text").data(this._grps).join("text").attr("x",0).attr("y",((t,e)=>{let i=this.chartArea.yScale.group(e)+this.chartArea.yScale.groupSpacing()-10;return"top"===this.chartArea._xAxis.placement&&0===e&&(i-=this.chartArea.yScale.groupSpacing()),i})).text((t=>t)).style("font-size",`${this._style.groups.font.size}px`).style("font-weight",this._style.groups.font.weight)}_renderBars(t,e){Wt(t).select(".dv_bars").selectAll("g").data(this._stack).join("g").attr("fill",((t,e)=>this._cols[e])).selectAll("rect").data((t=>t)).join("rect").attr("x",(t=>this.chartArea.xScale(t[0]))).attr("y",((t,e)=>this.chartArea.yScale(this._cats.flat(1)[e],e))).attr("height",this.chartArea.yScale.bandwidth()).attr("width",(t=>this.chartArea.xScale(t[1])-this.chartArea.xScale(t[0])))}_renderInteractionLayer(t,e){const i=Wt(t).select(".dv_interaction").selectAll("g").data(this._stack).join("g").attr("data-idx",((t,e)=>e)).attr("fill","#fff0").selectAll("rect").data((t=>t)).join("rect").attr("x",(t=>this.chartArea.xScale(t[0]))).attr("y",((t,e)=>this.chartArea.yScale(this._cats.flat(1)[e],e))).attr("height",this.chartArea.yScale.bandwidth()).attr("width",(t=>this.chartArea.xScale(t[1])-this.chartArea.xScale(t[0]))).attr("data-idx",((t,e)=>e)).on("mouseover",this._select.bind(this)).on("mouseleave",this._deselect.bind(this));!0===this._style.tooltip.show&&i.call(this.tooltip.bindTooltip())}_renderBarLabels(t,e){null!==this._barLabel&&Wt(t).select(".dv_barLabels").selectAll("text").attr("x",((t,e)=>this.chartArea.xScale(t._tot)+this._style.barLabels.offset)).attr("y",((t,e)=>this.chartArea.yScale(this._cats.flat(1)[e],e)+.5*this.chartArea.yScale.bandwidth()+.5*this._style.barLabels.font.size))}_renderValueLabels(t,e){null!==this._values&&([!0,"always","hover"].indexOf(this._style.values.show)<0||(Wt(t).select(".dv_valueLabels").selectAll("text").attr("x",(t=>"right"===this._style.values.position?this.chartArea.xScale(t.stackedValues[1])-this._style.values.offset:this.chartArea.xScale(t.stackedValues[0])+this._style.values.offset)).attr("y",(t=>this.chartArea.yScale(this._cats.flat(1)[t.categoryIdx],t.categoryIdx)+.5*this.chartArea.yScale.bandwidth()+.5*this._style.values.font.size)).style("text-anchor","right"===this._style.values.position?"end":"start").attr("class",((t,e,i)=>{i[e].style.display="block";const s=i[e].getBoundingClientRect();i[e].style.display=null;const n=this.chartArea.xScale(t.stackedValues[1])-this.chartArea.xScale(t.stackedValues[0])-2*this._style.values.offset,r=s.width<=0||s.width>n?"dv_overflowHidden":"";return"hover"===this._style.values.show?`dv_hidden ${r}`:r})),this._adjustOverflowValueLabels(t)))}_adjustOverflowValueLabels(t){"hover"===this._style.values.show&&!0!==this._style.values.onHover.showAllSeries&&Wt(t).select(".dv_valueLabels").selectAll("text.dv_overflowHidden").each(((t,e,i)=>{const s=i[e];s.style.display="block";const n=s.getBoundingClientRect();s.style.display=null;const r=this.chartArea.xScale(0),a=this.chartArea.xScale(this._vmax);let l=null,o=null,h=t.seriesIdx,c=null;"right"===this._style.values.position?(l=this.chartArea.xScale(t.stackedValues[1])+this._style.values.offset,o="start",h=t.seriesIdx+1,c="right",a-l<n.width&&(l=this.chartArea.xScale(t.stackedValues[0])-this._style.values.offset,o="end",h=t.seriesIdx-1,c="left")):(l=this.chartArea.xScale(t.stackedValues[0])-this._style.values.offset,o="end",h=t.seriesIdx-1,c="left",l-r<n.width&&(l=this.chartArea.xScale(t.stackedValues[1])+this._style.values.offset,o="start",h=t.seriesIdx+1,c="right")),Wt(s).attr("x",l).style("text-anchor",o).style("fill",(t=>this._(this._style.values.font.colorOutside,{...t,barColor:this._cols[h]||null,placement:c},this._state,this))),s.classList.remove("dv_overflowHidden")}))}_getTooltipText(t,e){if("string"==typeof this._tooltipText)return this._tooltipText;const i=this._seriesCache.map((t=>t.title)),s=this._cols,n=this._seriesCache.map((e=>this._style.tooltip.valueFormat(t.value.data[e.key],{data:t.value.data,series:e},this._state,this)));let r="<p>";i.forEach(((t,e)=>{const i=n[e];null!=i&&(r+=`<rect w="8" h="8" baseLineShift="1" fill="${s[e]}" /><tab /><span fontColor="#757575">${t}</span><tab/><b>${i}</b><br/>`)})),r+="</p>";const a=`\n      <text lineHeight="1.8" tabStops="15,${La(Math.max(...i.map((t=>t.length))),12,400)+20}">\n        <p fontSize="14" fontWeight="700">{{category}}</p>\n        ${r}\n      </text>`;return"function"==typeof this._tooltipText?this._tooltipText({...t,labels:i,colors:s,formattedValues:n,defaultText:a.trim(),series:this._seriesCache,category:this._cats.flat(1)[t.idx]},this._state,e,this):a}_initTooltip(t,e,i,s){Wt(t).append("text")}_prerenderTooltip(t,e,i,s){const n=new Se({width:this._style.tooltip.maxWidth,fontSize:this._style.tooltip.font.size}),r=this._cats.flat(1)[e.idx];n.render(this._getTooltipText(e,i),t,{category:r,d:e,state:this._state});const a=t.getBoundingClientRect();i.viewRect.setHeight(a.height+10),i.viewRect.setWidth(a.width+10),t.setAttribute("transform",`translate(${i.viewRect.left+5} ${i.viewRect.top+5})`)}_renderTooltip(t,e,i,s){}_computeSeriesTotal(){this._vals.forEach((t=>{t._tot=this._seriesCache.map((e=>t[e.key])).reduce(((t,e)=>t+e))}))}_select(t,e){const i=+t.target.closest("g").getAttribute("data-idx"),s=+t.target.getAttribute("data-idx");if("hover"===this._style.values.show){const t=!0===this._style.values.onHover.showAllCategories?this._node.querySelectorAll(".dv_valueLabels g"):this._node.querySelectorAll(`.dv_valueLabels g:nth-of-type(${s+1})`);if(0===t.length)return;t.forEach((t=>{(!0===this._style.values.onHover.showAllSeries?t.querySelectorAll("text"):t.querySelectorAll(`text:nth-of-type(${i+1})`)).forEach((t=>t.classList.remove("dv_hidden")))}))}}_deselect(t,e){"hover"===this._style.values.show&&this._node.querySelectorAll(".dv_valueLabels text").forEach((t=>t.classList.add("dv_hidden")))}}class Ql extends Ea{constructor(){super({hasChartArea:!1}),this._values=null,this._categories=null,this._labels=null,this._data=null,this._vals=null,this._cats=null,this._lbls=null,this._topLabelsHeight=0,this._bottomLabelsHeight=0,this._stackedVals=null,this._valuesSum=null,this._xScale=null,this.style({bar:{height:30,spacing:3,color:{default:"#728cd7",selected:"#4B62b3"},highlighted:!1},label:{font:{size:14,weight:400},align:"center",minWidth:100,top:{show:"default",padding:{bottom:4}},middle:{show:"default"},bottom:{show:"default",padding:{top:6}}}})}categories(t){return this._categories=t,this}values(t){return this._values=t,this}labels(t){return this._labels=t,this}init(t,e){super.init(t,e),t.classList.add("dv_dividedBarChart"),Wt(t).append("g").attr("class","dv_bar"),Wt(t).append("g").attr("class","dv_labelsTop"),Wt(t).append("g").attr("class","dv_labelsMiddle"),Wt(t).append("g").attr("class","dv_labelsBottom"),Wt(t).append("g").attr("class","dv_interaction")}prerender(t,e){if(super.prerender(t,e),!this.datasource.loaded)return void console.info("Rendering of chart postponed. Datasource not yet ready.");this.emit("prerenderWillStart",[t,e,this]),this._data=this.transformedData(e),this._vals=this._(this._values,this._data,e,this),this._cats=this._(this._categories,this._data,e,this),this._lbls=this._(this._labels,this._data,e,this),this._stackedVals=[0],this._valuesSum=0;for(let t=0;t<this._vals.length;t++)this._stackedVals.push(this._vals[t]+this._valuesSum),this._valuesSum+=this._vals[t];const i=this._vals.length,s=this._(this._style.bar.spacing,this._vals,e,this);this._xScale=on().domain([0,this._valuesSum]).range([this.viewRect.left,this.viewRect.width()-(i-1)*s]),this._prerenderLabels(t,e);const n=Wt(t).selectAll(".dv_labelsTop .dv_labelWrapper").nodes().map((t=>t.getBBox().height));this._topLabelsHeight=Math.max(...n);const r=Wt(t).selectAll(".dv_labelsBottom .dv_labelWrapper").nodes().map((t=>t.getBBox().height));this._bottomLabelsHeight=Math.max(...r);const a=this._style.bar.height+(this._topLabelsHeight>0?this._topLabelsHeight+this._style.label.top.padding.bottom:0)+(this._bottomLabelsHeight>0?this._bottomLabelsHeight+this._style.label.bottom.padding.top:0);this.viewRect.setHeight(a),this.emit("prerenderDidEnd",[t,e,this])}_prerenderLabels(t,e){const i=this._style.label,s=new Se({fontSize:i.font.size,fontWeight:i.font.weight}),n=n=>{Wt(t).select(`.dv_labels${De(n)}`).selectAll("g.dv_labelWrapper").data(this._lbls).join("g").attr("class","dv_labelWrapper").each(((t,r,a)=>{if(!t[n])return;const l=this._xScale(this._vals[r]);s.render(t[n],a[r],{value:this._vals[r],labels:t,category:this._cats[r],state:e},null,{width:Math.max(l,i.minWidth),textAlign:i.align})}))};"never"!==i.top.show&&n("top"),"never"!==i.middle.show&&n("middle"),"never"!==i.bottom.show&&n("bottom")}render(t,e){this.datasource.loaded&&(this.emit("renderWillStart",[t,e,this]),super.render(t,e),this._renderBar(t,e),this._renderLabels(t,e))}_renderBar(t,e){const i=this._(this._style.bar.spacing,this._vals,e,this),s=this.viewRect.top+(this._topLabelsHeight>0?this._topLabelsHeight+this._style.label.top.padding.bottom:0);Wt(t).select(".dv_interaction").selectAll("rect").data(this._vals).join("rect").attr("x",((t,e)=>this._xScale(this._stackedVals[e])+e*i)).attr("y",s).attr("width",(t=>this._xScale(t))).attr("height",this._style.bar.height).attr("data-idx",((t,e)=>e)).on("mouseover",(t=>this._selectBar(t.target))).on("mouseout",(()=>this._unselectBar())),Wt(t).select(".dv_bar").selectAll("rect").data(this._vals).join("rect").attr("x",((t,e)=>this._xScale(this._stackedVals[e])+e*i)).attr("y",s).attr("width",(t=>this._xScale(t))).attr("height",this._style.bar.height).classed("dv_highlighted",((t,i)=>this._(this._style.bar.highlighted,{data:t,idx:i},e,this))).style("fill",((t,i,s)=>Ve(this._(this._style.bar.color,t,e,this),s[i])))}_renderLabels(t,e){const i=this._style.label,s=this._(this._style.bar.spacing,this._vals,e,this),n=Wt(t).select(".dv_bar").selectAll("rect").nodes(),r=e=>{Wt(t).select(`.dv_labels${De(e)}`).selectAll("g.dv_labelWrapper").each(((t,r,a)=>{const l=i[e].show;let o="always"===l;if("default"!==l&&"selected"!==l||!1!==o||(o=n[r].classList.contains("dv_selected")),"default"!==l&&"highlighted"!==l||!1!==o||(o=n[r].classList.contains("dv_highlighted")),!o)return void a[r].classList.add("dv_hidden");a[r].classList.remove("dv_hidden");const h=this._xScale(this._stackedVals[r])+r*s,c=this.viewRect.top+(this._topLabelsHeight>0?this._topLabelsHeight+i.top.padding.bottom:0),d=this._xScale(this._vals[r]),u=this._style.bar.height,_=a[r].getBoundingClientRect().width,p=a[r].getBBox().height;let f=h-(d<i.minWidth?(i.minWidth-d)/2:0);if(d<i.minWidth){const t=h+d/2-_/2;t<this.viewRect.left&&(f+=this.viewRect.left-t);const e=f+i.minWidth/2+_/2;e>this.viewRect.right&&(f-=e-this.viewRect.right)}let g=0;"top"===e&&(g=c-p-i.top.padding.bottom),"middle"===e&&(g=c+(u-p)/2),"bottom"===e&&(g=c+u+i.bottom.padding.top),a[r].setAttribute("transform",`translate(${f} ${g})`)})).call((t=>{const e=t.nodes().map(((t,e)=>({node:t,idx:e,value:this._vals[e],hidden:t.classList.contains("dv_hidden"),selected:t.classList.contains("dv_selected"),highlighted:t.classList.contains("dv_highlighted"),rect:t.getBoundingClientRect()}))).filter((t=>!t.hidden&&t.rect.width>0));e.sort(((t,e)=>t.selected-e.selected||t.highlighted-e.highlighted||t.value-e.value||t.idx-e.idx));const i=[];e.forEach((t=>{!function(t,e,i=0){for(let s=0;s<e.length;s++)if(jt(t,e[s],i))return!0;return!1}(t.rect,i)?t.node.classList.remove("dv_hidden"):t.node.classList.add("dv_hidden"),i.push(t.rect)}))}))};"never"!==i.top.show&&r("top"),"never"!==i.middle.show&&r("middle"),"never"!==i.bottom.show&&r("bottom")}_selectBar(t){const e=+t.getAttribute("data-idx");Wt(this._node).select(".dv_bar").selectAll("rect").classed("dv_selected",((t,i)=>i===e)),this._renderBar(this._node,this._state),this._renderLabels(this._node,this._state)}_unselectBar(){Wt(this._node).select(".dv_bar").selectAll("rect").classed("dv_selected",!1),this._renderBar(this._node,this._state),this._renderLabels(this._node,this._state)}}class to extends Fa{constructor(t){super(t),this.xAxis({type:"band"}),this.yAxis({type:"linear"}),this.style({bars:{spacing:3,minWidth:7},categories:{margin:{top:3}},dataRect:{padding:{left:20,right:20}},grid:{horizontal:{show:!0,color:"#ccc",width:1},vertical:{show:!1}},yAxis:{show:!0,font:{size:12},customize:t=>{},margin:{right:4}}}),this.defineDefaults({height:()=>Math.max(300,Math.min(550,document.documentElement.clientHeight-100)),yAxisTitle:null,yAxisFormat:(t,e,i,s)=>{const n=s.chartArea._yAxis,r=n.ticks[1]-n.ticks[0];return`${Math.log10(r)<0?t.toFixed(Math.abs(Math.floor(Math.log10(r)))):t}`.replace(/\.0+$/g,"")}})}init(t,e){super.init(t,e);const i=this._style;t.classList.add("dv_verticalBarChart"),this.chartArea.xGrid(i.grid.vertical),this.chartArea.yGrid(i.grid.horizontal),Object.assign(this.chartArea._xAxis.style.values,{orientation:this._style.categories.orientation,rotationThreshold:this._style.categories.orientationThreshold,allowRotation:!0});const s=i.values.show&&"never"!==i.values.show?i.values.font.size+4:0;this.style({chartArea:{margin:{top:Math.max(s,i.yAxis.font.size/2+4)}}}),this.chartArea.style.dataRect.padding.left=i.dataRect.padding.left,this.chartArea.style.dataRect.padding.right=i.dataRect.padding.right}prerender(t,e){super.prerender(t,e),this.datasource.loaded&&(this.viewRect.setHeight(this._f(this._height,{values:this._vals,categories:this._cats},e,this)),this.chartArea._yAxisLabel=this._f(this._yAxisTitle,this,e),this.chartArea.style.yAxis.format=this._style.yAxis.format||this._style.values.format,this.chartArea.xDomain(this._cats),this.chartArea.yDomain([this._vmin,this._vmax]),this.emit("prerenderDidEnd",[t,e,this]))}render(t,e){this.datasource.loaded&&(this.emit("renderWillStart",[t,e,this]),super.render(t,e),this._renderBars(t,e),this._style.values.show&&"never"!==this._style.values.show&&this._renderValues(t,e))}_renderBars(t,e){Wt(t).select(".dv_bars").selectAll("rect").data(this._vals).join("rect").style("fill",((t,i,s)=>Oa(this._f(this._style.bars.fill,{value:t,idx:i,nodes:s},e,this),s[i]))).attr("x",((t,e)=>this.chartArea.xScale(this._cats[e]))).attr("y",(t=>Math.min(this.chartArea.yScale(0),this.chartArea.yScale(t||0)))).attr("width",this.chartArea.xScale.bandwidth()).attr("height",(t=>Math.abs(this.chartArea.yScale(0)-this.chartArea.yScale(t||0)))),Wt(t).select(".dv_interaction").selectAll("rect").data(this._vals).join("rect").attr("x",((t,e)=>this.chartArea.xScale(this._cats[e]))).attr("y",(t=>Math.min(this.chartArea.yScale(0),this.chartArea.yScale(t||0))-12)).attr("width",this.chartArea.xScale.bandwidth()).attr("height",(t=>Math.abs(this.chartArea.viewRect.bottom-this.chartArea.yScale(t||0))+12)).attr("data-idx",((t,e)=>e)).on("mouseover",this._handleSelect.bind(this)).on("click",this._handleSelect.bind(this)).on("mouseout",this._handleUnselect.bind(this)),this.emit("renderDidEnd",[t,e,this])}_renderValues(t,e){Wt(t).select(".dv_values").selectAll("text").attr("x",((t,e)=>this.chartArea.xScale(this._cats[e])+this.chartArea.xScale.bandwidth()/2)).attr("y",(t=>this.chartArea.yScale(t)-4)).attr("text-anchor","middle")}}const eo=["#C2CEF2","#AABAEA","#92A6E2","#7A92DA","#6680C9","#556DB4","#445CA0","#344A8C","#243979","#142966"];class io extends Ea{constructor(t={}){t.hasChartArea=!0,super(t),this.xAxis({type:"band"}),this.yAxis({type:"linear"}),this.chartArea.style.categories.minimumPaddingInner=14,this.legend=null,this._values=null,this._confidenceInterval=null,this.defineDefaults({categories:null,colors:null,height:(t,e,i)=>400,series:null,tooltipText:null,yAxisTitle:null,yAxisFormat:t=>t}),this._minValue=null,this._maxValue=null,this.style({columns:{spacing:1,confidenceInterval:{opacity:1,color:"#333",xStep:7,yStep:7,strokeWidth:2,label:"Confidence interval",showLegend:!0}},dataRect:{padding:{top:0,bottom:0}},grid:{vertical:{show:!1},horizontal:{show:!0,color:"#ccc",width:1}},legend:{align:"top",box:{width:8,height:8},padding:{bottom:20}},tooltip:{maxWidth:300,font:{size:12},valueFormat:(t,e,i,s)=>Number.isInteger(t)?t:t.toFixed(1)}})}values(t,e=null){return this._values=t,this._confidenceInterval=e,this}minValue(t){return this._minValue=t,this}maxValue(t){return this._maxValue=t,this}valueRange(t,e){return this._minValue=t,this._maxValue=e,this}init(t,e){super.init(t,e);const i=this._style;if(t.classList.add("dv_groupedColumnChart"),Wt(t).append("g").attr("class","dv_columns"),Wt(t).append("g").attr("class","dv_columns_ci"),this._legendNode=Wt(t).append("g").node(),Wt(t).append("g").attr("class","dv_interaction"),this.legend=(new Na).style({align:this._style.legend.align,box:{width:this._style.legend.box.width,height:this._style.legend.box.height,padding:{bottom:6},customize:(t,e,s,n,r)=>{s===this._seriesCache.length&&Wt(t).style("fill-opacity",i.columns.confidenceInterval.opacity)}}}),this.legend.init(this._legendNode,e),this.chartArea.xGrid(this._style.grid.vertical),this.chartArea.yGrid(this._style.grid.horizontal),this.chartArea._yAxisLabel=this._f(this._yAxisTitle,e,this),this.chartArea.yAxis.formatValue=this._yAxisFormat,this.chartArea.style.dataRect.padding.top=this._style.dataRect.padding.top,this.chartArea.style.dataRect.padding.bottom=this._style.dataRect.padding.bottom,this._hasConfidenceIntervals()){new ja(`columnchart${this.id}`,{xStep:i.columns.confidenceInterval.xStep,yStep:i.columns.confidenceInterval.yStep,strokeWidth:i.columns.confidenceInterval.strokeWidth,color:i.columns.confidenceInterval.color}).insert(t)}this.tooltip=new Za,this.tooltip.anchorPosition(["centerbottom","centertop","centerleft","centerright"]).on("init",this._initTooltip.bind(this)).on("prerender",this._prerenderTooltip.bind(this)).on("render",this._renderTooltip.bind(this))}prerender(t,e){if(super.prerender(t,e),!this.datasource.loaded)return void console.info("Rendering of chart postponed. Datasource not yet ready.");this.emit("prerenderWillStart",[t,e,this]),this._data=this.transformedData(e),this._vals=this._f(this._values,this._data,e,this),this._cats=this._f(this._categories,this._vals,e,this),this._seriesCache=this._f(this._series,this._vals,this._data,e,this),this._valsCI=this._confidenceIntervalValues(),this._computeSeriesMax(),this._cols=this._colors?this._f(this._colors,this._vals,this._seriesCache,e,this):eo,this._vmin=null===this._minValue?Math.min(0,Ci(this._vals.map((t=>t._min)))):this._(this._minValue,this._vals,this._data,e,this),this._vmax=null===this._maxValue?Si(this._vals.map((t=>t._max))):this._(this._maxValue,this._vals,this._data,e,this);const i=this._seriesCache.map((t=>t.title));this.legend.categories(this._hasConfidenceIntervals()&&this._style.columns.confidenceInterval.showLegend?[...i,this._style.columns.confidenceInterval.label]:i).colors(this._hasConfidenceIntervals()&&this._style.columns.confidenceInterval.showLegend?[...this._cols,`url(#columnchart${this.id})`]:this._cols),this.legend.maxViewRect=new ne(this.viewRect.left,this.viewRect.top,this.viewRect.width(),null),this.legend.prerender(this._legendNode,e),this.style({chartArea:{margin:{top:this.legend.viewRect.height()+this._style.legend.padding.bottom}}}),this.viewRect.setHeight(this._f(this._height,{values:this._vals,series:this._seriesCache},e,this)),this.chartArea.xDomain(this._cats),this.chartArea.yDomain([this._vmin,this._vmax]),this.emit("prerenderDidEnd",[t,e,this])}render(t,e){this.datasource.loaded&&(this.emit("renderWillStart",[t,e,this]),super.render(t,e),this.legend.render(this._legendNode,e),this._renderColumns(t,e),this._hasConfidenceIntervals()&&this._renderCI(t,e),this._renderInteractionColumns(t,e))}_renderColumns(t,e){const i=this._seriesCache.length;Wt(t).select(".dv_columns").selectAll("g").data(this._seriesCache.map(((t,e)=>({key:t.key,idx:e})))).join("g").attr("fill",((t,e)=>this._cols[e])).selectAll("rect").data((t=>this._vals.map(((e,i)=>({value:e[t.key],series:t,data:e,idx:i}))))).join("rect").attr("x",((t,e)=>{const s=t.series.idx*(this.chartArea.xScale.bandwidth()/i);return this.chartArea.xScale(this._cats[e])+s})).attr("y",(t=>this.chartArea.yScale(Math.max(t.value,0)))).attr("height",(t=>Math.abs(this.chartArea.yScale(t.value)-this.chartArea.yScale(0)))).attr("width",this.chartArea.xScale.bandwidth()/i-this._style.columns.spacing)}_renderCI(t,e){const i=this._seriesCache.length;Wt(t).select(".dv_columns_ci").selectAll("g").data(this._seriesCache.map(((t,e)=>({key:t.key,idx:e})))).join("g").selectAll("rect").data((t=>this._valsCI.map(((e,i)=>({ci:e[t.key],series:t,idx:i}))))).join("rect").style("fill",`url(#columnchart${this.id})`).style("fill-opacity",this._style.columns.confidenceInterval.opacity).attr("x",((t,e)=>{const s=t.series.idx*(this.chartArea.xScale.bandwidth()/i);return this.chartArea.xScale(this._cats[e])+s+1})).attr("y",((t,e)=>this.chartArea.yScale(this._vals[e][t.series.key]+t.ci[1]))).attr("height",((t,e)=>{const i=t.series.key;return this.chartArea.yScale(this._vals[e][i]-t.ci[0])-this.chartArea.yScale(this._vals[e][i]+t.ci[1])})).attr("width",this.chartArea.xScale.bandwidth()/i-this._style.columns.spacing-2)}_renderInteractionColumns(t,e){const i=this._seriesCache.length;Wt(t).select(".dv_interaction").selectAll("g").data(this._seriesCache.map(((t,e)=>({key:t.key,idx:e})))).join("g").style("opacity",0).selectAll("rect").data((t=>this._vals.map(((e,i)=>({value:e[t.key],series:t,data:e,idx:i}))))).join("rect").attr("x",((t,e)=>{const s=t.series.idx*(this.chartArea.xScale.bandwidth()/i);return this.chartArea.xScale(this._cats[e])+s})).attr("y",((t,e)=>{const i=t.series.key;return this.chartArea.yScale(t.value+this._valsCI[e][i][1])})).attr("width",this.chartArea.xScale.bandwidth()/i).attr("height",((t,e)=>{const i=t.series.key;return this.chartArea.yScale(this._vmin)-this.chartArea.yScale(t.value+this._valsCI[e][i][1])})).call(this.tooltip.bindTooltip())}_hasConfidenceIntervals(){return!(null===this._confidenceInterval)}_confidenceIntervalValues(){if(!this._hasConfidenceIntervals())return this._vals.map((t=>Object.fromEntries(this._seriesCache.map((t=>[t.key,[0,0]])))));return this._f(this._confidenceInterval,this._data,this._state,this).map((t=>Object.fromEntries(this._seriesCache.map((e=>{const i=t[e.key];let s=[i,i];return null===i?s=[0,0]:"object"==typeof i&&(s=[i.lower,i.upper]),[e.key,s]})))))}_getTooltipText(t,e){return"string"==typeof this._tooltipText?this._tooltipText:"function"==typeof this._tooltipText?this._tooltipText(t,this._state,e,this):this.defaultTooltipText(t,this._state,e)}defaultTooltipText(t,e,i){const s=this._seriesCache.map((t=>t.title)),n=this._cols,r=t.idx,a=this._seriesCache.map((e=>{const i={key:e.key,title:e.title,data:t.value.data,category:this._cats[r],confidenceInterval:this._valsCI[r][e.key]};return this._style.tooltip.valueFormat(t.value.data[e.key],i,this._state,this)}));let l="<p>";s.forEach(((t,e)=>{l+=`<rect w="8" h="8" baseLineShift="1" fill="${n[e]}" /><tab /><span fontColor="#757575">${t}</span><tab/><b>${a[e]}</b><br/>`})),l+="</p>";return`\n      <text lineHeight="1.8" tabStops="15,${La(Math.max(...s.map((t=>t.length))),12,400)+20}">\n        <p fontSize="14" fontWeight="700">{{category}}</p>\n        ${l}\n      </text>`}_initTooltip(t,e,i,s){Wt(t).append("text")}_prerenderTooltip(t,e,i,s){const n=new Se({width:this._style.tooltip.maxWidth,fontSize:this._style.tooltip.font.size}),r=this._cats[e.idx];n.render(this._getTooltipText(e,i),t,{category:r,d:e,state:this._state});const a=t.getBoundingClientRect();i.viewRect.setHeight(a.height+10),i.viewRect.setWidth(a.width+10),t.setAttribute("transform",`translate(${i.viewRect.left+5} ${i.viewRect.top+5})`)}_renderTooltip(t,e,i,s){}_computeSeriesMax(){this._vals.forEach(((t,e)=>{t._max=this._seriesCache.map((i=>t[i.key]+this._valsCI[e][i.key][1])).reduce(((t,e)=>Math.max(t,e))),t._min=this._seriesCache.map((i=>t[i.key]+this._valsCI[e][i.key][1])).reduce(((t,e)=>Math.min(t,e)))}))}}class so extends Ea{constructor(t={}){t.hasChartArea=!0,super(t),this.xAxis({type:"band"}),this.yAxis({type:"linear"}),this.legend=null,this.defineDefaults({categories:null,colors:null,columnLabel:null,groups:null,height:(t,e,i)=>400,maxValue:null,series:null,tooltipText:null,values:t=>t,yAxisTitle:null,yAxisFormat:t=>t}),this.style({dataRect:{padding:{top:0,bottom:0}},xScale:{paddingInner:.25,paddingOuter:.35},grid:{vertical:{show:!1},horizontal:{show:!0,color:"#ccc",width:1}},legend:{align:"top",padding:{top:0,bottom:10}},columnLabels:{color:"#000",font:{size:10,weight:400},offset:5},tooltip:{maxWidth:300,font:{size:12},valueFormat:(t,e,i,s)=>void 0===t?null:Number.isInteger(t)?t:t.toFixed(1)}})}init(t,e){super.init(t,e),t.classList.add("dv_stackedColumnChart"),Wt(t).append("g").attr("class","dv_columns"),Wt(t).append("g").attr("class","dv_columnLabels"),Wt(t).append("g").attr("class","dv_groups"),this._legendNode=Wt(t).append("g").node(),Wt(t).append("g").attr("class","dv_interaction"),this.legend=(new Na).style({align:this._style.legend.align,box:{width:8,height:8,padding:{bottom:6}}}),this.legend.init(this._legendNode,e),this.chartArea.xGrid(this._style.grid.vertical),this.chartArea.yGrid(this._style.grid.horizontal),this.chartArea._yAxisLabel=this._f(this._yAxisTitle,e,this),this.chartArea.style.yAxis.format=this._yAxisFormat,this.chartArea.style.dataRect.padding.top=this._style.dataRect.padding.top,this.chartArea.style.dataRect.padding.bottom=this._style.dataRect.padding.bottom,this.tooltip=new Za,this.tooltip.anchorPosition(["centerbottom","centertop","centerleft","centerright"]).on("init",this._initTooltip.bind(this)).on("prerender",this._prerenderTooltip.bind(this)).on("render",this._renderTooltip.bind(this))}prerender(t,e){if(super.prerender(t,e),!this.datasource.loaded)return void console.info("Rendering of chart postponed. Datasource not yet ready.");this.emit("prerenderWillStart",[t,e,this]),this._data=this.transformedData(e),this._vals=this._values(this._data,e,this),this._grps=this._(this._groups,this._vals,this._data,e,this),this._cats=this._(this._categories,this._vals,e,this),this._seriesCache=this._f(this._series,this._vals,this._data,e,this),this._computeSeriesTotal(),this._cols=this._colors?this._f(this._colors,this._vals,this._seriesCache,e,this):Qa[this._seriesCache.length],this._vmax=null===this._maxValue?Si(this._vals.map((t=>t._tot))):this._maxValue;const i=Kl().keys(this._seriesCache.map((t=>t.key))).value(((t,e)=>t[e]||0));this._stack=i(this._vals),this._prerenderColumnLabels(t,e),this.legend.categories(this._seriesCache.map((t=>t.title))).colors(this._cols).style(this._style.legend),this.legend.maxViewRect=new ne(this.viewRect.left,this.viewRect.top+(this._style.legend.padding.top||0),this.viewRect.width(),null),this.legend.prerender(this._legendNode,e),this.style({chartArea:{margin:{top:this.legend.viewRect.height()+this._style.legend.padding.bottom}}}),this.viewRect.setHeight(this._f(this._height,{values:this._vals,series:this._seriesCache},e,this)),this.chartArea.xDomain(this._cats),this.chartArea.yDomain([0,this._vmax]),this.emit("prerenderDidEnd",[t,e,this])}_prerenderColumnLabels(t,e){null!==this._columnLabel&&Wt(t).select(".dv_columnLabels").selectAll("text").data(this._vals).join("text").text((t=>this._(this._columnLabel,{values:t},e,this))).style("text-anchor","middle").style("font-size",`${this._style.columnLabels.font.size}px`).style("font-weight",this._style.columnLabels.font.weight).style("fill",this._style.columnLabels.color)}render(t,e){this.datasource.loaded&&(this.emit("renderWillStart",[t,e,this]),super.render(t,e),this.legend.render(this._legendNode,e),this._renderBars(t,e),this._renderColumnLabels(t,e),this.emit("renderDidEnd",[t,e,this]))}_renderBars(t,e){Wt(t).select(".dv_columns").selectAll("g").data(this._stack).join("g").attr("fill",((t,e)=>this._cols[e])).selectAll("rect").data((t=>t)).join("rect").attr("x",((t,e)=>this.chartArea.xScale(this._cats[e]))).attr("y",((t,e)=>this.chartArea.yScale(t[1]))).attr("width",this.chartArea.xScale.bandwidth()).attr("height",(t=>this.chartArea.yScale(t[0])-this.chartArea.yScale(t[1]))).call(this.tooltip.bindTooltip())}_renderColumnLabels(t,e){null!==this._columnLabel&&Wt(t).select(".dv_columnLabels").selectAll("text").attr("x",((t,e)=>this.chartArea.xScale(this._cats[e])+.5*this.chartArea.xScale.bandwidth())).attr("y",(t=>this.chartArea.yScale(t._tot)-this._style.columnLabels.offset))}_getTooltipText(t,e){if("string"==typeof this._tooltipText)return this._tooltipText;const i=this._seriesCache.map((t=>t.title)),s=this._cols,n=this._seriesCache.map((e=>this._style.tooltip.valueFormat(t.value.data[e.key],{data:t.value.data,series:e},this._state,this)));let r="<p>";i.forEach(((t,e)=>{const i=n[e];null!=i&&(r+=`<rect w="8" h="8" baseLineShift="1" fill="${s[e]}" /><tab /><span fontColor="#757575">${t}</span><tab/><b>${i}</b><br/>`)})),r+="</p>";const a=`\n      <text lineHeight="1.8" tabStops="15,${La(Math.max(...i.map((t=>t.length))),12,400)+20}">\n        <p fontSize="14" fontWeight="700">{{category}}</p>\n        ${r}\n      </text>`;return"function"==typeof this._tooltipText?this._tooltipText({...t,labels:i,colors:s,formattedValues:n,defaultText:a.trim(),series:this._seriesCache,category:this._cats.flat(1)[t.idx]},this._state,e,this):a}_initTooltip(t,e,i,s){Wt(t).append("text")}_prerenderTooltip(t,e,i,s){const n=new Se({width:this._style.tooltip.maxWidth,fontSize:this._style.tooltip.font.size}),r=this._cats.flat(1)[e.idx];n.render(this._getTooltipText(e,i),t,{category:r,d:e,state:this._state});const a=t.getBoundingClientRect();i.viewRect.setHeight(a.height+10),i.viewRect.setWidth(a.width+10),t.setAttribute("transform",`translate(${i.viewRect.left+5} ${i.viewRect.top+5})`)}_renderTooltip(t,e,i,s){}_computeSeriesTotal(){this._vals.forEach((t=>{t._tot=this._seriesCache.map((e=>t[e.key])).reduce(((t,e)=>t+e))}))}}var no={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};const ro=Object.create(null);for(const t in no)Object.hasOwn(no,t)&&(ro[no[t]]=t);const ao={to:{},get:{}};function lo(t,e,i){return Math.min(Math.max(e,t),i)}function oo(t){const e=Math.round(t).toString(16).toUpperCase();return e.length<2?"0"+e:e}ao.get=function(t){let e,i;switch(t.slice(0,3).toLowerCase()){case"hsl":e=ao.get.hsl(t),i="hsl";break;case"hwb":e=ao.get.hwb(t),i="hwb";break;default:e=ao.get.rgb(t),i="rgb"}return e?{model:i,value:e}:null},ao.get.rgb=function(t){if(!t)return null;let e,i,s,n=[0,0,0,1];if(e=t.match(/^#([a-f\d]{6})([a-f\d]{2})?$/i)){for(s=e[2],e=e[1],i=0;i<3;i++){const t=2*i;n[i]=Number.parseInt(e.slice(t,t+2),16)}s&&(n[3]=Number.parseInt(s,16)/255)}else if(e=t.match(/^#([a-f\d]{3,4})$/i)){for(e=e[1],s=e[3],i=0;i<3;i++)n[i]=Number.parseInt(e[i]+e[i],16);s&&(n[3]=Number.parseInt(s+s,16)/255)}else if(e=t.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|/]\s*([+-]?[\d.]+)(%?)\s*)?\)$/)){for(i=0;i<3;i++)n[i]=Number.parseInt(e[i+1],10);e[4]&&(n[3]=e[5]?.01*Number.parseFloat(e[4]):Number.parseFloat(e[4]))}else{if(!(e=t.match(/^rgba?\(\s*([+-]?[\d.]+)%\s*,?\s*([+-]?[\d.]+)%\s*,?\s*([+-]?[\d.]+)%\s*(?:[,|/]\s*([+-]?[\d.]+)(%?)\s*)?\)$/)))return(e=t.match(/^(\w+)$/))?"transparent"===e[1]?[0,0,0,0]:Object.hasOwn(no,e[1])?(n=no[e[1]],n[3]=1,n):null:null;for(i=0;i<3;i++)n[i]=Math.round(2.55*Number.parseFloat(e[i+1]));e[4]&&(n[3]=e[5]?.01*Number.parseFloat(e[4]):Number.parseFloat(e[4]))}for(i=0;i<3;i++)n[i]=lo(n[i],0,255);return n[3]=lo(n[3],0,1),n},ao.get.hsl=function(t){if(!t)return null;const e=t.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d.]+)%\s*,?\s*([+-]?[\d.]+)%\s*(?:[,|/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(e){const t=Number.parseFloat(e[4]);return[(Number.parseFloat(e[1])%360+360)%360,lo(Number.parseFloat(e[2]),0,100),lo(Number.parseFloat(e[3]),0,100),lo(Number.isNaN(t)?1:t,0,1)]}return null},ao.get.hwb=function(t){if(!t)return null;const e=t.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d.]+)%\s*,\s*([+-]?[\d.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(e){const t=Number.parseFloat(e[4]);return[(Number.parseFloat(e[1])%360+360)%360,lo(Number.parseFloat(e[2]),0,100),lo(Number.parseFloat(e[3]),0,100),lo(Number.isNaN(t)?1:t,0,1)]}return null},ao.to.hex=function(...t){return"#"+oo(t[0])+oo(t[1])+oo(t[2])+(t[3]<1?oo(Math.round(255*t[3])):"")},ao.to.rgb=function(...t){return t.length<4||1===t[3]?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"},ao.to.rgb.percent=function(...t){const e=Math.round(t[0]/255*100),i=Math.round(t[1]/255*100),s=Math.round(t[2]/255*100);return t.length<4||1===t[3]?"rgb("+e+"%, "+i+"%, "+s+"%)":"rgba("+e+"%, "+i+"%, "+s+"%, "+t[3]+")"},ao.to.hsl=function(...t){return t.length<4||1===t[3]?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"},ao.to.hwb=function(...t){let e="";return t.length>=4&&1!==t[3]&&(e=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+e+")"},ao.to.keyword=function(...t){return ro[t.slice(0,3)]};let ho={x:null,y:null};function co(t){const e=t.target.closest("svg");if(null===e)return t;const i=t.x||t.touches[0]&&t.touches[0].clientX,s=t.y||t.touches[0]&&t.touches[0].clientY;i&&s&&(ho={x:i,y:s});const n=function(t,e,i,s){const n=(t||e.closest("svg")).createSVGPoint();return n.x=i,n.y=s,n.matrixTransform(e.getScreenCTM().inverse())}(e,t.target,ho.x,ho.y);return{type:t.type,target:t.target,x:n.x,y:n.y,event:t}}class uo extends Ea{constructor(t={}){t.hasChartArea=!0,super(t),this.legend=null,this._legendNode=null,this.xAxis({type:"linear"}),this.yAxis({type:"linear"}),this.style({chartArea:{margin:{top:0,right:50,left:0,bottom:0}},confidenceInterval:{opacity:.3,color:null,customize:(t,e,i)=>{},label:"Confidence interval",showLegend:!1},dataPoints:{show:{default:!1,selected:!0},showLast:{default:!0,selected:!0},size:{default:7,selected:7,highlighted:7},stroke:{color:{highlighted:"#ffffff"},width:{default:2,selected:2,highlighted:2}},fill:{color:{default:"#ffffff"}},distanceThreshold:{default:10,selected:7},customize:(t,e,i)=>{}},dataRect:{padding:{left:20,right:20}},grid:{horizontal:{show:!0,color:"#ccc",width:1,customize:(t,e,i)=>{}},vertical:{show:!1,customize:(t,e,i)=>{}}},labels:{show:"default",handleOverlappingLabels:!1,color:null,font:{size:12},customize:(t,e,i)=>{}},legend:{show:!1,align:"left",position:"bottom",padding:{top:15,bottom:5}},line:{color:null,width:{default:1,selected:3},customize:(t,e,i)=>{},class:(t,e,i)=>[]},theme:{color:{default:"#8e8e8e",selected:"#0089ce",highlighted:"#0089ce"}},tooltip:{font:{size:12},maxSnapDistance:100,maxWidth:300,line:{color:null,width:1},label:{color:null,font:{size:16,color:null}},value:{color:null,font:{size:16,color:null}},verticalPosition:"mouse"},zoom:{max:1/0,min:1}}),this.defineDefaults({height:()=>Math.max(300,Math.min(550,document.documentElement.clientHeight-100)),labelFn:()=>null,values:t=>t,xAutoSort:!0,xAxisTitle:"",yAxisTitle:"",xAxisFormat:t=>t,yAxisFormat:t=>t,xAxisTooltip:(t,e,i,s)=>e.xLabel||this._xAxisFormat(t)||null,yAxisTooltip:t=>this._yAxisFormat(t),xDomain:null,yDomain:null}),this._referenceLine={show:!1,key:"referenceValue",fill:!0,fillColor:"#ddd",strokeWidth:.5,strokeColor:"#f00"},this._tooltip=null,this._tooltipConfig={enabled:!0,type:"popup",text:null},this._zoom={enabled:!1},this._stepped=!1,this._stepType="middle",this._vals=null,this._currentInteraction=null,this._svg=null,this._syncFn={...this._syncFn,xDomain:this._handleXDomainSync.bind(this)}}referenceLine(t){for(const e in this._referenceLine)this._referenceLine[e]=t[e]||this._referenceLine[e];return this}tooltips(t){for(const e in this._tooltipConfig)this._tooltipConfig[e]=t[e]||this._tooltipConfig[e];return this}zoomable(t={enabled:!0}){return Object.assign(this._zoom,!0===t?{enabled:!0}:t),this._zoom.enabled&&this.chartArea._xAxis.isCategorical()&&(console.warn("Zoom function is not available for categorical axis"),this._zoom.enabled=!1),this._zoom.enabled&&(this.chartArea.snapXDomainToTicks=!1),this}xAxisType(t){return"categorical"===t&&(console.warn("Axis type 'categorical' is deprecated. Use 'ordinal' instead."),t="ordinal"),"continuous"===t&&(console.warn("Axis type 'continuous' is deprecated. Use 'linear' instead."),t="linear"),this.xAxis({type:t}),this}stepped(t="middle"){if(!1!==t)return this._stepped=!0,this._stepType=t,this;this._stepped=!1}lineColor(){return console.warn("The function lineColor of the line chart does not exist anymore. Replace by setting the style of the chart, e.g. the lineChart.style({ theme: { color: ... } }) or lineChart.style({ line: { color: ... } }). Please refer to the documentation for more information."),this}_lineColor(){return"#993333"}zoomLevel(){if(!this._origXDomain||!this.chartArea._xDomain)return null;return(this._origXDomain[1]-this._origXDomain[0])/(this.chartArea._xDomain[1]-this.chartArea._xDomain[0])}hasConfidenceInterval(){return!!this._data&&this._vals.map((t=>{const e=t[0].confidenceInterval;return"number"==typeof e&&e>0||e&&e.lower&&e.upper})).some((t=>t>0))}init(t,e){super.init(t,e),t.classList.add("dv_lineChart"),Wt(t).append("g").attr("class","dv_legend"),Wt(t).append("g").attr("class","dv_linesAlt"),Wt(t).append("g").attr("class","dv_confInt"),Wt(t).append("g").attr("class","dv_refLine"),Wt(t).append("g").attr("class","dv_lines"),Wt(t).append("g").attr("class","dv_linePoints"),Wt(t).append("g").attr("class","dv_labels"),Wt(t).append("g").attr("class","dv_tooltipBkgd"),Wt(t).append("g").attr("class","dv_tooltip"),Wt(t).append("g").attr("class","dv_bkgd dv_interaction dv_noprint").append("rect"),Wt(t).append("g").attr("class","dv_lines_hdl dv_hdl dv_noprint"),Wt(t).select(".dv_bkgd.dv_interaction").append("g").attr("class","dv_brush dv_noprint"),this._tooltipConfig.enabled&&"popup"===this._tooltipConfig.type&&(this._tooltip=new Za,this._tooltip.anchorPosition(["centerleft"]).on("init",this._initPopupTooltip.bind(this)).on("prerender",this._prerenderPopupTooltip.bind(this)).on("render",this._renderPopupTooltip.bind(this))),this._confIntClip=Wt(this.defs()).append("clipPath").attr("id",`clipAlt_${this.id}`),this.chartArea.xGrid(this._style.grid.vertical),this.chartArea.yGrid(this._style.grid.horizontal),this.chartArea.style.xAxis.format=this._xAxisFormat,this.chartArea.style.yAxis.format=this._yAxisFormat,this.chartArea.style.dataRect.padding.left=this._style.dataRect.padding.left,this.chartArea.style.dataRect.padding.right=this._style.dataRect.padding.right,this._zoom.enabled&&this._insertZoomControls(),Wt(window).on("blur",(()=>{this._removeTooltip()}))}prerender(t,e){if(super.prerender(t,e),!this.datasource.loaded)return void console.info("Rendering of chart postponed. Datasource not yet ready.");this.emit("prerenderWillStart",[t,e,this]),this._node=t;const i=this._style;this._data=this.transformedData(e);const s=new Kt;this._data.forEach(((t,i)=>{t.idx=i,t.sortedValues=this._values(t,e),t.sortedValues.forEach(((e,i)=>{e.obj=t,e.data=t.sortedValues,e.valueIdx=i})),s.update(t.sortedValues.map((t=>t.x)))}));const n=s.sequence();this._data.forEach(((t,e)=>{t.sortedValues.forEach(((t,e)=>{t.sortIdx=n.indexOf(t.x)})),this._xAutoSort&&(this.chartArea._xAxis.isCategorical()?t.sortedValues.sort(((t,e)=>t.sortIdx-e.sortIdx)):t.sortedValues.sort(((t,e)=>t.x>e.x?1:t.x<e.x?-1:0))),this._flagLonelyPoints(t.sortedValues)})),this._filteredData=this._data.filter((t=>!t.sortedValues.every((t=>null===t.y)))),this._filteredData.forEach(((t,e)=>{const i=this._style.line.class(t,this._state,this);!0!==i.dv_highlighted?!0!==i.dv_selected?t.__sortIdx__=e:t.__sortIdx__=this._filteredData.length+e:t.__sortIdx__=2*this._filteredData.length+e})),this._filteredData.sort(((t,e)=>t.__sortIdx__-e.__sortIdx__)),this._vals=this._filteredData.map((t=>t.sortedValues));const r=this.hasConfidenceInterval(),a=this._(i.confidenceInterval.showLegend,{value:this._vals},e,this),l=this._(i.legend.show,{value:this._vals,data:this._data,filteredData:this._filteredData},e,this);if(null===this.legend){this._legendNode=t.querySelector("g.dv_legend");const s=[],n=[],o=[];if(l){const t=this._prop(i.line.color,i.theme.color);n.push(...this._filteredData.map(((e,i)=>t(e,i,null))));const e=this._prop(i.line.width,{default:1,selected:3}),r=this._filteredData.map(((t,i)=>e(t,i,null)));o.push(...this._filteredData.map(((t,e)=>({width:15,height:15,bottom:0,shape:"line",lineWidth:r[e],padding:{bottom:3}})))),s.push(...this._filteredData.map((t=>this._labelFn(t,this._state,this)||t.label||t.key||t.name||"")))}if(r&&a){s.push(this._(i.confidenceInterval.label,{data:this._data},e,this)),o.push({width:-7,height:15,bottom:0,shape:null,padding:{bottom:3}});const t=this._prop(i.confidenceInterval.color,i.theme.color),r=this._filteredData.map(((e,i)=>t(e,i,null)));n.push(r.length>0?r[0]:"#fff")}this.legend=(new Na).categories(s).colors(n).boxes(o).style({align:i.legend.align,padding:{bottom:0}}),this.legend.init(this._legendNode,e)}if(r&&a||l){this.legend.maxViewRect=new ne(this.viewRect.left,this.viewRect.top,this.viewRect.width(),null),this.legend.prerender(this._legendNode,e);const t="bottom"===i.legend.position?i.legend.padding.top:i.legend.padding.bottom;"top"===i.legend.position?i.chartArea.margin.top=this.legend.viewRect.height()+t:i.chartArea.margin.bottom=this.legend.viewRect.height()+t}else this.legend.viewRect.setHeight(0),i.chartArea.margin.top=0,i.chartArea.margin.bottom=0;this.viewRect.setHeight("function"==typeof this._height?this._height(e,this):this._height),this.chartArea._xAxisLabel=this._f(this._xAxisTitle,e,this),this.chartArea._yAxisLabel=this._f(this._yAxisTitle,e,this);const o=this._vals.flat().map((t=>t.x));if(this._origXDomain=this._computeXDomain(),this._zoom.enabled&&this._zoom.xDomain&&this._zoom.xDomain.default){const t=this._f(this._zoom.xDomain.default,{data:this._vals,values:o,minValue:Ci(o),maxValue:Si(o)},this._state,this);this.chartArea.xDomain(t)}else if(this._zoom.enabled&&this._zoom.zoom&&this._zoom.zoom.default){let t=this._f(this._zoom.zoom.default,{data:this._vals,values:o,minValue:Ci(o),maxValue:Si(o)},this._state,this);t<1&&(t=1),t>this._zoom.zoom.max&&(t=this._zoom.zoom.max);const e=this._origXDomain;this.chartArea.xDomain([e[1]-(e[1]-e[0])/t,e[1]])}else this.chartArea.xDomain(this._origXDomain);this.chartArea.yDomain(this._computeYDomain()),this.chartArea.style.dataRect.padding.top=Math.max(this.chartArea.style.dataRect.padding.top||0,10),this.chartArea._xValues=o,this.chartArea._yValues=this._vals.flat().map((t=>t.y)),this.emit("prerenderDidEnd",[t,e,this])}render(t,e){if(!this.datasource.loaded)return;this.emit("renderWillStart",[t,e,this]),super.render(t,e);const i=this._style,s=this.hasConfidenceInterval(),n=this._(i.confidenceInterval.showLegend,{value:this._vals},e,this),r=this._(i.legend.show,{value:this._vals,data:this._data,filteredData:this._filteredData},e,this);s&&n||r?(Wt(t).select(".dv_legend").style("display",null),"bottom"===i.legend.position&&t.querySelector(".dv_legend").setAttribute("transform",`translate(0 ${this.chartArea.viewRect.height()+i.legend.padding.top})`),this.legend.render(this._legendNode,e)):Wt(t).select(".dv_legend").style("display","none"),this._line=$l().x((t=>this.chartArea.xScale(t.x))).y((t=>this.chartArea.yScale(t.y))).defined((t=>null!==t.x&&null!=t.y));const a={middle:Pl,before:Ul,after:ql};if(this._stepped&&this._line.curve(a[this._stepType]||Pl),this._confInt=Vl().x((t=>this.chartArea.xScale(t.x))).y0((t=>this.chartArea.yScale(t.y-this._ciLower(t)))).y1((t=>this.chartArea.yScale(t.y+this._ciUpper(t)))).defined((t=>null!==t.x&&null!==t.y&&t.confidenceInterval)),this._referenceLine.show){const t=this._referenceLine.key;this._refLine=$l().x((t=>this.chartArea.xScale(t.x))).y((e=>this.chartArea.yScale(e[t]))).defined((e=>null!==e.x&&null!=e[t])),this._refLineArea=Vl().x((t=>this.chartArea.xScale(t.x))).y0((e=>this.chartArea.yScale(e[t]))).y1((t=>this.chartArea.yScale(t.y))).defined((e=>null!==e.x&&null!==e.y&&null!==e[t])),this._stepped&&(this._refLine.curve(a[this._stepType]||Pl),this._refLineArea.curve(a[this._stepType]||Pl))}this._tooltip&&this._tooltip.shown&&this._removeTooltip(),this._renderConfidenceInterval(),this._renderReferenceLine(),this._renderLines(),this._renderDataPoints(),this._renderLabels(),this._renderInteractionHandles(),this._zoom.enabled&&this._makeZoomable(),this.emit("renderDidEnd",[t,e,this])}_renderConfidenceInterval(){const t=this._style;Wt(this._node).select("g.dv_confInt").selectAll("path").data(this._filteredData).join("path").attr("d",(t=>this._confInt(t.sortedValues))).classed("dv_selected",(t=>t.selected)).attr("fill",this._prop(this._style.confidenceInterval.color,this._style.theme.color,((t,e,i,s)=>{const n=this._prop(this._style.confidenceInterval.opacity,.3)(e.data,e.idx,e.nodes);return`rgb(${ao.get.rgb(t).map((t=>255-(255-t)*n)).join(",")})`}))).call((t=>{this._style.confidenceInterval.customize(t,this._state,this)})),Wt(this._node).select("g.dv_confInt").selectAll("g").data(this._filteredData).join("g").style("stroke",this._prop(t.confidenceInterval.color,t.theme.color)).selectAll("line").data((t=>t.sortedValues.filter((t=>t.isLonely&&t.confidenceInterval)))).join("line").attr("x1",(t=>this.chartArea.xScale(t.x))).attr("x2",(t=>this.chartArea.xScale(t.x))).attr("y1",(t=>this.chartArea.yScale(t.y-this._ciLower(t)))).attr("y2",(t=>this.chartArea.yScale(t.y+this._ciUpper(t)))).style("stroke-width",15).style("stroke-opacity",this._prop(t.confidenceInterval.opacity,.3)).style("fill","none"),this._confIntClip.selectAll("path").data(this._filteredData).join("path").attr("d",(t=>this._confInt(t.sortedValues)))}_renderReferenceLine(){!0===this._referenceLine.show&&(this._referenceLine.fill&&Wt(this._node).select("g.dv_refLine").selectAll("path.dv_refFill").data(this._filteredData).join("path").attr("class","dv_refFill").attr("clip-path",`url(#clip_${this.id})`).attr("d",(t=>this._refLineArea(t.sortedValues))).style("stroke","none").style("stroke-width",0).style("fill",this._referenceLine.fillColor),this._referenceLine.strokeWidth>0&&Wt(this._node).select("g.dv_refLine").selectAll("path.dv_refStroke").data(this._filteredData).join("path").attr("class","dv_refStroke").attr("clip-path",`url(#clip_${this.id})`).attr("d",(t=>this._refLine(t.sortedValues))).style("stroke",this._referenceLine.strokeColor).style("stroke-width",this._referenceLine.strokeWidth))}_renderLines(){const t=this._style;Wt(this._node).select("g.dv_lines").selectAll("path").data(this._filteredData).join("path").attr("d",(t=>this._line(t.sortedValues))).classed("dv_selected",(t=>t.selected)).attr("clip-path",`url(#clipAlt_${this.id})`).call(this._lineClassNames.bind(this)).style("stroke",this._prop(t.line.color,t.theme.color)).style("stroke-width",this._prop(t.line.width,{default:1,selected:3})).style("fill","none").call((t=>{this._style.line.customize(t,this._state,this)})),Wt(this._node).select("g.dv_linesAlt").selectAll("path").data(this._filteredData).join("path").attr("d",(t=>this._line(t.sortedValues))).classed("dv_selected",(t=>t.selected)).classed("dv_alt",!0).call(this._lineClassNames.bind(this)).style("stroke",this._prop(t.line.color,t.theme.color)).style("stroke-width",this._prop(t.line.width,{default:1,selected:3})).style("fill","none").call((t=>{this._style.line.customize(t,this._state,this)}))}_renderDataPoints(){const t=this._style;if(!1===t.dataPoints.show)return;const e=this.chartArea,i=Math.min(...this._vals.map((t=>{const e=t.map((t=>({x:this.chartArea.xScale(t.x),y:this.chartArea.yScale(+t.y+(+t.yref||0))})));let i=1/0;for(let t=1;t<e.length;t++)e[t].x&&e[t].y&&e[t-1].x&&e[t-1].y&&(i=Math.min(i,Math.pow(e[t].x-e[t-1].x,2)+Math.pow(e[t].y-e[t-1].y,2)));return i})));Wt(this._node).select("g.dv_linePoints").selectAll("g").data(this._filteredData).join("g").classed("dv_selected",(t=>t.selected)).call((e=>{e.each(((e,s,n)=>{if(!this._prop(t.dataPoints.show,!1)(e,s,n))return void n[s].classList.remove("dv_visible");const r=this._prop(t.dataPoints.distanceThreshold,10)(e,s,n);i<Math.pow(r,2)?(n[s].classList.add("dv_pointsTooClose"),n[s].classList.remove("dv_visible")):(n[s].classList.remove("dv_pointsTooClose"),n[s].classList.add("dv_visible"))}))})).call(this._lineClassNames.bind(this)).selectAll("circle").data((t=>t.sortedValues)).join("circle").classed("dv_highlighted",((t,e,i)=>i[e].parentNode.classList.contains("dv_highlighted"))).classed("dv_alt",(t=>t.confidenceInterval&&(t.confidenceInterval.lower<0||t.confidenceInterval.upper<0))).classed("dv_hidden",(t=>null===t.y)).classed("dv_visible",((e,i,s)=>!!e.isLonely||i===s.length-1&&this._prop(t.dataPoints.showLast,!0)(e,i,s))).attr("cx",(t=>e.xScale(t.x)+("band"===e.xScale.type?e.xScale.bandwidth()/2:0))).attr("cy",(t=>e.yScale(+t.y+(+t.yref||0)))).attr("r",this._prop(t.dataPoints.size,14,(t=>t/2))).style("stroke",this._prop(t.dataPoints.stroke.color,t.theme.color)).style("stroke-width",this._prop(t.dataPoints.stroke.width,2)).style("fill",this._prop(t.dataPoints.fill.color,"#ffffff")).call((e=>{t.dataPoints.customize(e,this._state,this)}))}_flagLonelyPoints(t){const e=t.length;t.forEach(((i,s)=>{i.isLonely=!1,null!==i.y&&(1!==e?s>0&&s<e-1&&null===t[s-1].y&&null===t[s+1].y?i.isLonely=!0:0!==s||null!==t[s+1].y?s===e-1&&null===t[s-1].y&&(i.isLonely=!0):i.isLonely=!0:i.isLonely=!0)}))}_renderLabels(){const t=this._style;if(!1===t.labels.show||"hidden"===t.labels.show)return;const e=this.chartArea;if(Wt(this._node).select("g.dv_labels").selectAll("text").classed("dv_hidden",!1),Wt(this._node).select("g.dv_labels").selectAll("text").data(this._filteredData).join("text").text((t=>this._labelFn(t,this._state,this)||t.label||t.key||t.name||"")).attr("x",(t=>e.dataRect.right+5)).attr("y",(i=>{const s=i.sortedValues,n=e.xScale.domain(),r=n[n.length-1],a=Zt(s.filter((t=>t.x<=r)),(t=>null!==t.x&&null!==t.y));return e.yScale(+a.y+(+a.yref||0))+(t.labels.font.size/2-2)})).style("font-size",`${t.labels.font.size}px`).classed("dv_selected",(t=>t.selected)).classed("dv_show","always"===t.labels.show).call(this._lineClassNames.bind(this)).attr("fill",this._prop(t.labels.color,t.theme.color)).call((e=>{t.labels.customize(e,this._state,this)})).call((i=>{i.nodes().forEach((i=>{Aa(i,this.viewRect.right-e.dataRect.right-9,1.2*t.labels.font.size)}))})),"always"===t.labels.show)this._handleOverlappingLabels();else{const e=Wt(this._node).select("g.dv_labels text.dv_selected").node();if(e){const t=e.getBoundingClientRect();Wt(this._node).selectAll("g.dv_labels text").nodes().forEach((e=>{!e.classList.contains("dv_selected")&&jt(t,e.getBoundingClientRect())&&e.classList.add("dv_hidden")}))}t.labels.handleOverlappingLabels&&this._handleOverlappingLabels()}}_handleOverlappingLabels(){const t=this._style;Wt(this._node).select("g.dv_labels").selectAll("text").attr("transform","translate(0 0)");const e=Wt(this._node).selectAll("g.dv_labels text").nodes().map(((t,e)=>({node:t,idx:e,bbox:t.getBoundingClientRect(),selected:t.classList.contains("dv_selected"),highlighted:t.classList.contains("dv_highlighted")}))).filter((e=>"always"===t.labels.show||"never"!==t.labels.show&&(e.node.classList.contains("dv_selected")||e.node.classList.contains("dv_highlighted")))),i={};if(e.forEach((t=>{i[t.idx]=t})),!function(t,e=0){for(let i=0;i<t.length;i++)for(let s=i;s<t.length;s++)if(jt(t[i],t[s],e))return!0;return!1}(e.map((t=>t.bbox))))return;(function(t,e,i){const s=t.map(((t,e)=>({x:t.left,y:t.top+Math.random(),oy:t.top,dy:0,width:t.width,height:t.height,idx:e}))),n=t=>{for(let n=0;n<s.length;n++){s[n].dy=0;for(let r=0;r<s.length;r++){if(n===r)continue;const a=(s[n].y<s[r].y?s[n].height:s[r].height)+i,l=Math.abs(s[n].y-s[r].y),o=Math.max(0,a-l);s[n].dy+=.5*t*(s[n].y<s[r].y?-1:1)*o,s[n].dy-=Math.max(Math.abs(s[n].y+s[n].dy-s[n].oy)-e,0)}}s.forEach((t=>{t.y=t.y+t.dy}))};let r=.5;for(;r>.1;)n(r),r*=.7;return s})(e.map((t=>t.bbox)),20,5).forEach((t=>{e[t.idx].movedBBox=t})),Wt(this._node).select("g.dv_labels").selectAll("text").each(((t,e,s)=>{const n=i[e];if(!n)return;const r=n.movedBBox.y-n.bbox.top;s[e].setAttribute("transform",`translate(0 ${r})`)}))}_renderInteractionHandles(){Wt(this._node).select("g.dv_lines_hdl").selectAll("path").data(this._filteredData).join("path").attr("d",(t=>this._line(t.sortedValues))).on("mouseover",this._selectLine.bind(this)).on("mouseout",this._deselectLine.bind(this)).on("mousemove",this._handleBackgroundMousemove.bind(this)).on("click",this._selectLine.bind(this)).style("fill","none"),Wt(this._node).select("g.dv_lines_hdl").selectAll("g").data(this._filteredData).join("g").on("mouseover",this._selectLine.bind(this)).on("mouseout",this._deselectLine.bind(this)).on("mousemove",this._handleBackgroundMousemove.bind(this)).on("click",this._selectLine.bind(this)).selectAll("circle").data((t=>t.sortedValues.filter((t=>t.isLonely)))).join("circle").attr("cx",(t=>this.chartArea.xScale(t.x))).attr("cy",(t=>this.chartArea.yScale(t.y))).attr("r",7),Wt(this._node).select(".dv_bkgd.dv_interaction rect").attr("x",this.chartArea.dataRect.left).attr("y",this.chartArea.dataRect.top).attr("width",this.chartArea.dataRect.width()).attr("height",this.chartArea.dataRect.height()),Wt(this._node).select(".dv_bkgd.dv_interaction").on("mousemove",this._handleBackgroundMousemove.bind(this)).on("touchmove",this._handleBackgroundMousemove.bind(this)).on("mouseleave",(()=>{this._removeTooltip(),this._tooltip&&this._tooltip.hide()})).on("click",this._handleBackgroundClick.bind(this))}_renderTooltip(t,e){if("inline"===this._tooltipConfig.type&&!this._selection)return void this._removeTooltip();const i=this._style,s="inline"===this._tooltipConfig.type?this._selection.sortedValues.map((t=>t.x)):this._filteredData.map((t=>t.sortedValues.map((t=>t.x)))).flat(),n=this._snapX(t,s);if(null===n)return void this._removeTooltip();const r="inline"===this._tooltipConfig.type?[this._selection]:this._filteredData.filter((t=>t.sortedValues.filter((t=>t.x.toString()===n.toString())).length>0)),a=this.chartArea,l=a.xScale(n)+("band"===a.xScale.type?a.xScale.bandwidth()/2:0),o=r.map((t=>this._valueAtX(t,n))).filter((t=>null!==t));o.every((t=>null===t.y))?this._removeTooltip():(Wt(this._node).select(".dv_tooltip").selectAll("line").data(["inline"===this._tooltipConfig.type?this._selection:1]).join("line").attr("class","dv_selected").classed("dv_alt",((t,e)=>o[e].confidenceInterval&&(o[e].confidenceInterval.lower<0||o[e].confidenceInterval.upper<0))).attr("x1",l).attr("y1","inline"===this._tooltipConfig.type?a.yScale(+o[0].y+(+o[0].yref||0)):a.dataRect.top).attr("x2",l).attr("y2","inline"===this._tooltipConfig.type&&o[0].yref?a.yScale(o[0].yref||0):a.dataRect.bottom+3).call(this._lineClassNames.bind(this)).style("stroke",this._prop(i.tooltip.line.color,i.theme.color,(t=>null===t?"#8e8e8e":t))).style("stroke-width",this._prop(i.tooltip.line.width,1)),Wt(this._node).select(".dv_tooltip").selectAll("circle").data(r).join("circle").attr("class","dv_selected").classed("dv_alt",((t,e)=>o[e].confidenceInterval&&(o[e].confidenceInterval.lower<0||o[e].confidenceInterval.upper<0))).attr("cx",l).attr("cy",((t,e)=>a.yScale(+o[e].y+(+o[e].yref||0)))).attr("r",this._prop(i.dataPoints.size,7,(t=>(t+3)/2))).call(this._lineClassNames.bind(this)).style("fill",this._prop(i.dataPoints.fill.color,i.theme.color)),"inline"===this._tooltipConfig.type?this._renderInlineTooltipLabel(t,l,o[0]):this._renderPopupTooltipLabel(t,l,e,o))}_renderPopupTooltipLabel(t,e,i,s){const n=Wt(this._node).select(".dv_bkgd.dv_interaction rect").node().getBoundingClientRect();this._tooltip.hide(),this._tooltip.anchorPosition(["centerleft","centerright"]),this._svg=this._svg||this._node.closest("svg");const r=this._svg.createSVGPoint();r.x=e,r.y="mouse"===this._style.tooltip.verticalPosition?i:n.height/2;const a=r.matrixTransform(this._node.getScreenCTM());s.forEach(((t,e)=>{t.yIdx=e})),s.sort(((t,e)=>t.y<e.y)),this._tooltip.show({clientX:a.x,clientY:a.y,target:{__data__:s}})}_renderInlineTooltipLabel(t,e,i){const s=this._style;Wt(this._node).select(".dv_tooltip").selectAll("text.dv_xAxisTitle").data([this._selection]).join("text").attr("class","dv_xAxisTitle dv_selected").classed("dv_alt",((t,e)=>i.confidenceInterval&&(i.confidenceInterval.lower<0||i.confidenceInterval.upper<0))).attr("x",e).attr("y",this.chartArea.dataRect.bottom+this.chartArea._xAxis.style.values.font.size+4).style("font-size",`${s.tooltip.font.size}px`).text(this._xAxisTooltip(i.x,i,this._state,this)).call(this._lineClassNames.bind(this)).style("fill",this._prop(s.tooltip.label.font.color,s.theme.color));const n=Wt(this._node).select(".dv_tooltip text.dv_xAxisTitle").node().getBoundingClientRect();Wt(this._node).select(".dv_tooltipBkgd").selectAll("rect.dv_xAxisRect").data([this._selection]).join("rect").attr("class","dv_xAxisRect").attr("x",this.chartArea.xScale(i.x)-n.width/2-3).attr("y",this.chartArea.dataRect.bottom+3).attr("width",n.width+6).attr("height",n.height+2);const r=()=>{if("number"==typeof i.yref){const t=this.chartArea.yScale,e=t(+i.y+(+i.yref||0)),n=t(i.yref||0);if(n-e>2*s.tooltip.font.size)return(n+e)/2+.5*s.tooltip.font.size}return this.chartArea.yScale(+i.y+(+i.yref||0))-10};Wt(this._node).select(".dv_tooltip").selectAll("text.dv_valueHalo").data([this._selection]).join("text").attr("class","dv_valueHalo").attr("x",this.chartArea.xScale(i.x)).attr("y",r()).style("font-size",`${this._style.tooltip.font.size}px`).style("fill","#ffffffaa").style("stroke","#ffffffaa").style("stroke-width",7).style("stroke-linejoin","round").text(this._yAxisTooltip(i.y,i,this._state,this)).call(this._lineClassNames.bind(this)),Wt(this._node).select(".dv_tooltip").selectAll("text.dv_valueLabel").data([this._selection]).join("text").attr("class","dv_valueLabel dv_selected").classed("dv_alt",((t,e)=>i.confidenceInterval&&(i.confidenceInterval.lower<0||i.confidenceInterval.upper<0))).attr("x",this.chartArea.xScale(i.x)).attr("y",r()).style("font-size",`${this._style.tooltip.font.size}px`).text(this._yAxisTooltip(i.y,i,this._state,this)).call(this._lineClassNames.bind(this)).style("fill",this._prop(s.tooltip.value.font.color,s.theme.color))}_computeXDomain(){if("band"===this.chartArea._xAxis.type)return[...new Set(this._vals.flat().map((t=>t.x)))];if("ordinal"===this.chartArea._xAxis.type){const t=[];return this._vals.flat().forEach((e=>{t[e.sortIdx]=e.x})),t}const t=this._f(this._xDomain,this._vals,this._vals.flat().map((t=>t.x)),this._state,this)||[null,null];return null===t[0]&&(t[0]=Ci(this._vals.flat().map((t=>t.x)))),null===t[1]&&(t[1]=Si(this._vals.flat().map((t=>t.x)))),t}_computeYDomain(){const t=this._f(this._yDomain,this._vals,this._vals.flat().map((t=>t.y)),this._state,this)||[null,null];return null===t[0]&&(t[0]=Ci(this._vals.flat().map((t=>t.y)))),null===t[1]&&(t[1]=Si(this._vals.flat().map((t=>t.y)))),t}_ciLower(t){return"object"==typeof t.confidenceInterval?t.confidenceInterval.lower:+t.confidenceInterval}_ciUpper(t){return"object"==typeof t.confidenceInterval?t.confidenceInterval.upper:+t.confidenceInterval}_lineClassNames(t){t.nodes().forEach((t=>{const e=Wt(t),i=this._style.line.class(e.datum(),this._state,this);Object.entries(i).forEach((([e,i])=>{i?t.classList.add(e):t.classList.remove(e)}))}))}_prop(t,e=null,i=t=>t){return(s,n,r)=>{const a=void 0===s.obj?s:s.obj,l=r&&r[n]||null;let o=null===t?null:this._(t,{values:a,idx:a.idx,node:l},this._state,this);return"object"==typeof o&&(o=Ve(o,l)),null==o&&(o=Ve(this._(e,{values:a,idx:a.idx,node:l},this._state,this),l)),i(o,{data:s,idx:n,node:l,nodes:r},this._state,this)}}_selectLine(t,e){this._selection=e,e.selected=!0,this._renderConfidenceInterval(),this._renderLines(),this._renderDataPoints(),this._renderLabels()}_deselectLine(t,e){e.selected=!1,this._selection=null,this._renderConfidenceInterval(),this._renderLines(),this._renderDataPoints(),this._renderLabels()}_makeZoomable(){const t=this.chartArea;this._clipPath.select("rect").attr("x",t.dataRect.left).attr("y",t.dataRect.top-4).attr("width",t.dataRect.width()).attr("height",t.dataRect.height()+8),Wt(this._node).select("g.dv_lines").attr("clip-path",`url(#clip_${this.id})`),Wt(this._node).select("g.dv_linesAlt").attr("clip-path",`url(#clip_${this.id})`),Wt(this._node).select("g.dv_lines_hdl").attr("clip-path",`url(#clip_${this.id})`),Wt(this._node).select("g.dv_linePoints").attr("clip-path",`url(#clip_${this.id})`),Wt(this._node).select("g.dv_confInt").attr("clip-path",`url(#clip_${this.id})`),Wt(this._node).select("g.dv_vgrid").attr("clip-path",`url(#clip_${this.id})`),Wt(this._node).select(".dv_bkgd.dv_interaction").on("wheel",this._handleZoom.bind(this),{passive:!1}),Wt(this._node).select(".dv_bkgd.dv_interaction").on("mousedown.brush",this._handleBackgroundMouseDown.bind(this)).on("mouseup.brush",this._handleBackgroundMouseUp.bind(this)).on("touchstart.brush",this._handleBackgroundMouseDown.bind(this)).on("touchend.brush",this._handleBackgroundMouseUp.bind(this)),this._origXDomain=this._origXDomain||[...this.chartArea._xDomain],Wt(this._node).select("g.dv_zoomControls use.dv_zoomIn").attr("x",this.viewRect.right-20).attr("y",this.viewRect.top).classed("dv_disabled",Math.abs(this.zoomLevel()-this._style.zoom.max)<1e-4),Wt(this._node).select("g.dv_zoomControls use.dv_zoomOut").attr("x",this.viewRect.right-20).attr("y",this.viewRect.top+18).classed("dv_disabled",Math.abs(this.zoomLevel()-this._style.zoom.min)<1e-4),Wt(this._node).select("g.dv_zoomControls use.dv_zoomAll").attr("x",this.viewRect.right-20).attr("y",this.viewRect.top+45).classed("dv_hidden",Math.abs(this.zoomLevel()-1)<1e-4),Math.abs(this.zoomLevel()-1)<1e-4?this._node.querySelector(".dv_bkgd.dv_interaction").style.cursor="crosshair":this._node.querySelector(".dv_bkgd.dv_interaction").style.cursor="move"}_insertZoomControls(){Wt(this.svg()).insert("symbol",":first-child").attr("id","zoomIn").attr("viewBox","0 0 50 50"),Wt(this.svg()).insert("symbol",":first-child").attr("id","zoomOut").attr("viewBox","0 0 50 50"),Wt(this.svg()).insert("symbol",":first-child").attr("id","zoomAll").attr("viewBox","0 0 50 50"),this.svg().querySelector("#zoomIn").innerHTML='\n      <rect x="2" y="2" width="46" height="46" rx="2" stroke="#555" stroke-width="2"/>\n      <line stroke="#555" stroke-width="5" x1="15" y1="25" x2="35" y2="25"/>\n      <line stroke="#555" stroke-width="5" x1="25" y1="15" x2="25" y2="35"/>\n    ',this.svg().querySelector("#zoomOut").innerHTML='\n      <rect x="2" y="2" width="46" height="46" rx="2" stroke="#555" stroke-width="2"/>\n      <line stroke="#555" stroke-width="5" x1="15" y1="25" x2="35" y2="25"/>\n    ',this.svg().querySelector("#zoomAll").innerHTML='\n      <rect x="2" y="2" width="46" height="46" rx="2" stroke="#555" stroke-width="2"/>\n      <polygon fill="#555" points="8,22 8,8 22,8"/>\n      <polygon fill="#555" points="22,42 8,42 8,28"/>\n      <polygon fill="#555" points="42,28 42,42 28,42"/>\n      <polygon fill="#555" points="28,8 42,8 42,22"/>\n      <line stroke="#555" stroke-width="5" x1="10" y1="10" x2="40" y2="40"/>\n      <line stroke="#555" stroke-width="5" x1="40" y1="10" x2="10" y2="40"/>\n    ';const t=Wt(this._node).select(".dv_bkgd.dv_interaction").append("g").attr("class","dv_controls dv_zoomControls dv_noprint");t.append("use").attr("href","#zoomIn").attr("width",20).attr("height",20).attr("class","dv_zoomIn").on("click",this._zoomIn.bind(this)),t.append("use").attr("href","#zoomOut").attr("width",20).attr("height",20).attr("class","dv_zoomOut").on("click",this._zoomOut.bind(this)),t.append("use").attr("href","#zoomAll").attr("width",20).attr("height",20).attr("class","dv_zoomAll").on("click",this._zoomAll.bind(this))}_handleBackgroundMousemove(t){const e=co(t);null===this._currentInteraction&&this._renderTooltip(e.x,e.y),"brushing"===this._currentInteraction&&this._brushMove(e),"moving"===this._currentInteraction&&this._move(e)}_handleBackgroundClick(t){this._selection&&this._deselectLine(null,this._selection)}_handleBackgroundMouseDown(t){if(t.button>0)return;const e=co(t);this._zoom.enabled&&Math.abs(this.zoomLevel()-1)<1e-4?this._brushStart(e):this._zoom.enabled&&Math.abs(this.zoomLevel()-1)>=1e-4&&this._moveStart(e)}_handleBackgroundMouseUp(t){const e=co(t);"brushing"===this._currentInteraction&&this._brushEnd(e),"moving"===this._currentInteraction&&this._moveEnd(e)}_handleXDomainSync(t,e){this.chartArea.xDomain(e),this.update()}_handleZoom(t){t.preventDefault();const e=co(t);this._performZoom(e.x,t.deltaY/Math.abs(t.deltaY))}_performZoom(t,e){const i=this._origXDomain.map((t=>this.chartArea.xScale(t))),s=this.chartArea.xScale.range(),n=this.chartArea.xScale.domain(),r=this.zoomLevel();let a=r+.2*e*r;a=Math.max(Math.min(a,this._style.zoom.max),this._style.zoom.min);const l=a/r;let o=i.map((e=>(e-t)*l+t));o[0]>s[0]&&(o=o.map((t=>t-(o[0]-s[0])))),o[1]<s[1]&&(o=o.map((t=>t+(s[1]-o[1])))),this.chartArea.xScale.range(o).domain(this._origXDomain);const h=[this.chartArea.xScale.invert(s[0]),this.chartArea.xScale.invert(s[1])];this.chartArea.xScale.range(s).domain(n),this.chartArea.xDomain(h),this.update(),this.emit("zoomEnd",[this._node,this._state,this]),this.triggerSync("xDomain",[h])}_zoomIn(){this._performZoom(this.chartArea.dataRect.left+this.chartArea.dataRect.width()/2,1)}_zoomOut(){this._performZoom(this.chartArea.dataRect.left+this.chartArea.dataRect.width()/2,-1)}_zoomAll(t){this.chartArea.xDomain(this._origXDomain),this.update(),this.triggerSync("xDomain",[this._origXDomain])}_moveStart(t){this._currentInteraction="moving",this._moveStartX=t.x,Wt(document).on("mouseup",this._handleBackgroundMouseUp.bind(this)),Wt(document).on("mouseout",this._handleBackgroundMouseUp.bind(this))}_move(t){let e=this._moveStartX-t.x;this._moveStartX=t.x;const i=this._origXDomain.map((t=>this.chartArea.xScale(t))),s=this.chartArea.xScale.range();e=Math.min(i[1]-s[1],e),e=Math.max(i[0]-s[0],e);const n=[this.chartArea.xScale.invert(this.chartArea.xScale(this.chartArea._xDomain[0])+e),this.chartArea.xScale.invert(this.chartArea.xScale(this.chartArea._xDomain[1])+e)];this.chartArea.xDomain(n),this.update(),this.triggerSync("xDomain",[n])}_moveEnd(t){this._currentInteraction=null,Wt(document).on("mouseup",null),Wt(document).on("mouseout",null),this.emit("moveEnd",[this._node,this._state,this])}_brushStart(t){Wt(this._node).select(".dv_brush").append("rect").attr("x",t.x).attr("y",this.chartArea.dataRect.top).attr("width",0).attr("height",this.chartArea.dataRect.height()),Wt(this._node).select(".dv_hdl").classed("dv_hidden",!0),this._currentInteraction="brushing",this._brushStartX=t.x}_brushMove(t){const e=Math.min(this._brushStartX,t.x),i=Math.max(this._brushStartX,t.x)-e;Wt(this._node).select(".dv_brush rect").attr("x",e).attr("width",i)}_brushEnd(t){if(Wt(this._node).selectAll(".dv_brush rect").remove(),Wt(this._node).select(".dv_hdl").classed("dv_hidden",!1),this._currentInteraction=null,Math.abs(this._brushStartX-t.x)<2)return;this._origXScale||(this._origXScale=this.chartArea.xScale);let e=[this.chartArea.xScale.invert(Math.min(this._brushStartX,t.x)),this.chartArea.xScale.invert(Math.max(this._brushStartX,t.x))];const i=this._origXScale.domain(),s=isFinite(this._style.zoom.max)?(i[1]-i[0])/this._style.zoom.max:0,n=e[1]-e[0];Math.abs(n)<Math.abs(s)&&(e=this._adaptDomainToMinimumRange(e,s)),this.chartArea.xDomain(e),this.update(),this.emit("brushEnd",[this._node,this._state,this]),this.triggerSync("xDomain",[e])}_adaptDomainToMinimumRange(t,e){if(t[0]instanceof Date){const i=t[0].getTime()+(t[1].getTime()-t[0].getTime())/2;return[new Date(i-e/2),new Date(i+e/2)]}{const i=t[0]+(t[1]-t[0])/2;return[i-e/2,i+e/2]}}update(){this.render(this._node,this._state)}_snapX(t,e){const i=this.chartArea;let s=1/0,n=-1;for(let r=0;r<e.length;r++){const a=i.xScale(e[r])+("band"===i.xScale.type?i.xScale.bandwidth()/2:0),l=Math.abs(a-t);s>l&&(s=l,n=r)}return s>this._style.tooltip.maxSnapDistance?null:e[n]}_valueAtX(t,e){const i=t.sortedValues;let s=t=>t;"object"==typeof e&&(s=t=>t.toString(),"[object Object]"===e.toString()&&console.warn("Values for the x-axis in a line chart should be numbers, strings or implement the toString function."));for(let t=0;t<i.length;t++)if(s(i[t].x)===s(e))return i[t];return console.warn(`Line chart tooltip: no data value found at ${e}`),null}_popupTooltipText(t,e){if("string"==typeof this._tooltipConfig.text)return this._tooltipConfig.text;if("function"==typeof this._tooltipConfig.text)return this._tooltipConfig.text(t.value,this._state,e);const i=this._filteredData.map((t=>this._labelFn(t,this._state,this)||t.label||t.key||t.name||"")),s=La(Math.max(...i.map((t=>t.length))),12,400),n=this._filteredData.map(((t,e)=>this._prop(this._style.line.color,this._style.theme.color)(t,e,null)));let r="<p>";return t.forEach((t=>{const e=t.yLabel||this._yAxisTooltip(t.y,t,this._state,this)||t.y;r+=`\n        <circle r="4" fill="${n[t.yIdx]}" /><tab />\n        <span fontColor="#757575">${i[t.yIdx]}</span><tab/><b>${e}</b><br/>\n      `})),r+="</p>",`\n      <text lineHeight="1.8" tabStops="15,${s}">\n        <p fontSize="14" fontWeight="700">{{xLabel}}</p>${r}\n      </text>\n    `}_initPopupTooltip(t,e,i,s){Wt(t).append("text")}_prerenderPopupTooltip(t,e,i,s){new Se({width:this._style.tooltip.maxWidth,fontSize:this._style.tooltip.font.size}).render(this._popupTooltipText(e.value,i),t,{data:e.value,state:this._state,x:e.value[0].x,xLabel:this._xAxisTooltip(e.value[0].x,e.value[0],this._state,this)||e.value[0].xLabel||e.value[0].x});const n=t.getBoundingClientRect();i.viewRect.setHeight(n.height),i.viewRect.setWidth(n.width),t.setAttribute("transform",`translate(${i.viewRect.left} ${i.viewRect.top})`)}_renderPopupTooltip(t,e,i,s){}_removeTooltip(){Wt(this._node).select(".dv_tooltip").selectAll("*").remove(),Wt(this._node).select(".dv_tooltipBkgd").selectAll("*").remove(),this._tooltip&&this._tooltip.hide()}}class _o{constructor(t,e){this.ctx=t,this.bw=e.bandwidth?e.bandwidth():10}areaStart(){this._areaStarted=!0,this._lineIdx=0}areaEnd(){this._areaStarted=!1,this._lineIdx=-1}lineStart(){this._lineIdx=this._lineIdx>=0?this._lineIdx+1:1,this._prevX=NaN,this._prevY=NaN,this._ptType=0}lineEnd(){1===this._lineIdx&&this.ctx.lineTo(this._prevX+this.bw,this._prevY),!0===this._areaStarted&&2===this._lineIdx&&this.ctx.closePath()}point(t,e){t=+t,e=+e,0===this._ptType?(this._lineIdx>1?(this.ctx.lineTo(t+this.bw,e),this.ctx.lineTo(t,e)):this.ctx.moveTo(t,e),this._ptType=1):this._lineIdx>1?(this.ctx.lineTo(this._prevX,e),this.ctx.lineTo(t,e)):(this.ctx.lineTo(t,this._prevY),this.ctx.lineTo(t,e)),this._prevX=t,this._prevY=e}}class po extends uo{constructor(t={}){super(t),this.style({area:{color:null,opacity:.5,customize:(t,e,i)=>{}},dataPoints:{size:4,show:{default:!1,selected:!1}},line:{width:{default:.5,selected:1}},chartArea:{margin:{right:0}}})}stepped(t="middle"){if(!1!==t)return this._stepped=!0,this._stepType=t,"band"===t&&this.chartArea._xAxis.isContinuous()&&(this.xAxis({type:"band"}),this.chartArea.style.categories.noPadding=!0,this.chartArea._xAxis.style.values.allowLabelShortening=!1),this;this._stepped=!1}init(t,e){super.init(t,e),Wt(t).insert("g",".dv_linesAlt").attr("class","dv_area"),Wt(t).append("g").attr("class","dv_area_hdl").style("opacity",0)}prerender(t,e){if(super.prerender(t,e),!this.datasource.loaded)return;let i=0,s=null;for(let t=0;t<this._data.length;t++){const e=this._data[t],n=e.sortedValues.length;n>i&&(i=n,s=e.sortedValues.map((t=>t.x)))}const n=new Array(i).fill(0);this._data.forEach((t=>{const e=Object.fromEntries(t.sortedValues.map((t=>[t.x,t])));t.completedValues=s.map((t=>{let i=e[t];return void 0===i&&(i={x:t,y:0,obj:null,data:null,valueIdx:null,sortIdx:null}),i})),t.completedValues.forEach((t=>{const e=s.indexOf(t.x);e>=0&&(t.yref=n[e],n[e]+=+t.y)}))}))}render(t,e){if(this.datasource.loaded){if(this.emit("renderWillStart",[t,e,this]),super.render(t,e),this._area=Vl().x((t=>this.chartArea.xScale(t.x))).y0((t=>this.chartArea.yScale(t.yref))).y1((t=>this.chartArea.yScale(t.yref+ +t.y))).defined((t=>null!==t.x&&null!=t.y)),this._line=$l().x((t=>this.chartArea.xScale(t.x))).y((t=>this.chartArea.yScale(t.yref+ +t.y))).defined((t=>null!==t.x&&null!=t.y)),this._stepped){const t={band:(i=this.chartArea.xScale,function(t){return new _o(t,i)}),middle:Pl,before:Ul,after:ql};this._area.curve(t[this._stepType]||Pl),this._line.curve(t[this._stepType]||Pl)}var i;this._renderArea(),this._renderLines(),this._renderDataPoints(),this._renderLabels(),this._renderInteractionHandles(),this._renderAreaInteractionHandles(),this._zoom.enabled&&this._makeZoomable(),this.emit("renderDidEnd",[t,e,this])}}_renderArea(){const t=this._style;Wt(this._node).select("g.dv_area").selectAll("path").data(this._data).join("path").attr("d",(t=>this._area(t.completedValues))).classed("dv_selected",(t=>t.selected)).style("stroke",null).style("stroke-width",0).style("fill",this._prop(t.area.color,t.theme.color)).style("fill-opacity",this._prop(t.area.opacity,.5)).call((t=>{this._style.area.customize(t,this._state,this)}))}_renderAreaInteractionHandles(){Wt(this._node).select("g.dv_area_hdl").selectAll("path").data(this._data).join("path").attr("d",(t=>this._area(t.completedValues))).on("mouseover",this._selectLine.bind(this)).on("mouseout",this._deselectLine.bind(this)).on("mousemove",this._handleBackgroundMousemove.bind(this)).on("click",this._selectLine.bind(this))}_renderLines(){const t=this._style;Wt(this._node).select("g.dv_lines").selectAll("path").data(this._data).join("path").attr("d",(t=>this._line(t.completedValues))).classed("dv_selected",(t=>t.selected)).call(this._lineClassNames.bind(this)).style("stroke",this._prop(t.line.color,"#ffffff")).style("stroke-width",this._prop(t.line.width,0)).style("fill","none").call((t=>{this._style.line.customize(t,this._state,this)}))}_renderLabels(){const t=this._style;if(!1===t.labels.show||"hidden"===t.labels.show)return;const e=this.chartArea;if(Wt(this._node).select("g.dv_labels").selectAll("text").classed("dv_hidden",!1),Wt(this._node).select("g.dv_labels").selectAll("text").data(this._filteredData).join("text").text((t=>this._labelFn(t,this._state,this)||t.label||t.key||t.name||"")).attr("x",(t=>e.dataRect.right+5)).attr("y",(i=>{const s=i.sortedValues,n=e.xScale.domain(),r=n[n.length-1],a=Zt(s.filter((t=>t.x<=r)),(t=>null!==t.x&&null!==t.y));return e.yScale(+a.y/2+(+a.yref||0))+(t.labels.font.size/2-2)})).style("font-size",`${t.labels.font.size}px`).classed("dv_selected",(t=>t.selected)).classed("dv_show","always"===t.labels.show).call(this._lineClassNames.bind(this)).attr("fill",this._prop(t.labels.color,t.theme.color)).call((e=>{t.labels.customize(e,this._state,this)})).call((i=>{i.nodes().forEach((i=>{Aa(i,this.viewRect.right-e.dataRect.right-9,1.2*t.labels.font.size)}))})),"always"===t.labels.show)this._handleOverlappingLabels();else{const e=Wt(this._node).select("g.dv_labels text.dv_selected").node();if(e){const t=e.getBoundingClientRect();Wt(this._node).selectAll("g.dv_labels text").nodes().forEach((e=>{!e.classList.contains("dv_selected")&&jt(t,e.getBoundingClientRect())&&e.classList.add("dv_hidden")}))}t.labels.handleOverlappingLabels&&this._handleOverlappingLabels()}}}class fo extends Ea{constructor(t){t.hasChartArea=!0,t.hasGriddedChartArea=!0,super(t),this.style({bars:{spacing:3},categories:{margin:{left:7,right:7},font:{size:12}},dataRect:{padding:{top:20,bottom:20}},grid:{horizontal:{show:!1},vertical:{show:!0,color:"#ccc",width:1}},values:{show:!0,alwaysOutside:!0,font:{size:11,colorInside:"#fff",colorOutside:"#454545"},format:t=>t,margin:5},referenceLine:{left:{color:"#000",width:2},right:{color:"#000",width:2}},xAxis:{show:!0,font:{size:12},customize:(t,e)=>{}},chartArea:{yAxis:{format:t=>t}}}),this.defineDefaults({categories:null,valuesLeft:null,valuesRight:null,referenceValuesLeft:null,referenceValuesRight:null,barColorLeft:()=>null,barColorRight:()=>null,height:(t,e,i)=>30*t.categories.length+50,maxValueLeft:null,maxValueRight:null,xAxisTitleLeft:null,xAxisTitleRight:null,xAxisFormat:t=>t,yAxisFormat:t=>t}),this.xAxis({type:"linear",placement:"top",mirrored:!0}),this.yAxis({type:"band"})}init(t,e){super.init(t,e),t.classList.add("dv_butterfly"),Wt(t).append("g").attr("class","dv_bars dv_barsLeft"),Wt(t).append("g").attr("class","dv_bars dv_barsRight"),Wt(t).append("g").attr("class","dv_bars dv_lineLeft"),Wt(t).append("g").attr("class","dv_bars dv_lineRight"),Wt(t).append("g").attr("class","dv_categories"),this._style.values.show&&(Wt(t).append("g").attr("class","dv_values dv_valuesLeft"),Wt(t).append("g").attr("class","dv_values dv_valuesRight")),this.chartArea.xGrid(this._style.grid.vertical),this.chartArea.yGrid(this._style.grid.horizontal),this.chartArea._xAxis.left.formatValue=this._xAxisFormat,this.chartArea._xAxis.right.formatValue=this._xAxisFormat,this.chartArea.style.dataRect.padding.top=this._style.dataRect.padding.top,this.chartArea.style.dataRect.padding.bottom=this._style.dataRect.padding.bottom,this.chartArea.style.categories.paddingInner=this._style.bars.spacing,this.chartArea.style.yAxis=this._style.chartArea.yAxis}prerender(t,e){if(super.prerender(t,e),!this.datasource.loaded)return void console.info("Rendering of chart postponed. Datasource not yet ready.");this.emit("prerenderWillStart",[t,e,this]),this._data=this.transformedData(e);const i=this._style;this._cats="function"==typeof this._categories?this._categories(this._data,e,this):this._data.map((t=>t[this._categories])),this._valsLeft="function"==typeof this._valuesLeft?this._valuesLeft(this._data,e,this):this._data.map((t=>t[this._valuesLeft])),this._valsRight="function"==typeof this._valuesRight?this._valuesRight(this._data,e,this):this._data.map((t=>t[this._valuesRight])),null!==this._referenceValuesLeft&&null!==this._referenceValuesRight&&(this._refValsLeft="function"==typeof this._referenceValuesLeft?this._referenceValuesLeft(this._data,e,this):this._data.map((t=>t[this._referenceValuesLeft])),this._refValsRight="function"==typeof this._referenceValuesRight?this._referenceValuesRight(this._data,e,this):this._data.map((t=>t[this._referenceValuesRight]))),this._maxValuesWidthLeft=0,this._maxValuesWidthRight=0,this._style.values.show&&(Wt(t).select(".dv_valuesLeft").selectAll("text").data(this._valsLeft).join("text").style("font-size",`${i.values.font.size}px`).text((t=>i.values.format(t))).each(((t,e,s)=>{const n=s[e].getBoundingClientRect().width;s[e].setAttribute("data-width",n),i.values.show&&i.values.alwaysOutside&&(this._maxValuesWidthLeft=Math.max(this._maxValuesWidthLeft,n+i.values.margin))})),Wt(t).select(".dv_valuesRight").selectAll("text").data(this._valsRight).join("text").style("font-size",`${i.values.font.size}px`).text((t=>i.values.format(t))).each(((t,e,s)=>{if(i.values.show&&i.values.alwaysOutside){const t=s[e].getBoundingClientRect().width;this._maxValuesWidthRight=Math.max(this._maxValuesWidthRight,t+i.values.margin)}}))),this.viewRect.setHeight(this._f(this._height,{valuesLeft:this._valsLeft,valuesRight:this._valsRight,categories:this._cats},e,this)),this.chartArea._xAxisLabel={left:this._f(this._xAxisTitleLeft,this,e),right:this._f(this._xAxisTitleRight,this,e)};const s=null===this._maxValueLeft?this._valsLeft.reduce(((t,e)=>Math.max(t,e))):this._maxValueLeft,n=null===this._maxValueRight?this._valsRight.reduce(((t,e)=>Math.max(t,e))):this._maxValueRight;this.chartArea.xDomain({left:[0,s],right:[0,n]}),this.chartArea.yDomain(this._cats),this.emit("prerenderDidEnd",[t,e,this])}render(t,e){this.datasource.loaded&&(this.emit("renderWillStart",[t,e,this]),super.render(t,e),this._renderBars(t,e),null!==this._referenceValuesLeft&&null!==this._referenceValuesRight&&this._renderReferenceLines(t,e))}_renderBars(t,e){const i=this._style;if(Wt(t).select(".dv_barsLeft").selectAll("rect").data(this._valsLeft).join("rect").attr("x",(t=>this.chartArea.xScale.left(t))).attr("width",(t=>this.chartArea.xScale.left(0)-this.chartArea.xScale.left(t))).attr("y",((t,e)=>this.chartArea.yScale(this._cats[e]))).attr("height",this.chartArea.yScale.bandwidth()).each(((t,e,i)=>{const s=i[e],n=this._barColorLeft({category:this._cats[e],value:t,idx:e,data:this._data},this._state,this);n&&(s.style.fill=n)})),Wt(t).select(".dv_barsRight").selectAll("rect").data(this._valsRight).join("rect").attr("x",(t=>this.chartArea.xScale.right(0))).attr("width",(t=>this.chartArea.xScale.right(t)-this.chartArea.xScale.right(0))).attr("y",((t,e)=>this.chartArea.yScale(this._cats[e]))).attr("height",this.chartArea.yScale.bandwidth()).each(((t,e,i)=>{const s=i[e],n=this._barColorRight({category:this._cats[e],value:t,idx:e,data:this._data},this._state,this);n&&(s.style.fill=n)})),i.values.show){const e=(this.chartArea.yScale.bandwidth()-this._style.categories.font.size)/2+.9*this._style.categories.font.size;Wt(t).select(".dv_valuesLeft").selectAll("text").data(this._valsLeft).join("text").attr("y",((t,i)=>this.chartArea.yScale(this._cats[i])+e)).each(((t,e,s)=>{const n=s[e],r=n.getBoundingClientRect().width+2*i.values.margin;i.values.alwaysOutside||r>=this.chartArea.xScale.left(0)-this.chartArea.xScale.left(t)?(n.style.fill=this._f(i.values.font.colorOutside,{data:t,idx:e,node:s[e]},this._state,this),n.style.textAnchor="end",n.setAttribute("x",this.chartArea.xScale.left(t)-i.values.margin)):(n.style.fill=this._f(i.values.font.colorInside,{data:t,idx:e,node:s[e]},this._state,this),n.style.textAnchor="start",n.setAttribute("x",this.chartArea.xScale.left(t)+i.values.margin))})),Wt(t).select(".dv_valuesRight").selectAll("text").data(this._valsRight).join("text").attr("y",((t,i)=>this.chartArea.yScale(this._cats[i])+e)).each(((t,e,s)=>{const n=s[e],r=n.getBoundingClientRect().width+2*i.values.margin;i.values.alwaysOutside||r>=this.chartArea.xScale.right(t)-this.chartArea.xScale.right(0)?(n.style.fill=this._f(i.values.font.colorOutside,{data:t,idx:e,node:s[e]},this._state,this),n.style.textAnchor="start",n.setAttribute("x",this.chartArea.xScale.right(t)+i.values.margin)):(n.style.fill=this._f(i.values.font.colorInside,{data:t,idx:e,node:s[e]},this._state,this),n.style.textAnchor="end",n.setAttribute("x",this.chartArea.xScale.right(t)-i.values.margin))}))}this.emit("renderDidEnd",[t,e,this])}_renderReferenceLines(t,e){const i=this._style,s=$l().x((t=>this.chartArea.xScale.left(t))).y(((t,e)=>this.chartArea.yScale(this._cats[e])+.5*this.chartArea.yScale.bandwidth()));Wt(t).select(".dv_bars.dv_lineLeft").selectAll("path").data([this._refValsLeft]).join("path").attr("d",s).style("stroke",(t=>this._(i.referenceLine.left.color,{values:t,position:"left"},e,this))).style("stroke-width",(t=>{const s=this._(i.referenceLine.left.width,{values:t,position:"left"},e,this);return"number"==typeof s?`${s}px`:s})).style("fill","none");const n=$l().x((t=>this.chartArea.xScale.right(t))).y(((t,e)=>this.chartArea.yScale(this._cats[e])+.5*this.chartArea.yScale.bandwidth()));Wt(t).select(".dv_bars.dv_lineRight").selectAll("path").data([this._refValsRight]).join("path").attr("d",n).style("stroke",(t=>this._(i.referenceLine.right.color,{values:t,position:"right"},e,this))).style("stroke-width",(t=>{const s=this._(i.referenceLine.right.width,{values:t,position:"right"},e,this);return"number"==typeof s?`${s}px`:s})).style("fill","none")}}class go extends Ea{constructor(t={}){t.hasChartArea=!1,super(t),this._categories=null,this._series=null,this._colors=null,this._values=t=>t,this._xAxis={title:null,tickValues:"auto"},this.style({box:{padding:{left:0,top:0,right:0,bottom:0}},categories:{spacing:{top:10,bottom:10,between:5},labels:{show:!0,align:"right",font:{size:12,weight:400,color:"#757575"},padding:4,width:.3,overflow:"wrap",lineHeight:15},gridlines:{show:!0,stroke:{width:1,color:"#e6e6e6"}}},dots:{size:10,stroke:{width:0,color:null}},rangeLine:{show:!0,stroke:{width:4,color:"#cccccc"},minValue:null,maxValue:null},values:{show:"hover",font:{size:12,weight:400,color:"#757575"},padding:7,format:","},xAxis:{placement:"top",domain:{minValue:0,maxValue:null},labels:{show:!0,font:{size:12,weight:400,color:"#757575"},format:",",padding:4},tickValuesMultiplier:[1,2,5,10],gridlines:{show:!0,stroke:{width:1,color:"#e6e6e6"}},title:{font:{size:12,weight:400,color:"#757575"},position:"center",padding:4},padding:{left:10,right:0}},legend:{show:null,placement:"top",position:"left",font:{size:12,weight:400,color:"#757575"},padding:{top:0,right:0,bottom:10,left:0}}}),this._d={data:null,categories:null,colors:null,series:null,values:null,maxValue:null},this._c={legendNode:null,legend:null,showLegend:!0,seriesKeys:null,minValue:null,maxValue:null,xAxisDomain:null,xAxisLeft:null,xAxisRight:null,xAxisWidth:null,xAxisTitle:null,xScale:null,xTickValues:null,xAxisTickLabelWidth:null,categoryY:0,categoryOffsets:null,categoryHeights:null,yScale:this._yScale.bind(this),categoryLabelsWidth:null,effectiveCategoryLabelsWidth:null}}categories(t){return this._categories=t,this}series(t){return this._series=t,this}colors(t){return this._colors=t,this}values(t){return this._values=t,this}xAxisTitle(t){return this._xAxis.title=t,this}xAxisTickValues(t){return this._xAxis.tickValues=null===t?"auto":t,this}init(t,e){super.init(t,e),t.classList.add("dv_dotChart"),Wt(t).append("g").attr("class","dv_categoryLabels"),Wt(t).append("g").attr("class","dv_categoryGridlines"),Wt(t).append("g").attr("class","dv_xAxisGridlines"),Wt(t).append("g").attr("class","dv_xAxisLabels"),Wt(t).append("g").attr("class","dv_xAxisTitle"),Wt(t).append("g").attr("class","dv_rangeLines"),Wt(t).append("g").attr("class","dv_valueDots"),Wt(t).append("g").attr("class","dv_valueLabels"),Wt(t).append("g").attr("class","dv_interaction"),this._c.legendNode=Wt(t).append("g").attr("class","dv_legend").node(),this._c.legend=(new Na).on("select",this._selectLegendItem.bind(this),null).on("deselect",this._deselectLegendItem.bind(this),null).style({box:{shape:"circle",width:this._style.dots.size,height:this._style.dots.size,padding:{bottom:6}},padding:this._style.legend.padding,align:this._style.legend.position,font:this._style.legend.font}),this._c.legend.init(this._c.legendNode,e)}prerender(t,e){if(super.prerender(t,e),!this.datasource.loaded)return void console.info("Rendering of chart postponed. Datasource not yet ready.");this.emit("prerenderWillStart",[t,e,this]),this._prepareData(t,e),this._prerenderCategories(t,e),this._prerenderXAxis(t,e),this._computeTickValues(),this._prerenderLegend(t,e),this._computeXScale();const i=this._computeChartHeight(t);this.viewRect.setHeight(i),this.emit("prerenderDidEnd",[t,e,this])}_prepareData(t,e){this._d.data=this.transformedData(e),this._d.values=this._values({data:this._d.data},e,this),this._d.categories=this._(this._categories,{values:this._d.values,data:this._d.data},e,this),this._d.series=this._(this._series,{values:this._d.values,data:this._d.data,categories:this._d.categories},e,this),this._c.seriesKeys=this._d.series.map((t=>t.key)),this._d.values.forEach((t=>{const e=this._c.seriesKeys.map((e=>t[e]));t._minValue=Math.min(...e),t._maxValue=Math.max(...e)})),this._d.colors=this._colors?this._(this._colors,{values:this._d.values,data:this._d.data,categories:this._d.categories,series:this._d.series},e,this):Qa[this._d.series.length],this._c.minValue=Math.min(...this._d.values.map((t=>t._minValue))),this._c.maxValue=Math.max(...this._d.values.map((t=>t._maxValue))),this._c.xAxisTitle=this._(this._xAxis.title,{data:this._d.data,categories:this._d.categories,series:this._d.series,values:this._d.values},e,this)||""}_prerenderXAxis(t,e){this._c.xAxisDomain={minValue:this._(this._style.xAxis.domain.minValue,{...this._d,minValue:this._c.minValue,maxValue:this._c.maxValue},e,this)||0,maxValue:this._(this._style.xAxis.domain.maxValue,{...this._d,minValue:this._c.minValue,maxValue:this._c.maxValue},e,this)||this._c.maxValue,adjustedMaxValue:null};const i=("string"==typeof this._style.xAxis.labels.format?tn(this._style.xAxis.labels.format):this._style.xAxis.labels.format)(this._c.xAxisDomain.maxValue);Wt(t).select("g.dv_xAxisLabels").node().innerHTML="",Wt(t).select("g.dv_xAxisLabels").append("text").style("font-size",`${this._style.xAxis.labels.font.size}px`).style("font-weight",this._style.xAxis.labels.font.weight).text(i),this._c.xAxisTickLabelWidth=t.querySelector(".dv_xAxisLabels text").getBBox().width;const s=Math.max(this._style.xAxis.padding.right,this._style.dots.size/2+this._style.dots.stroke.width,this._c.xAxisTickLabelWidth/2);this._c.xAxisLeft=this.viewRect.left+this._style.box.padding.left+this._c.effectiveCategoryLabelsWidth+this._style.categories.labels.padding+this._style.xAxis.padding.left,this._c.xAxisRight=this.viewRect.right-s-this._style.box.padding.right,this._c.xAxisWidth=this._c.xAxisRight-this._c.xAxisLeft}_computeTickValues(){const t=this._(this._xAxis.tickValues,{xAxisWidth:this._c.xAxisWidth,xAxisDomain:this._c.xAxisDomain,minValue:this._c.minValue,maxValue:this._c.maxValue,data:this._d.data,values:this._d.values},this._state,this);if(this._c.xAxisDomain.adjustedMaxValue=null,Array.isArray(t)&&t.length>0){this._c.xTickValues=t;const e=t[t.length-1];return void(e>this._c.xAxisDomain.maxValue&&(this._c.xAxisDomain.adjustedMaxValue=e))}const e=function(t,e,i=12,s=10){let n=s;const r=e+i,a=Math.floor(t/r)-2;return n=Math.min(n,a),n=Math.max(2,n),n}(this._c.xAxisWidth,this._c.xAxisTickLabelWidth,12,10),i=$a(this._c.xAxisDomain.minValue,this._c.xAxisDomain.maxValue,e,this._style.xAxis.tickValuesMultiplier),s=Math.floor(this._c.xAxisDomain.minValue/i.step)*i.step;let n=Math.ceil(this._c.xAxisDomain.maxValue/i.step)*i.step;n-this._c.xAxisDomain.maxValue>i.step/2?n-=i.step:this._c.xAxisDomain.adjustedMaxValue=n;const r=[];for(let t=s;t<=n;t+=i.step)r.push(t);this._c.xTickValues=r}_prerenderCategories(t,e){const i=this.viewRect.width();this._d.categoryLabelsWidth=this._(this._style.categories.labels.width,{...this._d,chartWidth:i},e,this),null===this._d.categoryLabelsWidth?this._c.categoryLabelsWidth=.3*i:this._d.categoryLabelsWidth<=1?this._c.categoryLabelsWidth=this._d.categoryLabelsWidth*i:this._c.categoryLabelsWidth=this._d.categoryLabelsWidth;const s=this._style.categories.labels,n=new Se({fontSize:s.font.size,fontColor:s.font.color,fontWeight:s.font.weight,lineHeight:`${s.lineHeight}px`,textAlign:s.align});Wt(t).select(".dv_categoryLabels").selectAll("g.dv_categoryLabel").data(this._d.categories).join("g").attr("class","dv_categoryLabel").call((t=>{const e=t.nodes(),i=t.data();let s=0;this._c.categoryHeights=[],this._c.categoryOffsets=[];for(let t=0;t<e.length;t++){const r=e[t],a=i[t];r.innerHTML="";const l="string"==typeof a?a:a.label||a.text||"";n.render(l,r,{},{},{width:this._c.categoryLabelsWidth}),r.setAttribute("transform",`translate(0 ${s})`);const o=r.getBBox();this._c.categoryOffsets.push(s),this._c.categoryHeights.push(o.height),s+=o.height+this._style.categories.spacing.between}})),this._c.effectiveCategoryLabelsWidth=Wt(t).select(".dv_categoryLabels").node().getBBox().width}_prerenderLegend(t,e){this._c.legend.categories(this._d.series.map((t=>t.label))).colors(this._d.colors),this._c.showLegend=this._(this._style.legend.show,this._d,e,this),null===this._c.showLegend&&(this._c.showLegend=this._d.series.length>1),this._c.showLegend?(this._c.legend.maxViewRect=new ne(this.viewRect.left,this.viewRect.top+(this._style.legend.padding.top||0),this.viewRect.width(),null),this._c.legend.prerender(this._c.legendNode,e)):this._c.legendNode.querySelector("g.dv_legendWrapper").innerHTML=""}_computeXScale(){const t=null===this._c.xAxisDomain.adjustedMaxValue?this._c.xAxisDomain.maxValue:this._c.xAxisDomain.adjustedMaxValue;this._c.xScale=on([this._c.xAxisDomain.minValue,t],[this._c.xAxisLeft,this._c.xAxisRight])}_yScale(t){return this._c.categoryY+this._c.categoryOffsets[t]+.5*this._c.categoryHeights[t]}_computeChartHeight(t){let e=this._c.showLegend?this._c.legendNode.getBBox().height+this._style.legend.padding.bottom:0;return null!==this._xAxis.title&&(e+=this._style.xAxis.title.font.size+this._style.xAxis.title.padding),e+=this._style.xAxis.labels.font.size+this._style.xAxis.labels.padding,e+=this._style.categories.spacing.top,this._c.categoryY=this.viewRect.top+e,e+=t.querySelector(".dv_categoryLabels").getBBox().height+this._style.categories.spacing.bottom,e}render(t,e){this.datasource.loaded&&(this.emit("renderWillStart",[t,e,this]),super.render(t,e),this._c.showLegend&&this._c.legend.render(this._c.legendNode,e),this._renderCategories(t,e),this._renderXAxis(t,e),this._renderRangeLines(t,e),this._renderDots(t,e),this._renderValueLabels(t,e),this._renderInteractionLayer(t,e))}_renderCategories(t,e){if(!this._style.categories.gridlines.show)return;const i=t.querySelector(".dv_categoryLabels"),s=i.getBBox(),n=-1*s.x+this.viewRect.left+this._style.box.padding.left,r=-1*s.y+this._c.categoryY;i.setAttribute("transform",`translate(${n} ${r})`),Wt(t).select(".dv_categoryGridlines").selectAll("line").data(this._d.categories).join("line").attr("x1",this.viewRect.left+this._style.box.padding.left+this._c.effectiveCategoryLabelsWidth+this._style.categories.labels.padding).attr("x2",this.viewRect.right-this._style.box.padding.right).attr("y1",((t,e)=>this._c.yScale(e))).attr("y2",((t,e)=>this._c.yScale(e))).style("stroke-width",`${this._style.categories.gridlines.stroke.width}px`).style("stroke",this._style.categories.gridlines.stroke.color)}_renderXAxis(t,e){this._renderXAxisTitle(t,e),this._renderXAxisLabels(t,e)}_renderXAxisTitle(t,e){if(null===this._xAxis.title||0===this._c.xAxisTitle.length)return;const i=this._style.xAxis.title,s="center"===i.position?"middle":"left"===i.position?"start":"end";Wt(t).select(".dv_xAxisTitle").selectAll("text").data([this._c.xAxisTitle]).join("text").attr("x","center"===i.position?this._c.xAxisLeft+this._c.xAxisWidth/2:"left"===i.position?this._c.xAxisLeft-this._style.xAxis.padding.left:this.viewRect.right-this._style.box.padding.right).attr("y",this._c.categoryY-this._style.categories.spacing.top-this._style.xAxis.labels.padding-this._style.xAxis.labels.font.size-this._style.xAxis.title.padding).style("font-size",`${i.font.size}px`).style("font-weight",i.font.weight).style("fill",i.font.color).style("text-anchor",s).text((t=>t))}_renderXAxisLabels(t,e){const i="string"==typeof this._style.xAxis.labels.format?tn(this._style.xAxis.labels.format):this._style.xAxis.labels.format;Wt(t).select(".dv_xAxisLabels").selectAll("text").data(this._c.xTickValues).join("text").attr("x",(t=>this._c.xScale(t))).attr("y",this._c.categoryY-this._style.categories.spacing.top-this._style.xAxis.labels.padding).style("text-anchor","middle").style("font-size",`${this._style.xAxis.labels.font.size}px`).style("font-weight",this._style.xAxis.labels.font.weight).style("fill",this._style.xAxis.labels.font.color).text((t=>i(t)));const s=this._c.categoryOffsets.length,n=this._c.categoryOffsets[s-1],r=this._c.categoryHeights[s-1];Wt(t).select(".dv_xAxisGridlines").selectAll("line").data(this._style.xAxis.gridlines.show?this._c.xTickValues:[]).join("line").attr("x1",(t=>this._c.xScale(t))).attr("x2",(t=>this._c.xScale(t))).attr("y1",this._c.categoryY-this._style.categories.spacing.top).attr("y2",this._c.categoryY+n+r+this._style.categories.spacing.bottom).style("stroke-width",`${this._style.xAxis.gridlines.stroke.width}px`).style("stroke",this._style.xAxis.gridlines.stroke.color)}_renderRangeLines(t,e){this._style.rangeLine.show&&Wt(t).select(".dv_rangeLines").selectAll("line").data(this._d.values).join("line").style("stroke-width",`${this._style.rangeLine.stroke.width}px`).style("stroke",`${this._style.rangeLine.stroke.color}`).style("fill","none").each(((t,i,s)=>{const n=s[i],r=this._(this._style.rangeLine.minValue,{category:this._d.categories[i],value:t,idx:i,data:this._d.values},e,this),a=this._(this._style.rangeLine.maxValue,{category:this._d.categories[i],value:t,idx:i,data:this._d.values},e,this);n.setAttribute("x1",this._c.xScale("number"==typeof r?r:t._minValue)),n.setAttribute("x2",this._c.xScale("number"==typeof a?a:t._maxValue));const l=this._c.yScale(i);n.setAttribute("y1",l),n.setAttribute("y2",l)}))}_renderDots(t,e){Wt(t).select(".dv_valueDots").selectAll("g").data(this._d.series).join("g").attr("data-series",(t=>t.key)).selectAll("circle").data(((t,e)=>this._d.values.map((i=>({value:i[t.key],categoryValues:i,series:t,seriesIdx:e,color:this._d.colors[e]}))))).join("circle").attr("cx",(t=>this._c.xScale(t.value))).attr("cy",((t,e)=>this._c.yScale(e))).attr("r",this._style.dots.size/2).style("fill",(t=>t.color)).call((t=>{this._style.dots.stroke.width>0&&null!==this._style.dots.stroke.color?t.style("stroke",this._style.dots.stroke.color).style("stroke-width",`${this._style.dots.stroke.width}px`):t.style("stroke","none")})).style("stroke")}_renderValueLabels(t,e){Wt(t).select(".dv_valueLabels").selectAll("g").data(this._d.series).join("g").attr("data-series",(t=>t.key)).style("fill-opacity",0).selectAll("text").data(((t,e)=>this._d.values.map((i=>({value:i[t.key],categoryValues:i,series:t,seriesIdx:e,color:this._d.colors[e]}))))).join("text").attr("x",(t=>this._c.xScale(t.value)+this._style.values.padding)).attr("y",((t,e)=>this._c.yScale(e)+this._style.values.font.size/2-1)).style("fill",this._style.values.font.color).style("font-size",`${this._style.values.font.size}px`).style("font-weight",this._style.values.font.weight).style("text-anchor","start").text((t=>("string"==typeof this._style.values.format?tn(this._style.values.format):this._style.values.format)(t.value,{data:t},e,this))).each(((t,e,i)=>{const s=i[e],n=s.getBBox();n.x+n.width>this.viewRect.right-this._style.box.padding.right&&(s.setAttribute("x",this._c.xScale(t.value)-this._style.values.padding),s.style.textAnchor="end")}))}_renderInteractionLayer(t,e){Wt(t).select(".dv_interaction").selectAll("g").data(this._d.series).join("g").attr("data-series",(t=>t.key)).selectAll("circle").data(((t,e)=>this._d.values.map((i=>({value:i[t.key],categoryValues:i,series:t,seriesIdx:e,color:this._d.colors[e]}))))).join("circle").attr("cx",(t=>this._c.xScale(t.value))).attr("cy",((t,e)=>this._c.yScale(e))).attr("r",this._style.dots.size/2+2).style("fill","#fff0").on("mouseover",this._select.bind(this)).on("mouseleave",this._deselect.bind(this))}_select(t,e){const i=e.series.key;Wt(this._node).selectAll(".dv_valueDots > g").each(((t,e,s)=>{t.key!==i&&(s[e].style.fillOpacity=.15,s[e].style.strokeOpacity=.15)})),Wt(this._node).select(".dv_rangeLines").style("stroke-opacity",.5),this._style.values.show&&Wt(this._node).select(`.dv_valueLabels > g[data-series="${e.series.key}"]`).style("fill-opacity",1),Wt(this._node).selectAll(".dv_legendWrapper > g").each(((t,e,s)=>{this._c.seriesKeys[e]!==i&&(s[e].style.opacity=.3)}))}_deselect(t,e){Wt(this._node).selectAll(".dv_valueDots > g").style("fill-opacity",1).style("stroke-opacity",1),Wt(this._node).select(".dv_rangeLines").style("stroke-opacity",1),Wt(this._node).selectAll(".dv_valueLabels > g").style("fill-opacity",0),Wt(this._node).selectAll(".dv_legendWrapper > g").style("opacity",1)}_selectLegendItem(t,e,i){const s=this._c.seriesKeys[e.idx];this._select(t,{series:{key:s}})}_deselectLegendItem(t,e,i){this._deselect(t,{})}}const yo=new Te({class:"LineColumnChart",dataSource:void 0,transformer:void 0,height:300,categories:null,line:{title:"Line",values:null,stroke:"#ff0000",strokeWidth:2},dataPoints:{show:"hover",stroke:{selected:"#990000",default:"#ff0000"},strokeWidth:2},columns:{title:"Column",values:null,fill:{selected:"#cccccc",default:"#d5d5d5"}},chartArea:{xAxis:{title:null,formatValue:t=>t},yAxis:{title:null,formatValue:t=>t}},legend:{show:!0,position:"top",padding:{bottom:7}},tooltip:{show:!0,maxWidth:300,font:{size:12},text:(t,e,i)=>'\n        <text tabStops="20">\n          <p><b>{{category}}</b></p>\n          <p><rect fill="{{columnColor}}" w="12" h="10" /><tab />{{columnTitle}}:<tab />{{column}}</p>\n          <p><rect fill="{{lineColor}}" w="12" h="2" baseLineShift="5" /><tab />{{lineTitle}}:<tab />{{line}}</p>\n        </text>\n      ',formatValue:{category:t=>t,column:t=>t,line:t=>t}},events:{init:null,prerenderWillStart:null,prerenderDidEnd:null,renderWillStart:null,renderDidEnd:null}});class mo extends Ea{constructor(t={},e){void 0!==e||Object.prototype.hasOwnProperty.call(t,"class")||(e=t,t={}),e.hasChartArea=!0,super(yo.extend(t),e),this.style({dataRect:{padding:{left:20,right:20}},grid:{horizontal:{show:!0,color:"#ccc",width:1,customize:(t,e,i)=>{}},vertical:{show:!1,customize:(t,e,i)=>{}}}}),this.xAxis({type:"band",placement:"bottom"}),this.yAxis({type:"linear",placement:"left"}),this._legend=null}categories(t){return this.props.categories=t,this}columnValues(t){return this.props.columns.values=t,this}lineValues(t){return this.props.line.values=t,this}height(t){return this.props.height=t,this}init(t,e){super.init(t,e),t.classList.add("dv_lineColumnChart");const i=Wt(t);i.insert("g",":first-child").attr("class","dv_columns"),i.append("g").attr("class","dv_line"),i.append("g").attr("class","dv_dataPoints"),i.append("g").attr("class","dv_interaction dv_noprint"),this.props.legend.show&&(this._legendNode=Wt(t).append("g").attr("class","dv_legend").node(),this.legend=(new Na).style({align:this.props.legend.position,box:{width:8,height:8,padding:{bottom:6}}}),this.legend.init(this._legendNode,e)),this.props.tooltip.show&&(this.props.tooltip._obj=new Za,this.props.tooltip._obj.anchorPosition(["centerleft","centerright"]).on("init",this._initTooltip.bind(this)).on("prerender",this._prerenderTooltip.bind(this)).on("render",this._renderTooltip.bind(this))),this.chartArea.xGrid(this._style.grid.vertical),this.chartArea.yGrid(this._style.grid.horizontal),this.chartArea._xAxis.style.values.allowLabelShortening=!1}prerender(t,e){if(super.prerender(t,e),!this.datasource.loaded)return void console.info("Rendering of chart postponed. Datasource not yet ready.");this.emit("prerenderWillStart",[t,e,this]),this._data=this.transformedData(e),this._cats="function"==typeof this.props.categories?this.props.categories(this._data,e,this):this._data.map((t=>t[this.props.categories])),this.props.columns._vals="function"==typeof this.props.columns.values?this.props.columns.values(this._data,e,this):this._data.map((t=>t[this.props.columns.values])),this.props.line._vals="function"==typeof this.props.line.values?this.props.line.values(this._data,e,this):this._data.map((t=>t[this.props.line.values])),this.props.legend.show&&(this.legend.categories([this.get("columns.title","",[null,this._state,this]),this.get("line.title","",[null,this._state,this])]),this.legend.colors([this.get("columns.fill","",[null,this._state,this],"default"),this.get("line.stroke","",[null,this._state,this],"default")]),this.legend.shapes(["rect","line"]),this.legend.maxViewRect=new ne(this.viewRect.left,this.viewRect.top,this.viewRect.width(),null),this.legend.prerender(this._legendNode,e),this.style({chartArea:{margin:{top:this.legend.viewRect.height()+this.props.legend.padding.bottom}}})),this.chartArea._xAxisLabel=this.get("chartArea.xAxis.title",null,[e,this]),this.chartArea._yAxisLabel=this.get("chartArea.yAxis.title",null,[e,this]),this.chartArea.style.xAxis.format=this.props.chartArea.xAxis.formatValue,this.chartArea.style.yAxis.format=this.props.chartArea.yAxis.formatValue,this.viewRect.setHeight(this.get("height",300,[{categories:this._cats,columnValues:this.props.columns._vals,lineValues:this.props.line._vals},e,this]));const i=this.props.line._vals.reduce(((t,e)=>Math.max(t,e))),s=this.props.columns._vals.reduce(((t,e)=>Math.max(t,e)));this.chartArea.yDomain([0,Math.max(i,s)]),this.chartArea.xDomain(this._cats),this.emit("prerenderDidEnd",[t,e,this])}render(t,e){this.datasource.loaded&&(this.emit("renderWillStart",[t,e,this]),super.render(t,e),this._renderColumns(t,e),this._renderLine(t,e),this._renderDataPoints(t,e),this._renderInteractionLayer(t,e))}_renderColumns(t,e){Wt(t).select(".dv_columns").selectAll("rect").data(this.props.columns._vals).join("rect").attr("x",((t,e)=>this.chartArea.xScale(this._cats[e]))).attr("width",this.chartArea.xScale.bandwidth()).attr("y",(t=>this.chartArea.yScale(t))).attr("height",(t=>this.chartArea.yScale(0)-this.chartArea.yScale(t))).style("fill",((t,i)=>this.get("columns.fill","#ccc",[{value:t,data:this.props.columns._vals},e,this],this._selection&&this._selection.idx===i?"selected":"default")))}_renderLine(t,e){const i=$l().x(((t,e)=>this.chartArea.xScale(this._cats[e])+.5*this.chartArea.xScale.bandwidth())).y((t=>this.chartArea.yScale(t)));Wt(t).select(".dv_line").selectAll("path").data([this.props.line._vals]).join("path").attr("d",(t=>i(t))).style("fill","none").style("stroke",(t=>this.get("line.stroke","#f00",[t,e,this]))).style("stroke-width",(t=>this.get("line.strokeWidth",1,[t,e,this])))}_renderDataPoints(t,e){Wt(t).select(".dv_dataPoints").selectAll("circle").data(this.props.line._vals).join("circle").attr("cx",((t,e)=>this.chartArea.xScale(this._cats[e])+.5*this.chartArea.xScale.bandwidth())).attr("cy",(t=>this.chartArea.yScale(t))).attr("r",4).classed("dv_selected",((t,e)=>this._selection&&this._selection.idx===e)).classed("dv_hidden",((t,e)=>{switch(this.get("dataPoints.show","hover")){case"never":return!0;case"hover":return!this._selection;case"hover:single":return!(this._selection&&this._selection.idx===e);default:return!1}})).style("fill","#fff").style("stroke",((t,i)=>this.get("dataPoints.stroke","#f00",[t,e,this],this._selection&&this._selection.idx===i?"selected":"default"))).style("stroke-width",(t=>this.get("dataPoints.strokeWidth",1,[t,e,this]))).style("display",(t=>null===t?"none":""))}_renderInteractionLayer(t,e){Wt(t).select(".dv_interaction").selectAll("rect").data(this.props.columns._vals.map(((t,e)=>({category:this._cats[e],column:t,line:this.props.line._vals[e],idx:e})))).join("rect").attr("x",((t,e)=>this.chartArea.xScale(this._cats[e]))).attr("width",this.chartArea.xScale.step()).attr("y",(t=>this.chartArea.yScale(Math.max(t.column,t.line)))).attr("height",(t=>this.chartArea.yScale(0)-this.chartArea.yScale(Math.max(t.column,t.line)))).style("fill-opacity",0).style("cursor","pointer").on("mouseover",this._select.bind(this)).on("mouseleave",this._deselect.bind(this)).on("click",((t,e)=>{t.target.classList.contains("dv_selected")?this._deselect(t):this._select(t)})).call(this.props.tooltip._obj.bindTooltip(this,e))}_initTooltip(t,e,i,s){Wt(t).append("text")}_prerenderTooltip(t,e,i,s){const n=new Se({width:this.get("tooltip.maxWidth",300,[e,this._state,this]),fontSize:this.get("tooltip.font.size",12,[e,this._state,this])}),r={category:this.get("tooltip.formatValue.category",null,[e.value.category,this._state,this]),column:this.get("tooltip.formatValue.column",null,[e.value.column,this._state,this]),line:this.get("tooltip.formatValue.line",null,[e.value.line,this._state,this])};n.render(this.get("tooltip.text","",[e,this._state,this]),t,ie(r,{columnTitle:this.get("columns.title","",[e,this._state,this]),columnColor:this.get("columns.fill","#ccc",[e,this._state,this],"default"),lineTitle:this.get("line.title","",[e,this._state,this]),lineColor:this.get("line.stroke","#f00",[e,this._state,this])}));const a=t.getBoundingClientRect();i.viewRect.setHeight(a.height),i.viewRect.setWidth(a.width),t.setAttribute("transform",`translate(${i.viewRect.left} ${i.viewRect.top})`)}_renderTooltip(t,e,i,s){}_select(t,e){this._selection=e,this._renderColumns(this._node,this._state),this._renderDataPoints(this._node,this._state)}_deselect(t,e){this._selection=null,this._renderColumns(this._node,this._state),this._renderDataPoints(this._node,this._state)}}class xo extends Ea{constructor(t={}){t.hasChartArea=!0,super(t),this.xAxis({type:"linear"}),this.yAxis({type:"linear"}),this._x=null,this._y=null,this._markShape="circle",this._markSize=5,this._markColor={default:"#728CD7",selected:"#728CD7",faded:"#c6d1ef"},this._markLabel=null,this._xAxisLabel=null,this._xAxisFormat=t=>t,this._xValueRange=null,this._yAxisLabel=null,this._yAxisFormat=t=>t,this._yValueRange=null,this._height=400,this._tooltipText=null,this._links=null,this._linkColor="#ccc",this._linkWidth=2,this._d={data:null,x:null,y:null,markShape:null,markSize:null,markColor:null,markLabel:null,xValueRange:null,yValueRange:null,links:null,linkColor:null,linkWidth:null},this._c={height:null,xMin:null,xMax:null,yMin:null,yMax:null,drawOrder:null,markLabels:{candidatePositions:null}},this.tooltip=null,this.style({dataRect:{padding:{top:0,bottom:0}},grid:{vertical:{show:!0,color:"#ccc",width:1},horizontal:{show:!0,color:"#ccc",width:1}},tooltip:{maxWidth:300,font:{size:12}},marks:{labels:{display:!1,font:{size:11,color:"#000",weight:200},offset:3}}})}height(t){return this._height=t,this}x(t){return this._x=t,this}y(t){return this._y=t,this}markShape(t){return this._markShape=t,this}markSize(t){return this._markSize=t,this}markColor(t){return this._markColor=t,this}markLabel(t){return this._markLabel=t,this}tooltipText(t){return this._tooltipText=t,this}xAxisLabel(t){return this._xAxisLabel=t,this}xAxisFormat(t){return this._xAxisFormat=t,this}xValueRange(t){return this._xValueRange=t,this}yAxisLabel(t){return this._yAxisLabel=t,this}yAxisFormat(t){return this._yAxisFormat=t,this}yValueRange(t){return this._yValueRange=t,this}links(t){return this._links=t,this}linkColor(t){return this._linkColor=t,this}linkWidth(t){return this._linkWidth=t,this}init(t,e){super.init(t,e),t.classList.add("dv_scatterPlot");const i=Wt(t).append("g").attr("class","dv_chartWrapper").node();Wt(i).append("g").attr("class","dv_links"),Wt(i).append("g").attr("class","dv_markLabels"),Wt(i).append("g").attr("class","dv_dots"),Wt(i).append("g").attr("class","dv_interaction"),this.chartArea.xGrid(this._style.grid.vertical||{}),this.chartArea.yGrid(this._style.grid.horizontal||{}),this.chartArea._xAxisLabel=this._(this._xAxisLabel,e,this),this.chartArea.style.xAxis.format=this._xAxisFormat,this.chartArea._yAxisLabel=this._(this._yAxisLabel,e,this),this.chartArea.style.yAxis.format=this._yAxisFormat,this.chartArea.style.dataRect.padding.top=this._style.dataRect.padding.top,this.chartArea.style.dataRect.padding.bottom=this._style.dataRect.padding.bottom,this.tooltip=new Za,this.tooltip.on("init",this._initTooltip.bind(this)).on("prerender",this._prerenderTooltip.bind(this)).on("render",this._renderTooltip.bind(this))}prerender(t,e){super.prerender(t,e),this.datasource.loaded?(this.emit("prerenderWillStart",[t,e,this]),this._state=e,this.extractData(),this.sortData(),this._c.height=this._(this._height,{...this._d,width:this.viewRect.width()},e,this),this.viewRect.setHeight(this._c.height),this.chartArea.xDomain(this._d.xValueRange),this.chartArea.yDomain(this._d.yValueRange),this._prerenderMarkLabels(t,e),this.emit("prerenderDidEnd",[t,e,this])):console.info("Rendering of chart postponed. Datasource not yet ready.")}_prerenderMarkLabels(t,e){!1!==this._style.marks.labels.show&&null!==this._markLabel&&Wt(t).select(".dv_markLabels").selectAll("g").data(this._c.drawOrder).join("g").attr("class","dv_noTextSelect").attr("data-idx",((t,e)=>e)).selectAll("text").data((t=>Array.isArray(this._c.dotData[t])?[this._c.dotData[t][this._c.dotData[t].length-1]]:[this._c.dotData[t]])).join("text").attr("data-idx",(t=>t.idx)).style("font-size",(t=>`${this._(this._style.marks.labels.font.size,t,this._state,this)}px`)).style("font-weight",(t=>this._(this._style.marks.labels.font.weight,t,this._state,this))).style("fill",(t=>this._(this._style.marks.labels.font.color,t,this._state,this))).text((t=>t.label||"")).on("mouseenter",((t,e)=>{this.tooltip.show.bind(this.tooltip)(t,e),this._handleSelect(t,e)})).on("mousemove",((t,e)=>{this.tooltip.move.bind(this.tooltip)(t,e)})).on("mouseout",((t,e)=>{this.tooltip.hide.bind(this.tooltip)(t,e),this._handleUnselect(t,e)}))}render(t,e){this.datasource.loaded&&(this.emit("renderWillStart",[t,e,this]),super.render(t,e),this._renderDots(t,e),this._renderInteractionDots(t,e),this._renderMarkLabels(t,e),this._renderLinks(t,e),this._renderInteractionLinks(t,e))}_renderDots(t,e){Wt(t).select(".dv_dots").selectAll("g").data(this._c.drawOrder).join("g").attr("data-idx",((t,e)=>e)).selectAll("circle").data((t=>this._c.dotData[t])).join("circle").attr("cx",(t=>this.chartArea.xScale(t.x))).attr("cy",(t=>this.chartArea.yScale(t.y))).attr("r",(t=>t.size)).style("fill",(t=>"string"==typeof t.color?t.color:t.color.default)).style("stroke","#fff").style("stroke-width","1px")}_renderInteractionDots(t,e){Wt(t).select(".dv_interaction").selectAll("g").data(this._c.drawOrder).join("g").attr("data-idx",((t,e)=>e)).selectAll("circle").data((t=>this._c.dotData[t])).join("circle").attr("cx",(t=>this.chartArea.xScale(t.x))).attr("cy",(t=>this.chartArea.yScale(t.y))).attr("r",(t=>t.size)).style("fill","#fff0").style("stroke","#fff0").style("stroke-width","4px").on("mouseenter",((t,e)=>{this.tooltip.show.bind(this.tooltip)(t,e),this._handleSelect(t,e)})).on("mousemove",((t,e)=>{this.tooltip.move.bind(this.tooltip)(t,e)})).on("mouseout",((t,e)=>{this.tooltip.hide.bind(this.tooltip)(t,e),this._handleUnselect(t,e)}))}_renderInteractionLinks(t,e){null!==this._d.links&&Wt(t).select(".dv_interaction").selectAll("g").selectAll("path").data((t=>[this._c.dotData[t]])).join("path").attr("d",(t=>this._linkLine(t))).style("fill","none").style("stroke-width",((t,e)=>`${Math.max(3,3*(this._d.linkWidth.default||this._d.linkWidth))}px`)).style("stroke","#fff0").on("mouseenter",((t,e)=>{const i=Array.isArray(e)?e[e.length-1]:e;this._handleSelect(t,i)})).on("mouseout",((t,e)=>{const i=Array.isArray(e)?e[e.length-1]:e;this._handleUnselect(t,i)}))}_renderMarkLabels(t,e){if(!1===this._style.marks.labels.show||null===this._markLabel)return;const i=this._c.dotData.flat().map((t=>({x:this.chartArea.xScale(t.x),y:this.chartArea.yScale(t.y),r:t.size})));this._c.markLabels.candidatePositions=this._d.data.map(this._labelCandidatePosition.bind(this)),Wt(t).select(".dv_markLabels").selectAll("g").selectAll("text").call((t=>{const e=[];t.each(((t,s,n)=>{if(!1===t.showLabel)return void(n[s].style.display="none");n[s].style.display="";const{pos:r,score:a}=this._labelScorePositions(t,s,n,i,e);if(null===r||a<0)n[s].style.display="none";else{n[s].style.display="",n[s].setAttribute("x",r.x),n[s].setAttribute("y",r.y),n[s].setAttribute("text-anchor",r.anchor),n[s].setAttribute("dominant-baseline",r.baseline);const t=n[s].getBBox();e.push({left:t.x,right:t.x+t.width,top:t.y,bottom:t.y+t.height})}}))}))}_labelCandidatePosition(t,e){const i=(Array.isArray(this._d.markSize[e])?this._d.markSize[e][this._d.markSize[e].length-1]:this._d.markSize[e])+this._style.marks.labels.offset,s=this.chartArea.xScale("number"==typeof this._d.x[e]?this._d.x[e]:this._d.x[e][this._d.x[e].length-1]),n=this.chartArea.yScale("number"==typeof this._d.y[e]?this._d.y[e]:this._d.y[e][this._d.x[e].length-1]),r=Math.SQRT1_2*i;return[{lbl:"right",x:s+i,y:n,anchor:"start",baseline:"middle",score:120},{lbl:"left",x:s-i,y:n,anchor:"end",baseline:"middle",score:100},{lbl:"top",x:s,y:n-i,anchor:"middle",baseline:"auto",score:100},{lbl:"bottom",x:s,y:n+i,anchor:"middle",baseline:"hanging",score:120},{lbl:"topright",x:s+r,y:n-r,anchor:"start",baseline:"auto",score:80},{lbl:"bottomright",x:s+r,y:n+r,anchor:"start",baseline:"hanging",score:80},{lbl:"topleft",x:s-r,y:n-r,anchor:"end",baseline:"auto",score:80},{lbl:"bottomleft",x:s-r,y:n+r,anchor:"end",baseline:"hanging",score:80}]}_labelScorePositions(t,e,i,s,n){const r=i[e].getBBox(),a=r.width,l=r.height;let o=null,h=-1/0;return this._c.markLabels.candidatePositions[t.idx].forEach((t=>{let e=t.score;const i={left:"start"===t.anchor?t.x:"end"===t.anchor?t.x-a:t.x-.5*a,top:"auto"===t.baseline?t.y-l:"hanging"===t.baseline?t.y:t.y-.5*l,right:"start"===t.anchor?t.x+a:"end"===t.anchor?t.x:t.x+.5*a,bottom:"auto"===t.baseline?t.y:"hanging"===t.baseline?t.y+l:t.y+.5*l};if(!1==(r=this.chartArea.dataRect,!((c=i).left<r.left||c.right>r.right||c.top<r.top||c.bottom>r.bottom)))return;var r,c;const d=s.map((t=>function(t,e){const i=(e.left-t.x)*(e.right-t.x)<=0?0:Math.min(Math.abs(e.left-t.x),Math.abs(e.right-t.x)),s=(e.top-t.y)*(e.bottom-t.y)<=0?0:Math.min(Math.abs(e.top-t.y),Math.abs(e.bottom-t.y));return Math.sqrt(i*i+s*s)}(t,i)-t.r)),u=Math.min(...d);e=u<=1?-1/0:e+u;const _=n.map((t=>function(t,e){const i=(t.left+t.right)/2,s=(e.left+e.right)/2,n=(t.bottom+t.top)/2,r=(e.bottom+e.top)/2,a=Math.abs(t.right-t.left),l=Math.abs(e.right-e.left),o=Math.abs(t.bottom-t.top),h=Math.abs(e.bottom-e.top);return Math.max(Math.abs(i-s)-(a+l)/2,Math.abs(n-r)-(o+h)/2)}(i,t))),p=Math.min(..._);e=p<=1?-1/0:e+p,e>h&&(o=t,h=e)})),{pos:o,score:h}}_renderLinks(t,e){null!==this._d.links&&(this._linkLine=$l().x((t=>this.chartArea.xScale(t.x))).y((t=>this.chartArea.yScale(t.y))),Wt(t).select(".dv_links").selectAll("path").data(this._c.dotData).join("path").attr("d",(t=>this._linkLine(t))).style("fill","none").style("stroke-width",((t,e)=>`${this._d.linkWidth.default||this._d.linkWidth}px`)).style("stroke",((t,e)=>this._d.linkColor.default||this._d.linkColor)))}extractData(){this._d.data=this.transformedData(this._state),this._links&&(this._d.links=this._links,this._d.linkColor=this._linkColor,this._d.linkWidth=this._linkWidth),this._d.x=this._getDataArray(this._x),this._d.y=this._getDataArray(this._y),this._d.markShape=this._getDataArray(this._markShape),this._d.markSize=this._getDataArray(this._markSize),this._d.markColor=this._getDataArray(this._markColor),this._d.markLabel=this._getDataArray(this._markLabel);const t=this._d.x.flat();this._c.minX=t.reduce(((t,e)=>Math.min(t,e))),this._c.maxX=t.reduce(((t,e)=>Math.max(t,e)));const e=this._d.y.flat();this._c.minY=e.reduce(((t,e)=>Math.min(t,e))),this._c.maxY=e.reduce(((t,e)=>Math.max(t,e))),this._d.xValueRange=this._(this._xValueRange,{data:this._d.data,minValue:this._c.minX,maxValue:this._c.maxX,values:this._d.x},this._state,this)||[null,null],this._d.yValueRange=this._(this._yValueRange,{data:this._d.data,minValue:this._c.minY,maxValue:this._c.maxY,values:this._d.y},this._state,this)||[null,null],this._d.xValueRange[0]=null===this._d.xValueRange[0]?this._c.minX:this._d.xValueRange[0],this._d.xValueRange[1]=null===this._d.xValueRange[1]?this._c.maxX:this._d.xValueRange[1],this._d.yValueRange[0]=null===this._d.yValueRange[0]?this._c.minY:this._d.yValueRange[0],this._d.yValueRange[1]=null===this._d.yValueRange[1]?this._c.maxY:this._d.yValueRange[1],this._c.dotData=this._d.data.map(((t,e)=>{const i=Array.isArray(t)?t:[t],s=[this._d.x[e]].flat(),n=[this._d.y[e]].flat();return i.map(((i,r)=>{const a=Array.isArray(this._d.markSize[e])?this._d.markSize[e][r]:this._d.markSize[e],l=Array.isArray(this._d.markShape[e])?this._d.markShape[e][r]:this._d.markShape[e],o=Array.isArray(this._d.markColor[e])?this._d.markColor[e][r]:this._d.markColor[e],h=Array.isArray(this._d.markLabel[e])?this._d.markLabel[e][this._d.markLabel[e].length-1]:this._d.markLabel[e];let c="string"==typeof h&&h.length>0;return Array.isArray(this._d.markLabel[e])&&this._d.markLabel[e].length-1<r&&(c=!1),{idx:e,data:i,itemData:t,valueIdx:r,x:s[r],y:n[r],xAll:this._d.x[e],yAll:this._d.y[e],size:a,shape:l,color:o,label:h,showLabel:c}}))}))}_getDataArray(t){return this._d.data.map((e=>null!==this._d.links&&Array.isArray(e)?e.map(((e,i)=>this._(t,{value:e,link:this._d.links[i],linkIdx:i,itemData:this._d.data,data:this._d.data[i]},this._state,this))):this._(t,{value:e,data:this._d.data},this._state,this)))}sortData(){this._c.drawOrder=this._d.data.map(((t,e)=>e)),this._c.drawOrder.sort(((t,e)=>this._d.markSize[e]-this._d.markSize[t]))}_getTooltipText(t,e){return"string"==typeof this._tooltipText?this._tooltipText:"function"==typeof this._tooltipText?this._tooltipText({...t.value},this._state,e,this):this.defaultTooltipText({...t.value},this._state,e)}defaultTooltipText(t,e,i){let s="";return t.label&&(s=`<b>${t.label}</b><br />`),s+`X: <b>${t.x}</b><br />Y: <b>${t.y}</b>`}_handleSelect(t){const e=Wt(t.target).data();if(!Array.isArray(e)||0===e.length)return;const i=Array.isArray(e[0])?e[0][e[0].length-1]:e[0];Wt(this._node).selectAll(".dv_dots g").each(((t,e,s)=>{const n=s[e];let r="default";t===i.idx?(n.classList.add("dv_selected"),n.classList.remove("dv_faded"),r="selected"):(n.classList.remove("dv_selected"),n.classList.add("dv_faded"),r="faded"),Wt(n).selectAll("*").style("fill",(t=>"string"==typeof t.color?t.color:t.color[r]||t.color.default||"#ccc"))})),null!==this._d.links&&Wt(this._node).select(".dv_links").selectAll("path").each(((t,e,s)=>{const n=e===i.idx?"selected":"faded",r="number"==typeof this._d.linkWidth?this._d.linkWidth:this._d.linkWidth[n],a="string"==typeof this._d.linkColor?this._d.linkColor:this._d.linkColor[n];s[e].style.strokeWidth=`${r}px`,s[e].style.stroke=a}))}_handleUnselect(t){const e=Wt(t.target).data();Array.isArray(e)&&0!==e.length&&(Wt(this._node).selectAll(".dv_dots g").each(((t,e,i)=>{const s=i[e];s.classList.remove("dv_selected"),s.classList.remove("dv_faded"),Wt(s).selectAll("*").style("fill",(t=>"string"==typeof t.color?t.color:t.color.default||"#ccc"))})),null!==this._d.links&&Wt(this._node).select(".dv_links").selectAll("path").each(((t,e,i)=>{const s="number"==typeof this._d.linkWidth?this._d.linkWidth:this._d.linkWidth.default,n="string"==typeof this._d.linkColor?this._d.linkColor:this._d.linkColor.default;i[e].style.strokeWidth=`${s}px`,i[e].style.stroke=n})))}_initTooltip(t,e,i,s){Wt(t).append("text")}_prerenderTooltip(t,e,i,s){new Se({width:this._style.tooltip.maxWidth,fontSize:this._style.tooltip.font.size}).render(this._getTooltipText(e,i),t,{d:e,state:this._state});const n=t.getBoundingClientRect();i.viewRect.setHeight(n.height+10),i.viewRect.setWidth(n.width+10),t.setAttribute("transform",`translate(${i.viewRect.left+5} ${i.viewRect.top+5})`)}_renderTooltip(t,e,i,s){}}class vo extends Ea{constructor(){super({hasChartArea:!1}),this._node=null,this._state=null,this._dimensions=null,this._dimensionLabels=null,this._values=null,this._labels=null,this._colors=null,this._size=400,this._d={data:null,dimensions:null,dimensionLabels:null,values:null,labels:null,colors:null},this._c={minValue:null,maxValue:null},this.scale=null,this.style({dimension:{label:{font:{size:12,color:"#999",weight:400},offset:4}},grid:{minValue:null,maxValue:null,line:{color:"#ccc",width:1},padding:{top:20,bottom:20}},value:{line:{width:2},dot:{size:8},label:{font:{size:12,color:"#000",weight:400},offset:8,baseLineShift:-2},format:t=>parseInt(t)===t?`${t}`:t.toFixed(1)},label:{font:{size:12,color:"#000",weight:700},offset:4,baseLineShift:-2}})}dimensions(t){return this._dimensions=t,this}dimensionLabels(t){return this._dimensionLabels=t,this}values(t){return this._values=t,this}labels(t){return this._labels=t,this}colors(t){return this._colors=t,this}size(t){return this._size=t,this}init(t,e){super.init(t,e),t.classList.add("dv_slopeChart"),Wt(t).append("g").attr("class","dv_dimensions"),Wt(t).append("g").attr("class","dv_dimensionLabels"),Wt(t).append("g").attr("class","dv_valueLines"),Wt(t).append("g").attr("class","dv_valueDots"),Wt(t).append("g").attr("class","dv_valueLabels"),Wt(t).append("g").attr("class","dv_lineLabels")}prerender(t,e){super.prerender(t,e),this.datasource.loaded?(this.emit("prerenderWillStart",[t,e,this]),this._node=t,this._state=e,this.extractData(),this._c.size=this._(this._size,{...this._d,width:this.viewRect.width()},e,this),this._c.minValue=null===this._style.grid.minValue?Ci(this._d.values.flat()):this._(this._style.grid.minValue,this._d,e,this),this._c.maxValue=null===this._style.grid.maxValue?Si(this._d.values.flat()):this._(this._style.grid.maxValue,this._d,e,this),this.viewRect.setHeight(this._c.size),this.defineScale(),this._prerenderDimensionLabels(t,e),this._prerenderValueLabels(t,e),this._prerenderLineLabels(t,e),this.emit("prerenderDidEnd",[t,e,this])):console.info("Rendering of chart postponed. Datasource not yet ready.")}_prerenderDimensionLabels(t,e){const i=new Se({fontSize:this._style.dimension.label.font.size,fontColor:this._style.dimension.label.font.color,fontWeight:this._style.dimension.label.font.weight});Wt(t).select(".dv_dimensionLabels").selectAll("g.dv_dimensionLabel").data(this._d.dimensionLabels).join("g").attr("class","dv_dimensionLabel").each(((t,e,s)=>{this._renderDimensionLabel(s[e],t,e,i)}))}_prerenderValueLabels(t,e){Wt(t).select(".dv_valueLabels").selectAll("g").data(this._d.values).join("g").selectAll("text").data(((t,e)=>t.map((t=>({value:t,dimension:e}))))).join("text").attr("class",((t,e)=>0===e?"dv_leftValueLabel":"dv_rightValueLabel")).text((t=>this._style.value.format(t.value))).style("font-size",`${this._style.value.label.font.size}px`).style("fill",this._style.value.label.font.color).style("font-weight",this._style.value.label.font.weight)}_prerenderLineLabels(t,e){Wt(t).select(".dv_lineLabels").selectAll("text").data(this._d.labels).join("text").text((t=>t)).style("font-size",`${this._style.label.font.size}px`).style("fill",this._style.label.font.color).style("font-weight",this._style.label.font.weight)}render(t,e){this.datasource.loaded&&(this.emit("renderWillStart",[t,e,this]),super.render(t,e),this.defineScale(),this._renderDimensions(t,e),this._renderDimensionLabels(t,e),this._renderValueLines(t,e),this._renderValueDots(t,e),this._renderValueLabels(t,e),this._renderLineLabels(t,e),this.emit("renderDidEnd",[t,e,this]))}_renderDimensions(t,e){Wt(t).select(".dv_dimensions").selectAll("line").data(this._d.dimensions).join("line").style("stroke",this._style.grid.line.color).style("stroke-width",`${this._style.grid.line.width}px`).each(((t,e,i)=>{const s=i[e],n=this.scale(e,this._c.minValue),r=this.scale(e,this._c.maxValue);s.setAttribute("x1",n.x),s.setAttribute("y1",n.y+this._style.grid.padding.bottom),s.setAttribute("x2",r.x),s.setAttribute("y2",r.y-this._style.grid.padding.top)}))}_renderDimensionLabels(t,e){Wt(t).select(".dv_dimensionLabels").selectAll("g.dv_dimensionLabel").each(((t,e,i)=>{const s=i[e],n=s.getBBox(),r=this.scale(e,this._c.maxValue),a=r.y-this._style.grid.padding.top-this._style.dimension.label.offset,l=r.x-n.x-n.width/2,o=a-n.y-n.height;s.setAttribute("transform",`translate(${l} ${o})`)}))}_renderDimensionLabel(t,e,i,s){const n=Math.max(50,this.viewRect.width()/2);s.render(e,t,{},{},{width:n,textAlign:"center"})}_renderValueLines(t,e){Wt(t).select(".dv_valueLines").selectAll("line").data(this._d.values).join("line").style("stroke-width",`${this._style.value.line.width}px`).style("stroke",((t,e)=>this._d.colors[e])).each(((t,e,i)=>{const s=i[e],n=this.scale(0,t[0]),r=this.scale(1,t[1]);s.setAttribute("x1",n.x),s.setAttribute("y1",n.y),s.setAttribute("x2",r.x),s.setAttribute("y2",r.y)}))}_renderValueDots(t,e){Wt(t).select(".dv_valueDots").selectAll("g").data(this._d.values).join("g").selectAll("circle").data(((t,e)=>t.map((t=>({value:t,dimension:e}))))).join("circle").attr("r",this._style.value.dot.size/2).attr("fill",(t=>this._d.colors[t.dimension])).each(((t,e,i)=>{const s=i[e],n=this.scale(e,t.value);s.setAttribute("cx",n.x),s.setAttribute("cy",n.y)}))}_renderValueLabels(t,e){Wt(t).select(".dv_valueLabels").selectAll("g").selectAll("text").each(((t,e,i)=>{const s=i[e],n=this.scale(e,t.value),r=this._style.value.label.offset;s.setAttribute("x",0===e?n.x-r:n.x+r),s.setAttribute("y",n.y+this._style.value.label.font.size/2+this._style.value.label.baseLineShift),s.style.textAnchor=0===e?"end":"start"}))}_renderLineLabels(t,e){const i=Math.max(0,...Wt(this._node).selectAll("text.dv_rightValueLabel").nodes().map((t=>t.getBBox().width))),s=this._style.value.label.offset+i+this._style.label.offset;Wt(t).select(".dv_lineLabels").selectAll("text").each(((t,e,i)=>{const n=i[e],r=this.scale(1,this._d.values[e][1]);n.setAttribute("x",r.x+s),n.setAttribute("y",r.y+this._style.label.font.size/2+this._style.label.baseLineShift)}))}extractData(){this._d.data=this.transformedData(this._state),this._d.dimensions=this._(this._dimensions,this._d.data,this._state,this),this._d.dimensionLabels=this._(this._dimensionLabels,this._d.data,this._state,this),this._d.values=this._(this._values,this._d.data,this._state,this),this._d.labels=this._(this._labels,this._d.data,this._state,this),this._d.colors=this._(this._colors,this._d.data,this._state,this)}defineScale(){const t=Wt(this._node).select(".dv_dimensionLabels").node().getBBox(),e=Math.max(0,...Wt(this._node).selectAll("text.dv_leftValueLabel").nodes().map((t=>t.getBBox().width))),i=Math.max(0,...Wt(this._node).selectAll("text.dv_rightValueLabel").nodes().map((t=>t.getBBox().width))),s=Math.max(0,...Wt(this._node).selectAll(".dv_lineLabels text").nodes().map((t=>t.getBBox().width))),n=this._style.value.label.offset+i+this._style.label.offset+s,r={top:t.height,left:e+this._style.value.label.offset,bottom:0,right:n},a=this._style.grid.padding,l=this.viewRect.width(),o=this.viewRect.height(),h=on([this._c.minValue,this._c.maxValue],[o-r.bottom-a.bottom,r.top+a.top]);this.scale=function(t,e){return{x:0===t?r.left:l-r.right,y:h(e)}}}}function bo(t){var e=0,i=t.children,s=i&&i.length;if(s)for(;--s>=0;)e+=i[s].value;else e=1;t.value=e}function wo(t,e){t instanceof Map?(t=[void 0,t],void 0===e&&(e=ko)):void 0===e&&(e=Ao);for(var i,s,n,r,a,l=new Co(t),o=[l];i=o.pop();)if((n=e(i.data))&&(a=(n=Array.from(n)).length))for(i.children=n,r=a-1;r>=0;--r)o.push(s=n[r]=new Co(n[r])),s.parent=i,s.depth=i.depth+1;return l.eachBefore(So)}function Ao(t){return t.children}function ko(t){return Array.isArray(t)?t[1]:null}function Lo(t){void 0!==t.data.value&&(t.value=t.data.value),t.data=t.data.data}function So(t){var e=0;do{t.height=e}while((t=t.parent)&&t.height<++e)}function Co(t){this.data=t,this.depth=this.height=0,this.parent=null}function Ro(){return 0}function To(t){return function(){return t}}function Mo(t){t.x0=Math.round(t.x0),t.y0=Math.round(t.y0),t.x1=Math.round(t.x1),t.y1=Math.round(t.y1)}function zo(t,e,i,s,n){for(var r,a=t.children,l=-1,o=a.length,h=t.value&&(s-e)/t.value;++l<o;)(r=a[l]).y0=i,r.y1=n,r.x0=e,r.x1=e+=r.value*h}function Do(t,e,i,s,n){for(var r,a=t.children,l=-1,o=a.length,h=t.value&&(n-i)/t.value;++l<o;)(r=a[l]).x0=e,r.x1=s,r.y0=i,r.y1=i+=r.value*h}Co.prototype=wo.prototype={constructor:Co,count:function(){return this.eachAfter(bo)},each:function(t,e){let i=-1;for(const s of this)t.call(e,s,++i,this);return this},eachAfter:function(t,e){for(var i,s,n,r=this,a=[r],l=[],o=-1;r=a.pop();)if(l.push(r),i=r.children)for(s=0,n=i.length;s<n;++s)a.push(i[s]);for(;r=l.pop();)t.call(e,r,++o,this);return this},eachBefore:function(t,e){for(var i,s,n=this,r=[n],a=-1;n=r.pop();)if(t.call(e,n,++a,this),i=n.children)for(s=i.length-1;s>=0;--s)r.push(i[s]);return this},find:function(t,e){let i=-1;for(const s of this)if(t.call(e,s,++i,this))return s},sum:function(t){return this.eachAfter((function(e){for(var i=+t(e.data)||0,s=e.children,n=s&&s.length;--n>=0;)i+=s[n].value;e.value=i}))},sort:function(t){return this.eachBefore((function(e){e.children&&e.children.sort(t)}))},path:function(t){for(var e=this,i=function(t,e){if(t===e)return t;var i=t.ancestors(),s=e.ancestors(),n=null;t=i.pop(),e=s.pop();for(;t===e;)n=t,t=i.pop(),e=s.pop();return n}(e,t),s=[e];e!==i;)e=e.parent,s.push(e);for(var n=s.length;t!==i;)s.splice(n,0,t),t=t.parent;return s},ancestors:function(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e},descendants:function(){return Array.from(this)},leaves:function(){var t=[];return this.eachBefore((function(e){e.children||t.push(e)})),t},links:function(){var t=this,e=[];return t.each((function(i){i!==t&&e.push({source:i.parent,target:i})})),e},copy:function(){return wo(this).eachBefore(Lo)},[Symbol.iterator]:function*(){var t,e,i,s,n=this,r=[n];do{for(t=r.reverse(),r=[];n=t.pop();)if(yield n,e=n.children)for(i=0,s=e.length;i<s;++i)r.push(e[i])}while(r.length)}};var $o=(1+Math.sqrt(5))/2;function Vo(t,e,i,s,n,r){for(var a,l,o,h,c,d,u,_,p,f,g,y=[],m=e.children,x=0,v=0,b=m.length,w=e.value;x<b;){o=n-i,h=r-s;do{c=m[v++].value}while(!c&&v<b);for(d=u=c,g=c*c*(f=Math.max(h/o,o/h)/(w*t)),p=Math.max(u/g,g/d);v<b;++v){if(c+=l=m[v].value,l<d&&(d=l),l>u&&(u=l),g=c*c*f,(_=Math.max(u/g,g/d))>p){c-=l;break}p=_}y.push(a={value:c,dice:o<h,children:m.slice(x,v)}),a.dice?zo(a,i,s,n,w?s+=h*c/w:r):Do(a,i,s,w?i+=o*c/w:n,r),w-=c,x=v}return y}var Wo=function t(e){function i(t,i,s,n,r){Vo(e,t,i,s,n,r)}return i.ratio=function(e){return t((e=+e)>1?e:1)},i}($o);function Eo(){var t=Wo,e=!1,i=1,s=1,n=[0],r=Ro,a=Ro,l=Ro,o=Ro,h=Ro;function c(t){return t.x0=t.y0=0,t.x1=i,t.y1=s,t.eachBefore(d),n=[0],e&&t.eachBefore(Mo),t}function d(e){var i=n[e.depth],s=e.x0+i,c=e.y0+i,d=e.x1-i,u=e.y1-i;d<s&&(s=d=(s+d)/2),u<c&&(c=u=(c+u)/2),e.x0=s,e.y0=c,e.x1=d,e.y1=u,e.children&&(i=n[e.depth+1]=r(e)/2,s+=h(e)-i,c+=a(e)-i,(d-=l(e)-i)<s&&(s=d=(s+d)/2),(u-=o(e)-i)<c&&(c=u=(c+u)/2),t(e,s,c,d,u))}return c.round=function(t){return arguments.length?(e=!!t,c):e},c.size=function(t){return arguments.length?(i=+t[0],s=+t[1],c):[i,s]},c.tile=function(e){return arguments.length?(t=function(t){if("function"!=typeof t)throw new Error;return t}(e),c):t},c.padding=function(t){return arguments.length?c.paddingInner(t).paddingOuter(t):c.paddingInner()},c.paddingInner=function(t){return arguments.length?(r="function"==typeof t?t:To(+t),c):r},c.paddingOuter=function(t){return arguments.length?c.paddingTop(t).paddingRight(t).paddingBottom(t).paddingLeft(t):c.paddingTop()},c.paddingTop=function(t){return arguments.length?(a="function"==typeof t?t:To(+t),c):a},c.paddingRight=function(t){return arguments.length?(l="function"==typeof t?t:To(+t),c):l},c.paddingBottom=function(t){return arguments.length?(o="function"==typeof t?t:To(+t),c):o},c.paddingLeft=function(t){return arguments.length?(h="function"==typeof t?t:To(+t),c):h},c}function Bo(t,e,i,s,n){(1&t.depth?Do:zo)(t,e,i,s,n)}var Io=function t(e){function i(t,i,s,n,r){if((a=t._squarify)&&a.ratio===e)for(var a,l,o,h,c,d=-1,u=a.length,_=t.value;++d<u;){for(o=(l=a[d]).children,h=l.value=0,c=o.length;h<c;++h)l.value+=o[h].value;l.dice?zo(l,i,s,n,_?s+=(r-s)*l.value/_:r):Do(l,i,s,_?i+=(n-i)*l.value/_:n,r),_-=l.value}else t._squarify=a=Vo(e,t,i,s,n,r),a.ratio=e}return i.ratio=function(e){return t((e=+e)>1?e:1)},i}($o);function jo(t){return t}var Ho=1e-6;function No(t){return"translate("+t+",0)"}function Oo(t){return"translate(0,"+t+")"}function Fo(t){return e=>+t(e)}function Po(t,e){return e=Math.max(0,t.bandwidth()-2*e)/2,t.round()&&(e=Math.round(e)),i=>+t(i)+e}function Uo(){return!this.__axis}function qo(t,e){var i=[],s=null,n=null,r=6,a=6,l=3,o="undefined"!=typeof window&&window.devicePixelRatio>1?0:.5,h=1===t||4===t?-1:1,c=4===t||2===t?"x":"y",d=1===t||3===t?No:Oo;function u(u){var _=null==s?e.ticks?e.ticks.apply(e,i):e.domain():s,p=null==n?e.tickFormat?e.tickFormat.apply(e,i):jo:n,f=Math.max(r,0)+l,g=e.range(),y=+g[0]+o,m=+g[g.length-1]+o,x=(e.bandwidth?Po:Fo)(e.copy(),o),v=u.selection?u.selection():u,b=v.selectAll(".domain").data([null]),w=v.selectAll(".tick").data(_,e).order(),A=w.exit(),k=w.enter().append("g").attr("class","tick"),L=w.select("line"),S=w.select("text");b=b.merge(b.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),w=w.merge(k),L=L.merge(k.append("line").attr("stroke","currentColor").attr(c+"2",h*r)),S=S.merge(k.append("text").attr("fill","currentColor").attr(c,h*f).attr("dy",1===t?"0em":3===t?"0.71em":"0.32em")),u!==v&&(b=b.transition(u),w=w.transition(u),L=L.transition(u),S=S.transition(u),A=A.transition(u).attr("opacity",Ho).attr("transform",(function(t){return isFinite(t=x(t))?d(t+o):this.getAttribute("transform")})),k.attr("opacity",Ho).attr("transform",(function(t){var e=this.parentNode.__axis;return d((e&&isFinite(e=e(t))?e:x(t))+o)}))),A.remove(),b.attr("d",4===t||2===t?a?"M"+h*a+","+y+"H"+o+"V"+m+"H"+h*a:"M"+o+","+y+"V"+m:a?"M"+y+","+h*a+"V"+o+"H"+m+"V"+h*a:"M"+y+","+o+"H"+m),w.attr("opacity",1).attr("transform",(function(t){return d(x(t)+o)})),L.attr(c+"2",h*r),S.attr(c,h*f).text(p),v.filter(Uo).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",2===t?"start":4===t?"end":"middle"),v.each((function(){this.__axis=x}))}return u.scale=function(t){return arguments.length?(e=t,u):e},u.ticks=function(){return i=Array.from(arguments),u},u.tickArguments=function(t){return arguments.length?(i=null==t?[]:Array.from(t),u):i.slice()},u.tickValues=function(t){return arguments.length?(s=null==t?null:Array.from(t),u):s&&s.slice()},u.tickFormat=function(t){return arguments.length?(n=t,u):n},u.tickSize=function(t){return arguments.length?(r=a=+t,u):r},u.tickSizeInner=function(t){return arguments.length?(r=+t,u):r},u.tickSizeOuter=function(t){return arguments.length?(a=+t,u):a},u.tickPadding=function(t){return arguments.length?(l=+t,u):l},u.offset=function(t){return arguments.length?(o=+t,u):o},u}class Xo extends Ea{constructor(t){super(t),this.style({marimekko:{paddingInner:1,customize:()=>{}},chartArea:{margin:{top:30,right:0,left:40,bottom:45}},labels:{show:!0,font:{size:10},margin:{left:5,top:5,right:5,bottom:5},customize:(t,e,i)=>{}},tooltips:{maxWidth:300,font:{size:12},customize:()=>{}},xAxis:{show:!0,font:{size:10},offset:{x:0,y:0},customize:(t,e,i)=>{}},yAxis:{show:!0,font:{size:10},offset:{x:3,y:0},customize:(t,e,i)=>{}},columnLabels:{show:!0,font:{size:10},offset:{y:7},padding:40},columnHeaders:{font:{size:10}},columnSpacing:0,legend:{show:!0}}),this.defineDefaults({height:500,value:(t,e)=>t.value||0,category:(t,e)=>t.category||null,rectColor:(t,e)=>{const i=this._category(t.data,e);return this._categoriesObj[i]||t.data.color||"#006699"},label:(t,e)=>`${Math.round(t.value/t.parent.value*100)}%`,xAxisTitle:"",xAxisFormat:t=>t,yAxisFormat:t=>t,columnLabel:(t,e)=>t.data.key,columnHeader:null}),this._categories=[],this._categoriesObj={},this._c={nColumns:null,columnSpacing:null},this._legend=new Na,this._tooltip=null,this._tooltipConfig={enabled:!0,text:null,init:null,prerender:null,render:null}}categories(t){return this._categories=t,this._categoriesObj=Object.fromEntries(t.map((t=>[t.key,t.color||null]))),this}tooltips(t){for(const e in this._tooltipConfig)this._tooltipConfig[e]=t[e]||this._tooltipConfig[e];return this}legend(){return this._legend}init(t,e){super.init(t,e),t.classList.add("dv_marimekko"),Wt(t).append("g").attr("class","dv_marimekkoWrapper"),Wt(t).select("g.dv_marimekkoWrapper").append("g").attr("class","dv_rects"),Wt(t).select("g.dv_marimekkoWrapper").append("g").attr("class","dv_labels"),Wt(t).select("g.dv_marimekkoWrapper").append("g").attr("class","dv_columnLabels"),Wt(t).append("g").attr("class","dv_columnHeader"),Wt(t).select("g.dv_marimekkoWrapper").append("g").attr("class","dv_interaction dv_noprint").style("fill-opacity",0),Wt(t).append("g").attr("class","dv_axis dv_xaxis"),Wt(t).append("g").attr("class","dv_axis dv_yaxis");const i=Wt(t).append("g").attr("class","dv_axisTitle");i.append("text").attr("class","dv_xaxisTitle"),i.append("text").attr("class","dv_yaxisTitle"),this._style.legend.show&&(this._legendNode=Wt(t).append("g").attr("class","dv_legend").node(),this._legend.init(this._legendNode,e)),this._tooltipConfig.enabled&&(this._tooltip=new Za,this._style.tooltips.customize(this._tooltip,e,this),this._tooltip.on("init",this._initTooltip.bind(this)).on("prerender",this._prerenderTooltip.bind(this)).on("render",this._renderTooltip.bind(this)))}prerender(t,e){if(super.prerender(t,e),this.datasource&&!this.datasource.loaded)return void console.info("Rendering of control postponed. Datasource not yet ready.");this.emit("prerenderWillStart",[t,e,this]);const i=this._style;i.legend.show&&(this._legend.categories(this._categories.map((t=>t.key))),this._legend.colors(this._categories.map((t=>t.color))),this._legend.maxViewRect=new ne(this.viewRect.left+this._legend._style.padding.left,this.viewRect.top+this._legend._style.padding.top,this.viewRect.right-this._legend._style.padding.right,null),this._legend.prerender(this._legendNode,e)),this._tree=this._computeTreeValues(this.transformedData(e)),this._root=wo(this._tree).sum((t=>t.value)),this._c.nColumns=this._tree.children.length,this._root.children.forEach(((t,e)=>{t.children.forEach((t=>{t.colIdx=e}))}));const s="function"==typeof this._height?this._height(this,e):this._height;i.legend.show?this._marimekkoHeight=s-i.chartArea.margin.top-i.chartArea.margin.bottom-this._legend.viewRect.height():this._marimekkoHeight=s-i.chartArea.margin.top-i.chartArea.margin.bottom;const n=this.viewRect.width()-i.chartArea.margin.left-i.chartArea.margin.right;if(this._c.columnSpacing=this._(i.columnSpacing,{categories:this._categories,data:this._tree,nColumns:this._c.nColumns,width:n},e,this),Eo().tile(Bo).size([n-this._c.columnSpacing*(this._c.nColumns-1),this._marimekkoHeight]).paddingInner(i.marimekko.paddingInner).round(!0)(this._root),this._deltaColLabelHeight=0,this._origColLabelHeight=null,i.columnLabels.show&&Wt(t).select(".dv_columnLabels").selectAll("text").data(this._root.children).join("text").attr("x",((t,e)=>t.x0+(t.x1-t.x0)/2+e*this._c.columnSpacing)).attr("y",(t=>t.y0-i.columnLabels.offset.y)).attr("data-width",(t=>t.x1-t.x0)).attr("text-anchor","middle").style("font-size",`${i.columnLabels.font.size}pt`).text((t=>this._columnLabel(t,e))).call((t=>{t.nodes().forEach((t=>{this._origColLabelHeight=this._origColLabelHeight||t.getBoundingClientRect().height,t.innerHTML.trim().length>0&&Aa(t,parseInt(t.getAttribute("data-width"))-i.columnLabels.padding+this._c.columnSpacing,1.4*i.columnLabels.font.size,0);const e=t.getBoundingClientRect().height;this._deltaColLabelHeight=Math.max(this._deltaColLabelHeight,e-this._origColLabelHeight),$e(0,this._origColLabelHeight-e)(Wt(t))}))})),this._columnHeader){const e=this._root.children.map(((t,e)=>this._columnHeader(t,this._state,e,this._root.children))).filter((t=>t));Wt(t).select(".dv_columnHeader").selectAll("text").data(e).join("text").attr("x",(t=>t.x+i.chartArea.margin.left)).attr("y",this._legend.viewRect.bottom+20).style("font-size",`${i.columnHeaders.font.size}pt`).text((t=>t.text)).call((t=>{t.each(((t,e,s)=>{Object.keys(t.attrs||{}).forEach((i=>{s[e].setAttribute(i,t.attrs[i])})),Aa(s[e],t.width,1.4*i.columnHeaders.font.size,0)}))})),this._deltaColLabelHeight+=Wt(t).select(".dv_columnHeader").node().getBoundingClientRect().height}this.viewRect.setHeight(s+this._deltaColLabelHeight),this.emit("prerenderDidEnd",[t,e,this])}render(t,e){if(!this.datasource.loaded)return;this.emit("renderWillStart",[t,e,this]),super.render(t,e);const i=this._style,s=this._root.leaves();let n=0;if(n=i.legend.show?this.viewRect.top+i.chartArea.margin.top+this._legend.viewRect.height()+this._deltaColLabelHeight:this.viewRect.top+i.chartArea.margin.top+this._deltaColLabelHeight,Wt(t).select(".dv_marimekkoWrapper").call($e(i.chartArea.margin.left,n)),Wt(t).select(".dv_marimekkoWrapper").select(".dv_rects").selectAll("rect").data(s).join("rect").attr("x",(t=>t.x0+t.colIdx*this._c.columnSpacing)).attr("y",(t=>t.y0)).attr("width",(t=>t.x1-t.x0)).attr("height",(t=>t.y1-t.y0)).style("fill",(t=>"function"==typeof this._rectColor?this._rectColor(t,e):this._rectColor)).call((t=>{i.marimekko.customize(t,e,this)})),i.labels.show){const n=Wt(t).select(".dv_marimekkoWrapper").select(".dv_labels").selectAll("text").data(s).join("text").attr("x",(t=>t.x0+(t.x1-t.x0)/2+t.colIdx*this._c.columnSpacing)).attr("y",(t=>t.y0+(t.y1-t.y0)/2+i.labels.font.size/2)).style("font-size",`${i.labels.font.size}px`);Wt(t).select(".dv_marimekkoWrapper").select(".dv_labels").selectAll("text").data(s).style("fill",(t=>"function"==typeof i.labels.font.color?i.labels.font.color(t,e):i.labels.font.color)).each(((t,i,s)=>{s[i].classList.remove("dv_hidden");let n=this._label(t,e);if("string"==typeof n&&(n=[n]),n){const e=this._style.labels.margin,r=t.x1-t.x0-e.left-e.right,a=t.y1-t.y0-e.top-e.bottom;ka(n,s[i],r,a)||s[i].classList.add("dv_hidden")}})),i.labels.customize(n,e,this)}if(i.xAxis.show){this._xscale=on().domain([0,this._root.value]).range([0,this.viewRect.width()-i.chartArea.margin.left-i.chartArea.margin.right]),0===this._c.columnSpacing&&(this._xaxis=(r=this._xscale,qo(3,r)).tickFormat(this._xAxisFormat),i.xAxis.customize(this._xaxis,e,this),Wt(t).select(".dv_xaxis").call($e(this.viewRect.left+i.chartArea.margin.left,this.viewRect.bottom-i.chartArea.margin.bottom+3)).call(this._xaxis));const s=this.viewRect.width()-i.chartArea.margin.left-i.chartArea.margin.right;Wt(t).select(".dv_xaxisTitle").attr("x",this.viewRect.left+i.chartArea.margin.left+s/2+i.xAxis.offset.x).attr("y",this.viewRect.bottom-3+i.xAxis.offset.y).style("text-anchor","middle").style("font-size",`${i.xAxis.font.size}pt`).text("function"==typeof this._xAxisTitle?this._xAxisTitle(this._state,this):this._xAxisTitle)}var r;i.yAxis.show&&(this._yscale=on().domain([100,0]).range([0,this._marimekkoHeight]),this._yaxis=function(t){return qo(4,t)}(this._yscale).tickFormat(this._yAxisFormat),i.yAxis.customize(this._yaxis,e,this),Wt(t).select(".dv_yaxis").call($e(this.viewRect.left+i.chartArea.margin.left-i.yAxis.offset.x,this.viewRect.top+i.chartArea.margin.top+this._legend.viewRect.height()+this._deltaColLabelHeight)).call(this._yaxis)),i.legend.show&&this._legend.render(this._legendNode,e),this._tooltipConfig.enabled&&Wt(t).select(".dv_marimekkoWrapper").select(".dv_interaction").selectAll("rect").data(s).join("rect").attr("x",(t=>t.x0+t.colIdx*this._c.columnSpacing)).attr("y",(t=>t.y0)).attr("width",(t=>t.x1-t.x0)).attr("height",(t=>t.y1-t.y0)).call(this._tooltip.bindTooltip()),this.emit("renderDidEnd",[t,e,this])}_defaultTooltipText(t){const e=this._label(t,this._state),i=this._category(t.data,this._state);return`${t.parent.data.key}\n${i}\n${t.value} (${e})`}_initTooltip(t,e,i){this._tooltipConfig.init||this._tooltipConfig.prerender||this._tooltipConfig.render?this._tooltipConfig.init&&this._tooltipConfig.init(e.value,t,this._state,i):Wt(t).append("text")}_prerenderTooltip(t,e,i){if(this._tooltipConfig.init||this._tooltipConfig.prerender||this._tooltipConfig.render)return void(this._tooltipConfig.prerender&&this._tooltipConfig.prerender(e.value,t,this._state,i));const s=this._tooltipConfig.text?this._tooltipConfig.text(e.value,t,this._state,i):this._defaultTooltipText(e.value);Wt(t).select("text").attr("x",i.viewRect.left).attr("y",i.viewRect.top+12).style("font-size",`${this._style.tooltips.font.size}px`).text(s);const n=Wt(t).select("text").node();Aa(n,this._style.tooltips.maxWidth,1.25*this._style.tooltips.font.size);const r=n.getBoundingClientRect();i.viewRect.setHeight(r.height),i.viewRect.setWidth(r.width)}_renderTooltip(t,e,i){(this._tooltipConfig.init||this._tooltipConfig.prerender||this._tooltipConfig.render)&&this._tooltipConfig.render&&this._tooltipConfig.render(e.value,t,this._state,i)}_computeTreeValues(t){return t.value=this._value(t,this._state),t.children&&t.children.forEach((t=>this._computeTreeValues(t,this._state))),t}}function Yo(t,e){return t.sourceLinks.length?t.depth:e-1}function Go(t){return function(){return t}}function Zo(t,e){return Jo(t.source,e.source)||t.index-e.index}function Ko(t,e){return Jo(t.target,e.target)||t.index-e.index}function Jo(t,e){return t.y0-e.y0}function Qo(t){return t.value}function th(t){return t.index}function eh(t){return t.nodes}function ih(t){return t.links}function sh(t,e){const i=t.get(e);if(!i)throw new Error("missing: "+e);return i}function nh({nodes:t}){for(const e of t){let t=e.y0,i=t;for(const i of e.sourceLinks)i.y0=t+i.width/2,t+=i.width;for(const t of e.targetLinks)t.y1=i+t.width/2,i+=t.width}}function rh(){let t,e,i,s=0,n=0,r=1,a=1,l=24,o=8,h=th,c=Yo,d=eh,u=ih,_=!1,p=6,f=function(t,e){return new Array(t).fill(e/t)};function g(){const g={nodes:d.apply(null,arguments),links:u.apply(null,arguments)},x=_?function({nodes:t,links:e}){const i=t.length,s=new Array(i).fill(null).map((()=>[])),n=new Array(i).fill(null).map((()=>[]));for(let t=0;t<e.length;t++){const i=e[t];i.origIdx=t,s[i.source].push(i),n[i.target].push(i)}const r=[];for(let e=0;e<i;e++)0===n[e].length&&r.push(e),t[e].origIdx=e;let a=new Set(r),l=new Set,o=0;for(;a.size;){if(a.forEach((e=>{const i=t[e];i.level=o,i.dummy=!1;for(const t of s[e])l.add(t.target)})),o+=1,o>i)throw new Error("Circular links are not supported");a=l,l=new Set}for(let e=0;e<t.length;e++)0===s[e].length&&(t[e].level=o);const h={nodes:[],links:[]};let c=0;for(let e=0;e<i;e++){const i=t[e];h.nodes.indexOf(i)<0&&(i.idx=c,h.nodes.push(i),c+=1);const n=s[e];for(let e=0;e<n.length;e++){const s=n[e],r=t[s.target];if(i.level+1<r.level){let t=i;for(let e=i.level+1;e<r.level;e++){const n={...i,idx:c,dummy:!0,level:e,node:null,origIdx:null};h.nodes.push(n),c+=1;const r={...s,origSource:s.source,source:t.idx,origTarget:s.target,target:n.idx};h.links.push(r),t=n}h.nodes.indexOf(r)<0&&(r.idx=c,h.nodes.push(r),c+=1),h.links.push({...s,origSource:s.source,source:t.idx,origTarget:s.target,target:r.idx})}else h.nodes.indexOf(r)<0&&(r.idx=c,h.nodes.push(r),c+=1),h.links.push({...s,origSource:s.source,source:i.idx,origTarget:s.target,target:r.idx})}}return h}(g):g;return function({nodes:t,links:e}){for(const[e,i]of t.entries())i.index=e,i.sourceLinks=[],i.targetLinks=[];const s=new Map(t.map(((e,i)=>[h(e,i,t),e])));for(const[t,i]of e.entries()){i.index=t;let{source:e,target:n}=i;"object"!=typeof e&&(e=i.source=sh(s,e)),"object"!=typeof n&&(n=i.target=sh(s,n)),e.sourceLinks.push(i),n.targetLinks.push(i)}if(null!=i)for(const{sourceLinks:e,targetLinks:s}of t)e.sort(i),s.sort(i)}(x),function({nodes:t}){for(const e of t)e.value=void 0===e.fixedValue?Math.max(Ri(e.sourceLinks,Qo),Ri(e.targetLinks,Qo)):e.fixedValue}(x),function({nodes:t}){const e=t.length;let i=new Set(t),s=new Set,n=0;for(;i.size;){for(const t of i){t.depth=n;for(const{target:e}of t.sourceLinks)s.add(e)}if(++n>e)throw new Error("circular link");i=s,s=new Set}}(x),function({nodes:t}){const e=t.length;let i=new Set(t),s=new Set,n=0;for(;i.size;){for(const t of i){t.height=n;for(const{source:e}of t.targetLinks)s.add(e)}if(++n>e)throw new Error("circular link");i=s,s=new Set}}(x),function(i){const h=function({nodes:t}){const i=Si(t,(t=>t.depth))+1,n=f(i-1,r-s-l),a=[s];for(let t=0;t<i-1;t++)a.push(a[t]+n[t]);const o=new Array(i);for(const e of t){const t=Math.max(0,Math.min(i-1,Math.floor(c.call(null,e,i))));e.layer=t,e.x0=a[t],e.x1=e.x0+l,o[t]?o[t].push(e):o[t]=[e]}if(e)for(const t of o)t.sort(e);return o}(i);t=Math.min(o,(a-n)/(Si(h,(t=>t.length))-1)),function(e){const i=Ci(e,(e=>(a-n-(e.length-1)*t)/Ri(e,Qo)));for(const s of e){let e=n;for(const n of s){n.y0=e,n.y1=e+n.value*i,e=n.y1+t;for(const t of n.sourceLinks)t.width=t.value*i}e=(a-e+t)/(s.length+1);for(let t=0;t<s.length;++t){const i=s[t];i.y0+=e*(t+1),i.y1+=e*(t+1)}A(s)}}(h);for(let t=0;t<p;++t){const e=Math.pow(.99,t),i=Math.max(1-e,(t+1)/p);m(h,e,i),y(h,e,i)}}(x),nh(x),_?function(t){const e=t.nodes.filter((t=>!t.dummy)).length,i=new Set(t.links.map((t=>t.origIdx))).size,s={nodes:new Array(e),links:new Array(i)},n=t.nodes.length;for(let e=0;e<n;e++){const i=t.nodes[e];if(!0===i.dummy)continue;const n=i.origIdx;s.nodes[n]={...i,idx:n,index:n,sourceLinks:[],targetLinks:[]};for(const t of i.sourceLinks){const e=ah(t),i=t.origIdx;s.links[i]={id:t.id,index:i,source:n,target:e.node.origIdx,value:t.value,width:t.width,y0:t.y0,y1:e.y1,steps:e.steps}}}for(const t of s.links)t.source=s.nodes[t.source],t.target=s.nodes[t.target],t.source.sourceLinks.push(t),t.target.targetLinks.push(t);return s}(x):x}function y(t,i,s){for(let n=1,r=t.length;n<r;++n){const r=t[n];for(const t of r){let e=0,s=0;for(const{source:i,value:n}of t.targetLinks){const r=n*(t.layer-i.layer);e+=k(i,t)*r,s+=r}if(!(s>0))continue;const n=(e/s-t.y0)*i;t.y0+=n,t.y1+=n,w(t)}void 0===e&&r.sort(Jo),x(r,s)}}function m(t,i,s){for(let n=t.length-2;n>=0;--n){const r=t[n];for(const t of r){let e=0,s=0;for(const{target:i,value:n}of t.sourceLinks){const r=n*(i.layer-t.layer);e+=L(t,i)*r,s+=r}if(!(s>0))continue;const n=(e/s-t.y0)*i;t.y0+=n,t.y1+=n,w(t)}void 0===e&&r.sort(Jo),x(r,s)}}function x(e,i){const s=e.length>>1,r=e[s];b(e,r.y0-t,s-1,i),v(e,r.y1+t,s+1,i),b(e,a,e.length-1,i),v(e,n,0,i)}function v(e,i,s,n){for(;s<e.length;++s){const r=e[s],a=(i-r.y0)*n;a>1e-6&&(r.y0+=a,r.y1+=a),i=r.y1+t}}function b(e,i,s,n){for(;s>=0;--s){const r=e[s],a=(r.y1-i)*n;a>1e-6&&(r.y0-=a,r.y1-=a),i=r.y0-t}}function w({sourceLinks:t,targetLinks:e}){if(void 0===i){for(const{source:{sourceLinks:t}}of e)t.sort(Ko);for(const{target:{targetLinks:e}}of t)e.sort(Zo)}}function A(t){if(void 0===i)for(const{sourceLinks:e,targetLinks:i}of t)e.sort(Ko),i.sort(Zo)}function k(e,i){let s=e.y0-(e.sourceLinks.length-1)*t/2;for(const{target:n,width:r}of e.sourceLinks){if(n===i)break;s+=r+t}for(const{source:t,width:n}of i.targetLinks){if(t===e)break;s-=n}return s}function L(e,i){let s=i.y0-(i.targetLinks.length-1)*t/2;for(const{source:n,width:r}of i.targetLinks){if(n===e)break;s+=r+t}for(const{target:t,width:n}of e.sourceLinks){if(t===i)break;s-=n}return s}return g.update=function(t){return nh(t),t},g.nodeId=function(t){return arguments.length?(h="function"==typeof t?t:Go(t),g):h},g.nodeAlign=function(t){return arguments.length?(c="function"==typeof t?t:Go(t),g):c},g.nodeSort=function(t){return arguments.length?(e=t,g):e},g.nodeWidth=function(t){return arguments.length?(l=+t,g):l},g.nodePadding=function(e){return arguments.length?(t=o=+e,g):o},g.stepped=function(t){return arguments.length?(_=t,g):_},g.nodes=function(t){return arguments.length?(d="function"==typeof t?t:Go(t),g):d},g.links=function(t){return arguments.length?(u="function"==typeof t?t:Go(t),g):u},g.linkSort=function(t){return arguments.length?(i="function"==typeof t?t:Go(t),g):i},g.columnWidths=function(t){return arguments.length?(f=t,g):f},g.size=function(t){return arguments.length?(s=n=0,r=+t[0],a=+t[1],g):[r-s,a-n]},g.extent=function(t){return arguments.length?(s=+t[0][0],r=+t[1][0],n=+t[0][1],a=+t[1][1],g):[[s,n],[r,a]]},g.iterations=function(t){return arguments.length?(p=+t,g):p},g}function ah(t,e=[]){const i=t.target;if(!1===i.dummy)return{node:i,steps:e,y1:t.y1};return ah(i.sourceLinks[0],[...e,{depth:i.depth,x0:i.x0,x1:i.x1,y0:i.y0,y1:i.y1}])}function lh(t){return[t.source.x1,t.y0]}function oh(t){return[t.target.x0,t.y1]}function hh(t){const e=[],i=t.width/2;let s=t.source.x1,n=t.y0+i;e.push(`M ${s} ${n}`);const r=t.steps||[];for(let t=0;t<r.length;t++){const i=r[t],a=i.x0+(i.x1-i.x0)/2,l=i.y1,o=s+(a-s)/2;e.push(`C ${o} ${n}, ${o} ${l} ${a} ${l}`),s=a,n=l}let a=t.target.x0,l=t.y1+i,o=s+(a-s)/2;e.push(`C ${o} ${n}, ${o} ${l} ${a} ${l}`),s=a,l=n=t.y1-i,e.push(`L ${a} ${l}`);for(let t=r.length-1;t>=0;t--){const i=r[t],a=i.x0+(i.x1-i.x0)/2,l=i.y0,o=s+(a-s)/2;e.push(`C ${o} ${n}, ${o} ${l} ${a} ${l}`),s=a,n=l}return a=t.source.x1,l=t.y0-i,o=s+(a-s)/2,e.push(`C ${o} ${n}, ${o} ${l} ${a} ${l}`),e.push("z"),e.join(" ")}class ch extends Ea{constructor(t){super(t),this.style({chartArea:{margin:{top:0,right:50,left:50,bottom:0}},labels:{show:!0,font:{size:10,weight:400},margin:7},blockHeader:{font:{size:10,weight:400},offset:{y:7},align:"center",maxWidth:null},streamHeader:{font:{size:10,weight:400},offset:{y:7}},blocks:{width:15,padding:15,strokeWidth:2,color:(t,e,i)=>t.color||"#006699",tooltips:{maxWidth:300,font:{size:12},customize:()=>{}}},streams:{color:(t,e,i)=>{const s=t.source.targetLinks.length>0,n=t.target.sourceLinks.length>0;return s&&n||s?t.source.color||"#006699":n?t.target.color||"#006699":t.source.color||"#006699"},stepped:!1,tooltips:{maxWidth:300,font:{size:12},customize:()=>{}}}}),this.defineDefaults({height:()=>Math.max(300,Math.min(550,document.documentElement.clientHeight-100)),labelFn:(t,e,i)=>t&&t.name||"",blockSort:void 0,blockHeader:null,streamHeader:null,columnWidths:(t,e)=>new Array(t).fill(e/t)}),this._blockTooltip=null,this._blockTooltipConfig={enabled:!0,text:null,init:null,prerender:null,render:null},this._streamTooltip=null,this._streamTooltipConfig={enabled:!0,text:null,init:null,prerender:null,render:null}}columnLabel(t){return console.warn("[Sankey] columnLabel is deprecated. Use blockHeader instead."),this._blockHeader=t,this}blockTooltips(t){for(const e in this._blockTooltipConfig)this._blockTooltipConfig[e]=t[e]||this._blockTooltipConfig[e];return this}streamTooltips(t){for(const e in this._streamTooltipConfig)this._streamTooltipConfig[e]=t[e]||this._streamTooltipConfig[e];return this}init(t,e){super.init(t,e),t.classList.add("dv_sankey"),Wt(t).append("g").attr("class","dv_streams"),Wt(t).append("g").attr("class","dv_blocks"),Wt(t).append("g").attr("class","dv_labels"),Wt(t).append("g").attr("class","dv_blockHeader"),Wt(t).append("g").attr("class","dv_streamHeader"),this._blockTooltipConfig.enabled&&(this._blockTooltip=new Za,this._style.blocks.tooltips.customize(this._blockTooltip,e,this),this._blockTooltip.on("init",this._initBlockTooltip.bind(this)).on("prerender",this._prerenderBlockTooltip.bind(this)).on("render",this._renderBlockTooltip.bind(this))),this._streamTooltipConfig.enabled&&(this._streamTooltip=new Za,this._style.streams.tooltips.customize(this._streamTooltip,e,this),this._streamTooltip.on("init",this._initStreamTooltip.bind(this)).on("prerender",this._prerenderStreamTooltip.bind(this)).on("render",this._renderStreamTooltip.bind(this)))}prerender(t,e){if(super.prerender(t,e),this.datasource&&!this.datasource.loaded)return void console.info("Rendering of control postponed. Datasource not yet ready.");this.emit("prerenderWillStart",[t,e,this]);const i=this._style;i.columnLabels&&(console.warn("[Sankey] columnLabels style is deprecated, use blockHeader style instead."),this._style.blockHeader=ie(this._style.blockHeader,this._style.columnLabels)),this._data=this.transformedData(e),this._cleanData(),this.viewRect.setHeight("function"==typeof this._height?this._height(t,e,this):this._height);const s=this._blockHeader?i.blockHeader.font.size+i.blockHeader.offset.y:0,n=this._streamHeader?i.streamHeader.font.size+i.streamHeader.offset.y:0;let r=s+n,a=[[this.viewRect.left+i.chartArea.margin.left,this.viewRect.top+i.chartArea.margin.top+r],[this.viewRect.right-i.chartArea.margin.right,this.viewRect.bottom-i.chartArea.margin.bottom]];if(this._graph=this._calculateDiagram(a),this._prerenderBlockHeader(t,e),this._prerenderStreamHeader(t,e),this._blockHeader){const t=function(t){return"string"==typeof t?new $t([document.querySelectorAll(t)],[document.documentElement]):new $t([z(t)],Dt)}(".dv_blockHeader text").nodes().map((t=>t.getBoundingClientRect().height)).reduce(((t,e)=>t>e?t:e))+i.blockHeader.offset.y;t>s&&(r=t+n),a=[[this.viewRect.left+i.chartArea.margin.left,this.viewRect.top+i.chartArea.margin.top+r],[this.viewRect.right-i.chartArea.margin.right,this.viewRect.bottom-i.chartArea.margin.bottom]],this._graph=this._calculateDiagram(a)}this._style.labels.show&&(this._labels=this._data.nodes.map((t=>{let i=this._labelFn(t,e,this)||"";return"string"==typeof i&&(i={label:i,position:"default"}),i.node=t,i.position=i.position||"default","left"===i.position&&(i.type="src"),"right"===i.position&&(i.type="dest"),"default"===i.position&&(i.type=t.sourceLinks.length>0&&0===t.targetLinks.length?"src":"dest"),i})),Wt(t).select("g.dv_labels").selectAll("text.dv_src").data(this._labels.filter((t=>"src"===t.type))).join("text").attr("class","dv_src").text((t=>t.label)).style("font-size",`${this._style.labels.font.size}pt`).style("font-weight",this._style.labels.font.weight),this._srcLabelsWidth=Math.max([...Wt(t).selectAll("g.dv_labels text.dv_src").nodes().map((t=>t.getBoundingClientRect().width))]),Wt(t).select("g.dv_labels").selectAll("text.dv_dest").data(this._labels.filter((t=>"dest"===t.type))).join("text").attr("class","dv_dest").text((t=>t.label)).style("font-size",`${this._style.labels.font.size}pt`).style("font-weight",this._style.labels.font.weight),this._destLabelsWidth=Math.max([...Wt(t).selectAll("g.dv_labels text.dv_dest").nodes().map((t=>t.getBoundingClientRect().width))])),this.emit("prerenderDidEnd",[t,e,this])}_prerenderBlockHeader(t,e){if(!this._blockHeader)return;const i={};this._data.nodes.forEach((t=>{i[t.layer]=i[t.layer]||[],i[t.layer].push(t)})),Wt(t).select("g.dv_blockHeader").selectAll("text").data(Object.keys(i).map((t=>({column:+t,blocks:i[t]})))).join("text").attr("x",(t=>t.blocks[0].x1-(t.blocks[0].x1-t.blocks[0].x0)/2)).attr("y",this._style.blockHeader.font.size).attr("text-anchor",((t,i,s)=>({center:"middle",left:"start",right:"end"}[this._(this._style.blockHeader.align,{columnData:t,columnIndex:i,node:s[i],data:this._data},e,this)]||"middle"))).text((t=>this._blockHeader(t,e,this))).style("font-size",`${this._style.blockHeader.font.size}px`).style("font-weight",this._style.blockHeader.font.weight).call((t=>{t.each(((t,i,s)=>{const n=this._(this._style.blockHeader.maxWidth,{columnData:t,columnIndex:i,data:this._data},e,this);n>0&&Aa(s[i],n,1.25*this._style.blockHeader.font.size)}))}))}_prerenderStreamHeader(t,e){if(!this._streamHeader)return;const i={};this._data.nodes.forEach((t=>{i[t.layer]=i[t.layer]||[],i[t.layer].push(t)}));const s=Object.keys(i).map((t=>+t));s.sort();const n=[];for(let t=0;t<s.length-1;t++)n.push({column:s[t],sourceBlocks:i[t],targetBlocks:i[t+1]});Wt(t).select("g.dv_streamHeader").selectAll("text").data(n).join("text").attr("x",(t=>{const e=t.sourceBlocks[0].x1-(t.sourceBlocks[0].x1-t.sourceBlocks[0].x0)/2;return e+(t.targetBlocks[0].x1-(t.targetBlocks[0].x1-t.targetBlocks[0].x0)/2-e)/2})).attr("y",this._style.streamHeader.font.size).attr("text-anchor","middle").text((t=>this._streamHeader(t,e,this))).style("font-size",`${this._style.streamHeader.font.size}px`).style("font-weight",this._style.streamHeader.font.weight)}_calculateDiagram(t){this._sankey=rh().nodeWidth(this._style.blocks.width).nodePadding(this._style.blocks.padding).extent(t),this._style.streams.stepped&&(this._sankey.stepped?this._sankey.stepped(this._style.streams.stepped):(console.warn("This version of d3-sankey does not support stepped streams."),this._style.streams.stepped=!1)),this._sankey.columnWidths?this._sankey.columnWidths(this._columnWidths):console.warn("This version of d3-sankey does not support setting the column widths."),"function"==typeof this._blockSort&&(this._sankey.nodeSort(this._blockSort),this._sankey.linkSort(((t,e)=>this._blockSort(t.target,e.target))));return this._sankey(this._data)}render(t,e){if(!this.datasource.loaded)return;this.emit("renderWillStart",[t,e,this]),super.render(t,e);const i=this._style;this._streamClips=Wt(this.defs()).selectAll(`clipPath.dv_clipStream_${this.id}`).data(this._graph.links).join("clipPath").attr("id",((t,e)=>`dv_clipStream_${this.id}_${e}`)).attr("class",`dv_clipStream_${this.id}`).selectAll("rect").data((t=>[t])).join("rect").attr("x",(t=>Math.max(t.source.x0,t.source.x1))).attr("y",(t=>Math.min(t.y0,t.y1)-Math.max(1,t.width))).attr("width",(t=>Math.min(t.target.x0,t.target.x1)-Math.max(t.source.x0,t.source.x1))).attr("height",(t=>Math.abs(t.y0-t.y1)+2*Math.max(1,t.width))),Wt(t).select("g.dv_streams").selectAll("path").data(this._graph.links).join("path").attr("d",i.streams.stepped?hh:Ol().source(lh).target(oh)).attr("clip-path",((t,e)=>i.streams.stepped?"":`url(#dv_clipStream_${this.id}_${e})`)).style("stroke",(t=>i.streams.stepped?"#fff":i.streams.color(t,e,this))).style("stroke-width",(t=>i.streams.stepped?1:Math.max(1,t.width))).style("fill",(t=>i.streams.stepped?i.streams.color(t,e,this):"none")).call(this._streamTooltip.bindTooltip()),Wt(t).select("g.dv_blocks").selectAll("rect").data(this._graph.nodes).join("rect").attr("x",(t=>t.x0)).attr("y",(t=>t.y0-i.blocks.strokeWidth/2)).attr("height",(t=>t.y1-t.y0+i.blocks.strokeWidth)).attr("width",this._sankey.nodeWidth()).attr("fill",(t=>i.blocks.color(t,e,this))).attr("stroke-width",i.blocks.strokeWidth).style("stroke","#fff").on("mouseover",((e,i)=>{Wt(t).selectAll(".dv_hover").nodes().forEach((t=>t.classList.remove("dv_hover"))),Wt(t).selectAll(".dv_bkgd").nodes().forEach((t=>t.classList.remove("dv_bkgd"))),Wt(t).select("g.dv_streams").selectAll("path").each(((t,e,s)=>{i.sourceLinks.indexOf(t)>-1||i.targetLinks.indexOf(t)>-1?s[e].classList.add("dv_hover"):s[e].classList.add("dv_bkgd")}))})).on("mouseleave",(e=>{Wt(t).selectAll(".dv_hover").nodes().forEach((t=>t.classList.remove("dv_hover"))),Wt(t).selectAll(".dv_bkgd").nodes().forEach((t=>t.classList.remove("dv_bkgd")))})).call(this._blockTooltip.bindTooltip()),this._style.labels.show&&(Wt(t).select("g.dv_labels").selectAll("text.dv_src").data(this._labels.filter((t=>"src"===t.type)).map((t=>t.node))).join("text").attr("x",(t=>t.x0-i.labels.margin)).attr("y",(t=>t.y0+(t.y1-t.y0)/2)).attr("text-anchor","end").call((t=>{t.each(((t,e,s)=>{Aa(s[e],this._style.chartArea.margin.left-i.labels.margin,1.25*this._style.labels.font.size);const n=s[e].getBoundingClientRect().height,r=parseFloat(s[e].getAttribute("y")),a=r-n/2+1.25*this._style.labels.font.size;s[e].setAttribute("transform",`translate(0 ${a-r})`)}))})),Wt(t).select("g.dv_labels").selectAll("text.dv_dest").data(this._labels.filter((t=>"dest"===t.type)).map((t=>t.node))).join("text").attr("x",(t=>t.x1+i.labels.margin)).attr("y",(t=>t.y0+(t.y1-t.y0)/2)).call((t=>{t.each(((t,e,s)=>{Aa(s[e],this._style.chartArea.margin.right-i.labels.margin,1.25*this._style.labels.font.size);const n=s[e].getBoundingClientRect().height,r=parseFloat(s[e].getAttribute("y")),a=r-n/2+1.25*this._style.labels.font.size;s[e].setAttribute("transform",`translate(0 ${a-r})`)}))}))),this.emit("renderDidEnd",[t,e,this])}_cleanData(){if(void 0!==this._data.nodes[0].sourceLinks)return;this._data.links=this._data.links.filter((t=>null!==t.value&&isFinite(t.value)));const t=Array.from(new Set(this._data.links.map((t=>[t.source,t.target])).flat(1)));t.sort(((t,e)=>+t-+e)),this._data.nodes=this._data.nodes.filter((e=>t.indexOf(+e.node)>=0)),this._data.nodes.forEach((e=>{e.node=t.indexOf(e.node)})),this._data.links.forEach((e=>{e.source=t.indexOf(e.source),e.target=t.indexOf(e.target)}))}_initBlockTooltip(t,e,i){this._blockTooltipConfig.init||this._blockTooltipConfig.prerender||this._blockTooltipConfig.render?this._blockTooltipConfig.init&&this._blockTooltipConfig.init(e.value,t,this._state,i):Wt(t).append("text")}_prerenderBlockTooltip(t,e,i){if(this._blockTooltipConfig.init||this._blockTooltipConfig.prerender||this._blockTooltipConfig.render)return void(this._blockTooltipConfig.prerender&&this._blockTooltipConfig.prerender(e.value,t,this._state,i));const s=this._blockTooltipConfig.text?this._blockTooltipConfig.text(e.value,t,this._state,i):this._labelFn(e.value,this._state,this)||"";Wt(t).select("text").attr("x",i.viewRect.left).attr("y",i.viewRect.top+12).style("font-size",`${this._style.blocks.tooltips.font.size}px`).text(s);const n=Wt(t).select("text").node();Aa(n,this._style.blocks.tooltips.maxWidth,1.25*this._style.blocks.tooltips.font.size);const r=n.getBoundingClientRect();i.viewRect.setHeight(r.height),i.viewRect.setWidth(r.width)}_renderBlockTooltip(t,e,i){(this._blockTooltipConfig.init||this._blockTooltipConfig.prerender||this._blockTooltipConfig.render)&&this._blockTooltipConfig.render&&this._blockTooltipConfig.render(e.value,t,this._state,i)}_initStreamTooltip(t,e,i){this._streamTooltipConfig.init||this._streamTooltipConfig.prerender||this._streamTooltipConfig.render?this._streamTooltipConfig.init&&this._streamTooltipConfig.init(e.value,t,this._state,i):Wt(t).append("text")}_prerenderStreamTooltip(t,e,i){if(this._streamTooltipConfig.init||this._streamTooltipConfig.prerender||this._streamTooltipConfig.render)return void(this._streamTooltipConfig.prerender&&this._streamTooltipConfig.prerender(e.value,t,this._state,i));const s=this._streamTooltipConfig.text?this._streamTooltipConfig.text(e.value,t,this._state,i):`${this._labelFn(e.value.source,this._state,this)||""} - ${this._labelFn(e.value.target,this._state,this)||""}`;Wt(t).select("text").attr("x",i.viewRect.left).attr("y",i.viewRect.top+12).style("font-size",`${this._style.streams.tooltips.font.size}px`).text(s);const n=Wt(t).select("text").node();Aa(n,this._style.streams.tooltips.maxWidth,1.25*this._style.streams.tooltips.font.size);const r=n.getBoundingClientRect();i.viewRect.setHeight(r.height),i.viewRect.setWidth(r.width)}_renderStreamTooltip(t,e,i){(this._streamTooltipConfig.init||this._streamTooltipConfig.prerender||this._streamTooltipConfig.render)&&this._streamTooltipConfig.render&&this._streamTooltipConfig.render(e.value,t,this._state,i)}}var dh={value:()=>{}};function uh(){for(var t,e=0,i=arguments.length,s={};e<i;++e){if(!(t=arguments[e]+"")||t in s||/[\s.]/.test(t))throw new Error("illegal type: "+t);s[t]=[]}return new _h(s)}function _h(t){this._=t}function ph(t,e){for(var i,s=0,n=t.length;s<n;++s)if((i=t[s]).name===e)return i.value}function fh(t,e,i){for(var s=0,n=t.length;s<n;++s)if(t[s].name===e){t[s]=dh,t=t.slice(0,s).concat(t.slice(s+1));break}return null!=i&&t.push({name:e,value:i}),t}_h.prototype=uh.prototype={constructor:_h,on:function(t,e){var i,s,n=this._,r=(s=n,(t+"").trim().split(/^|\s+/).map((function(t){var e="",i=t.indexOf(".");if(i>=0&&(e=t.slice(i+1),t=t.slice(0,i)),t&&!s.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}}))),a=-1,l=r.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++a<l;)if(i=(t=r[a]).type)n[i]=fh(n[i],t.name,e);else if(null==e)for(i in n)n[i]=fh(n[i],t.name,null);return this}for(;++a<l;)if((i=(t=r[a]).type)&&(i=ph(n[i],t.name)))return i},copy:function(){var t={},e=this._;for(var i in e)t[i]=e[i].slice();return new _h(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var i,s,n=new Array(i),r=0;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(r=0,i=(s=this._[t]).length;r<i;++r)s[r].value.apply(e,n)},apply:function(t,e,i){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var s=this._[t],n=0,r=s.length;n<r;++n)s[n].value.apply(e,i)}};var gh,yh,mh=0,xh=0,vh=0,bh=0,wh=0,Ah=0,kh="object"==typeof performance&&performance.now?performance:Date,Lh="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Sh(){return wh||(Lh(Ch),wh=kh.now()+Ah)}function Ch(){wh=0}function Rh(){this._call=this._time=this._next=null}function Th(t,e,i){var s=new Rh;return s.restart(t,e,i),s}function Mh(){wh=(bh=kh.now())+Ah,mh=xh=0;try{!function(){Sh(),++mh;for(var t,e=gh;e;)(t=wh-e._time)>=0&&e._call.call(void 0,t),e=e._next;--mh}()}finally{mh=0,function(){var t,e,i=gh,s=1/0;for(;i;)i._call?(s>i._time&&(s=i._time),t=i,i=i._next):(e=i._next,i._next=null,i=t?t._next=e:gh=e);yh=t,Dh(s)}(),wh=0}}function zh(){var t=kh.now(),e=t-bh;e>1e3&&(Ah-=e,bh=t)}function Dh(t){mh||(xh&&(xh=clearTimeout(xh)),t-wh>24?(t<1/0&&(xh=setTimeout(Mh,t-kh.now()-Ah)),vh&&(vh=clearInterval(vh))):(vh||(bh=kh.now(),vh=setInterval(zh,1e3)),mh=1,Lh(Mh)))}function $h(t,e,i){var s=new Rh;return e=null==e?0:+e,s.restart((i=>{s.stop(),t(i+e)}),e,i),s}Rh.prototype=Th.prototype={constructor:Rh,restart:function(t,e,i){if("function"!=typeof t)throw new TypeError("callback is not a function");i=(null==i?Sh():+i)+(null==e?0:+e),this._next||yh===this||(yh?yh._next=this:gh=this,yh=this),this._call=t,this._time=i,Dh()},stop:function(){this._call&&(this._call=null,this._time=1/0,Dh())}};var Vh=uh("start","end","cancel","interrupt"),Wh=[];function Eh(t,e,i,s,n,r){var a=t.__transition;if(a){if(i in a)return}else t.__transition={};!function(t,e,i){var s,n=t.__transition;function r(t){i.state=1,i.timer.restart(a,i.delay,i.time),i.delay<=t&&a(t-i.delay)}function a(r){var h,c,d,u;if(1!==i.state)return o();for(h in n)if((u=n[h]).name===i.name){if(3===u.state)return $h(a);4===u.state?(u.state=6,u.timer.stop(),u.on.call("interrupt",t,t.__data__,u.index,u.group),delete n[h]):+h<e&&(u.state=6,u.timer.stop(),u.on.call("cancel",t,t.__data__,u.index,u.group),delete n[h])}if($h((function(){3===i.state&&(i.state=4,i.timer.restart(l,i.delay,i.time),l(r))})),i.state=2,i.on.call("start",t,t.__data__,i.index,i.group),2===i.state){for(i.state=3,s=new Array(d=i.tween.length),h=0,c=-1;h<d;++h)(u=i.tween[h].value.call(t,t.__data__,i.index,i.group))&&(s[++c]=u);s.length=c+1}}function l(e){for(var n=e<i.duration?i.ease.call(null,e/i.duration):(i.timer.restart(o),i.state=5,1),r=-1,a=s.length;++r<a;)s[r].call(t,n);5===i.state&&(i.on.call("end",t,t.__data__,i.index,i.group),o())}function o(){for(var s in i.state=6,i.timer.stop(),delete n[e],n)return;delete t.__transition}n[e]=i,i.timer=Th(r,0,i.time)}(t,i,{name:e,index:s,group:n,on:Vh,tween:Wh,time:r.time,delay:r.delay,duration:r.duration,ease:r.ease,timer:null,state:0})}function Bh(t,e){var i=jh(t,e);if(i.state>0)throw new Error("too late; already scheduled");return i}function Ih(t,e){var i=jh(t,e);if(i.state>3)throw new Error("too late; already running");return i}function jh(t,e){var i=t.__transition;if(!i||!(i=i[e]))throw new Error("transition not found");return i}function Hh(t,e){var i,s;return function(){var n=Ih(this,t),r=n.tween;if(r!==i)for(var a=0,l=(s=i=r).length;a<l;++a)if(s[a].name===e){(s=s.slice()).splice(a,1);break}n.tween=s}}function Nh(t,e,i){var s,n;if("function"!=typeof i)throw new Error;return function(){var r=Ih(this,t),a=r.tween;if(a!==s){n=(s=a).slice();for(var l={name:e,value:i},o=0,h=n.length;o<h;++o)if(n[o].name===e){n[o]=l;break}o===h&&n.push(l)}r.tween=n}}function Oh(t,e,i){var s=t._id;return t.each((function(){var t=Ih(this,s);(t.value||(t.value={}))[e]=i.apply(this,arguments)})),function(t){return jh(t,s).value[e]}}function Fh(t,e){var i;return("number"==typeof e?bs:e instanceof Zi?fs:(i=Zi(e))?(e=i,fs):Ls)(t,e)}function Ph(t){return function(){this.removeAttribute(t)}}function Uh(t){return function(){this.removeAttributeNS(t.space,t.local)}}function qh(t,e,i){var s,n,r=i+"";return function(){var a=this.getAttribute(t);return a===r?null:a===s?n:n=e(s=a,i)}}function Xh(t,e,i){var s,n,r=i+"";return function(){var a=this.getAttributeNS(t.space,t.local);return a===r?null:a===s?n:n=e(s=a,i)}}function Yh(t,e,i){var s,n,r;return function(){var a,l,o=i(this);if(null!=o)return(a=this.getAttribute(t))===(l=o+"")?null:a===s&&l===n?r:(n=l,r=e(s=a,o));this.removeAttribute(t)}}function Gh(t,e,i){var s,n,r;return function(){var a,l,o=i(this);if(null!=o)return(a=this.getAttributeNS(t.space,t.local))===(l=o+"")?null:a===s&&l===n?r:(n=l,r=e(s=a,o));this.removeAttributeNS(t.space,t.local)}}function Zh(t,e){var i,s;function n(){var n=e.apply(this,arguments);return n!==s&&(i=(s=n)&&function(t,e){return function(i){this.setAttributeNS(t.space,t.local,e.call(this,i))}}(t,n)),i}return n._value=e,n}function Kh(t,e){var i,s;function n(){var n=e.apply(this,arguments);return n!==s&&(i=(s=n)&&function(t,e){return function(i){this.setAttribute(t,e.call(this,i))}}(t,n)),i}return n._value=e,n}function Jh(t,e){return function(){Bh(this,t).delay=+e.apply(this,arguments)}}function Qh(t,e){return e=+e,function(){Bh(this,t).delay=e}}function tc(t,e){return function(){Ih(this,t).duration=+e.apply(this,arguments)}}function ec(t,e){return e=+e,function(){Ih(this,t).duration=e}}var ic=Vt.prototype.constructor;function sc(t){return function(){this.style.removeProperty(t)}}var nc=0;function rc(t,e,i,s){this._groups=t,this._parents=e,this._name=i,this._id=s}function ac(){return++nc}var lc=Vt.prototype;rc.prototype={constructor:rc,select:function(t){var e=this._name,i=this._id;"function"!=typeof t&&(t=M(t));for(var s=this._groups,n=s.length,r=new Array(n),a=0;a<n;++a)for(var l,o,h=s[a],c=h.length,d=r[a]=new Array(c),u=0;u<c;++u)(l=h[u])&&(o=t.call(l,l.__data__,u,h))&&("__data__"in l&&(o.__data__=l.__data__),d[u]=o,Eh(d[u],e,i,u,d,jh(l,i)));return new rc(r,this._parents,e,i)},selectAll:function(t){var e=this._name,i=this._id;"function"!=typeof t&&(t=$(t));for(var s=this._groups,n=s.length,r=[],a=[],l=0;l<n;++l)for(var o,h=s[l],c=h.length,d=0;d<c;++d)if(o=h[d]){for(var u,_=t.call(o,o.__data__,d,h),p=jh(o,i),f=0,g=_.length;f<g;++f)(u=_[f])&&Eh(u,e,i,f,_,p);r.push(_),a.push(o)}return new rc(r,a,e,i)},selectChild:lc.selectChild,selectChildren:lc.selectChildren,filter:function(t){"function"!=typeof t&&(t=V(t));for(var e=this._groups,i=e.length,s=new Array(i),n=0;n<i;++n)for(var r,a=e[n],l=a.length,o=s[n]=[],h=0;h<l;++h)(r=a[h])&&t.call(r,r.__data__,h,a)&&o.push(r);return new rc(s,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,i=t._groups,s=e.length,n=i.length,r=Math.min(s,n),a=new Array(s),l=0;l<r;++l)for(var o,h=e[l],c=i[l],d=h.length,u=a[l]=new Array(d),_=0;_<d;++_)(o=h[_]||c[_])&&(u[_]=o);for(;l<s;++l)a[l]=e[l];return new rc(a,this._parents,this._name,this._id)},selection:function(){return new ic(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,i=ac(),s=this._groups,n=s.length,r=0;r<n;++r)for(var a,l=s[r],o=l.length,h=0;h<o;++h)if(a=l[h]){var c=jh(a,e);Eh(a,t,i,h,l,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new rc(s,this._parents,t,i)},call:lc.call,nodes:lc.nodes,node:lc.node,size:lc.size,empty:lc.empty,each:lc.each,on:function(t,e){var i=this._id;return arguments.length<2?jh(this.node(),i).on.on(t):this.each(function(t,e,i){var s,n,r=function(t){return(t+"").trim().split(/^|\s+/).every((function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t}))}(e)?Bh:Ih;return function(){var a=r(this,t),l=a.on;l!==s&&(n=(s=l).copy()).on(e,i),a.on=n}}(i,t,e))},attr:function(t,e){var i=L(t),s="transform"===i?Vs:Fh;return this.attrTween(t,"function"==typeof e?(i.local?Gh:Yh)(i,s,Oh(this,"attr."+t,e)):null==e?(i.local?Uh:Ph)(i):(i.local?Xh:qh)(i,s,e))},attrTween:function(t,e){var i="attr."+t;if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==e)return this.tween(i,null);if("function"!=typeof e)throw new Error;var s=L(t);return this.tween(i,(s.local?Zh:Kh)(s,e))},style:function(t,e,i){var s="transform"==(t+="")?$s:Fh;return null==e?this.styleTween(t,function(t,e){var i,s,n;return function(){var r=st(this,t),a=(this.style.removeProperty(t),st(this,t));return r===a?null:r===i&&a===s?n:n=e(i=r,s=a)}}(t,s)).on("end.style."+t,sc(t)):"function"==typeof e?this.styleTween(t,function(t,e,i){var s,n,r;return function(){var a=st(this,t),l=i(this),o=l+"";return null==l&&(this.style.removeProperty(t),o=l=st(this,t)),a===o?null:a===s&&o===n?r:(n=o,r=e(s=a,l))}}(t,s,Oh(this,"style."+t,e))).each(function(t,e){var i,s,n,r,a="style."+e,l="end."+a;return function(){var o=Ih(this,t),h=o.on,c=null==o.value[a]?r||(r=sc(e)):void 0;h===i&&n===c||(s=(i=h).copy()).on(l,n=c),o.on=s}}(this._id,t)):this.styleTween(t,function(t,e,i){var s,n,r=i+"";return function(){var a=st(this,t);return a===r?null:a===s?n:n=e(s=a,i)}}(t,s,e),i).on("end.style."+t,null)},styleTween:function(t,e,i){var s="style."+(t+="");if(arguments.length<2)return(s=this.tween(s))&&s._value;if(null==e)return this.tween(s,null);if("function"!=typeof e)throw new Error;return this.tween(s,function(t,e,i){var s,n;function r(){var r=e.apply(this,arguments);return r!==n&&(s=(n=r)&&function(t,e,i){return function(s){this.style.setProperty(t,e.call(this,s),i)}}(t,r,i)),s}return r._value=e,r}(t,e,null==i?"":i))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(Oh(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,function(t){var e,i;function s(){var s=t.apply(this,arguments);return s!==i&&(e=(i=s)&&function(t){return function(e){this.textContent=t.call(this,e)}}(s)),e}return s._value=t,s}(t))},remove:function(){return this.on("end.remove",function(t){return function(){var e=this.parentNode;for(var i in this.__transition)if(+i!==t)return;e&&e.removeChild(this)}}(this._id))},tween:function(t,e){var i=this._id;if(t+="",arguments.length<2){for(var s,n=jh(this.node(),i).tween,r=0,a=n.length;r<a;++r)if((s=n[r]).name===t)return s.value;return null}return this.each((null==e?Hh:Nh)(i,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?Jh:Qh)(e,t)):jh(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?tc:ec)(e,t)):jh(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(function(t,e){if("function"!=typeof e)throw new Error;return function(){Ih(this,t).ease=e}}(e,t)):jh(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var i=e.apply(this,arguments);if("function"!=typeof i)throw new Error;Ih(this,t).ease=i}}(this._id,t))},end:function(){var t,e,i=this,s=i._id,n=i.size();return new Promise((function(r,a){var l={value:a},o={value:function(){0==--n&&r()}};i.each((function(){var i=Ih(this,s),n=i.on;n!==t&&((e=(t=n).copy())._.cancel.push(l),e._.interrupt.push(l),e._.end.push(o)),i.on=e})),0===n&&r()}))},[Symbol.iterator]:lc[Symbol.iterator]};var oc={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function hc(t,e){for(var i;!(i=t.__transition)||!(i=i[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return i}Vt.prototype.interrupt=function(t){return this.each((function(){!function(t,e){var i,s,n,r=t.__transition,a=!0;if(r){for(n in e=null==e?null:e+"",r)(i=r[n]).name===e?(s=i.state>2&&i.state<5,i.state=6,i.timer.stop(),i.on.call(s?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete r[n]):a=!1;a&&delete t.__transition}}(this,t)}))},Vt.prototype.transition=function(t){var e,i;t instanceof rc?(e=t._id,t=t._name):(e=ac(),(i=oc).time=Sh(),t=null==t?null:t+"");for(var s=this._groups,n=s.length,r=0;r<n;++r)for(var a,l=s[r],o=l.length,h=0;h<o;++h)(a=l[h])&&Eh(a,t,e,h,l,i||hc(a,e));return new rc(s,this._parents,t,e)};class cc extends Ea{constructor(t){super(t),this.style({treemap:{paddingInner:1,customize:()=>{},tilingScheme:"squarify",tilingColumns:null},labels:{font:{size:12},margin:{left:5,top:5,right:5,bottom:5},hideOnOverflow:!0,truncateText:"…",truncatedLabelMinLen:3,customize:()=>{}},valueLabels:{show:!1,position:"right",font:{size:12},margin:{left:5,top:5,right:5,bottom:5},hideOnOverflow:!0,truncateText:"…",truncatedLabelMinLen:3,customize:()=>{}},tooltips:{maxWidth:300,font:{size:12},customize:()=>{}},header:{padding:{bottom:3},font:{size:12,weight:400,color:"#757575"},label:()=>{},separator:()=>{}},zoomHint:{show:!0,color:"#ffffff66"}}),this.defineDefaults({height:500,rootLabel:null}),this._zoomable=!1,this._valueFn=(t,e)=>t.value||0,this._labelFn=(t,e)=>t.data.name||"",this._valueLabelFn=(t,e)=>t.value||0,this._rectColorFn=(t,e)=>t.data.color||"#006699",this._labelColorFn=(t,e)=>t.data.labelColor||"#fff",this._aggregationOptions={aggregate:!1,threshold:0,minDepth:0},this._sortValueFn=t=>t.value,this._sortOrder="desc",this._aggregationDecisionFn=(t,e,i)=>!0===this._aggregationOptions.aggregate&&t.value<=this._aggregationOptions.threshold&&i>=this._aggregationOptions.minDepth,this._aggregationFn=(t,e,i)=>({label:"Other values",value:t.value+e.value}),this._tooltip=null,this._tooltipConfig={enabled:!0,text:null,init:null,prerender:null,render:null}}height(t){return this._height=t,this}zoomable(t){return this._zoomable=void 0===t,this}value(t){return this._valueFn=t,this}label(t){return this._labelFn=t,this}valueLabel(t){return this._valueLabelFn=t,this}rectColor(t){return this._rectColorFn=t,this}labelColor(t){return this._labelColorFn=t,this}sortValue(t,e="asc"){return this._sortValueFn=t,this._sortOrder=e,this}aggregate(t,e){return"function"==typeof t?(this._aggregationDecisionFn=t,this._aggregationOptions.aggregate=!0):(Object.keys(t).forEach((e=>{this._aggregationOptions[e]=t[e]})),Object.prototype.hasOwnProperty.call(t,"aggregate")||(this._aggregationOptions.aggregate=!0)),e&&(this._aggregationFn=e),this}tooltips(t){for(const e in this._tooltipConfig)this._tooltipConfig[e]=t[e]||this._tooltipConfig[e];return this}init(t,e){super.init(t,e),t.classList.add("dv_treemap"),Wt(t).append("g").attr("class","dv_treemapHeader"),Wt(t).append("g").attr("class","dv_treemapWrapper"),Wt(t).select("g.dv_treemapWrapper").append("g").attr("class","dv_rects"),Wt(t).select("g.dv_treemapWrapper").append("g").attr("class","dv_labels"),Wt(t).select("g.dv_treemapWrapper").append("g").attr("class","dv_valueLabels"),Wt(t).select("g.dv_treemapWrapper").append("g").attr("class","dv_zoomHint"),Wt(t).select("g.dv_treemapWrapper").append("g").attr("class","dv_interaction dv_noprint").style("fill-opacity",0),this._tooltipConfig.enabled&&(this._tooltip=new Za,this._style.tooltips.customize(this._tooltip,e,this),this._tooltip.on("init",this._initTooltip.bind(this)).on("prerender",this._prerenderTooltip.bind(this)).on("render",this._renderTooltip.bind(this)))}prerender(t,e){if(super.prerender(t,e),!this.datasource||this.datasource.loaded){if(this.emit("prerenderWillStart",[t,e,this]),this._zoomable&&void 0!==e.zoomLevel&&void 0!==e.treemapSelection){if(Object.keys(e).filter((t=>t.startsWith("treemapZoomLevel_"))).length<=1){const t={};return t[`treemapZoomLevel_${this.id}`]=e.zoomLevel,t[`treemapSelection_${this.id}`]=e.treemapSelection,t.zoomLevel=void 0,t.treemapSelection=void 0,void this.setState(t)}console.warn("[Treemap] zoomLevel and treemapSelection states don't work with multiple treemaps")}if(this._zoomable&&void 0===e[`treemapZoomLevel_${this.id}`]){const t={};return t[`treemapZoomLevel_${this.id}`]=1,t[`treemapSelection_${this.id}`]=null,void this.setState(t)}if(this._tree=this.transformedData(e),this._tree=this._computeTreemapValues(this._tree),this._aggregationOptions.aggregate&&(this._tree=this._aggregateTree(this._tree,this._aggregationDecisionFn)),this._tree=this._cleanIntermediaryTreemapValues(this._tree),this._state[`treemapSelection_${this.id}`]&&(this._tree=this._state[`treemapSelection_${this.id}`]),this._root=wo(this._tree).sum((t=>t.value)).sort(((t,e)=>(e.data.hasBeenAggregated?-1:this._sortValueFn("asc"===this._sortOrder?t:e))-(t.data.hasBeenAggregated?-1:this._sortValueFn("asc"===this._sortOrder?e:t)))),this._computeAggregatedNodes(this._root),this._zoomable){this._headerLevels=[];let e=this._tree;for(;e.depth>0;)this._headerLevels.unshift(e),e=e.parent;this._headerLevels.unshift(e);const i=this._headerLevels.map(((t,e)=>this._style.header.label(t,this._state,this,e+1)||(0===t.depth?this._rootLabel||t.key||t.name:t.key||t.name))),s=this._headerLevels.slice(1).map(((t,e)=>this._style.header.separator(t,this._state,this,e+1)||" > ")),n="<text>"+i.map(((t,e)=>`<a idx="${e}">${t}</a>${s[e]||""}`)).join("")+"</text>",r=new Se({width:this.viewRect.width(),fontSize:this._style.header.font.size,fontWeight:this._style.header.font.weight,linkColor:this._style.header.font.color});r.handleClickOnLink=this._handleHeaderClick.bind(this),r.render(n,Wt(t).select(".dv_treemapHeader").node(),{})}this._headerHeight=Wt(t).select(".dv_treemapHeader").node().getBoundingClientRect().height+this._style.header.padding.bottom,this.viewRect.setHeight(("function"==typeof this._height?this._height(this,e):this._height)+this._headerHeight),Wt(t).select(".dv_treemapHeader").call($e(this.viewRect.left,this.viewRect.top)),Wt(t).select(".dv_treemapWrapper").call($e(this.viewRect.left,this.viewRect.top+this._headerHeight)),this.emit("prerenderDidEnd",[t,e,this])}else console.info("Rendering of control postponed. Datasource not yet ready.")}render(t,e){if(!this.datasource.loaded)return;this.emit("renderWillStart",[t,e,this]),super.render(t,e),Eo().tile(((t,e,i,s,n)=>{if("squarify"===this._style.treemap.tilingScheme)return Io(t,e,i,s,n);!function(t,e,i,s,n,r=null){const a=(s-e)*(n-i),l=a/t.value,o=t.children.map((t=>l*t.value));let h=r||1,[c,d]=dc(h,o,s-e,n-i);if(!r)for(let r=2;r<t.children.length;r++){const[t,a]=dc(r,o,s-e,n-i);if(!(t<c))break;c=t,d=a,h=r}let u=0,_=0;for(let e=0;e<d.length;e++){const s=d[e],r=s.reduce(((t,e)=>t+e))/(n-i);let a=0;for(let e=0;e<s.length;e++){const i=t.children[u];i.x0=_,i.x1=_+r,i.y0=a,i.y1=a+s[e]/r,a+=s[e]/r,u+=1}_+=r}}(t,e,i,s,n,this._(this._style.treemap.tilingColumns,{width:s-e,height:n-n,node:t},this._state,this))})).size([this.viewRect.width(),this.viewRect.height()-this._headerHeight]).paddingInner(this._style.treemap.paddingInner).round(!0)(this._root);const i=this._zoomable?this._root.children:this._root.leaves();let s=Wt(t).select(".dv_treemapWrapper").select(".dv_rects").selectAll("rect").data(i).join("rect").style("fill",(t=>this._rectColorFn(t,e))).on("click",this._handleTreemapClick.bind(this));this._renderedOnce&&(this._tooltip.hide(),s=s.transition()),s.attr("x",(t=>t.x0)).attr("y",(t=>t.y0)).attr("width",(t=>t.x1-t.x0)).attr("height",(t=>t.y1-t.y0)),this._renderedOnce=!0,this._style.treemap.customize(s,e,this);const n=Wt(t).select(".dv_treemapWrapper").select(".dv_labels").selectAll("text").data(i).join("text").attr("x",(t=>t.x0+this._style.labels.margin.left)).attr("y",(t=>t.y0+this._style.labels.margin.top+this._style.labels.font.size)).style("fill",(t=>this._labelColorFn(t,e))).style("font-size",`${this._style.labels.font.size}px`);Wt(t).select(".dv_treemapWrapper").select(".dv_labels").selectAll("text").data(i).each(((t,i,s)=>{s[i].classList.remove("dv_hidden");let n=this._labelFn(t,e);if("string"==typeof n&&(n=[n]),n){const e=this._style.labels,r=e.margin,a=t.x1-t.x0-r.left-r.right,l=t.y1-t.y0-r.top-r.bottom;ka(n,s[i],a,l,e.hideOnOverflow?null:e.truncateText,e.truncatedLabelMinLen)||s[i].classList.add("dv_hidden")}}));let r=null;!0===this._style.valueLabels.show&&(r=Wt(t).select(".dv_treemapWrapper").select(".dv_valueLabels").selectAll("text").data(i).join("text").attr("x",(t=>{let e=this._zoomable&&this._style.zoomHint.show?22:0;return t.children&&t.children.length>0||(e=0),"left"===this._style.valueLabels.position?t.x0+this._style.valueLabels.margin.left:t.x1-this._style.valueLabels.margin.right-e})).attr("y",(t=>t.y1-this._style.valueLabels.margin.bottom)).attr("text-anchor","left"===this._style.valueLabels.position?"start":"end").style("fill",(t=>this._labelColorFn(t,e))).style("font-size",`${this._style.valueLabels.font.size}px`),Wt(t).select(".dv_treemapWrapper").select(".dv_valueLabels").selectAll("text").data(i).each(((t,i,s)=>{s[i].classList.remove("dv_hidden");let n=this._valueLabelFn(t,e);!1===Array.isArray(n)&&(n=[n]);const r=this._style.valueLabels,a=r.margin,l=this._zoomable&&this._style.zoomHint.show?22:0,o=t.x1-t.x0-a.left-a.right-l,h=t.y1-t.y0-a.top-a.bottom-this._style.labels.margin.top-this._style.labels.font.size-this._style.labels.margin.bottom;ka(n,s[i],o,h,r.hideOnOverflow?null:r.truncateText,r.truncatedLabelMinLen)||s[i].classList.add("dv_hidden")}))),this._style.labels.customize(n,e,this),!0===this._style.valueLabels.show&&this._style.valueLabels.customize(r,e,this),this._zoomable&&this._style.zoomHint.show&&Wt(t).select(".dv_treemapWrapper").select(".dv_zoomHint").selectAll("text").data(i).join("text").attr("x",(t=>t.x1-7)).attr("y",(t=>t.y1-7)).style("fill",(t=>this._(this._style.zoomHint.color,t,e,this))).style("text-anchor","end").text((t=>"+")).classed("dv_hidden",(t=>!(t.children&&t.children.length>0)||(t.y1-t.y0<30||t.x1-t.x0<22))),this._tooltipConfig.enabled&&Wt(t).select(".dv_treemapWrapper").select(".dv_interaction").selectAll("rect").data(i).join("rect").attr("x",(t=>t.x0)).attr("y",(t=>t.y0)).attr("width",(t=>t.x1-t.x0)).attr("height",(t=>t.y1-t.y0)).on("click",this._handleTreemapClick.bind(this)).classed("dv_zoomable",(t=>t.children&&t.children.length>0)).call(this._tooltip.bindTooltip()),this.emit("renderDidEnd",[t,e,this])}_defaultTooltipText(t){const e=this._labelFn(t,this._state),i=t.value;return`${"string"==typeof e?e:e[0]}\n${i}`}_initTooltip(t,e,i){this._tooltipConfig.init||this._tooltipConfig.prerender||this._tooltipConfig.render?this._tooltipConfig.init&&this._tooltipConfig.init(e,t,this._state,i):Wt(t).append("text")}_prerenderTooltip(t,e,i){if(this._tooltipConfig.init||this._tooltipConfig.prerender||this._tooltipConfig.render)return void(this._tooltipConfig.prerender&&this._tooltipConfig.prerender(e,t,this._state,i));const s=this._tooltipConfig.text?this._tooltipConfig.text(e.value,t,this._state,i):this._defaultTooltipText(e.value);Wt(t).select("text").attr("x",i.viewRect.left).attr("y",i.viewRect.top+12).style("font-size",`${this._style.tooltips.font.size}px`).text(s);const n=Wt(t).select("text").node();Aa(n,this._style.tooltips.maxWidth,1.25*this._style.tooltips.font.size);const r=n.getBoundingClientRect();i.viewRect.setHeight(r.height),i.viewRect.setWidth(r.width)}_renderTooltip(t,e,i){(this._tooltipConfig.init||this._tooltipConfig.prerender||this._tooltipConfig.render)&&this._tooltipConfig.render&&this._tooltipConfig.render(e.value,t,this._state,i)}_computeTreemapValues(t){return t.value=this._valueFn(t,this._state),t.children&&t.children.forEach((t=>this._computeTreemapValues(t,this._state))),t}_computeAggregatedNodes(t){if(t.data.aggregatedChildren){const e=t.data.aggregatedChildren.reduce(((e,i)=>this._aggregationFn(e,i,this._state,t)));Object.assign(t.data,e)}t.data._value=t.value,t.children&&t.children.forEach((t=>this._computeAggregatedNodes(t)))}_cleanIntermediaryTreemapValues(t,e=0){return t.depth=e,t.children&&(t.value=void 0,t.children.forEach((i=>{i.parent=t,this._cleanIntermediaryTreemapValues(i,e+1)}))),t}_computeNodeSums(t){console.log("leaves",t)}_handleTreemapClick(t,e){if(this._zoomable&&e.children){const t={};t[`treemapZoomLevel_${this.id}`]=this._state[`treemapZoomLevel_${this.id}`]+1,t[`treemapSelection_${this.id}`]=e.data,this.setState(t)}}_handleHeaderClick(t){const e=+t.getAttribute("idx"),i=this._headerLevels[e];if(i.depth!==this._state[`treemapZoomLevel_${this.id}`]){const t={};t[`treemapZoomLevel_${this.id}`]=i.depth+1,t[`treemapSelection_${this.id}`]=i,this.setState(t)}return!1}_aggregateTree(t,e){return this._aggregationDecision(t,e),this._aggregateChildren(t)}_aggregationDecision(t,e,i=0){t.aggregate=e(t,this._state,i),t.children&&t.children.forEach((t=>{this._aggregationDecision(t,e,i+1)}))}_aggregateChildren(t){const e={};for(const i in t)"children"!==i&&(e[i]=t[i]);if(t.children&&t.children.some((t=>!1===t.aggregate))){e.children=[];const i=[];t.children.forEach((t=>{t.aggregate?i.push(t):e.children.push(this._aggregateChildren(t))})),i.length>0&&e.children.push({aggregate:!1,hasBeenAggregated:!0,aggregatedChildren:i,value:i.map((t=>t.value)).reduce(((t,e)=>t+e))})}return e}}function dc(t,e,i,s){const n=i/t,r=Array(t).fill(0).map((t=>[])),a=Array(t);let l=0,o=0;for(let i=0;i<t;i++){let h=0;for(;h<s&&l<e.length;){const t=e[l];h+=t/n,l++,r[i].push(t)}h-s>e[l-1]/n/2&&i<t-2&&r[i].length>0&&(r[i].splice(-1),h-=e[l-1]/n,l--),a[i]=h*n/s,o+=r[i].map((t=>{const e=a[i],s=t/e;return Math.max(e/s,s/e)})).reduce(((t,e)=>t+e))}return[o,r]}class uc extends Ea{constructor(){super({hasChartArea:!1}),this._categories=null,this._values=null,this._labels=null,this._colors=["#728cd7","#4f25d2","#cd35ab","#f56a00","#dc0018","#399D50","#a332de","#00a2b9","#8e8e8e"],this._size=400,this._infoLabel=null,this._d={data:null,categories:null,indexedValues:null,values:null,labels:null,colors:null,infoLabel:null},this._c={donut:null,donutData:null,formattedValues:null,innerRadius:null,size:null},this.style({donut:{stroke:{width:1,color:"#fff"},innerRadius:.6},label:{show:!0,font:{size:12,color:"#fff",weight:400}},value:{format:t=>Number.isInteger(t)?t:t.toFixed(1)},infoLabel:{show:!0,font:{size:12,color:"#000",weight:400}}}),this.defaultLabel='\n      <text textAlign="center">\n        <p><b>{{category}}</b></p>\n        <p>{{formattedValue}}</p>\n      </text>'}categories(t){return this._categories=t,this}values(t){return this._values=t,this}labels(t){return this._labels=t,this}colors(t){return this._colors=t,this}size(t){return this._size=t,this}infoLabel(t){return this._infoLabel=t,this}init(t,e){super.init(t,e),t.classList.add("dv_donutChart"),Wt(t).append("g").attr("class","dv_infoLabel"),Wt(t).append("g").attr("class","dv_donuts"),Wt(t).append("g").attr("class","dv_labels")}prerender(t,e){super.prerender(t,e),this.datasource.loaded?(this.emit("prerenderWillStart",[t,e,this]),this._state=e,this.extractData(),this._c.size=this._(this._size,{...this._d,width:this.viewRect.width()},e,this),this._c.innerRadius=this._style.donut.innerRadius<=1?this._c.size/2*this._style.donut.innerRadius:this._style.donut.innerRadius,this._prerenderInfoLabel(t,e),this._prerenderDonut(t,e),this._prerenderLabels(t,e),this.viewRect.setHeight(this._c.size),this.emit("prerenderDidEnd",[t,e,this])):console.info("Rendering of chart postponed. Datasource not yet ready.")}_prerenderInfoLabel(t,e){const i=this._style.infoLabel;if(!this._d.infoLabel||!i.show)return;new Se({fontSize:i.font.size,fontWeight:i.font.weight,fontColor:i.font.color}).render(this._d.infoLabel,t.querySelector(".dv_infoLabel"),null,null,{width:this._c.innerRadius,textAlign:"center"})}_prerenderDonut(t,e){this._c.donut=Bl().sort(((t,e)=>t.idx-e.idx)).value((t=>Math.abs(t.value))),this._c.donutData=this._c.donut(this._d.indexedValues)}_prerenderLabels(t,e){this._c.formattedValues=this._d.values.map(((t,i)=>this._style.value.format(Math.abs(t),{data:this._d.data,category:this._d.categories[i],color:this._d.colors[i]},e,this)));const i=this._style.label,s=new Se({fontSize:i.font.size,fontWeight:i.font.weight,fontColor:i.font.color});Wt(t).select(".dv_labels").selectAll("g.dv_labelWrapper").data(this._d.labels).join("g").attr("class","dv_labelWrapper").each(((t,i,n)=>{if(!1===this._(this._style.label.show,{value:this._d.values[i],formattedValue:this._c.formattedValues[i],category:this._d.categories[i],color:this._d.colors[i],state:e},e,this))return void(n[i].style.display="none");const r=this._c.size/2;s.render(t,n[i],{value:this._d.values[i],formattedValue:this._c.formattedValues[i],category:this._d.categories[i],color:this._d.colors[i],state:e},null,{width:r,textAlign:"center"})}))}render(t,e){this.datasource.loaded&&(this.emit("renderWillStart",[t,e,this]),super.render(t,e),this._renderInfoLabel(t,e),this._renderDonut(t,e),this._renderLabels(t,e),this.emit("renderDidEnd",[t,e,this]))}_renderInfoLabel(t,e){const i=t.querySelector(".dv_infoLabel"),s=i.getBBox(),n=this.viewRect.centerX()-s.x-s.width/2,r=this.viewRect.centerY()-s.y-s.height/2;i.setAttribute("transform",`translate(${n} ${r})`)}_renderDonut(t,e){const i=Sl().innerRadius(this._c.innerRadius).outerRadius(this._c.size/2);Wt(t).select(".dv_donuts").selectAll("path").data(this._c.donutData).join("path").attr("d",i).attr("fill",((t,e)=>this._d.colors[e])).attr("stroke",this._style.donut.stroke.color).attr("stroke-width",this._style.donut.stroke.width).attr("transform",`translate(${this.viewRect.centerX()} ${this._c.size/2})`)}_renderLabels(t,e){const i=this._c.donutData.map(((t,e)=>{const i=Sl().innerRadius(this._style.donut.innerRadius<=1?this._c.size/2*this._style.donut.innerRadius:this._style.donut.innerRadius).outerRadius(this._c.size/2).centroid(t);return{x:i[0]+this.viewRect.centerX(),y:i[1]+this.viewRect.centerY()}}));Wt(t).select(".dv_labels").selectAll("g.dv_labelWrapper").each(((t,e,s)=>{const n=s[e].getBBox(),r=i[e].x-n.x-n.width/2,a=i[e].y-n.y-n.height/2;s[e].setAttribute("transform",`translate(${r} ${a})`)}))}extractData(){this._d.data=this.transformedData(this._state),this._d.values=this._(this._values,this._d.data,this._state,this);let t=0,e=this._d.values.length-1;this._d.indexedValues=this._d.values.map((i=>i>=0?{value:i,idx:t++}:{value:i,idx:e--})),this._d.categories=this._(this._categories,this._d.data,this._state,this),this._d.colors=this._(this._colors,this._d.data,this._state,this),null===this._labels||void 0===this._labels?this._d.labels=this.defaultLabel:this._d.labels=this._(this._labels,{data:this._d.data,values:this._d.values,categories:this._d.categories},this._state,this),this._d.infoLabel=this._(this._infoLabel,{data:this._d.data,values:this._d.values,categories:this._d.categories,labels:this._d.labels},this._state,this),"string"==typeof this._d.labels&&(this._d.labels=this._d.values.map((()=>this._d.labels)))}}class _c{constructor(t){this.start=t.start,this.move=t.move,this.end=t.end,this.rateLimit=t.rateLimit||0,this.lastEvent=Date.now()-this.rateLimit}bind(){const t=this,e=function(){};return e.apply=function(e,i){const s=i[0];t.attach(s)},e}attach(t){t.on("mouseenter",this.handleStart.bind(this)).on("mousemove",this.handleMove.bind(this)).on("mouseout",this.handleEnd.bind(this)),t.each(((t,e,i)=>{i[e].__idx__=e}))}handleStart(t){this.executeEvent(this.start,t)}handleMove(t){Date.now()-this.lastEvent>=this.rateLimit&&(this.executeEvent(this.move,t),this.lastEvent=Date.now())}handleEnd(t){this.executeEvent(this.end,t)}executeEvent(t,e){const i=co(e),s=this.extractDataForEvent(e);e.data=s,i.data=s,t&&t(e,i,s)}extractDataForEvent(t){return{value:t.target.__data__,idx:t.target.__idx__}}}class pc extends Ea{constructor(){super({hasChartArea:!1}),this._categories=null,this._values=null,this._labels=null,this._colors=["#728cd7","#4f25d2","#cd35ab","#f56a00","#dc0018","#399D50","#a332de","#00a2b9","#8e8e8e"],this._size=400,this._tooltips={enabled:!1,text:()=>this.defaultTooltipText},this._d={data:null,categories:null,values:null,labels:null,colors:null},this._c={pie:null,pieData:null,formattedValues:null,formattedTooltipValues:null,radius:null,size:null,outsideLabelsHidden:!1,tooltip:null},this._s={fitRuns:null},this.style({pie:{stroke:{width:1,color:"#fff"},minSize:100},label:{placement:"inside",font:{size:12,color:"#fff",weight:400},width:(t,e,i)=>.7*t.radius},value:{format:t=>Number.isInteger(t)?t:t.toFixed(1)},tooltip:{value:{format:t=>Number.isInteger(t)?t:t.toFixed(1)},font:{size:12,color:"#000",weight:400},maxWidth:300}}),this.defaultLabel='\n      <text textAlign="center">\n        <p><b>{{{category}}}</b></p>\n        <p>{{{formattedValue}}}</p>\n      </text>',this.defaultTooltipText="\n      <text>\n        <p><b>{{{category}}}</b></p>\n        <p>{{{formattedValue}}}</p>\n      </text>\n    "}categories(t){return this._categories=t,this}values(t){return this._values=t,this}labels(t){return this._labels=t,this}colors(t){return this._colors=t,this}size(t){return this._size=t,this}tooltips(t){return void 0!==t.enabled&&(this._tooltips.enabled=t.enabled),void 0!==t.text&&(this._tooltips.text=t.text),this}init(t,e){super.init(t,e),t.classList.add("dv_pieChart"),Wt(t).append("g").attr("class","dv_pies"),Wt(t).append("g").attr("class","dv_labels"),this._createTootlip()}_createTootlip(){this._c.tooltip=new Za,this._c.tooltip.on("init",this._initTooltip.bind(this)).on("prerender",this._prerenderTooltip.bind(this)).on("render",this._renderTooltip.bind(this))}prerender(t,e){super.prerender(t,e),this.datasource.loaded?(this.emit("prerenderWillStart",[t,e,this]),this._state=e,this.extractData(),this._c.size=this._(this._size,{...this._d,width:this.viewRect.width()},e,this),this._c.radius=this._c.size/2,this._prerenderPie(t,e),this._prerenderLabels(t,e),this.viewRect.setHeight(this._c.size),this.emit("prerenderDidEnd",[t,e,this])):console.info("Rendering of chart postponed. Datasource not yet ready.")}extractData(){this._d.data=this.transformedData(this._state),this._d.values=this._(this._values,this._d.data,this._state,this),this._d.categories=this._(this._categories,this._d.data,this._state,this),this._d.colors=this._(this._colors,this._d.data,this._state,this),null===this._labels||void 0===this._labels?this._d.labels=this.defaultLabel:this._d.labels=this._(this._labels,{data:this._d.data,values:this._d.values,categories:this._d.categories},this._state,this),"string"==typeof this._d.labels&&(this._d.labels=this._d.values.map((()=>this._d.labels)))}_prerenderPie(t,e){this._c.pie=Bl().value((t=>t)),this._c.pieData=this._c.pie(this._d.values)}_prerenderLabels(t,e){this._c.formattedValues=this._d.values.map(((t,i)=>this._style.value.format(t,{data:this._d.data,category:this._d.categories[i],color:this._d.colors[i]},e,this))),this._c.formattedTootlipValues=this._d.values.map(((t,i)=>this._style.tooltip.value.format(t,{data:this._d.data,category:this._d.categories[i],color:this._d.colors[i]},e,this))),Wt(t).select(".dv_labels").style("display",null),"inside"===this._style.label.placement?this._prerenderInsideLabels(t,e):this._prerenderOutsideLabels(t,e)}_prerenderInsideLabels(t,e){const i=this._style.label,s=new Se({fontSize:i.font.size,fontWeight:i.font.weight,fontColor:i.font.color});Wt(t).select(".dv_labels").selectAll("g.dv_labelWrapper").data(this._d.labels).join("g").attr("class","dv_labelWrapper").each(((t,i,n)=>{const r="number"==typeof t?this._c.formattedValues[i]:t,a=this._c.radius;s.render(r,n[i],{value:this._d.values[i],formattedValue:this._c.formattedValues[i],category:this._d.categories[i],color:this._d.colors[i],state:e},null,{width:a,textAlign:"center"})}))}_prerenderOutsideLabels(t,e){const i=this._style.label,s=new Se({fontSize:i.font.size,fontWeight:i.font.weight,fontColor:i.font.color});Wt(t).select(".dv_labels").selectAll("g.dv_labelWrapper").data(this._d.labels).join("g").attr("class","dv_labelWrapper").each(((t,i,n)=>{const r=this._c.pieData[i],a=.5*(r.startAngle+r.endAngle),l=a>=0&&a<Math.PI?"left":"right",o=this._(this._style.label.width,{data:t,idx:i,node:n[i],radius:this._c.radius,chartWidth:this.viewRect.width()},e,this);s.render(t,n[i],{value:this._d.values[i],formattedValue:this._c.formattedValues[i],category:this._d.categories[i],color:this._d.colors[i],state:e},null,{width:o,textAlign:l})}))}render(t,e){if(!this.datasource.loaded)return;this.emit("renderWillStart",[t,e,this]),super.render(t,e),this._renderPie(t,e),"inside"===this._style.label.placement?this._renderInsideLabels(t,e):this._renderOutsideLabels(t,e),this._c.outsideLabelsHidden=!1,this._s.fitRuns=0,this._fitViewRect(t,e);const i=t.getBBox(),s=(this.viewRect.width()-i.width)/2,n=(this.viewRect.height()-i.height)/2,r=s-i.x,a=n-i.y;t.setAttribute("transform",`translate(${r} ${a})`),this.emit("renderDidEnd",[t,e,this])}_fitViewRect(t,e){const i=t.getBBox();if(this.viewRect.height()>=i.height&&this.viewRect.width()>=i.width)return;const s=Math.max(0,i.width-this.viewRect.width()+5),n=Math.max(0,i.height-this.viewRect.height()+5),r=Math.max(s,n);if(this._c.radius=Math.max(this._style.pie.minSize/2,Math.ceil(this._c.radius-r/2)),this._renderPie(t,e),"inside"===this._style.label.placement?this._renderInsideLabels(t,e):this._renderOutsideLabels(t,e),this._s.fitRuns+=1,this._s.fitRuns<3)this._fitViewRect(t);else if("outside"===this._style.label.placement){this._c.outsideLabelsHidden=!0;"none"!==Wt(t).select(".dv_labels").style("display")&&(Wt(t).select(".dv_labels").style("display","none"),this._c.radius=this._c.size/2,this._renderPie(t,e))}}_renderPie(t,e){const i=new _c({start:(t,i,s)=>{(this._(this._tooltips.enabled,s,e,this)||this._c.outsideLabelsHidden)&&this._c.tooltip.show(t)},move:(t,i,s)=>{(this._(this._tooltips.enabled,s,e,this)||this._c.outsideLabelsHidden)&&this._c.tooltip.move(t)},end:(t,e,i)=>{this._c.tooltip.hide(t)}});Wt(t).select(".dv_pies").selectAll("path").data(this._c.pieData).join("path").attr("d",Sl().innerRadius(0).outerRadius(this._c.radius)).attr("fill",((t,e)=>this._d.colors[e])).attr("stroke",this._style.pie.stroke.color).attr("stroke-width",this._style.pie.stroke.width).attr("transform",`translate(${this.viewRect.centerX()} ${this.viewRect.centerY()})`).call(i.bind())}_renderInsideLabels(t,e){const i=this._c.pieData.map(((t,e)=>{const i=Sl().innerRadius(0).outerRadius(this._c.radius).centroid(t);return{slice:{origin:{x:this.viewRect.centerX(),y:this.viewRect.centerY()},startAngle:t.startAngle,endAngle:t.endAngle,radius:this._c.radius},label:{center:{x:i[0]+this.viewRect.centerX(),y:i[1]+this.viewRect.centerY()}}}}));Wt(t).select(".dv_labels").selectAll("g.dv_labelWrapper").each(((t,e,s)=>{s[e].style.display="block";const n=s[e].getBBox(),r=i[e].label.center.x-n.x-n.width/2,a=i[e].label.center.y-n.y-n.height/2,l=i[e].slice;s[e].setAttribute("transform",`translate(${r} ${a})`);const o={x:i[e].label.center.x-n.width/2,y:i[e].label.center.y-n.height/2,width:n.width,height:n.height};s[e].style.display=function(t,e){const i=[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}],s=e.startAngle,n=e.endAngle,r=e.radius;for(const t of i){const i=t.x-e.origin.x,a=t.y-e.origin.y;if(Math.sqrt(i*i+a*a)>r)return!1;let l=Math.atan2(a,i)+Math.PI/2;if(l<0&&(l+=2*Math.PI),l>2*Math.PI&&(l-=2*Math.PI),!(s<=l&&l<=n))return!1}return!0}(o,l)?"block":"none"}))}_renderOutsideLabels(t,e){Wt(t).select(".dv_labels").selectAll("g.dv_labelLine").data(this._c.pieData).join("g").attr("class","dv_labelLine").call((e=>{this._fitOutsideLabels(e.data(),e.nodes(),t.querySelectorAll(".dv_labelWrapper"))}))}_fitOutsideLabels(t,e,i){const s=t.length,n={y:null,dx:null},r=this.viewRect.centerX(),a=this.viewRect.centerY(),l=this._c.radius;for(let o=0;o<s;o++){const s=t[o],h=e[o],c=i[o];c.setAttribute("transform","translate(0 0)");const d=c.getBBox(),u=.5*(s.startAngle+s.endAngle),_={x:Math.sin(u),y:-1*Math.cos(u)},p=u>=0&&u<Math.PI?1:-1,f=n.y+p*(d.height+6),g=a+1.1*l*_.y,y=p<0?Math.min(f,g):Math.max(f,g),m=[];m.push({x:r+.75*l*_.x,y:a+.75*l*_.y}),m.push({x:r+1.1*l*_.x,y:y}),m.push({x:p<0?r-l-10:r+l+10,y:m[1].y});const x=p>0?{x:d.x-4,y:d.y+.5*d.height}:{x:d.x+d.width+4,y:d.y+.5*d.height};c.setAttribute("transform",`translate(${m[2].x-x.x} ${m[2].y-x.y})`),Wt(h).selectAll("circle").data([m]).join("circle").attr("cx",(t=>t[0].x)).attr("cy",(t=>t[0].y)).attr("r",3),Wt(h).selectAll("polyline").data([m]).join("polyline").attr("points",(t=>t.map((t=>`${t.x},${t.y}`)).join(" "))).style("fill","none").style("stroke","#000").style("stroke-width","1px"),n.dx=p,n.y=m[2].y}}_initTooltip(t,e,i,s){Wt(t).append("text")}_prerenderTooltip(t,e,i,s){const n=this._style.tooltip,r=new Se({width:this._style.tooltip.maxWidth,fontSize:n.font.size,fontWeight:n.font.weight,fontColor:n.font.color}),a=e.idx,l={value:this._d.values[a],formattedValue:this._c.formattedValues[a],category:this._d.categories[a],color:this._d.colors[a],state:this._state},o=this._(this._tooltips.enabled,e,this._state,this)?this._tooltips.text(l,this._state,this):this._d.labels[a];r.render(o,t,l,null,{});const h=t.getBoundingClientRect();i.viewRect.setHeight(h.height+10),i.viewRect.setWidth(h.width+10),t.setAttribute("transform",`translate(${i.viewRect.left+5} ${i.viewRect.top+5})`)}_renderTooltip(){}}class fc extends Ea{constructor(){super({hasChartArea:!1}),this._categories=null,this._categoryLabels=null,this._colors=null,this._dimensions=null,this._dimensionLabels=null,this._values=null,this._size=400,this._tooltipText=null,this._d={data:null,categories:null,categoryLabels:null,colors:null,dimensions:null,dimensionLabels:null,tickLabels:null,values:null,valuesArray:null},this._c={center:null,radius:null,size:null,minValue:null,maxValue:null,ticks:null},this.scale=null,this.legend=null,this.legendNode=null,this.tooltip=null,this.style({category:{line:{width:2},fill:{opacity:.3},dot:{show:!0,size:8}},dimension:{label:{font:{size:12,color:"#999",weight:400},offset:10},line:{width:1,color:"#ccc"}},legend:{show:!0,align:"left",position:"top",box:{width:10,height:10},padding:{bottom:20}},grid:{minValue:null,maxValue:null,line:{width:1,color:"#ccc"},centerOffset:10,tickValues:null,tickLabels:{show:!1,format:(t,e,i,s)=>Number.isInteger(t)?t:t.toFixed(1),font:{size:11,weight:400,color:"#999"},offset:{x:4,y:-2},halo:{show:!0,color:"#fff9",size:3},position:"left"}},tooltip:{maxWidth:300,font:{size:12},valueFormat:t=>Number.isInteger(t)?t:t.toFixed(1)}})}categories(t){return this._categories=t,this}categoryLabels(t){return this._categoryLabels=t,this}colors(t){return this._colors=t,this}dimensions(t){return this._dimensions=t,this}dimensionLabels(t){return this._dimensionLabels=t,this}values(t){return this._values=t,this}size(t){return this._size=t,this}tooltipText(t){return this._tooltipText=t,this}init(t,e){super.init(t,e),t.classList.add("dv_radarChart");const i=Wt(t).append("g").attr("class","dv_chartWrapper").node();Wt(i).append("g").attr("class","dv_gridLines"),Wt(i).append("g").attr("class","dv_dimensions"),Wt(i).append("g").attr("class","dv_dimensionLabels"),Wt(i).append("g").attr("class","dv_valueLines"),Wt(i).append("g").attr("class","dv_valueDots"),Wt(i).append("g").attr("class","dv_tickLabelsHalo"),Wt(i).append("g").attr("class","dv_tickLabels"),this._initLegend(t,e),Wt(i).append("g").attr("class","dv_interaction"),this._createTooltip()}_initLegend(t,e){!0===this._style.legend.show&&(this.legendNode=Wt(t).append("g").node(),this.legend=(new Na).style({align:this._style.legend.align,box:{shape:"circle",width:this._style.legend.box.width,height:this._style.legend.box.height,padding:this._style.legend.padding}}),this.legend.init(this.legendNode,e))}_createTooltip(){this.tooltip=new Za,this.tooltip.on("init",this._initTooltip.bind(this)).on("prerender",this._prerenderTooltip.bind(this)).on("render",this._renderTooltip.bind(this))}prerender(t,e){if(super.prerender(t,e),!this.datasource.loaded)return void console.info("Rendering of chart postponed. Datasource not yet ready.");this.emit("prerenderWillStart",[t,e,this]),this._state=e,this.extractData(),this._c.size=this._(this._size,{...this._d,width:this.viewRect.width()},e,this),this._prerenderLegend(t,e);const i=this._style.legend.show?this.legend.viewRect.height():0;this._c.minValue=null===this._style.grid.minValue?Ci(this._d.valuesArray.flat()):this._(this._style.grid.minValue,this._d,e,this),this._c.maxValue=null===this._style.grid.maxValue?Si(this._d.valuesArray.flat()):this._(this._style.grid.maxValue,this._d,e,this),this._c.radius=this._c.size/2,this._c.center={x:this.viewRect.left+this.viewRect.width()/2,y:this.viewRect.top+i+this._c.radius},this.defineScale(),this._prerenderDimensionLabels(t,e),this._c.ticks=this._d.tickValues||function(t,e,i,s={}){const n=s.nTicks||Math.max(2,Math.min(Math.floor(i/(s.nPixels||100)),15)),r=Math.pow(10,Math.floor(Math.log10((e-t)/n))),a=Math.floor(t/r)*r,l=Math.ceil(e/r)*r,o=[];o.push(t);for(let i=a;i<=Math.min(l,e);i+=r)i>t&&o.push(i);return o.push(e),o}(this._c.minValue,this._c.maxValue,this._c.radius-this._style.grid.centerOffset),this.viewRect.setHeight(this._c.size+i),this.emit("prerenderDidEnd",[t,e,this])}_prerenderDimensionLabels(t,e){const i=this._d.dimensions.length,s=new Se({fontSize:this._style.dimension.label.font.size,fontColor:this._style.dimension.label.font.color,fontWeight:this._style.dimension.label.font.weight});let n=1/0,r=0;for(;n>1&&r<3;){Wt(t).select(".dv_dimensionLabels").selectAll("g.dv_dimensionLabel").data(this._d.dimensionLabels).join("g").attr("class","dv_dimensionLabel").each(((t,e,n)=>{const r=n[e];this._renderDimensionLabel(r,t,e,i,s)}));const e=t.querySelector(".dv_dimensionLabels").getBBox(),a=Math.max(this.viewRect.left-e.x,e.x+e.width-this.viewRect.right,0),l=Math.max(e.y-this.viewRect.top,2*e.y+e.height-this._c.size,0)/2,o=Math.max(this._c.radius-Math.max(a,l),this._c.size/4);n=Math.abs(o-this._c.radius),n>.1&&(this._c.radius=o,this._c.center.y-=e.y,this.defineScale()),r+=1}}_prerenderLegend(t,e){!0===this._style.legend.show&&(this.legend.categories(this._d.categoryLabels).colors(this._d.colors),this.legend.maxViewRect=new ne(this.viewRect.left,this.viewRect.top,this.viewRect.width(),null),this.legend.prerender(this.legendNode,e))}render(t,e){if(!this.datasource.loaded)return;this.emit("renderWillStart",[t,e,this]),super.render(t,e),!0===this._style.legend.show&&this.legend.render(this.legendNode,e),this._renderGrid(t,e),this._renderDimensionLabels(t,e),this._renderValueLines(t,e),this._renderValueDots(t,e),this._renderTickLabels(t,e),this._renderInteractionLayer(t,e),Wt(t).select(".dv_chartWrapper").attr("transform","translate(0 0)");const i=this.viewRect.height(),s=Wt(t).select(".dv_chartWrapper").node().getBoundingClientRect(),n=t.getBoundingClientRect(),r=this._style.legend.show?this.legend.viewRect.height():0,a=r+Math.max(0,i-r-s.height-10)/2-(s.y-n.y);Wt(t).select(".dv_chartWrapper").attr("transform",`translate(0 ${a})`),this.emit("renderDidEnd",[t,e,this])}_renderGrid(t,e){Wt(t).select(".dv_gridLines").selectAll("polygon").data(this._c.ticks).join("polygon").attr("points",(t=>function(t,e,i=1){1===arguments.length&&(e=t,t=0);const s=[];for(let n=t;i>0?n<e:n>e;n+=i)s.push(n);return s}(this._d.dimensions.length).map((e=>{const i=this.scale(e,t);return`${i.x},${i.y}`})).join(" "))).style("fill","none").style("stroke",this._style.grid.line.color).style("stroke-width",`${this._style.grid.line.width}px`),Wt(t).select(".dv_dimensions").selectAll("line").data(this._d.dimensions).join("line").each(((t,e,i)=>{const s=i[e],n=this.scale(e,this._c.minValue),r=this.scale(e,this._c.maxValue);s.setAttribute("x1",n.x),s.setAttribute("y1",n.y),s.setAttribute("x2",r.x),s.setAttribute("y2",r.y)})).style("fill","none").style("stroke",this._style.dimension.line.color).style("stroke-width",`${this._style.dimension.line.width}px`)}_renderTickLabels(t,e){const i=this._style.grid.tickLabels;if(!1===i.show)return;const s=(t,s,n)=>{const r=n[s],a=this.scale(0,t);r.setAttribute("x",a.x+("left"===i.position?-1:1)*i.offset.x),r.setAttribute("y",a.y+i.font.size/2+i.offset.y);const l=this._(i.format,t,this._d,e,this);r.textContent=l,r.style.textAnchor="left"===i.position?"end":"start",r.style.fontSize=`${i.font.size}px`,r.style.fontWeight=i.font.weight};Wt(t).select(".dv_tickLabels").selectAll("text").data(this._c.ticks).join("text").each(s).style("fill",i.font.color),!0===i.halo.show&&Wt(t).select(".dv_tickLabelsHalo").selectAll("text").data(this._c.ticks).join("text").each(s).style("fill",i.halo.color).style("stroke",i.halo.color).style("stroke-width",`${i.halo.size}px`)}_renderDimensionLabels(t,e){const i=this._d.dimensions.length;Wt(t).select(".dv_dimensionLabels").selectAll("g.dv_dimensionLabel").each(((t,e,s)=>{const n=s[e];this._renderDimensionLabel(n,t,e,i,null)}))}_renderDimensionLabel(t,e,i,s,n=null){const r=i,a=s,l=2*Math.PI/a*r,o=this.scale(r,this._c.maxValue),h=o.x+Math.sin(l)*this._style.dimension.label.offset,c=o.y-Math.cos(l)*this._style.dimension.label.offset,d=3*Math.round(360/a*r/3);let u="";(d<90||d>270)&&(u+="top"),d>90&&d<270&&(u+="bottom"),d>0&&d<180&&(u+="right"),d>180&&(u+="left");const _=u.includes("left")?"right":u.includes("right")?"left":"center";let p=this.viewRect.width();if(u.includes("right")&&(p=this.viewRect.width()-h-10),u.includes("left")&&(p=h-10),"top"===u||"bottom"===u){const t=this.scale(1,this._c.maxValue),e=this.scale(s-1,this._c.maxValue),i=Math.abs(e.x-t.x);p=Math.min(i,p)}p=Math.max(50,p),n&&n.render(e,t,{},{},{width:p,textAlign:_});const f=t.getBBox();let g=h-f.x,y=c-f.y;"top"!==u&&"bottom"!==u||(g-=f.width/2),u.includes("left")&&(g-=f.width),"left"!==u&&"right"!==u||(y-=f.height/2),u.includes("top")&&(y-=f.height),t.setAttribute("transform",`translate(${g} ${y})`)}_renderValueLines(t,e){Wt(t).select(".dv_valueLines").selectAll("polygon").data(this._d.categories).join("polygon").attr("points",((t,e)=>{const i=this._d.values[t];return this._d.dimensions.map(((t,e)=>{const s=this.scale(e,i[t]);return`${s.x},${s.y}`})).join(" ")})).style("fill",((t,e)=>this._d.colors[e])).style("fill-opacity",this._style.category.fill.opacity).style("stroke",((t,e)=>this._d.colors[e])).style("stroke-width",this._style.category.line.width)}_renderValueDots(t,e){Wt(t).select(".dv_valueDots").selectAll("circle").remove(),this._d.categories.forEach(((e,i)=>{const s=this._d.values[e],n=this._d.colors[i];Wt(t).select(".dv_valueDots").selectAll(`circle[data-cat='${e}']`).data(this._d.dimensions).join("circle").attr("data-cat",e).each(((t,e,i)=>{const n=i[e],r=s[t],a=this.scale(e,r);n.setAttribute("cx",a.x),n.setAttribute("cy",a.y)})).attr("r",this._style.category.dot.size/2).style("fill",n).style("stroke","none")}))}_renderInteractionLayer(t,e){const i=new _c({start:(t,e,i)=>{this.tooltip.show(t)},move:(t,e,i)=>{this.tooltip.move(t),this.selectDataPoint(e)},end:(t,e,i)=>{this.tooltip.hide(t),this.deselectDataPoints(e)}});Wt(t).select(".dv_interaction").selectAll("polygon").data(this._d.categories).join("polygon").attr("points",((t,e)=>{const i=this._d.values[t];return this._d.dimensions.map(((t,e)=>{const s=this.scale(e,i[t]);return`${s.x},${s.y}`})).join(" ")})).style("fill","none").style("stroke","#fff").style("stroke-width","12px").style("stroke-opacity",0).call(i.bind())}extractData(){this._d.data=this.transformedData(this._state),this._d.values=this._(this._values,this._d.data,this._state,this),this._d.categories=this._(this._categories,this._d.data,this._state,this),this._d.categoryLabels=this._(this._categoryLabels,this._d.data,this._state,this),this._d.colors=this._(this._colors,this._d.data,this._state,this),this._d.dimensions=this._(this._dimensions,this._d.data,this._state,this),this._d.dimensionLabels=this._(this._dimensionLabels,this._d.data,this._state,this),this._d.tickValues=this._(this._style.grid.tickValues,this._d.data,this._state,this),this._d.valuesArray=Object.values(this._d.values).map((t=>Object.values(t).map((t=>t))))}defineScale(){const t=on([this._c.minValue,this._c.maxValue],[this._style.grid.centerOffset,this._c.radius]),e=this._d.dimensions.length;this.scale=function(i,s){const n=2*Math.PI/e*i,r=t(s);return{x:Math.sin(n)*r+this._c.center.x,y:this._c.center.y+this._style.grid.centerOffset-Math.cos(n)*r}}}dimensionForEvent(t){const e=this._c.center.x,i=this._c.center.y+this._style.grid.centerOffset,s=t.x-e,n=i-t.y;let r=(90-Math.atan2(n,s)*(180/Math.PI))%360;r=r<0?r+360:r;let a=Math.round(r*this._d.dimensions.length/360);return a=a>=this._d.dimensions.length?a-this._d.dimensions.length:a,{id:this._d.dimensions[a],idx:a,label:this._d.dimensionLabels[a]}}selectDataPoint(t){this.deselectDataPoints();const e=this._d.categories[t.data.idx],i=Wt(this._node).select(".dv_valueDots").selectAll(`circle[data-cat='${e}']`).nodes();Wt(i[this.dimensionForEvent(t).idx]).attr("r",5).style("fill","#fff").style("stroke",this._d.colors[t.data.idx]).style("stroke-width","3px")}deselectDataPoints(){this._d.categories.forEach(((t,e)=>{Wt(this._node).select(".dv_valueDots").selectAll(`circle[data-cat='${t}']`).attr("r",this._style.category.dot.size/2).style("fill",this._d.colors[e]).style("stroke","none").style("stroke-width","0")}))}_getTooltipText(t,e){return"string"==typeof this._tooltipText?this._tooltipText:"function"==typeof this._tooltipText?this._tooltipText(t,this._state,e,this):this.defaultTooltipText(t,this._state,e)}defaultTooltipText(t,e,i){let s="<p>";s+=`<circle w="8" h="8" fill="${t.category.color}" /><tab />\n      <span fontColor="#757575"><b>${t.category.label}</b></span>`,s+="</p>",s+=`<p>${t.dimension.label}<tab />${t.formattedValue}</p>`;return`\n      <text lineHeight="1.8" tabStops="16,${La(t.dimension.label.length,12,400)+20}">\n        ${s}\n      </text>`}_initTooltip(t,e,i,s){Wt(t).append("text")}_prerenderTooltip(t,e,i,s){const n=new Se({width:this._style.tooltip.maxWidth,fontSize:this._style.tooltip.font.size}),r=this._d.categoryLabels[e.idx],a=this.dimensionForEvent(co(s)),l={category:{id:e.value,label:r,idx:e.idx,color:this._d.colors[e.idx]},dimension:a,value:this._d.values[e.value][a.id],formattedValue:this._(this._style.tooltip.valueFormat,this._d.values[e.value][a.id],this._d,this._state,this)};n.render(this._getTooltipText(l,i),t,{...l,state:this._state});const o=t.getBoundingClientRect();i.viewRect.setHeight(o.height+10),i.viewRect.setWidth(o.width+10),t.setAttribute("transform",`translate(${i.viewRect.left+5} ${i.viewRect.top+5})`)}_renderTooltip(t,e,i,s){}}const gc=new Te({class:"CustomBox",padding:{top:0,right:0,bottom:0,left:0},dataSource:null,transformer:null,height:0,events:{init:null,prerenderWillStart:null,prerender:null,prerenderDidEnd:null,renderWillStart:null,render:null,renderDidEnd:null}});class yc extends ze{constructor(t={},e={}){super(gc.extend(t),e)}prerender(t,e){super.prerender(t,e),this.emit("prerenderWillStart",[t,e,this]),this.emit("prerender",[t,e,this]);const i=this.get("height",null,[this.datasource&&this.datasource.data,e,this]);i&&this.viewRect.setHeight(i),this.emit("prerenderDidEnd",[t,e,this])}render(t,e){super.render(t,e),this.emit("renderWillStart",[t,e,this]),this.emit("render",[t,e,this]),this.emit("renderDidEnd",[t,e,this])}}class mc extends Ga{prerender(t,e){super.prerender(t,e),this.datasource.loaded?(this.emit("prerenderWillStart",[t,e,this]),this.emit("prerender",[t,e,this]),this.emit("prerenderDidEnd",[t,e,this])):console.info("Rendering of control postponed. Datasource not yet ready.")}render(t,e){this.datasource.loaded&&(this.emit("renderWillStart",[t,e,this]),super.render(t,e),this.emit("render",[t,e,this]),this.emit("renderDidEnd",[t,e,this]))}}class xc{constructor(t,e,i={}){this.anchor=t,this.callbacks=e,this.options=i,this._initialized=!1,this._handleClick=this._handleClick.bind(this),this._handleResize=this._handleResize.bind(this)}show(){this._initialized||this.init(),this.render()}hide(){window.removeEventListener("click",this._handleClick,{capture:!0}),window.removeEventListener("resize",this._handleResize),setTimeout((()=>{this.callbacks.hide&&this.callbacks.hide(this._root.node()),Wt(document.body).select("div.dv_drop").remove()}),30)}_handleClick(t){this._root.node().contains(t.target)||this.hide()}_handleResize(t){this.position()}init(){this._root=Wt(document.body).append("div").attr("class","dv_drop"),this.options.maxWidth&&this._root.style("max-width",`${this.options.maxWidth}px`),window.addEventListener("click",this._handleClick,{capture:!0}),window.addEventListener("resize",this._handleResize),this.callbacks.init&&this.callbacks.init(this._root.node()),this._initialized=!0}render(){this.callbacks.render&&this.callbacks.render(this._root.node()),this.position()}position(){const t=this.anchor.getBoundingClientRect(),e=this._root.node().getBoundingClientRect();this._root.style("top",`${t.bottom}px`).style("left",t.right-e.width+"px")}}function vc(t,e){const i=t.split("-");if(i.length<2)return null;return function(t){const e=t.split("-");if(e.length<3)return null;t=t.replace("_",".");const i=e[0];let s=e[1];["d","f","i","e"].indexOf(s)<0&&(s="e");const n=e[2].match(/([0-9][0-9])/);if(!n)return null;const r=n[0],a=`${i}-${e.slice(2).join("-")}`,l=`/assets/${r}/${a}/${t}.html`;return{theme:r,assetPath:l,lang:s,id:t}}([i[0],e.substr(0,1),...i.slice(1)].join("-"))}const bc={"Copy code":{fr:"Copier le code",de:"Code kopieren",it:"Copia il codice"},"Copy this code to embed the visualization into your page":{fr:"Copiez ce code pour intégrer la visualisation dans votre page",de:"Kopieren Sie diesen Code um die Visualisierung in Ihrer Seite zu integrieren",it:"Copia questo codice per integrare la visualizzazione nella tua pagina"},"Code copied!":{fr:"Le code a été copié!",de:"Der Code wurde kopiert!",it:"Il codice è stato copiato!"}},wc=function(t,e){return(bc[t]||{})[e||"en"]||t};class Ac extends Ga{constructor(t={}){super({},t),this.style({icon:{size:24}});const e=document.location.href.split("/");this.vizid=t.vizid||e[e.length-2];let i=t.embedWidgetPath||null;for(let t=0;t<document.scripts.length;t++){const e=document.scripts[t],s=e.src.split("/"),n=s[s.length-1];n.search(/^dynvis/)>-1&&n.search(/.js$/)>-1&&(i=e.src)}this.config={embedWidgetPath:i.src||i},this._copyCode=this._copyCode.bind(this),this._open=!1}init(t,e){super.init(t,e),t.classList.add("dv_noprint"),Wt(t).append("g").attr("class","dv_embed"),Wt(t).select("g.dv_embed").append("rect").attr("x",0).attr("y",0).attr("width",24).attr("height",24).style("fill","#fff"),Wt(t).select("g.dv_embed").append("path").attr("d","M7,5 L1,12 L7,19").style("fill","none").style("stroke","#069").style("stroke-width","2px").style("stroke-linecap","round").style("stroke-linejoin","round"),Wt(t).select("g.dv_embed").append("path").attr("d","M17,5 L23,12 L17,19").style("fill","none").style("stroke","#069").style("stroke-width","2px").style("stroke-linecap","round").style("stroke-linejoin","round"),Wt(t).select("g.dv_embed").append("path").attr("d","M13,2 L9,22 L11,22 L15,2z").style("fill","#069").style("stroke-linejoin","miter"),Wt(t).on("click",this.show.bind(this))}prerender(t,e){super.prerender(t,e),this.emit("prerenderWillStart",[t,e,this]),this._node=t,this.viewRect.setHeight(17),this.viewRect.setWidth(25),this.emit("prerenderDidEnd",[t,e,this])}render(t,e){super.render(t,e),this.emit("renderWillStart",[t,e,this]);const i=this._style.icon.size/24;Wt(t).select("g.dv_embed").attr("transform",`scale(${i}) translate(${this.viewRect.left}, ${this.viewRect.top})`),this.emit("renderDidEnd",[t,e,this])}show(){this._open||(this._embedWindow=new xc(Wt(this._node).select("g.dv_embed").node(),{render:this._renderEmbedWindow.bind(this),hide:this._closeEmbedWindow.bind(this)},{anchor:"topright",maxWidth:330}),this._embedWindow.show(),this._open=!0)}_copyCode(){(function(t){if(navigator.clipboard&&window.isSecureContext)return navigator.clipboard.writeText(t);{const e=document.createElement("input");return e.value=t,e.style.position="absolute",e.style.top="-100px",document.body.appendChild(e),e.focus(),e.select(),new Promise(((t,i)=>{document.execCommand("copy")?t():i(new Error("Copy to clipboard failed")),e.remove()}))}})(document.querySelector(".dv_embedWindow .dv_container code").innerText).then((()=>{document.querySelector(".dv_embedWindow.dv_control").classList.add("dv_hidden"),document.querySelector(".dv_embedWindow.dv_confirmation").classList.remove("dv_hidden"),this._embedWindow.position(),window.setTimeout((()=>{this._embedWindow.hide()}),1500)})).catch((t=>console.error("Copying embed code failed: "+t)))}_embedCode(t,e,i){const s=[];for(const t in i){let e="object"==typeof i[t]?JSON.stringify(i[t]):i[t];"string"==typeof e&&(e=e.replace(/"/g,"&#34;")),s.push(`data-state-${t}="${e}"`)}const n=this._parents.filter((t=>"layout"===t.role));if(n.length>0){const t=n[0].parent.embedConfig;for(const e in t){let i="object"==typeof t[e]?JSON.stringify(t[e]):t[e];"string"==typeof i&&(i=i.replace(/"/g,"&#34;")),s.push(`data-config-${e}="${i}"`)}}const r=s.join(" "),a=window.location,l=this.config.embedWidgetPath.startsWith(a.protocol)?this.config.embedWidgetPath:`${a.protocol}//${a.host}/${this.config.embedWidgetPath}`,o=vc(t,e);let h=window.location.href;if(null!==o){`${window.location.origin}${o.assetPath}`===h&&(h=t)}return`<div class="fso-datavis-widget" data-vizid="${h}" data-lang="${e}" ${r}></div><script src="${l}"><\/script>`.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}_renderEmbedWindow(t){const e=document.querySelector("html").getAttribute("lang"),i=this._options.lang||this._state.lang||e||"en",s=this._embedCode(this.vizid,i,this._state);t.innerHTML=`\n      <div class="dv_embedWindow dv_control">\n        <div class="dv_desc">\n          ${wc("Copy this code to embed the visualization into your page",i)}:\n        </div>\n        <div class="dv_copy">\n          <samp class="dv_container">\n            <code data-vizid="${this.vizid}" data-lang="${i}" class="dv_code">${s}</code>\n          </samp>\n          <button class="dv_copyButton">${wc("Copy code",i)}</button>\n        </div>\n      </div>\n      <div class="dv_embedWindow dv_hidden dv_confirmation">\n        <svg width="40" height="40">\n          <g transform="translate(0,-286.41666)">\n            <circle style="fill: #5bb600;" cx="20" cy="306.41666" r="19" />\n            <rect style="fill:#ffffff;" width="13.837906" height="4.834096" x="173.14397" y="270.2225" rx="1.5" ry="1.5" transform="matrix(0.89386442,0.44833738,-0.53397482,0.84550038,0,0)" />\n            <rect style="fill:#ffffff;" width="5.5527401" height="22.01265" x="155.19667" y="251.52736" rx="1.5" ry="1.5" transform="rotate(26.703325)" />\n          </g>\n        </svg>\n        <div class="dv_confirmationText">${wc("Code copied!",i)}</div>\n      </div>\n    `,t.querySelector(".dv_copy").addEventListener("click",this._copyCode)}_closeEmbedWindow(t){this._open=!1,t.querySelector(".dv_copy").removeEventListener("click",this._copyCode)}}class kc{constructor(){this._textRenderer=new Se({fontSize:16,fontColor:"#454545"}),this._symbolWidth={left:0,right:0},this._iconSize=[20,20],this._iconPaddding={right:10}}iconSize(t,e){return Array.isArray(t)&&void 0===e?this._iconSize=t:this._iconSize=[+t,+e],this}init(t,e,i){i._customRenderer?i._customRenderer.init(t,e,i):(Wt(t).append("rect"),Wt(t).append("text"),Wt(t).append("polyline"))}prerender(t,e,i){i._customRenderer&&i._customRenderer.prerender(t,e,i)}render(t,e,i){if(i._customRenderer)return void i._customRenderer.render(t,e,i);const s=i._style,n=i.viewRect;Wt(t).select("rect").attr("x",n.left+1).attr("y",n.top).attr("width",n.width()-2).attr("height",n.height()).attr("rx",4),Wt(t).select("text").attr("x",n.left+10).attr("y",n.top+8+s.font.size).style("font-size",`${s.font.size||16}px`).style("font-weight",s.font.weight||"normal"),this.renderCue(Wt(t).select("polyline"),{x:n.right-25,y:n.top+n.height()/2-2,width:10,height:5})}renderCue(t,e){const i=[`${e.x},${e.y}`,`${e.x+e.width/2},${e.y+e.height}`,`${e.x+e.width},${e.y}`];t.attr("points",i.join(" "))}initElement(t,e,i){}prerenderElement(t,e,i){}renderElement(t,e,i){}initSymbol(t,e,i){}prerenderSymbol(t,e,i){}renderSymbol(t,e,i){}}class Lc extends kc{render(t,e,i){super.render(t,e,i),this._node=t,i._customRenderer||(this.textNode=Wt(t).select("text"),this.update(i),this.truncate())}update(t){this.textNode.text(t._placeholder)}truncate(){const t=this._node.querySelector("rect").getBoundingClientRect().width-40;if(this.textNode.node().getBoundingClientRect().width>t&&t>60){let e=this.textNode.text();for(;this.textNode.node().getBoundingClientRect().width>t;)e=e.substring(0,e.length-2)+"…",this.textNode.text(e)}}initElement(t,e,i){const s=i._style.content;t.node.append("rect").attr("class","dv_dropdownElementBkgd").attr("x",0).attr("y",0);const n=void 0!==t.choice.icon?this._iconSize[0]+this._iconPaddding.right:0;t.node.append("g").attr("class","dv_element").attr("transform",`translate(${s.padding.left+this._symbolWidth.left+n} ${s.padding.top})`),t.choice.icon&&t.node.append("g").attr("class","dv_icon").attr("transform",`translate(${s.padding.left+this._symbolWidth.left} ${s.padding.top})`)}prerenderElement(t,e,i){const s=i._style.content,n=void 0!==t.choice.icon?this._iconSize[0]+this._iconPaddding.right:0,r=s.padding.left+s.padding.right+n+this._symbolWidth.left+this._symbolWidth.right;this._textRenderer.baseStyle.width=t.maxWidth-r;const a="string"==typeof t.choice.value&&t.choice.value.startsWith("<text")?t.choice.value:`<text>${t.choice.value}</text>`;return this._textRenderer.render(a,t.node.select("g").node(),{}),t.node.select(".dv_element").node().getBoundingClientRect().width+r}renderElement(t,e,i){const s=i._style.content,n=void 0!==t.choice.icon?this._iconSize[0]+this._iconPaddding.right:0;this._textRenderer.baseStyle.width=t.width-s.padding.left-s.padding.right-n-this._symbolWidth.left-this._symbolWidth.right,t.choice.icon&&(t.node.node().querySelector("g.dv_icon").innerHTML="function"==typeof t.choice.icon?t.choice.icon(this._iconSize):t.choice.icon);const r="string"==typeof t.choice.value&&t.choice.value.startsWith("<text")?t.choice.value:`<text>${t.choice.value}</text>`;this._textRenderer.render(r,t.node.select("g.dv_element").node(),{});const a=t.node.select(".dv_element").node().getBoundingClientRect().height+s.padding.top+s.padding.bottom;return t.node.select("rect").attr("width",t.width).attr("height",a),a}}class Sc extends Lc{constructor(){super(),this._symbolWidth.right=40}initSymbol(t,e,i){t.choice.key===i._currentChoice&&t.node.append("polyline").attr("class","dv_checkedSymbol").attr("points","0,8 6,14 16,3")}renderSymbol(t,e,i){const s=t.node.select(".dv_checkedSymbol");s&&s.attr("transform",(()=>`translate(${t.width-this._symbolWidth.right+10} ${Math.floor((t.elementHeight-16)/2)})`))}update(t){let e=t._currentChoice?t._choices.filter((e=>e.key===t._currentChoice)):[];e=0===e.length?null:e[0],this.textNode.text(e?e.value:t._placeholder||""),this.truncate()}}class Cc extends Lc{constructor(){super(),this._symbolWidth.left=40}initSymbol(t,e,i){const s=t.node.append("g").attr("class","dv_checkbox");s.append("rect").attr("x",0).attr("y",0).attr("width",20).attr("height",20).attr("rx",2),s.append("polyline").attr("class","dv_symbol").attr("points","4,10 8,14 16,6")}renderSymbol(t,e,i){i._currentChoice.map((t=>t.key)).indexOf(t.choice.key)>-1?t.node.node().classList.add("dv_selected"):t.node.node().classList.remove("dv_selected");const s=i._style.content;t.node.select(".dv_checkbox").attr("transform",`translate(${s.padding.left} ${s.padding.top})`)}update(t){this.textNode.text(t._currentChoice.length>0?t._choices.filter((t=>t._sel)).map((t=>t.value)).join(", "):t._placeholder||"")}}class Rc extends Ga{constructor(t){return super(t),this._type="single-choice",this._label=null,this._placeholder=null,this._dropdownChoices=null,this._choices=null,this.defineDefaults({currentChoice:null,closeOnSelection:!0}),this._stateKey=null,this._renderer=null,this._customRenderer=!1,this._minSelections=0,this._maxSelections=1/0,this.style({padding:{top:7,right:0,bottom:7,left:0},font:{size:14,weight:"normal"},content:{minWidth:100,padding:{top:5,right:7,bottom:5,left:7}}}),this.shown=null,this}zeroChoice(){return this._type="zero-choice",this}singleChoice(){return this._type="single-choice",this}multipleChoice(){return this._type="multiple-choice",this._closeOnSelection=!1,this}label(t){return this._label=t,this}placeholder(t){return this._placeholder=t,this}minSelections(t){return this._minSelections=Math.max(1,t),this}maxSelections(t){return this._maxSelections=t,this}choices(t){return this._dropdownChoices=t,this}mapToState(t,e=(t,e)=>t){return this._stateKey=t,this._stateKeyAction=e,this}renderer(t){return this._customRenderer=Object.assign(Object.fromEntries(["init","prerender","render"].map((t=>[t,()=>{}]))),t),this}init(t,e){this.emit("init",[t,e,this]),this._node=t,t.classList.add("dv_dropdown"),"single-choice"===this._type?this._renderer=new Sc:"multiple-choice"===this._type?this._renderer=new Cc:this._renderer=new Lc,"function"==typeof this._renderer.init&&this._renderer.init(t,e,this),"zero-choice"===this._type?t.setAttribute("role","menu"):t.setAttribute("role","listbox"),t.setAttribute("aria-label",this._label||this._placeholder||""),t.setAttribute("tabindex","0"),Wt(t).on("mousedown",(t=>{0===t.button&&this.show()})),this._initialized=!0}prerender(t,e){super.prerender(t,e),!this.datasource||this.datasource.loaded?(this.emit("prerenderWillStart",[t,e,this]),this.viewRect.setHeight(this._style.font.size+18),"function"==typeof this._dropdownChoices?this._choices=this._dropdownChoices(this,e):this._choices=this._dropdownChoices,this._renderer.prerender(t,e,this),this.emit("prerenderDidEnd",[t,e,this])):console.info("Rendering of control postponed. Datasource not yet ready.")}render(t,e){this.datasource&&!this.datasource.loaded||(this.emit("renderWillStart",[t,e,this]),super.render(t,e),this._stateKey&&("multiple-choice"===this._type?this._currentChoice=this._choices.filter((t=>(t._sel=e[this._stateKey].indexOf(t.key)>-1,t._sel))):this._currentChoice=e[this._stateKey]),this._renderer.render(t,e,this),null!==this.shown&&this.show(),this.emit("renderDidEnd",[t,e,this]))}show(){this._node.classList.contains("dv_open")&&this.hide(!1),this._node.classList.add("dv_open"),this._dropdownInteractionBkgd=Wt("body").append("div").attr("class","dv_dropdownInteractionBkgd").on("mouseup",(t=>{const e=this._node.getBoundingClientRect();t.x>=e.left&&t.x<=e.right&&t.y>=e.top&&t.y<=e.bottom?new Date-this.shown>300&&this.hide():this.hide()})),this._dropdownDiv=Wt("body").append("div").attr("class","dv_dropdownContentWrapper"),Wt(document.body).on("keyup",(t=>{27===t.keyCode&&this.hide()})),this._root=this._dropdownDiv.append("svg").attr("class","dv_dropdownContent"),this._dropdownElements=this._choices.map((t=>{const e=this._root.append("g").attr("class","dv_dropdownElement").datum(t);return!1===t.enabled&&e.classed("dv_disabled",!0),this._renderer.initElement({choice:t,node:e},this._state,this),this._renderer.initSymbol({choice:t,node:e},this._state,this),!1!==t.enabled&&e.on("mouseup",this.handleSelect.bind(this)),{choice:t,node:e}})),this.renderContent(),this.shown=new Date}renderContent(){const t=document.body.getBoundingClientRect().width-4,e=Math.min(Math.max(this.viewRect.width()-4,this._style.content.minWidth),t),i=this._dropdownElements.map((i=>{const s=this._renderer.prerenderElement({choice:i.choice,node:i.node,width:e,maxWidth:t},this._state,this);return this._renderer.prerenderSymbol({choice:i.choice,node:i.node,elementWidth:s},this._state,this),s})),s=Math.max(Math.max(...i),e);this._root.attr("width",s);let n=0;this._dropdownElements.forEach((t=>{const e=this._renderer.renderElement({choice:t.choice,node:t.node,width:s},this._state,this);return t.node.attr("transform",`translate(0 ${n})`),n+=e,this._renderer.renderSymbol({choice:t.choice,node:t.node,width:s,elementHeight:e},this._state,this),e})),this._root.attr("height",n);const r=this._node.getBoundingClientRect(),a=window.scrollY,l=Math.min(r.left,t+4-s);this._dropdownDiv.style("width",`${s}px`).style("left",`${l}px`).style("top",`${r.bottom+a+3}px`);const o=this._node.getBoundingClientRect().bottom+a+3;this._dropdownDiv.style("top",`${o}px`);const h=Math.min(n,window.innerHeight-o-8);this._dropdownDiv.style("height",`${h}px`),h<n&&this._dropdownDiv.style("overflow-y","scroll");const c=this._node.querySelector("polyline");c&&c.setAttribute("transform","translate(0,35)scale(1,-1)")}hide(t=!0){if(this._dropdownInteractionBkgd.remove(),this._dropdownDiv.remove(),Wt(document.body).on("keyup",null),t){this._node.classList.remove("dv_open");const t=this._node.querySelector("polyline");t&&t.setAttribute("transform",""),this.shown=null}}handleSelect(t,e){if("multiple-choice"===this._type){this._currentChoiceObj||(this._currentChoiceObj=this._choices.filter((t=>t._sel)));const t=this._currentChoiceObj.length+(e._sel?-1:1);if(t<this._minSelections)return void this.emit("validationError",[{currentChoice:this._currentChoiceObj,offendingChoice:e,message:`Minimum number of required selections: ${this._minSelections}`,code:101},this._state,this]);if(t>this._maxSelections)return void this.emit("validationError",[{currentChoice:this._currentChoiceObj,offendingChoice:e,message:`Maximum number of allowed selections: ${this._maxSelections}`,code:102},this._state,this]);e._sel=!e._sel,this._currentChoiceObj=this._choices.filter((t=>t._sel)),this._currentChoice=this._currentChoiceObj.map((t=>t.key))}else this._currentChoiceObj=e,this._currentChoice=e.key;if(this.hide(this._closeOnSelection),this.emit("select",[this._currentChoiceObj,this._state,this]),this._stateKey){let t={};t[this._stateKey]=this._currentChoice,t=this._stateKeyAction(t,this,this._state)||t,this.setState(t)}else"function"==typeof this._renderer.update&&this._renderer.update(this)}}class Tc{constructor(t={}){this._style={fill:"none",stroke:"#069","stroke-width":"2px"},this._style=ie(this._style,t.style||{})}render(t,e){Wt(t).selectAll("g.dv_exportIcon").data([1]).join("g").attr("class","dv_exportIcon"),Wt(t).select("g.dv_exportIcon").selectAll("rect").data([1]).join("rect").attr("x",0).attr("y",0).attr("width",24).attr("height",24).style("fill","#fff").style("stroke","none").style("stroke-width",0);const i=Wt(t).select("g.dv_exportIcon").selectAll("path").data([1]).join("path").attr("d","M1,15 L1,21 L23,21 L23,15 M12,3 L12,15 M6,11 L12,17 L18,11").style("stroke-linecap","square");for(const t in this._style)i.style(t,this._style[t])}}class Mc extends Rc{constructor(t){super(t),this._type="zero-choice",this._dropdownChoices=[],this._iconRenderer=new Tc,this.style({padding:{top:0,bottom:0}}),this.renderer({init:this._initIcon.bind(this),prerender:this._prerenderIcon.bind(this),render:this._renderIcon.bind(this)})}init(t,e,i){super.init(t,e,i),t.classList.add("dv_noprint")}format(t,e={}){return this._dropdownChoices.push({key:t,value:e.text||t.toUpperCase(),options:e}),this}handleSelect(t,e){this._dropdown.hide(!0);const i=this._parentLayout();if(e.options.exportFunction)e.options.exportFunction(i,e.options);else{const t=`saveAs${De(e.key)}`,s=`chart.${e.key}`;i[t]?i[t](e.options.filename||s,e.options):console.error(`No export function available for format ${e.key.toUpperCase()}.`)}}_initIcon(t,e,i){Wt(t).append("rect").style("opacity",0)}_prerenderIcon(t,e,i){this._dropdown=i,i.viewRect.setWidth(24),i.viewRect.setHeight(24)}_renderIcon(t,e,i){const s=i.viewRect;return Wt(t).select("rect").attr("x",s.left).attr("y",s.top).attr("width",s.width()).attr("height",s.height()),this._iconRenderer.render(t,s),t}_parentLayout(){for(let t=0;t<this._parents.length;t++)if("layout"===this._parents[t].role)return this._parents[t].parent;return null}}class zc extends Ga{constructor(t){super(t),this.classList=this.classList||[],this.classList.push("dv_buttonCollection"),this._buttons=[],this._stateKey=null,this.style({align:"center",padding:{top:2,right:2,bottom:10,left:2,horizontal:20,vertical:7},font:{size:16,weight:400},maxWidth:null}),this.defineDefaults({allowGridLayout:!0})}options(t,e="value"){return this._buttonOptions=t,this._key="object"==typeof t?e:null,this}mapToState(t){return this._stateKey=t,this}init(t,e){this.emit("init",[t,e,this]),this._initialized=!0}render(t,e){this.datasource&&!this.datasource.loaded||(this.emit("renderWillStart",[t,e,this]),super.render(t,e),this._renderButtons(t,e),this.emit("renderDidEnd",[t,e,this]))}prerender(t,e){if(super.prerender(t,e),this.datasource&&!this.datasource.loaded)return void console.info("Rendering of control postponed. Datasource not yet ready.");this.emit("prerenderWillStart",[t,e,this]),this._buttons=this._(this._buttonOptions,this,e),Wt(t).style("font-size",`${this._style.font.size||12}px`).style("font-weight",this._style.font.weight||"normal"),Wt(t).selectAll("g.dv_buttonCollection").data(this._buttons).join("g").attr("class","dv_buttonCollection").classed(this.classList.join(" "),!0).attr("role","button").attr("tabindex","0").on("click",this.handleButtonClick.bind(this)).on("keyup",this.handleKeyUp.bind(this)).each(((t,i,s)=>{s[i].getAttribute("data-init")||(this.initButton(s[i],e,t,i),s[i].setAttribute("data-init","1"))}));const i=[];Wt(t).selectAll("g.dv_buttonCollection").each(((t,s,n)=>{i.push(this.prerenderButton(n[s],e,t,s))})),this.buttonLayout=this._layoutButtons(i.map((t=>t.width))),this.cumulatedWidth=[],this.cumulatedHeight=[];let s=this._style.padding.left,n=this._style.padding.top;for(let t=0;t<i.length;t++){const e=t%this.buttonLayout.cols;0===e?(s=this._style.padding.left,t>0&&(n+=i[t-1].height+this._style.padding.vertical)):s+=this.buttonLayout.columnWidths[e-1],this.cumulatedWidth.push(s),this.cumulatedHeight.push(n)}const r=Math.max(...i.map(((t,e)=>this.cumulatedHeight[e]+t.height)));this.buttonXOffset=0,"center"===this._style.align&&this.buttonLayout.cols>1&&(this.buttonXOffset=Math.max(0,(this.viewRect.width()-this.buttonLayout.width)/2)),this.viewRect.setHeight(r+this._style.padding.bottom),this.emit("prerenderDidEnd",[t,e,this])}_renderButtons(t,e){Wt(t).selectAll("g.dv_buttonCollection").data(this._buttons).classed("dv_selected",(t=>this.isSelected(t,e))).attr("aria-pressed",(t=>this.isSelected(t,e)?"true":"false")),Wt(t).selectAll("g.dv_buttonCollection").each(((t,i,s)=>{this.renderButton(s[i],e,t,i)}))}_layoutButtons(t){const e=this.viewRect.width()-this._style.padding.left-this._style.padding.right,i=t.length,s=t.reduce(((t,e)=>t+e))+(i-1)*this._style.padding.horizontal;if(!this._allowGridLayout&&s>e){const e=t.reduce(((t,e)=>Math.max(t,e)));return{rows:i,cols:1,columnWidths:[e],width:e}}let n=1,r=null;for(;n<=i;){if(r=this._layoutButtonsInGrid(n,t),r.width<=e)return r;n+=1}return r}_layoutButtonsInGrid(t,e){const i=Math.ceil(e.length/t),s=new Array(i).fill(0);e.forEach(((t,e)=>{s[e%i]=Math.max(s[e%i],t)}));for(let t=0;t<i-1;t++)s[t]+=this._style.padding.horizontal;return{rows:t,cols:i,columnWidths:s,width:s.reduce(((t,e)=>t+e))}}initButton(t,e,i,s){console.warn("ButtonCollection.initButton not implemented.")}prerenderButton(t,e,i,s){return console.warn("ButtonCollection.prerenderButton not implemented."),{width:0,height:0}}renderButton(t,e,i,s){console.warn("ButtonCollection.renderButton not implemented.")}handleButtonClick(t,e){console.warn("ButtonCollection.handleButtonClick not implemented.")}handleKeyUp(t,e){13===t.keyCode&&this.handleButtonClick(t,e)}isSelected(t){return console.warn("ButtonCollection.isSelected not implemented."),!1}}class Dc extends zc{constructor(t){super(t),this.style({symbol:{size:20,margin:{top:0,right:5,bottom:0,left:0}}})}initButton(t,e,i,s){i._uid=Yt().replace(/-/g,""),Wt(t).append("rect").attr("class","dv_bkgd"),Wt(t).append("g").attr("class","dv_text").attr("id",`txt${i._uid}`),Wt(t).append("circle").attr("class","dv_focus"),Wt(t).append("circle").attr("class","dv_symbol"),Wt(t).append("circle").attr("class","dv_symbolInner"),Wt(t).attr("aria-labelledby",`txt${i._uid}`)}prerenderButton(t,e,i,s){const n=this._style,r=n.symbol,a=new Se({fontSize:this._style.font.size,fontWeight:this._style.font.weight}),l=(n.maxWidth>0?n.maxWidth:this.viewRect.width())-(r.margin.left+r.size+r.margin.right);return a.render(i.text,t.querySelector("g.dv_text"),{state:e},null,{width:l}),i._textClientRect=t.querySelector("g.dv_text").getBoundingClientRect(),i._textWidth=i._textClientRect.width,i._textHeight=i._textClientRect.height,i._width=r.margin.left+r.size+r.margin.right+i._textWidth,i._height=r.margin.top+Math.max(r.size,i._textHeight)+r.margin.bottom,{width:i._width,height:i._height}}renderButton(t,e,i,s){this._renderBackgroundRect(t,s),this._renderLabel(t,i,s),this._renderSymbol(t,i,s),this._renderCheckmark(t,i,s)}_renderBackgroundRect(t,e){Wt(t).select("rect.dv_bkgd").attr("x",(()=>this.cumulatedWidth[e]+this.buttonXOffset)).attr("y",(t=>this.cumulatedHeight[e])).attr("width",(t=>{const i=e%this.buttonLayout.cols;return this.buttonLayout.columnWidths[i]-(i===this.buttonLayout.cols-1?0:this._style.padding.horizontal)})).attr("height",(t=>t._height))}_renderLabel(t,e,i){const s=this._style,n=this.cumulatedWidth[i]+this.buttonXOffset+s.symbol.margin.left+s.symbol.size+s.symbol.margin.right,r=this.cumulatedHeight[i];Wt(t).select("g.dv_text").attr("transform",`translate(${n} ${r})`)}_renderSymbol(t,e,i){const s=this._style,n=this.cumulatedWidth[i]+this.buttonXOffset+s.symbol.margin.left+s.symbol.size/2,r=this.cumulatedHeight[i]+s.symbol.margin.top+s.symbol.size/2;Wt(t).select("circle.dv_focus").attr("cx",n).attr("cy",r).attr("r",s.symbol.size/2+1.5),Wt(t).select("circle.dv_symbol").attr("cx",n).attr("cy",r).attr("r",s.symbol.size/2-1),Wt(t).select("circle.dv_symbolInner").attr("cx",n).attr("cy",r).attr("r",s.symbol.size/2-6)}_renderCheckmark(t,e,i){}handleButtonClick(t,e){if(e.value===this._state[this._stateKey])return;const i={};i[this._stateKey]=e.value,this.setState(i)}isSelected(t){return t.value===this._state[this._stateKey]}}class $c extends Dc{constructor(t){super(t),this._minSelections=0,this._maxSelections=1/0}minSelections(t){return this._minSelections=Math.max(1,t),this}maxSelections(t){return this._maxSelections=t,this}initButton(t,e,i,s){i._uid=Yt().replace(/-/g,""),Wt(t).append("rect").attr("class","dv_bkgd"),Wt(t).append("g").attr("class","dv_text").attr("id",`txt${i._uid}`),Wt(t).append("rect").attr("class","dv_focus"),Wt(t).append("rect").attr("class","dv_symbol"),Wt(t).append("polyline"),Wt(t).attr("aria-labelledby",`txt${i._uid}`)}_renderSymbol(t,e,i){const s=this._style,n=this.cumulatedWidth[i]+this.buttonXOffset+s.symbol.margin.left,r=this.cumulatedHeight[i]+s.symbol.margin.top;Wt(t).select("rect.dv_focus").attr("x",n-2.5).attr("y",r-2.5).attr("width",s.symbol.size+4).attr("height",s.symbol.size+4),Wt(t).select("rect.dv_symbol").attr("x",n).attr("y",r).attr("width",s.symbol.size-1).attr("height",s.symbol.size-1).attr("rx",2)}_renderCheckmark(t,e,i){const s=this._style;Wt(t).select("polyline").attr("points",(()=>{const t=this.cumulatedWidth[i]+this.buttonXOffset,e=this.cumulatedHeight[i],n=s.symbol.margin.left+t,r=e+s.symbol.margin.top,a=s.symbol.size;return`${n+.2*a},${r+.5*a} ${n+.4*a},${r+.7*a} ${n+.8*a},${r+.2*a}`}))}handleButtonClick(t,e){const i=this._state[this._stateKey]||[],s=i.length+(i.indexOf(e.value)>-1?-1:1);if(s<this._minSelections)return void this.emit("validationError",[{currentChoice:i,offendingChoice:e.value,message:`Minimum number of required selections: ${this._minSelections}`,code:101},this._state,this]);if(s>this._maxSelections)return void this.emit("validationError",[{currentChoice:i,offendingChoice:e.value,message:`Maximum number of allowed selections: ${this._maxSelections}`,code:102},this._state,this]);i.indexOf(e.value)>-1?i.splice(i.indexOf(e.value),1):i.push(e.value);const n={};n[this._stateKey]=i,this.setState(n)}isSelected(t){return(this._state[this._stateKey]||[]).indexOf(t.value)>-1}}const Vc={passive:!1},Wc={capture:!0,passive:!1};function Ec(t){t.stopImmediatePropagation()}function Bc(t){t.preventDefault(),t.stopImmediatePropagation()}var Ic=t=>()=>t;function jc(t,{sourceEvent:e,subject:i,target:s,identifier:n,active:r,x:a,y:l,dx:o,dy:h,dispatch:c}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:i,enumerable:!0,configurable:!0},target:{value:s,enumerable:!0,configurable:!0},identifier:{value:n,enumerable:!0,configurable:!0},active:{value:r,enumerable:!0,configurable:!0},x:{value:a,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:o,enumerable:!0,configurable:!0},dy:{value:h,enumerable:!0,configurable:!0},_:{value:c}})}function Hc(t){return!t.ctrlKey&&!t.button}function Nc(){return this.parentNode}function Oc(t,e){return null==e?{x:t.x,y:t.y}:e}function Fc(){return navigator.maxTouchPoints||"ontouchstart"in this}function Pc(){var t,e,i,s,n=Hc,r=Nc,a=Oc,l=Fc,o={},h=uh("start","drag","end"),c=0,d=0;function u(t){t.on("mousedown.drag",_).filter(l).on("touchstart.drag",g).on("touchmove.drag",y,Vc).on("touchend.drag touchcancel.drag",m).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function _(a,l){if(!s&&n.call(this,a,l)){var o=x(this,r.call(this,a,l),a,l,"mouse");o&&(Wt(a.view).on("mousemove.drag",p,Wc).on("mouseup.drag",f,Wc),function(t){var e=t.document.documentElement,i=Wt(t).on("dragstart.drag",Bc,Wc);"onselectstart"in e?i.on("selectstart.drag",Bc,Wc):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}(a.view),Ec(a),i=!1,t=a.clientX,e=a.clientY,o("start",a))}}function p(s){if(Bc(s),!i){var n=s.clientX-t,r=s.clientY-e;i=n*n+r*r>d}o.mouse("drag",s)}function f(t){Wt(t.view).on("mousemove.drag mouseup.drag",null),function(t,e){var i=t.document.documentElement,s=Wt(t).on("dragstart.drag",null);e&&(s.on("click.drag",Bc,Wc),setTimeout((function(){s.on("click.drag",null)}),0)),"onselectstart"in i?s.on("selectstart.drag",null):(i.style.MozUserSelect=i.__noselect,delete i.__noselect)}(t.view,i),Bc(t),o.mouse("end",t)}function g(t,e){if(n.call(this,t,e)){var i,s,a=t.changedTouches,l=r.call(this,t,e),o=a.length;for(i=0;i<o;++i)(s=x(this,l,t,e,a[i].identifier,a[i]))&&(Ec(t),s("start",t,a[i]))}}function y(t){var e,i,s=t.changedTouches,n=s.length;for(e=0;e<n;++e)(i=o[s[e].identifier])&&(Bc(t),i("drag",t,s[e]))}function m(t){var e,i,n=t.changedTouches,r=n.length;for(s&&clearTimeout(s),s=setTimeout((function(){s=null}),500),e=0;e<r;++e)(i=o[n[e].identifier])&&(Ec(t),i("end",t,n[e]))}function x(t,e,i,s,n,r){var l,d,_,p=h.copy(),f=Et(r||i,e);if(null!=(_=a.call(t,new jc("beforestart",{sourceEvent:i,target:u,identifier:n,active:c,x:f[0],y:f[1],dx:0,dy:0,dispatch:p}),s)))return l=_.x-f[0]||0,d=_.y-f[1]||0,function i(r,a,h){var g,y=f;switch(r){case"start":o[n]=i,g=c++;break;case"end":delete o[n],--c;case"drag":f=Et(h||a,e),g=c}p.call(r,t,new jc(r,{sourceEvent:a,subject:_,target:u,identifier:n,active:g,x:f[0]+l,y:f[1]+d,dx:f[0]-y[0],dy:f[1]-y[1],dispatch:p}),s)}}return u.filter=function(t){return arguments.length?(n="function"==typeof t?t:Ic(!!t),u):n},u.container=function(t){return arguments.length?(r="function"==typeof t?t:Ic(t),u):r},u.subject=function(t){return arguments.length?(a="function"==typeof t?t:Ic(t),u):a},u.touchable=function(t){return arguments.length?(l="function"==typeof t?t:Ic(!!t),u):l},u.on=function(){var t=h.on.apply(h,arguments);return t===h?u:t},u.clickDistance=function(t){return arguments.length?(d=(t=+t)*t,u):Math.sqrt(d)},u}jc.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};class Uc extends Ga{constructor(t){super(t),this.defineDefaults({initialValue:null,label:null,range:[0,100],steps:null,blockSlider:!1,disable:[!1,!1],ticks:null,tickLabels:null,thumbLabel:!0,thumbLabelFormatter:t=>`${t}`,sliderWidth:t=>t,sliderHeight:t=>t,validation:t=>!0}),this._stateKey=null,this.style({tickLabel:{font:{size:12}},thumbLabel:{font:{size:12,weight:700,color:"#757575"}},margin:{left:18,top:18,right:18,bottom:30}}),this.textRenderer=null,this._handleKeyup=this._handleKeyup.bind(this),this._initialValueSet=!1,this._blockDistance=null}mapToState(t){return this._stateKey=t,this}checkSliderValue(){const t=this._state[this._stateKey];return this.isRangeSlider()?t[0]>=this._rangeValues()[0]&&t[0]<=this._rangeValues()[1]&&t[1]>=this._rangeValues()[0]&&t[1]<=this._rangeValues()[1]:t>=this._rangeValues()[0]&&t<=this._rangeValues()[1]}isRangeSlider(){return this._state[this._stateKey]instanceof Array&&this._state[this._stateKey].length>=2}init(t,e){super.init(t,e),this._node=t,"string"==typeof this._stateKey?!this.datasource||this.datasource.loaded?this._initSlider(t,e):this._initPostponed=!0:console.error("The value for a slider must be mapped to a state key.")}_initSlider(t,e){t.classList.add("dv_slider");const i=this._rangeValues();if(!this.checkSliderValue()||null!==this._initialValue&&!1===this._initialValueSet){this._initialValueSet=!0;const t={};this._initialValue?t[this._stateKey]=this._(this._initialValue,e,this):(console.warn("Initial slider value not valid. Setting to minimum value."),t[this._stateKey]=i[0]),this.setState(t)}Wt(t).append("line").attr("class","dv_bkgd"),Wt(t).append("line").attr("class","dv_curval"+(this.isRangeSlider()?" dv_range":"")),Wt(t).append("g").attr("class","dv_ticks"),Wt(t).append("g").attr("class","dv_focus"),this.textRenderer=new Se({width:300,textAlign:"center",fontSize:this._style.thumbLabel.font.size,fontWeight:this._style.thumbLabel.font.weight,fontColor:this._style.thumbLabel.font.color}),this._thumbLabel&&(Wt(t).append("g").attr("class","dv_thumbLabel dv_thumbLabel1"),this.isRangeSlider()&&Wt(t).append("g").attr("class","dv_thumbLabel dv_thumbLabel2"),this._style.margin.top+=this._style.thumbLabel.font.size),Wt(t).append("line").attr("class","dv_bkgd_hdl dv_noprint").on("click",this._handleClickOnLine.bind(this)),Wt(t).append("circle").attr("class","dv_val1").attr("role","slider"),this.isRangeSlider()&&Wt(t).append("circle").attr("class","dv_val2"),this.isRangeSlider()&&!0===this._blockSlider&&(Wt(t).append("rect").attr("class","dv_blockValue").style("fill","#fff").style("stroke","#000").style("stroke-width","1px"),Wt(t).append("rect").attr("class","dv_blockValueHandle dv_noprint").attr("role","slider").attr("tabindex","0").attr("aria-valuemax",i[0]).attr("aria-valuemin",i[1]).attr("aria-label","function"==typeof this._label?this._label(e,this):this._label).on("focus",this._handleFocus(-1).bind(this)).on("blur",this._handleBlur(-1).bind(this)).call(Pc().on("start",this._dragStart(-1).bind(this)).on("drag",this._drag(-1).bind(this)).on("end",this._dragEnd(-1).bind(this))).style("fill-opacity",0)),!1===this._disable[0]?Wt(t).append("circle").attr("class","dv_hdl1 dv_noprint").attr("role","slider").attr("tabindex","0").attr("aria-valuemax",i[0]).attr("aria-valuemin",i[1]).attr("aria-label","function"==typeof this._label?this._label(e,this):this._label).on("focus",this._handleFocus(1).bind(this)).on("blur",this._handleBlur(1).bind(this)).call(Pc().on("start",this._dragStart(1).bind(this)).on("drag",this._drag(1).bind(this)).on("end",this._dragEnd(1).bind(this))):Wt(t).append("circle").attr("class","dv_hdl1 dv_noprint").attr("role","slider").attr("tabindex","0").attr("aria-valuemax",i[0]).attr("aria-valuemin",i[1]).attr("aria-label","function"==typeof this._label?this._label(e,this):this._label),!1===this._disable[1]?this.isRangeSlider()&&Wt(t).append("circle").attr("class","dv_hdl2 dv_noprint").attr("role","slider").attr("tabindex","0").attr("aria-valuemax",i[0]).attr("aria-valuemin",i[1]).attr("aria-label","function"==typeof this._label?this._label(e,this):this._label).on("focus",this._handleFocus(2).bind(this)).on("blur",this._handleBlur(2).bind(this)).call(Pc().on("start",this._dragStart(2).bind(this)).on("drag",this._drag(2).bind(this)).on("end",this._dragEnd(2).bind(this))):this.isRangeSlider()&&Wt(t).append("circle").attr("class","dv_hdl2 dv_noprint").attr("role","slider").attr("tabindex","0").attr("aria-valuemax",i[0]).attr("aria-valuemin",i[1]).attr("aria-label","function"==typeof this._label?this._label(e,this):this._label)}prerender(t,e){if(super.prerender(t,e),this.datasource&&!this.datasource.loaded)return;this._initPostponed&&(this._initSlider(t,e),this._initPostponed=!1),this.emit("prerenderWillStart",[t,e,this]);const i=this._rangeValues();if(this._rangeSlider=this.isRangeSlider(),this._curval1=Gt(e[this._stateKey],i),this._curval2=null,this._rangeSlider&&(this._curval1=Gt(e[this._stateKey][0],i),this._curval2=Gt(e[this._stateKey][1],i),!0===this._blockSlider&&null===this._blockDistance&&(this._blockDistance=this._curval2-this._curval1)),this._calculateSteps(),this._calculateTicks(),this._calculateTickLabels(),"vertical"===this._orientation){this.viewRect.setWidth(this._tickLabels?80:40);const t="function"==typeof this._sliderHeight?this._sliderHeight(this.maxViewRect.height()):this._sliderHeight;this.viewRect.setHeight(t)}else{const t="function"==typeof this._sliderWidth?this._sliderWidth(this.maxViewRect.width(),e,this):this._sliderWidth;this.viewRect.setWidth(t);const i=this._style.margin.top+this._style.margin.bottom;this.viewRect.setHeight(this._tickLabels?i+this._style.tickLabel.font.size:i)}this.emit("prerenderDidEnd",[t,e,this])}render(t,e){if(this.datasource&&!this.datasource.loaded)return;this.emit("renderWillStart",[t,e,this]);const i=this._style;Wt(t).select("line.dv_bkgd").attr("x1",this.viewRect.left+i.margin.left).attr("y1",this.viewRect.top+i.margin.top).attr("x2",this.viewRect.right-i.margin.right).attr("y2",this.viewRect.top+i.margin.top),Wt(t).select("line.dv_bkgd_hdl").attr("x1",this.viewRect.left+i.margin.left).attr("y1",this.viewRect.top+i.margin.top).attr("x2",this.viewRect.right-i.margin.right).attr("y2",this.viewRect.top+i.margin.top),this._scale=on().domain(this._rangeValues()).range([this.viewRect.left+i.margin.left,this.viewRect.right-i.margin.right]).clamp(!0),Wt(t).select("circle.dv_val1").attr("cx",this._scale(this._curval1)).attr("cy",this.viewRect.top+i.margin.top).attr("r",7),Wt(t).select("circle.dv_hdl1").attr("cx",this._scale(this._curval1)).attr("cy",this.viewRect.top+i.margin.top).attr("r",16).attr("aria-valuenow",this._curval1),this._thumbLabel&&(Wt(t).select("g.dv_thumbLabel1").attr("transform",`translate(${this._scale(this._curval1)-150} ${this.viewRect.top})`),this.textRenderer.render(this._thumbLabelFormatter(this._curval1,e,this),this._node.querySelector("g.dv_thumbLabel1"),{})),"number"==typeof this._focusedVal&&Wt(this._node).select("g.dv_focus circle").attr("cx",this._scale(this[`_curval${this._focusedVal}`])).attr("cy",this.viewRect.top+i.margin.top),this._rangeSlider?(Wt(t).select("circle.dv_val2").attr("cx",this._scale(this._curval2)).attr("cy",this.viewRect.top+i.margin.top).attr("r",7),Wt(t).select("circle.dv_hdl2").attr("cx",this._scale(this._curval2)).attr("cy",this.viewRect.top+i.margin.top).attr("r",16).attr("aria-valuenow",this._curval2),this._thumbLabel&&(Wt(t).select("g.dv_thumbLabel2").attr("transform",`translate(${this._scale(this._curval2)-150} ${this.viewRect.top})`),this.textRenderer.render(this._thumbLabelFormatter(this._curval2,e,this),this._node.querySelector("g.dv_thumbLabel2"),{})),!0===this._blockSlider&&(Wt(t).select("rect.dv_blockValue").attr("x",.5*(this._scale(this._curval1)+this._scale(this._curval2))-10).attr("y",this.viewRect.top+i.margin.top-2).attr("width",20).attr("height",4),Wt(t).select("rect.dv_blockValueHandle").attr("x",.5*(this._scale(this._curval1)+this._scale(this._curval2))-16).attr("y",this.viewRect.top+i.margin.top-8).attr("width",32).attr("height",16)),Wt(t).select("line.dv_curval").attr("x1",this._scale(this._curval1)).attr("y1",this.viewRect.top+i.margin.top).attr("x2",this._scale(this._curval2)).attr("y2",this.viewRect.top+i.margin.top)):Wt(t).select("line.dv_curval").attr("x1",this.viewRect.left+i.margin.left).attr("y1",this.viewRect.top+i.margin.top).attr("x2",this._scale(this._curval1)).attr("y2",this.viewRect.top+i.margin.top),this._calculatedTicks&&Wt(t).select("g.dv_ticks").selectAll("line").data(this._calculatedTicks).join("line").attr("x1",(t=>this._scale(t))).attr("y1",this.viewRect.top+i.margin.top-3).attr("x2",(t=>this._scale(t))).attr("y2",this.viewRect.top+i.margin.top+3),this._calculatedTickLabels&&Wt(t).select("g.dv_ticks").selectAll("text").data(this._calculatedTickLabels).join("text").text((t=>t)).attr("text-anchor","middle").style("font-size",`${this._style.tickLabel.font.size}px`).attr("x",(t=>this._scale(t))).attr("y",this.viewRect.top+i.margin.top+i.tickLabel.font.size+15),this.emit("renderWillEnd",[t,e,this])}_setSingleValue(t){return e=>{if(this[`_curval${t}`]=e,Wt(this._node).select(`circle.dv_val${t}`).attr("cx",this._scale(this._snapValue(this[`_curval${t}`]))).attr("aria-valuenow",this._snapValue(this[`_curval${t}`])),Wt(this._node).select("g.dv_focus circle").attr("cx",this._scale(this._snapValue(this[`_curval${t}`]))),this._thumbLabel){const e=this._scale(this._snapValue(this[`_curval${t}`]))-150;Wt(this._node).select(`g.dv_thumbLabel${t}`).attr("transform",`translate(${e} ${this.viewRect.top})`),this.textRenderer.render(this._thumbLabelFormatter(this._snapValue(this[`_curval${t}`]),this._state,this),this._node.querySelector(`g.dv_thumbLabel${t}`),{})}this._rangeSlider?Wt(this._node).select("line.dv_curval").attr("x1",this._scale(this._snapValue(this._curval1))).attr("x2",this._scale(this._snapValue(this._curval2))):Wt(this._node).select("line.dv_curval").attr("x2",this._scale(this._snapValue(this._curval1)))}}_setBlockValue(t){return e=>{const i=this._blockDistance/2;switch(t){case 1:this._curval1=Math.min(e,this._range[1]-2*i),this._curval2=Math.max(e+2*i,this._range[0]+2*i);break;case 2:this._curval2=Math.max(e,this._range[0]+2*i),this._curval1=Math.min(e-2*i,this._range[1]-2*i);break;default:this._curval1=Math.min(e-i,this._range[1]-2*i),this._curval2=Math.max(e+i,this._range[0]+2*i)}if(Wt(this._node).select("circle.dv_val1").attr("cx",this._scale(this._snapValue(this._curval1))).attr("aria-valuenow",this._snapValue(this._curval1)),Wt(this._node).select("circle.dv_val2").attr("cx",this._scale(this._snapValue(this._curval2))).attr("aria-valuenow",this._snapValue(this._curval2)),Wt(this._node).select("rect.dv_blockValue").attr("x",.5*(this._scale(this._snapValue(this._curval2))+this._scale(this._snapValue(this._curval1)))-10),this._thumbLabel)for(let t=1;t<=2;t++){const e=this._scale(this._snapValue(this[`_curval${t}`]))-150;Wt(this._node).select(`g.dv_thumbLabel${t}`).attr("transform",`translate(${e} ${this.viewRect.top})`),this.textRenderer.render(this._thumbLabelFormatter(this._snapValue(this[`_curval${t}`]),this._state,this),this._node.querySelector(`g.dv_thumbLabel${t}`),{})}Wt(this._node).select("line.dv_curval").attr("x1",this._scale(this._snapValue(this._curval1))).attr("x2",this._scale(this._snapValue(this._curval2))),t>0?Wt(this._node).select("g.dv_focus circle").attr("cx",this._scale(this._snapValue(this[`_curval${t}`]))):Wt(this._node).select("g.dv_focus rect").attr("x",.5*(this._scale(this._snapValue(this._curval2))+this._scale(this._snapValue(this._curval1)))-16)}}_snapValue(t){if(null===this._calculatedSteps)return t;let e=1/0,i=null;return this._calculatedSteps.forEach((s=>{const n=Math.abs(t-s);n<e&&(e=n,i=s)})),i}_rangeValues(){return"function"==typeof this._range?this._range(this._state,this):this._range}_calculateSteps(){if(this._calculatedSteps=null,this._steps instanceof Array&&(this._calculatedSteps=this._steps),"number"==typeof this._steps){let t=this._rangeValues()[0];for(this._calculatedSteps=[];t<this._rangeValues()[1];)this._calculatedSteps.push(t),t+=this._steps}"function"==typeof this._steps&&(this._calculatedSteps=this._steps(this._state,this)),this._calculatedSteps&&this._calculatedSteps.indexOf(this._rangeValues()[0])<0&&this._calculatedSteps.unshift(this._rangeValues()[0]),this._calculatedSteps&&this._calculatedSteps.indexOf(this._rangeValues()[1])<0&&this._calculatedSteps.push(this._rangeValues()[1])}_increase(t){if(t<0)return;let e=null;if(this._calculatedSteps){const i=this._calculatedSteps.indexOf(this[`_curval${t}`]),s=Math.min(i+1,this._calculatedSteps.length-1);e=this._calculatedSteps[s]}else e=Math.min(this[`_curval${t}`]+(this._rangeValues()[1]-this._rangeValues()[0])/50,this._rangeValues()[1]);this.isRangeSlider()&&1===t&&e>this._curval2?(this._curval2=e,Wt(this._node).select("circle.dv_hdl2").node().focus()):this[`_curval${t}`]=e,!0===this._blockSlider&&(1===t?(this._curval1=Math.min(e,this._range[1]-this._blockDistance),this._curval2=this._curval1+this._blockDistance):this._curval1=e-this._blockDistance),this._saveValueToState()}_decrease(t){if(t<0)return;let e=null;if(this._calculatedSteps){const i=this._calculatedSteps.indexOf(this[`_curval${t}`]),s=Math.max(i-1,0);e=this._calculatedSteps[s]}else e=Math.max(this[`_curval${t}`]-(this._rangeValues()[1]-this._rangeValues()[0])/50,this._rangeValues()[0]);this.isRangeSlider()&&2===t&&e<this._curval1?(this._curval1=e,Wt(this._node).select("circle.dv_hdl1").node().focus()):this[`_curval${t}`]=e,!0===this._blockSlider&&(1===t?this._curval2=this._curval1+this._blockDistance:(this._curval2=Math.max(e,this._range[0]+this._blockDistance),this._curval1=this._curval2-this._blockDistance)),this._saveValueToState()}_calculateTicks(){if(this._calculatedTicks=null,null!==this._ticks){if(this._ticks instanceof Array&&(this._calculatedTicks=this._ticks),"number"==typeof this._ticks){let t=this._rangeValues()[0];for(this._calculatedTicks=[];t<this._rangeValues()[1]+this._ticks;)this._calculatedTicks.push(t),t+=this._ticks}"function"==typeof this._ticks&&(this._calculatedTicks=this._ticks(this._state,this))}}_calculateTickLabels(){if(this._calculatedTickLabels=null,null!==this._tickLabels){if(this._tickLabels instanceof Array&&(this._calculatedTickLabels=this._tickLabels),"number"==typeof this._tickLabels){let t=this._rangeValues()[0];for(this._calculatedTickLabels=[];t<=this._rangeValues()[1];)this._calculatedTickLabels.push(t),t+=this._tickLabels}"function"==typeof this._tickLabels&&(this._calculatedTickLabels=this._tickLabels(this._state,this))}}_dragStart(t){return()=>{t>0&&Wt(this._node).select(`circle.dv_val${t}`).attr("r",8).style("cursor","move"),document.body.style.cursor="move"}}_drag(t){return e=>{!0===this._blockSlider?this._setBlockValue(t)(this._scale.invert(e.x)):this._setSingleValue(t)(this._scale.invert(e.x))}}_dragEnd(t){return()=>{t>0&&Wt(this._node).select(`circle.dv_val${t}`).attr("r",7).style("cursor","grab"),document.body.style.cursor=null,this.isRangeSlider()&&this._curval1>this._curval2&&Wt(this._node).select("circle.dv_hdl"+(1===t?2:1)).node().focus(),this._saveValueToState()}}_saveValueToState(){const t={},e=this._snapValue(this._curval1);if(this._rangeSlider){Wt(this._node).select("circle.dv_val2").attr("r",8);const i=this._snapValue(this._curval2);t[this._stateKey]=[Math.min(e,i),Math.max(e,i)]}else t[this._stateKey]=e;this._validation(t)?this.setState(t):this.setState(this._state)}_handleFocus(t){return e=>{document.addEventListener("keydown",this._handleKeyup),this._focusedVal=t,t>0?Wt(this._node).select("g.dv_focus").append("circle").attr("r",16).attr("cx",this._scale(this[`_curval${t}`])).attr("cy",this.viewRect.top+this._style.margin.top):Wt(this._node).select("g.dv_focus").append("rect").attr("width",32).attr("height",20).attr("x",.5*(this._scale(this._snapValue(this._curval2))+this._scale(this._snapValue(this._curval1)))-16).attr("y",this.viewRect.top+this._style.margin.top-10)}}_handleBlur(t){return t=>{document.removeEventListener("keydown",this._handleKeyup),this._focusedVal=null,Wt(this._node).select("g.dv_focus circle").remove(),Wt(this._node).select("g.dv_focus rect").remove()}}_handleKeyup(t){"ArrowLeft"!==t.key&&"ArrowDown"!==t.key||this._decrease(this._focusedVal),"ArrowRight"!==t.key&&"ArrowUp"!==t.key||this._increase(this._focusedVal)}_handleClickOnLine(t){const e=this._scale.invert(this._toLocalPoint(t).x);this._rangeSlider&&Math.abs(e-this._curval1)>Math.abs(e-this._curval2)?(this._curval2=e,Wt(this._node).select("circle.dv_hdl2").node().focus()):(this._curval1=e,Wt(this._node).select("circle.dv_hdl1").node().focus()),this._saveValueToState()}_toLocalPoint(t){const e=Wt(this._node).select("line.dv_bkgd").node(),i=e.getBoundingClientRect(),s=i.x-e.getAttribute("x1"),n=i.y+i.height/2-e.getAttribute("y1");return{x:t.x-s,y:t.y-n}}}class qc{constructor(t,e,i,s){this.node=t,this.vizid=e,this.lang=i,this.opts=s||{},this.uid=this.node.getAttribute("data-uid"),this.onload=this.opts.onload||function(){},this.iframe=null,this.element_attributes=this.opts.attributes||{},this.config=this.opts.config||{},Object.keys(this.config).forEach((t=>{try{const e=JSON.parse(this.config[t]);this.config[t]=e}catch(t){}})),this.state=this.opts.state||{},Object.keys(this.state).forEach((t=>{try{const e=JSON.parse(this.state[t]);this.state[t]=e}catch(t){}})),this.stateSetAfterOnload=!1,this.build()}build(){if(console.info(`Creating new widget: ${this.vizid}`),(t=this.vizid).startsWith("http://")||t.startsWith("https://")||t.startsWith("./")||t.startsWith("/"))console.info("vizid looks like a valid URL. Ignoring the language setting."),this.vizurl=this.vizid;else{const t=vc(this.vizid,this.lang),e=window.location.origin;this.vizurl=`${e}${t.assetPath}`}var t;const e=document.createElement("iframe");e.setAttribute("id",this.uid),e.setAttribute("allow","clipboard-write 'src'; fullscreen 'src'"),e.setAttribute("allowFullScreen","true"),e.src=this.vizurl,e.style.display="block",e.style.border="0",e.style.width="100%",e.style.minWidth="100%",this.node.innerHTML="",this.node.appendChild(e),this.iframe=e}init(){!0!==this.stateSetAfterOnload&&(this.stateSetAfterOnload=!0,0===Object.keys(this.state).length&&0===Object.keys(this.config).length||(console.info("Setting iframe config and state:\n",`. ID:     ${this.iframe.id}\n`,`. State:  ${JSON.stringify(this.state)}\n`,`. Config: ${JSON.stringify(this.config)}`),this.iframe.contentWindow.postMessage({type:"setState",data:{state:this.state,config:this.config}},"*")))}}const Xc={qualitative:i,themes:{languages:s,religions:n,economicSectors:r,education:a,votes:l,gender:o,countries:h,nationality:c,importExport:d},sequential:{blue1:_,blue2:p,blue3:f,blue4:g,blue5:y,blue6:m,blue7:x,blue8:v,blue9:b,blue10:w}},Yc=new class{constructor(){this.widgets=[],this.subscribers={},window.addEventListener("message",this.handleMessage.bind(this))}init(){return document.querySelectorAll("div.fso-datavis-widget").forEach((t=>{if(t.getAttribute("data-uid"))return;const e=this.createWidget(t);null!==e&&this.widgets.push(e)})),this}createWidget(t){const e=We();t.setAttribute("data-uid",e);const i=t.getAttribute("name")||"",s=t.getAttribute("data-vizid"),n=t.getAttribute("data-lang")||"de";console.info(`New widget found: ${i} [vizid: ${s} uid:${e}]`);const r={},a={};for(let e=0;e<t.attributes.length;e++)0===t.attributes[e].name.indexOf("data-state-")&&(a[t.attributes[e].name.substring(11)]=t.attributes[e].value),0===t.attributes[e].name.indexOf("data-config-")&&(r[t.attributes[e].name.substring(12)]=t.attributes[e].value);return new qc(t,s,n,{state:a,config:r})}handleMessage(t){if(!t.data||!t.data.type)return;const e=this.widgetForEvent(t);if(null===e)return;const i=t.data;if(!i||"object"!=typeof i||!i.type||!i.data)return;const s=i.type||null;if(!s)return;const n=i.data;switch(s){case"ready":this.handleReady(e,n);break;case"resize":this.handleResize(e,n);break;default:this.publish(s,n,e)}}handleReady(t,e){t.init()}handleResize(t,e){t.iframe.style.height=`${e.document.height}px`}publish(t,e,i){(this.subscribers[t]||[]).forEach((t=>{t(e,i)})),this.widgets.forEach((s=>{i!==s&&s.iframe.contentWindow.postMessage({type:t,data:e},"*")}))}subscribe(t,e){this.subscribers[t]||(this.subscribers[t]=[]),this.subscribers[t].push(e)}unsubscribe(t,e){this.subscribers[t]&&(this.subscribers[t]=e?this.subscribers[t].filter((t=>t!==e)):[])}unsubscribeAll(t){this.subscribers[t]&&(this.subscribers[t]=[])}widgetForEvent(t){for(let e=0;e<this.widgets.length;e++){const i=this.widgets[e];if(i.iframe.contentWindow===t.source)return i}return null}};"interactive"===document.readyState||"complete"===document.readyState?Yc.init():document.addEventListener("DOMContentLoaded",(()=>{Yc.init()})),t.AreaChart=po,t.BarChart=Ya,t.Box=Ce,t.ButterflyChart=fo,t.CategoricalLegend=Na,t.Chart=Ea,t.Checkboxes=$c,t.ColumnChart=to,t.ContentBox=ze,t.Control=Ga,t.CustomBox=yc,t.CustomChart=Ba,t.CustomControl=mc,t.DataSource=ci,t.DividedBarChart=Ql,t.DonutChart=uc,t.DotChart=go,t.Dropdown=Rc,t.EmbedControl=Ac,t.ExportControl=Mc,t.FlexBox=Fe,t.Grid=Ue,t.GroupedBarChart=Ja,t.GroupedColumnChart=io,t.Layout=He,t.LineChart=uo,t.LineColumnChart=mo,t.Marimekko=Xo,t.PieChart=pc,t.RadarChart=fc,t.RadioButtons=Dc,t.Rect=ne,t.Sankey=ch,t.ScatterPlot=xo,t.Selection=Ne,t.Slider=Uc,t.SlopeChart=vo,t.StackedBarChart=Jl,t.StackedColumnChart=so,t.TextBox=Ee,t.TextRenderer=Se,t.Tooltip=Za,t.Treemap=cc,t.areaChart=function(t={}){return new po(t)},t.barChart=function(t={}){return new Ya(t)},t.box=function(t){return new yc(t)},t.butterflyChart=function(t={}){return new fo(t)},t.categoricalLegend=function(t){return new Na(t)},t.chart=function(t){return new Ba(t)},t.checkboxes=function(){return new $c},t.colors=Xc,t.columnChart=function(t={}){return new to(t)},t.control=function(){return new mc},t.dataSource=function(){return new ci},t.defaultTextStyle=ke,t.dividedBarChart=function(){return new Ql},t.donutChart=function(){return new uc},t.dotChart=function(t={}){return new go(t)},t.dropdown=function(){return new Rc},t.embedControl=function(t,e={}){return new Ac(t,e)},t.exportControl=function(t){return new Mc(t)},t.flexBox=function(t){return new Fe(t)},t.grid=function(){return new Ue},t.groupedBarChart=function(t={}){return new Ja(t)},t.groupedColumnChart=function(){return new io},t.horizontalBarChart=function(t={}){return new Ya(t)},t.lineChart=function(t={}){return new uo(t)},t.lineColumnChart=function(t={},e){return new mo(t,e)},t.managedState=function(t={}){return t._={layouts:[],register:function(t){this.layouts.push(t)},stateDidUpdate:function(e=!0){if(this.layouts.forEach((t=>t.stateDidUpdate())),e){const e={};Object.keys(t).forEach((i=>{i.startsWith("_")||(e[i]=t[i])})),this.sendMessage("setState",{state:e})}},update:function(e){0!==Object.keys(e).length&&(Object.assign(t,e),this.stateDidUpdate())},sendMessage:function(e,i){dynvis.widgetManager.publish(e,i,t)},handleSetState:function(e,i){i!==t&&(Object.assign(t,e.state),this.stateDidUpdate(!1))},on:function(t,e){dynvis.widgetManager.subscribe(t,e)},off:function(t,e=null){e?dynvis.widgetManager.unsubscribe(t,e):dynvis.widgetManager.unsubscribeAll(t)}},dynvis.widgetManager.subscribe("setState",t._.handleSetState.bind(t._)),t},t.marimekko=function(t){return new Xo(t)},t.pieChart=function(){return new pc},t.radarChart=function(){return new fc},t.radioButtons=function(){return new Dc},t.rect=function(t,e,i,s){return new ne(t,e,i,s)},t.sankey=function(t){return new ch(t)},t.scaleBand=Da,t.scatterPlot=function(){return new xo},t.select=function(t){return new Ne(t)},t.slider=function(){return new Uc},t.slopeChart=function(){return new vo},t.stackedBarChart=function(t={}){return new Jl(t)},t.stackedColumnChart=function(t={}){return new so(t)},t.symbol=Xa,t.textBox=function(t,e){const i="string"==typeof t||"function"==typeof t?t:null;return new Ee(i||"",(null===i?t:e)||{})},t.textRenderer=function(t={}){return new Se(t)},t.tooltip=function(t={}){return new Za(t)},t.treemap=function(t){return new cc(t)},t.verticalBarChart=function(t={}){return new to(t)},t.widgetManager=Yc,Object.defineProperty(t,"__esModule",{value:!0})}));
